const { join } = require('path');
const getMocks = require('./mocks');
const getUtils = require('./utils');

// https://tenner-joshua.gitbook.io/as-pect/cli-configuration

const runtimePath = join(__dirname, '../assembly/runtime/aspect.ts');

module.exports = {
  include: ['assembly/**/*.spec.ts', 'contract/assembly/**/*.spec.ts'],
  disclude: [/node_modules/],
  outputBinary: false,
  flags: {
    '--exportRuntime': [],
    '--runtime': ['stub'],
    '--transform': [join(__dirname, 'transform.js')],
  },
  imports: (memory, createImports, instantiateSync, binary) => {
    const context = getUtils(memory);
    const env = getMocks(context);
    const wasmModule = instantiateSync(binary, createImports({ env }));
    return wasmModule;
  },
};
