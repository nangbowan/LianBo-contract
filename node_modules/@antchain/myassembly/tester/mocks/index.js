const glob = require('glob');
const { join, basename, extname } = require('path');

const mocksPath = join(__dirname);

// mocks 目录中的每个文件都是一个 mock api
const mocks = glob.sync('**/*.js', { cwd: mocksPath }).map((file) => {
  const name = basename(file, extname(file));
  const fn = require(join(mocksPath, name));
  return [name, fn];
});

const getMocks = function (context) {
  return Object.fromEntries(
    mocks
      .map(([name, fn]) => {
        if (name === 'index') return null;
        return [name, (...args) => fn(context)(...args)];
      })
      .filter(Boolean),
  );
};

module.exports = getMocks;
