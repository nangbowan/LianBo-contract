"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("debug"),t=require("bignumber.js"),r=require("crypto-js"),n=require("crypto-js/sha3"),o=require("safe-buffer"),s=require("rlp"),a=require("secp256k1"),i=require("md5.js"),c=require("public-encrypt/browser"),u=require("browserify-aes/browser"),p=require("create-hash"),f=require("js-encoding-utils"),y=require("elliptic"),d=require("asn1.js"),h=require("bn.js"),l=require("fcbuffer"),m=require("node-forge"),g=require("events"),_=require("tls"),v=require("nanoid"),b=require("axios"),C=require("uuid"),q=require("json-rpc-engine"),E=require("json-rpc-middleware-stream"),w=require("pump");function x(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var T=x(e),k=x(t),S=x(n),P=x(i),B=x(c),R=x(p),N=x(f),I=x(h),A=x(l),K=x(m),O=x(g),D=x(_),L=x(b),M=x(w);function W(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function j(e){for(var t=1;arguments.length>t;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?W(Object(r),!0).forEach((function(t){F(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):W(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function U(e,t,r,n,o,s,a){try{var i=e[s](a),c=i.value}catch(e){return void r(e)}i.done?t(c):Promise.resolve(c).then(n,o)}function z(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var s=e.apply(t,r);function a(e){U(s,n,o,a,i,"next",e)}function i(e){U(s,n,o,a,i,"throw",e)}a(void 0)}))}}function F(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function H(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);t>r;r++)n[r]=e[r];return n}function V(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return H(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?H(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,o=function(){};return{s:o,n:function(){return e.length>n?{done:!1,value:e[n++]}:{done:!0}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,a=!0,i=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return a=e.done,e},e:function(e){i=!0,s=e},f:function(){try{a||null==r.return||r.return()}finally{if(i)throw s}}}}const Q="1"===process.env.MYFISH_DEBUG,$="development"===process.env.NODE_ENV,Y=require("is-electron")(),J="undefined"==typeof window&&"undefined"==typeof chrome&&!Y,G="undefined"!=typeof chrome&&"undefined"==typeof window,X=()=>T.default.enable("antchain:*");function Z(e){return($||Q)&&X(),T.default(e)}"undefined"!=typeof window&&(window.enableDebug=X),"undefined"!=typeof globalThis&&(globalThis.enableDebug=X);const ee=Z("antchain:jssdk");var te,re,ne,oe,se;(te=exports.ContractType||(exports.ContractType={})).assemblyscript="assemblyscript",te.solidity="solidity",(re=exports.VmType||(exports.VmType={})).WASM="WASM",re.EVM="EVM",(ne=exports.TxType||(exports.TxType={})).TX_DEPLOY_CONTRACT="TX_DEPLOY_CONTRACT",ne.CALL_CONTRACT="CALL_CONTRACT",(oe=exports.MychainMethods||(exports.MychainMethods={})).queryBlock="QueryBlock",oe.queryLastBlock="QueryLastBlock",oe.queryTransaction="QueryTransaction",oe.queryTransactionReceipt="QueryTransactionReceipt",oe.queryAccount="QueryAccount",oe.queryContract="QueryContract",oe.deployContract="DeployContract",oe.updateContract="UpdateContract",oe.callContract="CallContract",oe.encryptedTransaction="EncryptedTransaction",oe.LocalTransaction="LocalTransaction",(se=exports.RestMethods||(exports.RestMethods={})).queryBlock="QUERYBLOCKBODY",se.queryBlockHeader="QUERYBLOCK",se.queryLastBlock="QUERYLASTBLOCK",se.queryTransactionFromBlockchain="QUERYTRANSACTIONFROMBLOCKCHAIN",se.queryTransactionReceipt="QUERYRECEIPT",se.queryAccount="QUERYACCOUNT",se.queryContract="QUERYCONTRACT",se.deploySolidityContractForBizAsync="DEPLOYCONTRACTFORBIZASYNC",se.updateSolidityContractForBizAsync="UPDATECONTRACTFORBIZASYNC",se.deployWasmContractForBiz="DEPLOYWASMCONTRACT",se.updateWasmContractForBiz="UPDATECONTRACTFORBIZ",se.deployWasmContract="DEPLOYCONTRACT",se.updateWasmContract="UPDATECONTRACT",se.callWasmContractForBiz="CALLWASMCONTRACT",se.callWasmContractForBizAsync="CALLWASMCONTRACTASYNC",se.callWasmContract="CALLWASMCONTRACT",se.callContract="CALLCONTRACT",se.createAccountForBiz="TENANTCREATEACCUNT";const ae={default:"/api/contract/chainCall",[exports.RestMethods.callWasmContract]:"/api/contract/chainCallForBiz"};var ie,ce;(ie=exports.WalletMethods||(exports.WalletMethods={})).queryBlockHeader="antchain_queryBlockHeader",ie.queryBlock="antchain_queryBlock",ie.queryLastBlock="antchain_queryLastBlock",ie.queryTransaction="antchain_queryTransaction",ie.queryTransactionReceipt="antchain_queryTransactionReceipt",ie.queryAccount="antchain_queryAccount",ie.queryContract="antchain_queryContract",ie.sign="antchain_sign",ie.deployContract="antchain_deployContract",ie.deployWasmContract="antchain_deployWasmContract",ie.deploySolidityContract="antchain_deploySolidityContract",ie.callContract="antchain_callContract",ie.callWasmContract="antchain_callWasmContract",ie.callSolidityContract="antchain_callSolidityContract",ie.getProviderState="antchain_getProviderState",ie.requestAccounts="antchain_requestAccounts",ie.subscription="antchain_subscription";class ue extends Error{constructor(e,t,r){super(e),this.code=void 0,this.data=void 0,this.name="AntchainSDKError",this.code=t,this.data=r}}(ce=exports.EventListenerType||(exports.EventListenerType={}))[ce.ACCOUNT=0]="ACCOUNT",ce[ce.CONTRACT=1]="CONTRACT",ce[ce.TOPICS=2]="TOPICS",ce[ce.BLOCK=3]="BLOCK";class pe{constructor(e,t){this.options=void 0,this.provider=void 0,this.contractName=void 0,this.contractType=void 0,this.vmType=void 0,this.abi=void 0,ee("[Contract] new contarct with options:",e),this.options=e,this.provider=t;const r=e.contractType,n=void 0===r?exports.ContractType.assemblyscript:r,o=e.abi;this.contractName=e.contractName,this.contractType=n,this.vmType=n===exports.ContractType.solidity?exports.VmType.EVM:exports.VmType.WASM,this.abi="object"==typeof o?JSON.stringify(o):o}on(e,t){this.provider.watchContractEvent(this,e,t)}deploy(e,t){var r=this;return z((function*(){return(t||{}).update?r.provider.updateContract(r,e):r.provider.deployContract(r,e)}))()}call(e){var t=this;return z((function*(){if(1!==t.provider.majorVersion){if(t.vmType===exports.VmType.EVM)throw Error("当前版本的连接器不支持调用 Solidity 合约，请升级。");return t.provider.callContract(j({contractName:t.contractName,vmType:t.vmType,abi:t.abi},e))}return t.provider.callContract(t,e)}))()}generateDeployCode(e,t){throw Error("不能直接调用 Contract 类的 generateDeployCode")}generateCallCode(e,t){throw Error("不能直接调用 Contract 类的 generateCallCode")}parseReturnOutput(e,t){throw Error("不能直接调用 Contract 类的 generateCallCode")}}var fe,ye,de,he=String.fromCharCode;function le(e){for(var t,r,n=[],o=0,s=e.length;s>o;)55296>(t=e.charCodeAt(o++))||t>56319||o>=s?n.push(t):56320==(64512&(r=e.charCodeAt(o++)))?n.push(((1023&t)<<10)+(1023&r)+65536):(n.push(t),o--);return n}function me(e){if(e>=55296&&57343>=e)throw Error("Lone surrogate U+"+e.toString(16).toUpperCase()+" is not a scalar value")}function ge(e,t){return he(e>>t&63|128)}function _e(e){if(0==(4294967168&e))return he(e);var t="";return 0==(4294965248&e)?t=he(e>>6&31|192):0==(4294901760&e)?(me(e),t=he(e>>12&15|224),t+=ge(e,6)):0==(4292870144&e)&&(t=he(e>>18&7|240),t+=ge(e,12),t+=ge(e,6)),t+=he(63&e|128)}function ve(){if(de>=ye)throw Error("Invalid byte index");var e=255&fe[de];if(de++,128==(192&e))return 63&e;throw Error("Invalid continuation byte")}const be=function(e){for(var t=le(e),r=t.length,n=-1,o="";++n<r;)o+=_e(t[n]);return o},Ce=function(e){fe=le(e),ye=fe.length,de=0;for(var t,r,n,o=[];!1!==(r=void 0,n=void 0,t=de!=ye&&(r=255&fe[de],de++,0==(128&r)?r:192!=(224&r)||128>(n=(31&r)<<6|ve())?224!=(240&r)||2048>(n=(15&r)<<12|ve()<<6|ve())?240!=(248&r)||65536>(n=(7&r)<<18|ve()<<12|ve()<<6|ve())||n>1114111?void 0:n:(me(n),n):n));)o.push(t);return function(e){for(var t,r=e.length,n=-1,o="";++n<r;)(t=e[n])>65535&&(o+=he((t-=65536)>>>10&1023|55296),t=56320|1023&t),o+=he(t);return o}(o)};function qe(e,t){let n=e;return"hex"===t&&(n.length>2&&"0x"===n.substr(0,2)&&(n=n.substr(2)),n=r.enc.Hex.parse(n)),""+S.default(n,{outputLength:256})}function Ee(e,t){let n="0x";t&&(n="");let o=e.toString("hex");if(Te(e)){if("0x"!==e.substr(0,2))return n+""+r.SHA256(e);o=e.substr(2)}const s=r.enc.Hex.parse(o);return n+r.SHA256(s).toString(r.enc.Hex)}function we(e){return o.Buffer.isBuffer(e)}function xe(e){return e&&(e instanceof k.default||e.constructor&&"BigNumber"===e.constructor.name)}function Te(e){return"string"==typeof e||e&&e.constructor&&"String"===e.constructor.name}function ke(e){return null!==e&&!Array.isArray(e)&&"object"==typeof e}function Se(e){return Array.isArray(e)}function Pe(e,t){let r=e,n=t;if(we(r))return r;"number"==typeof r&&(r=r.toString(16)),Te(r)&&0===r.indexOf("0x")&&(r=r.slice(2)),n||(n=Math.ceil(r.length/2));const s=o.Buffer.alloc(n);for(let e=0;n>e;e++){const t=r.slice(2*e,2*e+2)||"00";s.write(t,e,1,"hex")}return s}function Be(e,t,r){return function(e,t,r){return parseInt(t)>e.length?Array(parseInt(t)-e.length+1).join(r||"0")+e:e}(e,t,r)}function Re(e,t,r){return parseInt(t)>e.length?e+Array(parseInt(t)-e.length+1).join(r||"0"):e}function Ne(e,t,r){return Re(e,t,r)}function Ie(e,t){const r=e||0;return xe(r)?r:Te(r)?0===r.indexOf("0x")||0===r.indexOf("-0x")?new k.default(r.replace("0x",""),16):new k.default(r,t||16):new k.default(r.toString(10),10)}function Ae(e,t){return Ie(e,t).toNumber()}function Ke(e,t){let r="0x";t&&(r="");const n=Ie(e),o=n.toString(16);return n.lessThan(0)?"-"+r+o.substr(1):r+o}function Oe(e,t,r){const n=be(e);let o="";for(let e=0;n.length>e;e++){const r=n.charCodeAt(e);if(0===r){if(!t)break;o+="00"}else{const e=r.toString(16);o+=2>e.length?"0"+e:e}}let s="0x";return r&&(s=""),s+o}function De(e,t){let r="0x";return t&&(r=""),we(e)?r+e.toString("hex"):Me(e,t)}function Le(e){return Ce(function(e,t){let r="",n=0;for("0x"===e.substring(0,2)&&(n=2);e.length>n;n+=2){const o=parseInt(e.substr(n,2),16);if(t&&0===o)break;r+=String.fromCharCode(o)}return r}(e))}function Me(e,t){return"boolean"==typeof e?Ke(+e,t):xe(e)?Ke(e,t):"object"==typeof e?Oe(JSON.stringify(e),!1,t):Te(e)?0===e.indexOf("-0x")?function(e,t){return Ke(e,t)}(e,t):0===e.indexOf("0x")?e:Oe(e,1,t):Ke(e,t)}function We(e){const t=Ie(e).round();return t.lessThan(0)?new k.default("ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff",16).plus(t).plus(1):t}function je(e){let t=e;return Te(t)?("0x"===t.substr(0,2)&&(t=t.substr(2)),o.Buffer.from(t,"hex")):t}function Ue(e){return e.readInt32BE(0)}function ze(e){return s.encode(e)}function Fe(e,t){return De(ze(e),t)}function He(e){return s.decode(e)}function Ve(e,t,r){this.tag=t,o.Buffer.isBuffer(e)?this.encode(e,t,r):e&&this.decode(e.toString("ascii").trim(),r)}Ve.prototype.toString=function(){return this.pem},Ve.prototype.toBuffer=function(){return this.buf},Ve.prototype.decode=function(e,t){e&&(this.pem=e.toString("ascii").trim());const n=this.pem.split(/\r?\n/),s=n[0].match(/\-\-\-\-\-\s*BEGIN ?([^-]+)?\-\-\-\-\-/);if(!s)throw Error("parse PEM: BEGIN not found");let a;if(this.tag=s[1],n.shift(),"Proc-Type: 4,ENCRYPTED"===n[0]){if("string"!=typeof t)throw Error("PEM is encrypted but no passphrase given");a=n[1].match(/DEK-Info: ([^,]+),([0-9A-F]+)/i),n.splice(0,3);const e=a[1].toLowerCase(),s=o.Buffer(a[2],"hex"),i=function(e,t,r){let n=r,s=Qe[e];if(!s){throw new TypeError("Unsupported type. Allowed: "+Object.keys(Qe))}let a=n.length;const i=8;n.length!==i&&(n=n.slice(0,i));const c=16;let u,p=!1;const f=new o.Buffer(s);let y=0;for(;;){const e=new P.default;p?e.update(u):p=!0,e.update(t),e.update(n),u=e.digest();let r=0;for(;s&&c>r;)f[y++]=u[r],s--,r++;const o=Math.min(a,c-r);if(a-=o,r+=o,0==s&&0==a)break}return f}
/**
 * @fileOverview
 * @name base64x-1.1.js
 * @author Kenji Urushima kenji.urushima@gmail.com
 * @version jsrsasign 8.0.12 base64x 1.1.14 (2018-Apr-22)
 * @since jsrsasign 2.1
 * @license <a href="https://kjur.github.io/jsrsasign/license/">MIT License</a>
 */(e.toUpperCase(),t,s);n.pop();const c=n.join("").toString("hex"),u=r.enc.Hex.parse(i.toString("hex")),p=r.AES.decrypt(c,u,{iv:r.enc.Hex.parse(s.toString("hex")),padding:r.pad.NoPadding,mode:r.mode.CBC});a&&(this.buf=o.Buffer(p.toString(r.enc.Hex),"hex"))}return this.pem="-----BEGIN"+(this.tag?" "+this.tag:"")+"-----\n"+o.Buffer(this.buf).toString("base64").match(/.{1,64}/g).join("\n")+"\n-----END"+(this.tag?" "+this.tag:"")+"-----",this.pem};const Qe={"DES-EDE3-CBC":24,"DES-CBC":8,"AES-128-CBC":16,"AES-192-CBC":24,"AES-256-CBC":32};function $e(e,t){return"-----BEGIN "+t+"-----\r\n"+function(e){let t=function(e){return function(e){let t,r,n="";for(t=0;e.length>=t+3;t+=3)r=parseInt(e.substring(t,t+3),16),n+=Ye.charAt(r>>6)+Ye.charAt(63&r);t+1==e.length?(r=parseInt(e.substring(t,t+1),16),n+=Ye.charAt(r<<2)):t+2==e.length&&(r=parseInt(e.substring(t,t+2),16),n+=Ye.charAt(r>>2)+Ye.charAt((3&r)<<4));for(;(3&n.length)>0;)n+="=";return n}(e)}
/*! (c) Tom Wu | http://www-cs-students.stanford.edu/~tjw/jsbn/
 */(e).replace(/(.{64})/g,"$1\r\n");return t=t.replace(/\r\n$/,""),t}(e)+"\r\n-----END "+t+"-----\r\n"}const Ye="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";const Je=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"];function Ge(e){if(e>65536)throw Error("requested too many random bytes");const t=o.Buffer.allocUnsafe(e);return e>0&&function(e){const t=e.length;for(let r=0;t>r;r++)e[r]="0x"+Je[parseInt(16*Math.random())]+Je[parseInt(16*Math.random())]}(t),t}const Xe=new y.ec("secp256k1"),Ze=Buffer.from("fffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141","hex"),et=Buffer.alloc(32,0);function tt(e,t){if(!e)throw Error(t||"Assertion failed")}function rt(e){return t=e,!(!Buffer.isBuffer(t)||32!==t.length)&&(e.compare(et)>0&&0>e.compare(Ze));var t}function nt(e){return Buffer.from(Ge(e))}function ot(e,t,r={}){let n=r.ephemPrivateKey||nt(32);for(;!rt(n);)n=r.ephemPrivateKey||nt(32);const o=(tt(32===(s=n).length,"Bad private key"),tt(rt(s),"Bad private key"),Buffer.from(Xe.keyFromPrivate(s).getPublic("arr")));var s;const a=function(e,t){tt(Buffer.isBuffer(e),"Bad private key"),tt(Buffer.isBuffer(t),"Bad public key"),tt(32===e.length,"Bad private key"),tt(rt(e),"Bad private key"),tt(65===t.length||33===t.length,"Bad public key"),65===t.length&&tt(4===t[0],"Bad public key"),33===t.length&&tt(2===t[0]||3===t[0],"Bad public key");const r=Xe.keyFromPrivate(e),n=Xe.keyFromPublic(t),o=r.derive(n.getPublic());return Buffer.from(o.toArray())}(n,e),i=Buffer.alloc(36);a.copy(i,0,0,32),i[35]=1;const c=function(e){const t=R.default("sha256").update(e).digest();return new Uint8Array(t)}(i),p=r.iv||nt(12),f=function(e,t,r){if(!t||!r)throw Error("aes empty key or iv!");const n=u.createCipheriv("aes-128-gcm",t,r);n.setAutoPadding(!1);const o=n.update(e).toString("hex");return n.final(),{data:o,authTag:n.getAuthTag().toString("hex")}}(t,Buffer.from(c.slice(0,16)),p),y=je(f.data),d=je(f.authTag);return Buffer.concat([o,p,d,y])}const st="02",at={prime256v1:32,secp256k1:32,secp384r1:48,secp521r1:66},it={prime256v1:"P-256",secp256k1:"P-256K",secp384r1:"P-384",secp521r1:"P-521"},ct={"P-256":"prime256v1","P-256K":"secp256k1","P-384":"secp384r1","P-521":"secp521r1"},ut=d.define("Rfc5915Key",(function(){this.seq().obj(this.key("version").int(),this.key("privateKey").octstr(),this.key("parameters").optional().explicit(0).objid({"1 2 840 10045 3 1 7":"prime256v1","1 3 132 0 10":"secp256k1","1 3 132 0 34":"secp384r1","1 3 132 0 35":"secp521r1"}),this.key("publicKey").optional().explicit(1).bitstr())})),pt=d.define("Pkcs8Key",(function(){this.seq().obj(this.key("version").int(),this.key("algorithmIdentifier").seq().obj(this.key("privateKeyType").objid({"1 2 840 10045 2 1":"EC"}),this.key("parameters").objid({"1 2 840 10045 3 1 7":"prime256v1","1 3 132 0 10":"secp256k1","1 3 132 0 34":"secp384r1","1 3 132 0 35":"secp521r1"})),this.key("privateKey").octstr())})),ft=d.define("SpkiKey",(function(){this.seq().obj(this.key("algorithmIdentifier").seq().obj(this.key("publicKeyType").objid({"1 2 840 10045 2 1":"EC"}),this.key("parameters").objid({"1 2 840 10045 3 1 7":"prime256v1","1 3 132 0 10":"secp256k1","1 3 132 0 34":"secp384r1","1 3 132 0 35":"secp521r1"})),this.key("publicKey").bitstr())}));function yt(e,t){var r=at[e];if(4==t[0]){if(t.length!=2*r+1)throw new TypeError("Invalid uncompressed key size");return{c:e,x:t.slice(1,r+1),y:t.slice(r+1)}}throw new TypeError("Compressed key unsupported")}function dt(e){var t=pt.decode(e,"der"),r=ut.decode(t.privateKey,"der"),n=t.algorithmIdentifier.parameters,o=at[n],s=r.privateKey;if(s.length>o)throw new TypeError("Invalid private key size: expected "+o+" gotten "+s.length);var a=yt(n,r.publicKey.data);return a.d=s,a}function ht(e){var t=ft.decode(e,"der");return yt(t.algorithmIdentifier.parameters,t.publicKey.data)}const lt=/-+BEGIN EC PRIVATE KEY-+([\s\S]+)-+END EC PRIVATE KEY-+/m,mt=/-+BEGIN PRIVATE KEY-+([\s\S]*)-+END PRIVATE KEY-+/m,gt=/-+BEGIN PUBLIC KEY-+([\s\S]*)-+END PUBLIC KEY-+/m;function _t(e){if("string"!=typeof e)throw new TypeError("PEM must be a string");var t=null;if(t=e.match(lt))return function(e){var t=ut.decode(e,"der"),r=at[t.parameters],n=t.privateKey;if(n.length>r)throw new TypeError("Invalid private key size: expected "+r+" gotten "+n.length);var o=yt(t.parameters,t.publicKey.data);return o.d=n,o}(new o.Buffer(t[1].replace(/[\s-]/gm,""),"base64"));if(t=e.match(mt))return dt(new o.Buffer(t[1].replace(/[\s-]/gm,""),"base64"));if(t=e.match(gt))return ht(new o.Buffer(t[1].replace(/[\s-]/gm,""),"base64"));throw new TypeError("Unrecognized PEM key structure")}function vt(e,t){if(!(this instanceof vt))return new vt(e,t);var r,n,s,a,i;if(t||(t="pem"),o.Buffer.isBuffer(e))if("pem"==t)r=(c=_t(e.toString("ascii"))).c,s=c.x,a=c.y,n=c.d;else if("pkcs8"==t||"rfc5208"==t){r=(c=dt(e)).c,s=c.x,a=c.y,n=c.d}else{if("spki"!=t&&"rfc5280"!=t)throw new TypeError('Unknown format for EC Key "'+t+'"');r=(c=ht(e)).c,s=c.x,a=c.y,n=c.d}else if("string"==typeof e){if("pem"==t)r=(c=_t(e)).c,s=c.x,a=c.y,n=c.d;else if("pkcs8"==t||"rfc5208"==t){r=(c=dt(new o.Buffer(e,"base64"))).c,s=c.x,a=c.y,n=c.d}else{if("spki"!=t&&"rfc5280"!=t)throw new TypeError('Unknown format for EC Key "'+t+'"');r=(c=ht(new o.Buffer(e,"base64"))).c,s=c.x,a=c.y,n=c.d}}else{if(!(i=e)||i.constructor!==Object)throw new TypeError("Unrecognized format for EC key");if("string"==typeof e.curve?r=e.curve:"string"==typeof e.crv&&(r=ct[e.crv]||e.crv),o.Buffer.isBuffer(e.privateKey)?n=e.privateKey:"string"==typeof e.privateKey?n=new o.Buffer(e.privateKey,"base64"):o.Buffer.isBuffer(e.d)?n=e.d:"string"==typeof e.d&&(n=new o.Buffer(e.d,"base64")),o.Buffer.isBuffer(e.publicKey)){var c=yt(r,e.publicKey);s=c.x,a=c.y}else if("string"==typeof e.publicKey){c=yt(r,new o.Buffer(e.publicKey,"base64"));s=c.x,a=c.y}else o.Buffer.isBuffer(e.x)?s=e.x:"string"==typeof e.x&&(s=new o.Buffer(e.x,"base64")),o.Buffer.isBuffer(e.y)?a=e.y:"string"==typeof e.y&&(a=new o.Buffer(e.y,"base64"))}if(!r)throw new TypeError("EC Key curve not specified");if(!s||!a)throw new TypeError("Public EC Key point unavailable");var u=at[r];if(!u)throw new TypeError('EC Key curve "'+r+'" invalid');if(s.length!=u)throw new TypeError("Public EC Key point X of wrong length");if(a.length!=u)throw new TypeError("Public EC Key point Y of wrong length");if(n&&a.length!=u)throw new TypeError("Private EC Key of wrong length");Object.defineProperties(this,{curve:{enumerable:!0,configurable:!1,value:r},isPrivateECKey:{enumerable:!0,configurable:!1,value:null!=n},x:{enumerable:!0,configurable:!1,get:function(){return new o.Buffer(s)}},y:{enumerable:!0,configurable:!1,get:function(){return new o.Buffer(a)}},jsonCurve:{enumerable:!1,configurable:!1,value:it[r]},publicCodePoint:{enumerable:!1,configurable:!1,get:function(){return o.Buffer.concat([new o.Buffer([4]),s,a])}}}),n&&Object.defineProperty(this,"d",{enumerable:!0,configurable:!1,get:function(){return new o.Buffer(n)}})}function bt(e,t){return function(e,t){const r=new vt(function(e,t,r){return new Ve(e,t,r)}(e,"EC PRIVATE KEY",t).pem,"pem"),n=r.d;let o=r.publicCodePoint;o.length>64&&(o=o.slice(1));return{privateKey:n,publicKey:o}}(e,t)}function Ct(e,t){let r=e;we(r)?32!==r.length&&(r=Pe(Ee(r))):r=Te(r)&&0===r.indexOf("0x")?Pe(r):Pe(Ee(r));const n=a.sign(r,t);return o.Buffer.concat([n.signature,o.Buffer.from([n.recovery])],65)}function qt(e,t){let r=e,n=t;if(!r||!n)throw Error("aes password or tx hash is invalid"+r+"..."+n);if(Te(r)&&(r="0x"===r.substr(0,2)?o.Buffer.from(r.substr(2),"hex"):o.Buffer.from(r,"ascii")),!we(r))throw Error("aes password is invalid");n=je(n);return R.default("sha256").update(o.Buffer.concat([r,n])).digest().slice(0,16)}function Et(){return Ge(4).readUInt32BE(0)}function wt(e,t,r,n,s){return s===st?function(e,t,r){let n=r,s=e;if(!s)throw Error("ecc_pub_key is invalid");n||(n=Ge(16));n=je(n);const a=Ge(12),i=xt(t,n,a),c=o.Buffer.from(i.authTag,"hex"),u=o.Buffer.from(i.data,"hex"),p={iv:a},f=N.default.formatter.pemToBin(""+s),y=o.Buffer.from(f);s=y.slice(y.byteLength-65,y.byteLength),s=je(s);let d=ot(s,n,p);if(109>d.length){const e=o.Buffer.alloc(109);d.copy(e,109-d.length),d=e}const h=new o.Buffer(2);h.writeUInt16BE(320,0),d=je(d);return"0x"+o.Buffer.concat([h,d,a,c,u]).toString("hex")}(e,t,qt(r,n)):function(e,t,r){let n=r,s=e;n||(n=Ge(16));if(n=je(n),!s)throw Error("rsa_pub_key is invalid");Te(s)&&-1===s.indexOf("PUBLIC KEY")&&("0x"===s.substr(0,2)&&(s=s.substr(2)),s=$e(s,"PUBLIC KEY"));const a=Ge(12),i=xt(t,n,a);let c=B.default.publicEncrypt(s,n);if(256>c.length){const e=o.Buffer.alloc(256);c.copy(e,256-c.length),c=e}const u=new o.Buffer(2);u.writeUInt16BE(1,0);return"0x"+o.Buffer.concat([u,c,a,o.Buffer.from(i.authTag,"hex"),o.Buffer.from(i.data,"hex")]).toString("hex")}(e,t,qt(r,n))}function xt(e,t,r){if(!t||!r)throw Error("aes empty key or iv!");let n=e,o=t;n=je(n),o=je(o);const s=u.createCipheriv("aes-128-gcm",o,r);s.setAutoPadding(!1);const a=s.update(n).toString("hex");s.final();return{data:a,authTag:s.getAuthTag().toString("hex")}}function Tt(e,t,r){return function(e,t){if(!t||!e)throw Error("aes empty key or data!");let r=e,n=t;r=je(r),n=je(n);let o=r.length-16,s=r.length;const a=r.slice(o,s);o-=12,s-=16;const i=r.slice(o,s),c=r.slice(0,o),p=u.createDecipheriv("aes-128-gcm",n,i);return p.setAuthTag(a),"0x"+p.update(c).toString("hex")}(e,qt(t,r))}function kt(e,t){if(-1!==e.name.indexOf("("))return e.name;let r="";return r=t?t.join(","):e.inputs.map((function(e){return e.type})).join(","),e.name+"("+r+")"}vt.prototype.asPublicECKey=function(){return this.isPrivateECKey?new vt({curve:this.curve,x:this.x,y:this.y}):this},vt.prototype.toBuffer=function(e){if(e||(e="pem"),"pem"==e)return new o.Buffer(this.toString("pem"),"ascii");if(this.isPrivateECKey){for(var t=this.d;0==t[0];)t=t.slice(1);if("pkcs8"==e||"rfc5208"==e)return pt.encode({version:0,algorithmIdentifier:{privateKeyType:"EC",parameters:this.curve},privateKey:ut.encode({version:1,privateKey:t,publicKey:{data:this.publicCodePoint}},"der")},"der");if("rfc5915"==e)return ut.encode({version:1,privateKey:t,parameters:this.curve,publicKey:{data:this.publicCodePoint}},"der");throw new TypeError('Unknown format for private key "'+e+'"')}if("spki"==e||"rfc5280"==e)return ft.encode({algorithmIdentifier:{publicKeyType:"EC",parameters:this.curve},publicKey:{data:this.publicCodePoint}},"der");throw new TypeError('Unknown format for public key "'+e+'"')},vt.prototype.toString=function(e){if(e||(e="pem"),this.isPrivateECKey){if("pem"==e)return"-----BEGIN PRIVATE KEY-----\n"+this.toBuffer("pkcs8").toString("base64").match(/.{1,64}/g).join("\n")+"\n-----END PRIVATE KEY-----\n";if("rfc5915"==e)return"-----BEGIN EC PRIVATE KEY-----\n"+this.toBuffer("rfc5915").toString("base64").match(/.{1,64}/g).join("\n")+"\n-----END EC PRIVATE KEY-----\n";if("pkcs8"==e||"rfc5208"==e)return this.toBuffer("pkcs8").toString("base64");if("spki"==e||"rfc5280"==e)return this.toBuffer("spki").toString("base64");throw new TypeError('Unknown format for private key "'+e+'"')}if("pem"==e)return"-----BEGIN PUBLIC KEY-----\n"+this.toBuffer("spki").toString("base64").match(/.{1,64}/g).join("\n")+"\n-----END PUBLIC KEY-----\n";if("spki"==e||"rfc5280"==e)return this.toBuffer("spki").toString("base64");throw new TypeError('Unknown format for public key "'+e+'"')},vt.prototype.toJSON=function(){function e(e){return e.toString("base64").replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")}var t={kty:"EC",crv:it[this.curve],x:e(this.x),y:e(this.y)},r=this.d;if(r){var n=at[this.curve];if(n>r.length)r=o.Buffer.concat([new o.Buffer(n-r.length).fill(0),r]);t.d=e(r)}return t};var St=function(e,t){this.value=e||"",this.offset=t};St.prototype.dynamicPartLength=function(){return this.dynamicPart().length/2},St.prototype.withOffset=function(e){return new St(this.value,e)},St.prototype.combine=function(e){return new St(this.value+e.value)},St.prototype.isDynamic=function(){return void 0!==this.offset},St.prototype.offsetAsBytes=function(){return this.isDynamic()?Be(We(this.offset).toString(16),64):""},St.prototype.staticPart=function(){return this.isDynamic()?this.offsetAsBytes():this.value},St.prototype.dynamicPart=function(){return this.isDynamic()?this.value:""},St.prototype.encode=function(){return this.staticPart()+this.dynamicPart()},St.encodeList=function(e){var t=32*e.length,r=e.map((function(e){if(!e.isDynamic())return e;var r=t;return t+=e.dynamicPartLength(),e.withOffset(r)}));return r.reduce((function(e,t){return e+t.dynamicPart()}),r.reduce((function(e,t){return e+t.staticPart()}),""))};var Pt=function(e){k.default.config({ROUNDING_MODE:k.default.ROUND_DOWN});var t=Be(We(e).toString(16),64);return new St(t)},Bt=function(e){var t=Me(e).substr(2);return t=Ne(t,64*Math.floor((t.length+63)/64)),new St(t)},Rt=function(e){var t=Me(e).substr(2);t.length%2!=0&&(t="0"+t);var r=t.length/2;return t=Ne(t,64*Math.floor((t.length+63)/64)),new St(Pt(r).value+t)},Nt=function(e){var t,r,n=(t=e,Oe(t,r)).substr(2),o=n.length/2;return n=Ne(n,64*Math.floor((n.length+63)/64)),new St(Pt(o).value+n)},It=function(e){return new St("000000000000000000000000000000000000000000000000000000000000000"+(e?"1":"0"))},At=function(e){return Pt(new k.default(e).times(new k.default(2).pow(128)))},Kt=function(e){var t=e.staticPart()||"0";return function(e){return"1"===new k.default(e.substr(0,1),16).toString(2).substr(0,1)}(t)?new k.default(t,16).minus(new k.default("ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff",16)).minus(1):new k.default(t,16)},Ot=function(e){var t=e.staticPart()||"0";return new k.default(t,16)},Dt=function(e){return Kt(e).dividedBy(new k.default(2).pow(128))},Lt=function(e){return Ot(e).dividedBy(new k.default(2).pow(128))},Mt=function(e){return"0000000000000000000000000000000000000000000000000000000000000001"===e.staticPart()},Wt=function(e,t){var r=t.match(/^bytes([0-9]*)/),n=parseInt(r[1]);return"0x"+e.staticPart().slice(0,2*n)},jt=function(e){var t=2*new k.default(e.dynamicPart().slice(0,64),16).toNumber();return"0x"+e.dynamicPart().substr(64,t)},Ut=function(e){var t=2*new k.default(e.dynamicPart().slice(0,64),16).toNumber();return Le(e.dynamicPart().substr(64,t))},zt=function(e){var t=e.staticPart();return"0x"+t.slice(t.length-40,t.length)},Ft=function(e){return"0x"+e.staticPart()},Ht=function(e){this._inputFormatter=e.inputFormatter,this._outputFormatter=e.outputFormatter};Ht.prototype.isType=function(e){throw"this method should be overrwritten for type "+e},Ht.prototype.staticPartLength=function(e){return(this.nestedTypes(e)||["[1]"]).map((function(e){return parseInt(e.slice(1,-1),10)||1})).reduce((function(e,t){return e*t}),32)},Ht.prototype.isDynamicArray=function(e){var t=this.nestedTypes(e);return!!t&&!t[t.length-1].match(/[0-9]{1,}/g)},Ht.prototype.isStaticArray=function(e){var t=this.nestedTypes(e);return!!t&&!!t[t.length-1].match(/[0-9]{1,}/g)},Ht.prototype.staticArrayLength=function(e){var t=this.nestedTypes(e);return t?parseInt(t[t.length-1].match(/[0-9]{1,}/g)||1):1},Ht.prototype.nestedName=function(e){var t=this.nestedTypes(e);return t?e.substr(0,e.length-t[t.length-1].length):e},Ht.prototype.isDynamicType=function(){return!1},Ht.prototype.nestedTypes=function(e){return e.match(/(\[[0-9]*\])/g)},Ht.prototype.encode=function(e,t){var r=this;return this.isDynamicArray(t)?function(){var n=e.length,o=r.nestedName(t),s=[];return s.push(Pt(n).encode()),e.forEach((function(e){s.push(r.encode(e,o))})),s}():this.isStaticArray(t)?function(){for(var n=r.staticArrayLength(t),o=r.nestedName(t),s=[],a=0;n>a;a++)s.push(r.encode(e[a],o));return s}():this._inputFormatter(e,t).encode()},Ht.prototype.decode=function(e,t,r){var n=this;if(this.isDynamicArray(r))return function(){for(var o=parseInt("0x"+e.substr(2*t,64)),s=parseInt("0x"+e.substr(2*o,64)),a=o+32,i=n.nestedName(r),c=n.staticPartLength(i),u=32*Math.floor((c+31)/32),p=[],f=0;s*u>f;f+=u)p.push(n.decode(e,a+f,i));return p}();if(this.isStaticArray(r))return function(){for(var o=n.staticArrayLength(r),s=t,a=n.nestedName(r),i=n.staticPartLength(a),c=32*Math.floor((i+31)/32),u=[],p=0;o*c>p;p+=c)u.push(n.decode(e,s+p,a));return u}();if(this.isDynamicType(r))return function(){var o=parseInt("0x"+e.substr(2*t,64)),s=parseInt("0x"+e.substr(2*o,64)),a=new St(e.substr(2*o,64*(1+Math.floor((s+31)/32))),0);return n._outputFormatter(a,r)}();var o=this.staticPartLength(r),s=new St(e.substr(2*t,2*o));return this._outputFormatter(s,r)};var Vt=function(){this._inputFormatter=Pt,this._outputFormatter=zt};(Vt.prototype=new Ht({})).constructor=Vt,Vt.prototype.isType=function(e){return!!e.match(/address(\[([0-9]*)\])?/)};var Qt=function(){this._inputFormatter=Pt,this._outputFormatter=Ft};(Qt.prototype=new Ht({})).constructor=Qt,Qt.prototype.isType=function(e){return!!e.match(/^identity(\[([0-9]*)\])*$/)};var $t=function(){this._inputFormatter=It,this._outputFormatter=Mt};($t.prototype=new Ht({})).constructor=$t,$t.prototype.isType=function(e){return!!e.match(/^bool(\[([0-9]*)\])*$/)};var Yt=function(){this._inputFormatter=Pt,this._outputFormatter=Kt};(Yt.prototype=new Ht({})).constructor=Yt,Yt.prototype.isType=function(e){return!!e.match(/^int([0-9]*)?(\[([0-9]*)\])*$/)};var Jt=function(){this._inputFormatter=Pt,this._outputFormatter=Ot};(Jt.prototype=new Ht({})).constructor=Jt,Jt.prototype.isType=function(e){return!!e.match(/^uint([0-9]*)?(\[([0-9]*)\])*$/)};var Gt=function(){this._inputFormatter=Rt,this._outputFormatter=jt};(Gt.prototype=new Ht({})).constructor=Gt,Gt.prototype.isType=function(e){return!!e.match(/^bytes(\[([0-9]*)\])*$/)},Gt.prototype.isDynamicType=function(){return!0};var Xt=function(){this._inputFormatter=Nt,this._outputFormatter=Ut};(Xt.prototype=new Ht({})).constructor=Xt,Xt.prototype.isType=function(e){return!!e.match(/^string(\[([0-9]*)\])*$/)},Xt.prototype.isDynamicType=function(){return!0};var Zt=function(){this._inputFormatter=At,this._outputFormatter=Dt};(Zt.prototype=new Ht({})).constructor=Zt,Zt.prototype.isType=function(e){return!!e.match(/real([0-9]*)?(\[([0-9]*)\])?/)};var er=function(){this._inputFormatter=At,this._outputFormatter=Lt};(er.prototype=new Ht({})).constructor=er,er.prototype.isType=function(e){return!!e.match(/^ureal([0-9]*)?(\[([0-9]*)\])*$/)};var tr=function(){this._inputFormatter=Bt,this._outputFormatter=Wt};(tr.prototype=new Ht({})).constructor=tr,tr.prototype.isType=function(e){return!!e.match(/^bytes([0-9]{1,})(\[([0-9]*)\])*$/)};var rr=function(e,t){return e.isDynamicType(t)||e.isDynamicArray(t)},nr=function(e){this._types=e};nr.prototype._requireType=function(e){var t=this._types.filter((function(t){return t.isType(e)}))[0];if(!t)throw Error("invalid solidity type!: "+e);return t},nr.prototype.encodeParam=function(e,t){return this.encodeParams([e],[t])},nr.prototype.encodeParams=function(e,t){var r=this.getSolidityTypes(e),n=r.map((function(r,n){return r.encode(t[n],e[n])})),o=r.reduce((function(t,n,o){var s=n.staticPartLength(e[o]),a=32*Math.floor((s+31)/32);return t+(rr(r[o],e[o])?32:a)}),0);return this.encodeMultiWithOffset(e,r,n,o)},nr.prototype.encodeMultiWithOffset=function(e,t,r,n){var o="",s=this;return e.forEach((function(a,i){if(rr(t[i],e[i])){o+=Pt(n).encode();var c=s.encodeWithOffset(e[i],t[i],r[i],n);n+=c.length/2}else o+=s.encodeWithOffset(e[i],t[i],r[i],n)})),e.forEach((function(a,i){if(rr(t[i],e[i])){var c=s.encodeWithOffset(e[i],t[i],r[i],n);n+=c.length/2,o+=c}})),o},nr.prototype.encodeWithOffset=function(e,t,r,n){var o=1,s=2,a=3,i=t.isDynamicArray(e)?o:t.isStaticArray(e)?s:a;if(i!==a){var c=t.nestedName(e),u=t.staticPartLength(c),p=i===o?r[0]:"";if(t.isDynamicArray(c))for(var f=i===o?2:0,y=0;r.length>y;y++)i===o?f+=+r[y-1][0]||0:i===s&&(f+=+(r[y-1]||[])[0]||0),p+=Pt(n+y*u+32*f).encode();for(var d=i===o?r.length-1:r.length,h=0;d>h;h++){var l=p/2;i===o?p+=this.encodeWithOffset(c,t,r[h+1],n+l):i===s&&(p+=this.encodeWithOffset(c,t,r[h],n+l))}return p}return r},nr.prototype.decodeParam=function(e,t){return this.decodeParams([e],t)[0]},nr.prototype.decodeParams=function(e,t){var r=this.getSolidityTypes(e),n=this.getOffsets(e,r);return r.map((function(r,o){return r.decode(t,n[o],e[o],o)}))},nr.prototype.getOffsets=function(e,t){for(var r=t.map((function(t,r){return t.staticPartLength(e[r])})),n=1;r.length>n;n++)r[n]+=r[n-1];return r.map((function(r,n){return r-t[n].staticPartLength(e[n])}))},nr.prototype.getSolidityTypes=function(e){var t=this;return e.map((function(e){return t._requireType(e)}))};var or=new nr([new Vt,new Qt,new $t,new Yt,new Jt,new Gt,new tr,new Xt,new Zt,new er]);var sr;!function(e){e.CONNECTION="connection",e.RESPONSE_NOT_JSON="responseNotJSON",e.RETURNCODE_ERROR="returnCode",e.RECEIPT_ERROR="receiptResult"}(sr||(sr={}));class ar extends Error{constructor(e,t){super(e),this.type=void 0,this.code=void 0,this.returnCode=void 0,this.receiptCode=void 0,this.hash=void 0,this.output=void 0,t&&(this.type=t.type,this.code=t.code,this.returnCode=t.returnCode,this.receiptCode=t.receiptCode,this.hash=t.hash,this.output=t.output)}}const ir={InvalidNumberOfSolidityArgs:()=>new ar("Invalid number of arguments to Solidity function"),connection:e=>new ar("CONNECTION ERROR: Could not connect "+e+".",{type:sr.CONNECTION}),response:()=>new ar("Response ERROR: Response is not JSON",{type:sr.RESPONSE_NOT_JSON}),timeout:()=>new ar("CONNECTION TIMEOUT"),unauthorized:()=>new ar("CONNECTION UNAUTHORIZED"),api:e=>new ar("API ERROR: "+e+" is not API"),param:e=>new ar("PARAMETER ERROR: The value of "+e+" is error"),contractDeploy:e=>new ar("CONTRACT ERROR: The contract of "+e+" is not deploy"),returnCode:e=>new ar("ERROR: The return_code is "+e,{type:sr.RETURNCODE_ERROR,code:e,returnCode:e}),receiptResult:(e,t,r)=>new ar("ERROR: The Receipt result is "+e,{type:sr.RECEIPT_ERROR,code:e,receiptCode:e,hash:t,output:r}),codeResult:(e,t)=>new ar("ERROR: The return_code is "+e+". The Receipt result is "+t,{type:sr.RETURNCODE_ERROR,code:`${e}-${t}`,returnCode:e,receiptCode:t})};function cr(e){let t=e;return we(t)&&(t=t.toString("hex")),t?"0x"+t:""}var ur=Object.freeze({__proto__:null,inputdecimal:function(e){return Ae(e)},inputhash:function e(t){if(Te(t)){if(0===t.indexOf("0x")){if(66===t.length)return t;if(66>t.length)return"0x"+Re(Me(t).slice(2),64)}return Ee(t)}if(we(t))return De(t);if(Se(t)){const r=[];for(let n=0;t.length>n;n++)r[n]=e(t[n]);return r}return"0x"+Re(Me(t).slice(2),64)},inputbytes:function(e){return we(e)?De(e):Te(e)&&0===e.indexOf("0x")?e:Me(e)},inputcode:function(e,t,r){let n=t,o=r;n||(n="01"),o||(o="");let s="",a="",i=0;if(we(e)?(i=e.length,s=e.toString("hex")):Te(e)&&(s=e,0===s.indexOf("0x")&&(s=s.slice(2)),i=s.length/2),"wasm"===n){n="02";const e=new Buffer(4);e.writeUInt32BE(i),a=e.toString("hex")}if(""===s)throw ir.param("code");return"0x"+n+a+s+o},inputbignumber:function(e){return I.default.isBN(e)?e:Te(e)&&0===e.indexOf("0x")?new I.default(e.slice(2),16):new I.default(e,10)},outputdecimal:function(e,t){let r=e;return we(r)&&(r=r.toString("hex")),Ae(r,t)},outputbytes:cr,outputhash:function(e){return cr(e)},outputstring:function(e){let t=e;return we(t)&&(t=t.toString("hex")),Le(t)},outputbignumber:function(e){let t=e;return"number"==typeof t?t:we(t)?(t=t.toString("hex"),new I.default(t,16).toNumber()):Te(t)&&0===t.indexOf("0x")?new I.default(t.slice(2),16).toNumber():new I.default(t).toNumber()}});const pr=[[{name:"session_id"}]],fr={name:"hash",type:"hash"},yr=Array(fr);yr.value=[],yr.name="hashes",yr.type="array";const dr=[{name:"key",type:"bytes"},{name:"value",type:"bytes"}];dr.name="configs",dr.type="array";const hr={name:"timestamp",type:"decimal"},lr={name:"from",type:"hash"},mr={name:"to",type:"hash"},gr={name:"gas_used",type:"decimal"},_r={name:"identity",type:"hash"},vr={name:"transaction_index",type:"decimal"},br={name:"topic",type:"string"},Cr={name:"msg_type",type:"decimal"},qr={name:"sequence",type:"decimal"},Er={name:"group_id",type:"bytes"},wr={name:"return_code",type:"decimal"},xr=[Cr],Tr=[xr,qr,Er],kr=[xr,qr,wr,Er],Sr={name:"block_number",type:"bignumber"},Pr=[br];Pr.name="topics",Pr.type="array",Pr.array_type="one";const Br=[lr,mr,Pr,{name:"log_data",type:"bytes"}];Br.name="log_entry",Br.value=[],Br.type="array";const Rr=[{name:"result",type:"decimal"},gr,Br,{name:"output",type:"bytes"}];Rr.name="receipt";const Nr=[Rr];Nr.name="receipts",Nr.type="array";const Ir={name:"transaction_type",type:"decimal"},Ar={name:"nonce"},Kr={name:"period",type:"decimal"},Or={name:"value",type:"decimal"},Dr={name:"gas",type:"decimal"},Lr={name:"version",type:"decimal",value:2},Mr=[];Mr.name="extensions",Mr.type="array";const Wr={name:"data",type:"bytes"},jr=[{name:"signature",type:"bytes"}];jr.name="signature",jr.type="array",jr.array_type="one";const Ur=[fr,Ir,hr,Ar,Kr,lr,mr,Or,Dr,Er,Lr,Wr,jr,Mr];Ur.name="transaction";const zr=[fr,Ir,hr,Ar,Kr,lr,mr,Or,Dr,Er,Lr,Wr,jr,Mr];zr.name="transactions",zr.type="array";const Fr=[Ur,Rr,Sr,vr];Fr.name="transaction_infos",Fr.type="array";const Hr=[...Ur];Hr.type="array",Hr.value=[],Hr.name="transaction_list";const Vr=[...Rr];Vr.type="array",Vr.value=[],Vr.name="receipt_list";const Qr=[fr,{name:"version",type:"decimal"},Sr,{name:"parent_hash",type:"hash"},{name:"transaction_root",type:"bytes"},{name:"receipt_root",type:"bytes"},{name:"state_root",type:"bytes"},gr,hr,{name:"log_bloom",type:"bytes"}];Qr.name="block_header";const $r=[Hr,Vr,{name:"consensus_proof",type:"bytes"}];$r.name="block_body";const Yr=[Qr,$r];Yr.name="block";const Jr={name:"balance",value:"",type:"decimal"},Gr={name:"recover_key",type:"bytes"},Xr={name:"recover_time",type:"decimal"},Zr={name:"status",type:"decimal"},en={name:"code",type:"bytes"},tn={name:"storage_root",type:"bytes"},rn={name:"code_hash",type:"hash"},nn={name:"encryption_key",type:"bytes"},on={name:"auth_key",type:"bytes"},sn={name:"auth_weight",type:"decimal"},an=[on,sn];an.name="auth_map",an.type="array",an.array_type=2,an.rlp=!0,an.mapInfo={key:on,value:sn};const cn=[_r,Jr,Gr,Xr,Zr,en,tn,rn,nn,[{name:"acc_version",type:"decimal",value:2}],an],un=[_r,Jr,Gr,Xr,Zr,en,tn,rn,nn,on,sn];cn.name="data";const pn=cn,fn={name:"node_id",type:"bytes",value:"0x00"},yn={name:"public_key",type:"bytes"},dn={name:"node_role",type:"decimal"},hn={name:"node_state",type:"decimal"},ln=[{name:"ip",type:"string"},{name:"port",type:"decimal"}];ln.name="endpoints",ln.type="array";const mn=[[fn,yn,dn,hn,ln],{name:"isConnected",type:"decimal"}];mn.name="node_status",mn.type="array";const gn=[{name:"total_node_count",type:"decimal"},{name:"total_consensus_node_count",type:"decimal"},{name:"total_non_consensus_node_count",type:"decimal"},{name:"total_connected_consensus_node_count",type:"decimal"},{name:"total_connected_non_consensus_node_count",type:"decimal"},mn];gn.name="p2p_status";const _n=[fn,yn,dn,hn,ln];_n.name="node_info",_n.type="array";const vn=[{name:"syncing",type:"decimal"},{name:"my_best",type:"decimal"},{name:"target",type:"decimal"}];vn.name="sync_status";const bn={name:"unverified_queue_limit",type:"decimal"},Cn={name:"verified_queue_limit",type:"decimal"},qn={name:"unverified_queue_usage",type:"decimal"},En={name:"verified_queue_usage",type:"decimal"},wn=[bn,Cn,qn,En];wn.name="transaction_cache_info";const xn=[bn,Cn,{name:"verified_parent_not_found_queue_limit",type:"decimal"},qn,En,{name:"verified_parent_not_found_queue_usage",type:"decimal"},{name:"unverified_max_block_number",type:"decimal"},{name:"verified_max_block_number",type:"decimal"},{name:"verified_parent_not_found_max_block_number",type:"decimal"}];xn.name="block_cache_info";const Tn={name:"code",type:"bytes"},kn={name:"type",type:"decimal",value:0},Sn={name:"filter_id",type:"decimal"},Pn=[{name:"type",type:"bytes"},{name:"phase",type:"string"},{name:"n",type:"decimal"},{name:"f",type:"decimal"},{name:"current_leader",type:"bytes"},{name:"my_id",type:"bytes"},{name:"current_view",type:"decimal"},{name:"last_exec_seq",type:"decimal"},{name:"propose_size",type:"decimal"},{name:"propose_timeout_interval",type:"decimal"},{name:"normal_timeout_interval",type:"decimal"},{name:"viewchange_timeout_interval",type:"decimal"}];Pn.name="info";const Bn=[{name:"black_list",type:"hash"}];Bn.name="black_list",Bn.type="array";const Rn=[{name:"type",type:"decimal"},{name:"proof",type:"bytes"}];Rn.name="block_proof_info";const Nn={name:"block_number",type:"decimal"},In=[{name:"data",type:"bytes"},{name:"next_key_begin_index",type:"decimal"},{name:"next_key_end_index",type:"decimal"}];In.name="nodes",In.type="array";const An=[Nn,{name:"state_root",type:"bytes"},In];An.name="proof";const Kn={name:"root",type:"bytes"},On={name:"index",type:"decimal"},Dn={name:"size",type:"decimal"},Ln={name:"branch",type:"decimal"},Mn=[Nn,Kn,On,Dn,Ln];Mn.name="proof";const Wn=[Nn,Kn,On,Dn,Ln];Wn.name="receipt_proof";const jn=[Rn,Qr];jn.name="header_infos",jn.type="array";const Un={name:"block_hash",type:"hash"},zn=[Un,Nr];zn.name="block_receipts",zn.type="array";const Fn=[zr,Nr,{name:"consensus_proof",type:"bytes"}];Fn.name="body";const Hn=[Un,Fn];Hn.name="block_body",Hn.type="array";const Vn=25,Qn=124,$n="CreateAccount",Yn="QueryTransactionReceipt",Jn="TransferBalance",Gn="SetRecoverkey",Xn="PreResetPubKey",Zn="ResetPubKey",eo="UpdateAuthMap",to="QueryLastBlock",ro="QueryBlockHeader",no="QueryLastBlockHeader",oo="QueryBlock",so="QueryTransaction",ao="QueryAccount",io="QueryContract",co="DeployContract",uo="UpdateContract",po="CallContract",fo="EncryptedTransaction",yo="EventContract",ho="EventFetch",lo={},mo={};function go(e,t){return Te(e)&&"0x"===e.substr(0,2)&&66===e.length?t?e.substr(2):e:Ee(e,t)}function _o(e,t){const r=[];for(let n=0;e.length>n;n++){const o=e[n];if(!Array.isArray(o)||o.rlp){let e=t[o.name]||o.value||"",s=o.type;o.rlp&&(s="bytes");const a=ur["input"+s];a&&(e="code"===s&&t.type?a(e,t.type,t.parameters):a(e)),r[n]=e}else r[n]=_o(o,t)}return r}function vo(e,t){const r=mo[e];if(!r)throw Error(e+" is not api");return _o(r.data,t)}function bo(e,t,r){const n=[];for(let o=0;r.length>o;o++){const s=r[o];if(!Array.isArray(s)||s.rlp){const r=s.name;let a=t[r]||s.value||"";if("msg_type"===r)a=mo[e].request_msg_type;else if("transaction_type"===r)a=mo[e].transaction_type,e===exports.MychainMethods.LocalTransaction&&(a=t.type);else{let e=s.type;s.rlp&&(e="bytes");const t=ur["input"+e];t&&(a=t(a))}n[o]=a}else n[o]=bo(e,t,s)}return n}function Co(e,t){ee("RequestProcess "+e,t);const r=mo[e];if(!r)throw Error(e+" is not api");return bo(e,t,r.request)}function qo(e,t){if(we(t)){const r=ur["output"+e.type];return r?r(t):t.toString("hex")}return t||e.value||""}function Eo(e,t,r={}){const n=t.name,o=t.type;let s=r;if(Array.isArray(t)&&e)if("array"===o&&Array.isArray(e)){const r=[];if("one"===t.array_type)e.forEach((e=>{r.push(qo(t[0],e))}));else if("number"==typeof t.array_type){const n=t.slice(0);for(let t=0;e.length>t;t+=2)r.push(wo([e[t],e[t+1]],n))}else e.forEach((e=>{r.push(wo(e,t))}));s[n||"arr"]=r}else if(t.rlp){s=Eo(He(e),t,s)}else n?s[n]=wo(e,t):s=wo(e,t,s);else s[n]=qo(t,e);return s}function wo(e,t,r={}){let n=r;for(let r=0;t.length>r;r++){n=Eo((Array.isArray(e)?e[r]:e)||"",t[r],n)}return n}function xo(e,t){switch(e){case exports.EventListenerType.ACCOUNT:return function(e){return wo(e,[[un]])}(t);case exports.EventListenerType.CONTRACT:return function(e){return wo(e,[[cn]])}(t);case exports.EventListenerType.TOPICS:return function(e){return wo(e,[[[br,{name:"data",type:"bytes"}]]])}(t);case exports.EventListenerType.BLOCK:return function(e){return wo(e,[[Qr]])}(t)}}function To(e,t,r){let n=e;if(!n)throw Error("aes empty key or iv or tag!");n=je(n);const o=function(e,t){if(!t||!e)throw Error("aes empty key or data!");let r=e,n=t;r=je(r),n=je(n);let o=0,s=12;const a=r.slice(o,s);o+=12,s+=16;const i=r.slice(o,s);o+=16,s=r.length;const c=r.slice(o,s),p=u.createDecipheriv("aes-128-gcm",n,a);return p.setAuthTag(i),"0x"+p.update(c).toString("hex")}(n.slice(258,n.length),qt(t,r));return wo(He(o),Ur)}function ko(e,t,r,n){const o=function(e){return mo[e].transaction_type}(e);ee("[NEW JS SDK] getTxData:",t);const s={type:o,group_id:t.group_id||"0x0000000000000000000000000000000000000000",timestamp:Date.now(),nonce:t.nonce||Et(),period:t.period||100,from:t.from||r.from,to:t.to,value:t.value||0,gas:t.gas||1e10,version:t.tx_version||2,extensions:[],data:t.data};r.sequence&&(s.sequence=r.sequence);const a=t.hash||Ee(Fe([s.type,s.timestamp,s.nonce,s.period,s.from,s.to,s.value,s.gas,s.group_id,s.version,s.data,s.extensions])),i=Ct(a,n||r.userPrivateKey);return s.hash=a,s.signature=r.isSign?De(i):"",ee("[NEW JS SDK] getTxData return param:",s),s}function So(e,t,r,n){return{type:t.transaction_type,group_id:e.group_id||"0x0000000000000000000000000000000000000000",timestamp:r,nonce:e.nonce||Et(),period:e.period||100,from:"0x0",to:"0x0",value:e.value||0,gas:e.gas||1e7,version:e.tx_version||2,extensions:[],data:e.data||"0x0",sequence:t.sequence,hash:n,signature:"0x0"}}function Po(e){return"0x"+Buffer.from(e,"base64").toString("hex")}function Bo(e,t,r,n=(e=>e)){ee("[RestProvider] getTransactionRequest args:",e,t,r);const o=ko(e,j(j({},t),{},{to:go(t.to),from:go(t.from),data:vo(e,t.data)[0]||""}),r);ee("[RestProvider] getTransactionRequest txData:",o);const a=Co(e,o);ee("[RestProvider] getTransactionRequest rlpRawData:",a);const i=s.encode(n(a));return ee("[RestProvider] getTransactionRequest rlpData:",i),{txData:o,rlpData:i}}function Ro(e,t){if(e.filter((function(e){return!(!0===ke(e)&&!1===Se(e)&&!1===xe(e))})).length!==t.length)throw ir.InvalidNumberOfSolidityArgs()}[{name:$n,topics:"create_account",request_msg_type:2,response_msg_type:14,transaction_type:0,request:[Cr,[Tr,Ur]],response:[Cr,[kr,fr]],data:cn},{name:Jn,topics:"transfer_balance",request_msg_type:3,response_msg_type:15,transaction_type:1,request:[Cr,[Tr,Ur]],response:[Cr,[kr,fr]],data:[]},{name:Gn,topics:"set_recover_key",request_msg_type:4,response_msg_type:16,transaction_type:20,request:[Cr,[Tr,Ur]],response:[Cr,[kr,fr]],data:[Gr]},{name:Xn,topics:"",request_msg_type:5,response_msg_type:17,transaction_type:21,request:[Cr,[Tr,Ur]],response:[Cr,[kr,fr]],data:[]},{name:Zn,topics:"",request_msg_type:6,response_msg_type:18,transaction_type:22,request:[Cr,[Tr,Ur]],response:[Cr,[kr,fr]],data:[on,sn]},{name:eo,topics:"",request_msg_type:7,response_msg_type:19,transaction_type:23,request:[Cr,[Tr,Ur]],response:[Cr,[kr,fr]],data:[on,sn]},{name:"FreezeAccount",topics:"",request_msg_type:24,response_msg_type:25,transaction_type:Vn,request:[Cr,[Tr,Ur]],response:[Cr,[kr,fr]],data:[]},{name:"FreezeContract",topics:"",request_msg_type:28,response_msg_type:29,transaction_type:Vn,request:[Cr,[Tr,Ur]],response:[Cr,[kr,fr]],data:[]},{name:"NativeDepositData",request_msg_type:36,response_msg_type:37,transaction_type:40,request:[Cr,[Tr,Ur]],response:[Cr,[kr,fr]],data:[{name:"payload",type:"bytes"}]},{name:to,request_msg_type:51,response_msg_type:58,transaction_type:"",request:[Cr,Tr],response:[Cr,[kr,Yr]],data:[]},{name:ro,request_msg_type:52,response_msg_type:59,transaction_type:"",request:[Cr,[Tr,Sr,fr]],response:[Cr,[kr,Qr]],data:[]},{name:no,request_msg_type:66,response_msg_type:67,transaction_type:"",request:[Cr,Tr],response:[Cr,[kr,Qr]],data:[]},{name:oo,request_msg_type:53,response_msg_type:60,transaction_type:"",request:[Cr,[Tr,Sr,fr]],response:[Cr,[kr,Yr]],data:[]},{name:so,request_msg_type:55,response_msg_type:62,transaction_type:"",request:[Cr,[Tr,fr]],response:[Cr,[kr,Ur,Sr,vr]],data:[]},{name:Yn,request_msg_type:56,response_msg_type:63,transaction_type:"",request:[Cr,[Tr,fr]],response:[Cr,[kr,Rr,Sr,vr]],data:[]},{name:"QueryTransactionList",request_msg_type:94,response_msg_type:95,transaction_type:"",request:[Cr,[Tr,fr]],response:[Cr,[kr,zr]],data:[]},{name:"QueryTransactionAndReceipt",request_msg_type:96,response_msg_type:97,transaction_type:"",request:[Cr,[Tr,fr]],response:[Cr,[kr,Fr]],data:[]},{name:ao,request_msg_type:54,response_msg_type:61,transaction_type:"",request:[Cr,[Tr,fr]],response:[Cr,[kr,cn]],data:[]},{name:io,request_msg_type:64,response_msg_type:65,transaction_type:"",request:[Cr,[Tr,fr]],response:[Cr,[kr,pn]],data:[]},{name:"QueryTimestamp",request_msg_type:50,response_msg_type:57,transaction_type:"",request:[Cr,Tr],response:[Cr,[kr,hr]],data:[]},{name:"QueryP2PStatus",request_msg_type:100,response_msg_type:101,transaction_type:"",request:[Cr,Tr,fn],response:[Cr,[kr,gn]],data:[]},{name:"QueryConsensusStatus",request_msg_type:102,response_msg_type:103,transaction_type:"",request:[Cr,[Tr,fn]],response:[Cr,[kr,Pn]],data:[]},{name:"QueryCommonConsensusStatus",request_msg_type:200,response_msg_type:201,transaction_type:"",request:[Cr,[Tr,fn]],response:[Cr,[kr,{name:"type",type:"decimal"},{name:"info",type:"bytes"}]],data:[]},{name:"QuerySyncStatus",request_msg_type:104,response_msg_type:105,transaction_type:"",request:[Cr,[Tr,fn]],response:[Cr,[kr,vn]],data:[]},{name:"QueryTransactionCacheStatus",request_msg_type:106,response_msg_type:107,transaction_type:"",request:[Cr,[Tr,fn]],response:[Cr,[kr,wn]],data:[]},{name:"QueryBlockCacheStatus",request_msg_type:108,response_msg_type:109,transaction_type:"",request:[Cr,[Tr,fn]],response:[Cr,[kr,xn]],data:[]},{name:"QueryContractNodesStatus",request_msg_type:110,response_msg_type:111,transaction_type:"",request:[Cr,Tr],response:[Cr,[kr,_n]],data:[]},{name:"QueryContractConfigStatus",request_msg_type:112,response_msg_type:113,transaction_type:"",request:[Cr,Tr],response:[Cr,[kr,dr]],data:[]},{name:"QueryLogLevel",request_msg_type:152,response_msg_type:153,transaction_type:"",request:[Cr,Tr],response:[Cr,[kr,{name:"level",type:"decimal"}]],data:[]},{name:"UpdateBlackList",request_msg_type:158,response_msg_type:159,transaction_type:"",request:[Cr,[Tr,Bn,jr]],response:[Cr,kr],data:[]},{name:"QueryBlockProof",request_msg_type:68,response_msg_type:69,transaction_type:"",request:[Cr,[Tr,Sr,fr]],response:[Cr,[kr,Rn]],data:[]},{name:"QueryLatestStateProof",request_msg_type:70,response_msg_type:71,transaction_type:"",request:[Cr,[Tr,_r]],response:[Cr,[kr,An]],data:[]},{name:"QueryStateProof",request_msg_type:80,response_msg_type:81,transaction_type:"",request:[Cr,[Tr,_r]],response:[Cr,[kr,An]],data:[]},{name:"QueryTransactionProof",request_msg_type:72,response_msg_type:73,transaction_type:"",request:[Cr,[Tr,fr]],response:[Cr,[kr,Mn]],data:[]},{name:"QueryReceiptProof",request_msg_type:82,response_msg_type:83,transaction_type:"",request:[Cr,[Tr,fr]],response:[Cr,[kr,Wn]],data:[]},{name:"QueryBlockHeaderInfos",request_msg_type:74,response_msg_type:75,transaction_type:"",request:[Cr,[Tr,fr,Sr,{name:"max_amount",type:"decimal"},{name:"reverse",type:"decimal"}]],response:[Cr,[kr,jn]],data:[]},{name:"QueryBlockReceiptInfos",request_msg_type:76,response_msg_type:77,transaction_type:"",request:[Cr,[Tr,fr]],response:[Cr,[kr,zn]],data:[]},{name:"QueryBlockBodyInfos",request_msg_type:78,response_msg_type:79,transaction_type:"",request:[Cr,[Tr,fr]],response:[Cr,[kr,Hn]],data:[]},{name:co,request_msg_type:8,response_msg_type:20,transaction_type:10,request:[Cr,[Tr,Ur]],response:[Cr,[kr,fr]],data:[Tn]},{name:uo,request_msg_type:10,response_msg_type:22,transaction_type:12,request:[Cr,[Tr,Ur]],response:[Cr,[kr,fr]],data:[Tn]},{name:po,request_msg_type:9,response_msg_type:21,transaction_type:11,request:[Cr,[Tr,Ur]],response:[Cr,[kr,fr]],data:[{name:"parameter",type:"bytes"}]},{name:"EventAccount",request_msg_type:120,response_msg_type:Qn,transaction_type:"",request:[Cr,[Tr,kn,_r]],response:[Cr,[kr,Sn]],data:[]},{name:yo,request_msg_type:121,response_msg_type:Qn,transaction_type:"",request:[Cr,[Tr,kn,_r]],response:[Cr,[kr,Sn]],data:[]},{name:"EventTopics",request_msg_type:122,response_msg_type:Qn,transaction_type:"",request:[Cr,[Tr,kn,[br]]],response:[Cr,[kr,Sn]],data:[]},{name:"EventBlock",request_msg_type:123,response_msg_type:Qn,transaction_type:"",request:[Cr,[Tr,kn,qr]],response:[Cr,[kr,Sn]],data:[]},{name:ho,request_msg_type:125,response_msg_type:136,transaction_type:"",request:[Cr,[Tr,Sn]],response:[Cr,[kr,{name:"event_type",type:"decimal"},{name:"event_data",type:"bytes"}]],data:[]},{name:"EventCancel",request_msg_type:134,response_msg_type:135,transaction_type:"",request:[Cr,[Tr,[Sn]]],response:[Cr,[xr,qr,wr,Er]],data:[]},{name:"LocalTransaction",request_msg_type:1,response_msg_type:13,request:[Cr,[Tr,Sr,Ur]],response:[Cr,[kr,fr,Rr]],data:[]},{name:fo,request_msg_type:800,response_msg_type:801,transaction_type:500,request:[Cr,[Tr,Ur]],response:[Cr,[kr,fr]],data:[{name:"encrypted_tx",type:"bytes"}]}].forEach((e=>{mo[e.name]=e,lo[e.response_msg_type]=e}));var No=function(){};No.prototype.encodeParams=function(e,t,r,n){let s="";if(!1===Te(e)||!1===ke(t)||!1===Se(r))return s;if(!1===ke(t.schema)||!t.schema[e]||!r)return s;if(!1===ke(t.schema[e])||!1===ke(t.schema[e].fields))return s;let a=Object.keys(t.schema[e].fields);if(Se(r)&&a.length!==r.length)return s;let i={},c=0;r&&Se(r)&&a.forEach((function(e){i[e]=r[c],c++}));const u=t.toBuffer(e,i),p=t.toBuffer("string",e),f=t.toBuffer("bytes",u),y=o.Buffer.concat([p,f]);if(n){let e=new o.Buffer(4);e.writeUInt32BE(y.length),s=e.toString("hex")+y.toString("hex")}else s=y.toString("hex");return s},No.prototype.decodeParam=function(e,t,r){return e&&t&&r?!1==("function"==typeof e.fromBuffer)?null:e.fromBuffer(t,r):null};var Io=new No;const Ao={name:"uint64",Identity:"bytes",checksum160:"fixed_bytes20",checksum256:"fixed_bytes32",checksum512:"fixed_bytes64",signature:"fixed_bytes65",public_key:"fixed_bytes33",message_type:"fixed_string16",symbol:"uint64",symbol_code:"uint64",field_name:"string",account_name:"name",permission_name:"name",type_name:"string",table_name:"name",scope_name:"name",action_name:"string",time_point:"int64",time_point_sec:"time",timestamp:"uint32",block_timestamp_type:"timestamp",block_id:"fixed_bytes32",checksum_type:"fixed_bytes32",checksum256_type:"fixed_bytes32",checksum512_type:"fixed_bytes64",checksum160_type:"fixed_bytes20",sha256:"fixed_bytes32",sha512:"fixed_bytes64",sha160:"fixed_bytes20",weight_type:"uint16",block_num_type:"uint32",share_type:"int64",digest_type:"checksum_type",context_free_type:"bytes",unsigned_int:"varuint32",bool:"uint8",extensions_type:{base:"",fields:{type:"uint16",data:"bytes"}},transaction_header:{base:"",fields:{expiration:"time",ref_block_num:"uint16",ref_block_prefix:"uint32",max_net_usage_words:"unsigned_int",max_cpu_usage_ms:"uint8",delay_sec:"unsigned_int"}},transaction:{base:"transaction_header",fields:{context_free_actions:"action[]",actions:"action[]",transaction_extensions:"extensions_type[]"}},signed_transaction:{base:"transaction",fields:{signatures:"signature[]",context_free_data:"bytes[]"}},fields:"field_def[]",field_def:{fields:{name:"field_name",type:"type_name"}},type_def:{base:"",fields:{new_type_name:"type_name",type:"type_name"}},struct_def:{base:"",fields:{name:"type_name",base:"type_name",fields:"field_def[]"}},clause_pair:{base:"",fields:{id:"string",body:"string"}},error_message:{base:"",fields:{error_code:"uint64",error_msg:"string"}},abi_def:{base:"",fields:{version:"string",types:"type_def[]",structs:"struct_def[]",actions:"action_def[]",tables:"table_def[]",ricardian_clauses:"clause_pair[]",error_messages:"error_message[]",abi_extensions:"extensions_type[]"}},table_def:{base:"",fields:{name:"table_name",index_type:"type_name",key_names:"field_name[]",key_types:"type_name[]",type:"type_name"}},permission_level:{base:"",fields:{actor:"account_name",permission:"permission_name"}},action:{base:"",fields:{name:"action_name"}},action_def:{base:"",fields:{name:"string",type:"type_name"}}};const Ko=e=>({"abi_def.fromObject":e=>{if("string"==typeof e){let t=""+o.Buffer.from(e,"hex");return 0===t.length&&(t=""+o.Buffer.from(e)),JSON.parse(t)}return o.Buffer.isBuffer(e)?JSON.parse(""+e):null}}),Oo=e=>({"setcode.code.fromObject":({object:t,result:r})=>{try{const n=""+t.code;if(/^\s*\(module/.test(n)){const t=e.binaryen;e.debug&&console.log("Assembling WASM..");const s=o.Buffer.from(t.parseText(n).emitBinary());r.code=s}else r.code=t.code}catch(e){throw console.error(e,t.code),e}}});function Do(e){null==e&&(e={}),e.abiCache={abi:function(e,n){if(n){o.Buffer.isBuffer(n)&&(n=JSON.parse(n));const s=function(e,t){const r={};e.types&&e.types.forEach((e=>{r[e.new_type_name]=e.type}));e.structs&&e.structs.forEach((e=>{const t={};var n,o=V(e.fields);try{for(o.s();!(n=o.n()).done;){const e=n.value;t[e.name]=e.type}}catch(e){o.e(e)}finally{o.f()}r[e.name]={base:e.base,fields:t,results:e.results},""===e.base&&delete r[e.name].base}));e.interfaces&&e.interfaces.forEach((e=>{const n=r[e.type];n?n.interface={name:e.name}:console.error("Missing abiSchema type",e.type,t)}));return r}(n,e),a=((e={},t)=>{const r=Object.assign({},Ko(),Oo(e),e.override),n=Object.assign({},{},e.customTypes);(e=Object.assign({override:r},{customTypes:n},e)).sort=Object.assign({},e.sort);const o=Object.assign({},Ao,t),s=A.default(o,e),a=s.structs,i=s.types,c=s.errors,u=s.fromBuffer,p=s.toBuffer;if(0!==c.length)throw Error(JSON.stringify(c,null,4));return{structs:a,types:i,fromBuffer:u,toBuffer:p}})(t,s);return r[e]=Object.assign({abi:n,schema:s},a)}const s=r[e];if(null==s)throw Error(`Abi '${e}' is not cached`);return s}};const t=Object.assign({},{defaults:!0},e),r={};return e.abiCache}function Lo(e,t){const r=K.default.md.sha256.create().update(t,"utf8");ee("[signMessage] message hash:",r.digest().toHex());const n=""+K.default.pki.privateKeyFromPem(e).sign(r),o=Buffer.from(K.default.util.binary.raw.decode(n)).toString("hex");return ee("[signMessage] result:",o),o}function Mo(e,t){if(ee("[parsePrivateKeyToAES] privateKey:",e),ee("[parsePrivateKeyToAES] passphrase:",t),J){const r=require("crypto").createPrivateKey({format:"pem",key:e,passphrase:t}).export({type:"sec1",format:"pem",cipher:"aes-256-cbc",passphrase:t});return ee("[parsePrivateKeyToAES] use node crypto, result:",r),r}return ee("[parsePrivateKeyToAES] 浏览器端需要用户手动进行转换"),e}function Wo(e,t){return Do().abi(e,Buffer.from(t))}function jo(e,t){return Uo.apply(this,arguments)}function Uo(){return(Uo=z((function*(e,t){ee("[utils/mychain] getUserInfo");const r=bt(Mo(e,t),t);if(!r)throw Error("[utils/mychain] 获取用户信息失败，请检查 account 相关配置");return r}))).apply(this,arguments)}function zo(e){const t=e.startsWith("0x")?e.substring(2):e;return Buffer.from(t,"hex").toString("base64")}function Fo(e){return e.startsWith("0x")?e.substring(2):e}function Ho(e){return new Promise((t=>{setTimeout((()=>{t()}),e)}))}const Vo=[3e4,1e4,5e3,2e3,1e3];class Qo extends O.default{queryTransactionReceiptWithRetry(e,t,r=Vo.length-1){var n=this;return z((function*(){0>r?yield Ho(3e4):yield Ho(Vo[r]);try{return yield n.queryTransactionReceipt(e)}catch(o){if("404"!==o.code&&"414"!==o.code)throw ee(`code is ${o.code}, stop retry`),o;if(t){if(Date.now()>t)throw Error("queryTransactionReceipt timeout")}else if(0===r)throw Error("queryTransactionReceipt retry times out");return yield n.queryTransactionReceiptWithRetry(e,t,r-1)}}))()}}const $o={ecdhCurve:"secp256k1:prime256v1"};class Yo{constructor({host:e,port:t,clients:r,timeout:n,cert:o,ca:s,key:a,passphrase:i,checkServerIdentity:c,sendCallback:u},p){this.callback=void 0,this.sendCallback=void 0,this.retryNum=void 0,this.clients=void 0,this.currentClient=void 0,this.host=void 0,this.port=void 0,this.timeout=void 0,this.cert=void 0,this.ca=void 0,this.key=void 0,this.passphrase=void 0,this.checkServerIdentity=void 0,this.socket=void 0,this.callback=p,this.sendCallback=u||"",this.retryNum=0;let f=e,y=t,d=r;f&&y?(Array.isArray(r)||(d=[]),d=[{host:f,port:y}].concat(d)):Array.isArray(r)&&r.length&&(f=r[0].host,y=r[0].port),this.clients=d||[],this.currentClient=0,this.resetConnect({host:e,port:t,timeout:n,cert:o,ca:s,key:a,passphrase:i,checkServerIdentity:c})}doCallback(e,t){"function"==typeof this.callback&&this.callback(e,t)}setConfig({host:e,port:t,timeout:r,cert:n,ca:o,key:s,passphrase:a,checkServerIdentity:i}){this.host=e||"localhost",this.port=t||"18130",this.timeout=r||3e4,this.cert=n||"",this.ca=o||"",this.key=s||"",this.passphrase=a||"",this.checkServerIdentity=i}connect(){const e=D.default.createSecureContext({cert:this.cert,ca:[this.ca],key:this.key,passphrase:this.passphrase,ciphers:"ALL",ecdhCurve:$o.ecdhCurve}),t={host:this.host,port:this.port,secureContext:e,checkServerIdentity:void 0};this.checkServerIdentity||(t.checkServerIdentity=()=>{});const r=D.default.connect(t,(()=>{r.authorized?(this.retryNum=0,this.doCallback()):this.doCallback(ir.unauthorized)}));return r}resetConnect(e){this.setConfig(e),this.socket=this.connect();let t=null;this.socket.on("readable",(e=>{if(t||(t=this.socket.read(16)),!t)return;const r=Ue(t),n=this.socket.read(r-16);if(!n)return;const o=function(e,t){return{total_len:Ue(e),version:e.readInt16BE(4),magic1:e.readInt8(6),magic2:e.readInt8(7),reserved1:e.readInt32BE(8),reserved2:e.readInt32BE(12),data:He(t)}}(t,n);t=null,"function"==typeof this.sendCallback&&this.sendCallback(e,o.data)})),this.socket.on("close",(()=>{if(4>this.retryNum)this.retryNum++,setTimeout((()=>{this.resetConnect(e)}),1e3);else{this.currentClient++;const t=this.clients[this.currentClient];t&&setTimeout((()=>{this.retryNum=0,this.resetConnect(j(j({},e),{},{host:t.host,port:t.port}))}),1e3)}})),this.socket.on("error",(e=>{console.error(e)}))}send(e){const t=function(e){const t=Array.isArray(e)?ze(e):e,r=16+t.length,n=o.Buffer.alloc(16);return n.writeInt32BE(r,0),n.writeInt16BE(2,4),n.writeInt8(51,6),n.writeInt8(119,7),n.writeInt32BE(0,8),n.writeInt32BE(0,12),o.Buffer.concat([n,t],r)}(e);this.socket.write(t,"buffer",(()=>{}))}}const Jo=function(e,t){return new Yo(e,t)};Jo.setEcdhCurve=function(e){$o.ecdhCurve=e},Jo.setPrime256v1EcdhCurve=function(){this.setEcdhCurve("prime256v1")};class Go{constructor(e,t){var r=this;this.sender=null,this.callbacks={},this.sendCache=[],this.sessionId="",this.callback=null,this.currentSequence=1,this.userPublicKey=void 0,this.userSignature=void 0,this.userPrivateKey=void 0,this.userRecoverPrivateKey=void 0,this.userRecoverPublicKey=void 0,this.options=void 0,this.userKeySeted=!1,this.setUserKey=z((function*(){if(r.userKeySeted)return;const e=r.options,t=e.accountPrivateKey,n=e.accountPrivateKeyPassword,o=e.accountRecoverPrivateKey,s=e.accountRecoverPrivateKeyPassword,a=yield jo(t,n);if(o){const e=yield jo(o,s);r.userRecoverPrivateKey=Pe(e.privateKey),r.userRecoverPublicKey=Pe(e.publicKey)}r.userPublicKey=Pe(a.publicKey||"0x97466f2b32bc3bb76d4741ae51cd1d8578b48d3f1e68da206d47321aec267ce78549b514e4453d74ef11b0cd5e4e4c364effddac8b51bcfc8de80682f952896f"),r.userPrivateKey=Pe(a.privateKey||"0x3ecb44df2159c26e0f995712d4f39b6f6e499b40749b1cf1246c37f9516cb6a4"),r.userKeySeted=!0})),this.sendCallback=(e,t)=>{const r=function(e){let t=parseInt(e[0],16);e[0]&&we(e[0])&&(t=parseInt(e[0].toString("hex"),16));const r=lo[t];if(!r){if(e[0]&&e[0][0]){const t="Handshake",r=wo(e,pr);return r.api=t,r}throw Error('msg_type "'+t+'" is not error')}const n=r.name,o=wo(e,r.response);return o.api=n,o}(t);if(ee("[TSL connector] sendCallback get data",r),"Handshake"===r.api){if(this.sessionId=r.session_id||"","function"==typeof this.callback&&(this.callback(e,r),this.callback=null),this.sendCache.length){let e=this.sendCache.shift();for(;e;)this._send(e.rlpData),e=this.sendCache.shift()}}else{const t=this.callbacks[r.sequence];"function"==typeof t&&t(0!==r.return_code?new ue("[TLSConnector] request failed, code: "+r.return_code,r.return_code+"",r):e,r)}},this.getSequence=()=>this.currentSequence++,this.getBaseData=z((function*(){return yield r.setUserKey(),{isSign:void 0===r.options.isSign||r.options.isSign,from:r.options.account,userPrivateKey:r.userPrivateKey,userPublicKey:r.userPublicKey,userRecoverPrivateKey:r.userRecoverPrivateKey,userRecoverPublicKey:r.userRecoverPublicKey}})),this._send=e=>{ee("[TSL connector] send data",e),this.sender.send(e)},this.handshake=z((function*(){ee("[TSL connector] handshake...");const e=r.options.nonce,t=void 0===e?"hello world":e;yield r.setUserKey(),r.userSignature=Ct(t,r.userPrivateKey),r.sender.send([t,r.userPrivateKey,r.userSignature,0])})),this.callback=t,this.options=e,this.sender=Jo(j(j({},e),{},{sendCallback:this.sendCallback}),(e=>{e&&(console.error(e),t&&t(e)),this.handshake()}))}send(e,t){var r=this;return z((function*(){return new Promise(((n,o)=>{r.callbacks[t]=(e,t)=>{e?o(e):n(t)},r.sessionId?r._send(e):r.sendCache.push({sequence:t+"",rlpData:e})}))}))()}}function Xo(){return Xo=z((function*(e,t){const r=t.getSequence(),n={sequence:r,group_id:e.groupId||"0x0000000000000000000000000000000000000000",hash:go(e.hash)},o=Co(Yn,n);return yield t.send(o,r)})),Xo.apply(this,arguments)}function Zo(){return Zo=z((function*(e,t){const r=t.getSequence(),n=go(e.from),o=go(e.to),s=yield t.getBaseData();s.sequence=r;const a=[];e.authMap.forEach((e=>{a.push(e.authKey),a.push(e.authWeight)}));const i={identity:o,recover_key:e.recoveryKey,auth_map:Fe(a)},c=ko($n,{from:n,to:o,data:Fe(vo($n,i))},s),u=Co($n,c);return yield t.send(u,r)})),Zo.apply(this,arguments)}function es(){return es=z((function*(e,t){const r=t.getSequence(),n=go(e.account),o=yield t.getBaseData();o.sequence=r;const s=ko(eo,{from:n,to:n,data:Fe(vo(eo,{auth_key:e.authMap[0].key,auth_weight:100}))},o),a=Co(eo,s);return yield t.send(a,r)})),es.apply(this,arguments)}function ts(){return ts=z((function*(e,t){const r=t.getSequence(),n=e.contract,o=yield t.getBaseData();o.sequence=r;const s=n.generateDeployCode(e.code),a=ko(co,{from:go(e.from),to:go(n.contractName),data:vo(co,{code:s})[0]||""},o),i=Co(co,a);if(e.encrypt){const s=So({from:go(e.from),to:go(n.contractName),data:vo(fo,{encrypted_tx:wt(e.publicKey,i,e.aesKey,a.hash,e.encryptType)})[0]||""},o,a.timestamp,a.hash);return yield t.send(Co(fo,s),r)}return yield t.send(i,r)})),ts.apply(this,arguments)}function rs(){return rs=z((function*(e,t){const r=t.getSequence(),n=yield t.getBaseData();n.sequence=r;let o,s=e.code;0===s.indexOf("0x")&&(s=s.slice(2)),o=e.vm===exports.VmType.EVM?"01":"02",s="0x"+o+s;const a=ko(uo,{from:go(e.contractName),to:go(e.contractName),data:vo(uo,{code:s})[0]||""},n),i=Co(uo,a);return yield t.send(i,r)})),rs.apply(this,arguments)}function ns(){return ns=z((function*(e,t){const r=t.getSequence(),n=e.contract,o=yield t.getBaseData();o.sequence=r;const s=n.generateCallCode(e.methodName,e.args),a=ko(po,{from:go(e.from),to:go(n.contractName),data:vo(po,{parameter:s})[0]||""},o),i=Co(po,a);if(e.encrypt){const s=So({to:go(n.contractName),data:vo(fo,{encrypted_tx:wt(e.publicKey,i,e.aesKey,a.hash,e.encryptType)})[0]||""},o,a.timestamp,a.hash);return yield t.send(Co(fo,s),r)}return yield t.send(i,r)})),ns.apply(this,arguments)}function os(){return os=z((function*(e,t){const r=t.getSequence(),n=yield t.getBaseData();n.sequence=r;const o=ko(Jn,{from:go(e.from),to:go(e.to),data:"0x0",value:e.value},n),s=Co(Jn,o);return yield t.send(s,r)})),os.apply(this,arguments)}function ss(){return ss=z((function*(e,t){const r=go(e.account),n=t.getSequence(),o=yield t.getBaseData();o.sequence=n;const s=ko(Gn,{from:r,to:r,data:vo(Gn,{recover_key:e.recoverKey})[0]||""},o),a=Co(Gn,s);return yield t.send(a,n)})),ss.apply(this,arguments)}function as(){return as=z((function*(e,t){const r=go(e.account),n=t.getSequence(),o=yield t.getBaseData();if(!o.userRecoverPrivateKey)throw Error("userRecoverPrivateKey is not set");o.sequence=n;const s=ko(Xn,{from:r,to:r},o,o.userRecoverPrivateKey),a=Co(Xn,s);return yield t.send(a,n)})),as.apply(this,arguments)}function is(){return is=z((function*(e,t){const r=go(e.account),n=t.getSequence(),o=yield t.getBaseData();if(!o.userRecoverPrivateKey)throw Error("userRecoverPrivateKey is not set");o.sequence=n;const s=ko(Zn,{from:r,to:r,data:Fe(vo(Zn,{auth_key:e.authKey,auth_weight:100}))},o,o.userRecoverPrivateKey),a=Co(Zn,s);return yield t.send(a,n)})),is.apply(this,arguments)}function cs(){return cs=z((function*(e,t){const r=t.getSequence(),n=Co(ho,{sequence:r,filter_id:e.filterId}),o=yield t.send(n,r);if(o.event_data){const e=He(je(o.event_data));return j(j({},o),{},{event_data:xo(o.event_type,e)})}return o})),cs.apply(this,arguments)}var us=function(){var e=z((function*(e,t){const r=t.method,n=void 0===r?"GET":r,o=t.body,s=void 0===o?{}:o,a=t.headers,i=void 0===a?{}:a;if("undefined"!=typeof fetch){const t=yield fetch(e,{method:n,body:JSON.stringify(s),headers:j({"Content-Type":"application/json"},i)});if(!t.ok)throw Error("[utils/fetch] res.ok is false");return t.json()}return(yield L.default(e,{method:n,data:s,headers:i})).data}));return function(t,r){return e.apply(this,arguments)}}();const ps={100:"哈希计算错误",101:"交易指针为空指针",102:"交易的 data 字段不满足类型约束",103:"签名不可用",104:"交易的发送账户余额不足",105:"交易的时间戳所在时间段无效，合约平台会对时间戳做检查，不在特定的时间范围内将被认为不可用",106:"交易的目标账户不包含可用的合约哈希",107:"交易的目标账户为空",108:"创建账户的交易不满足需求",109:"部署合约的交易不满足需求",110:"基本的交易类型需求校验失败",111:"交易类型未知",112:"恢复时间未知",113:"交易被重放",114:"交易的 data 字段太大，超过系统限制",115:"交易消耗的 gas 太大，超过系统限制",116:"交易的提交账户在区块链上不存在，提交账户是交易数据结构中的 from 字段",117:"交易的提交账户为空",118:"交易的提交账户被冻结",119:"交易的提交账户正在恢复中",120:"交易的目标账户在区块链上不存在，目标账户是交易数据结构中的 to 字段",121:"交易的目标账户被冻结",122:"交易的签名权重不足",123:"交易的目标账户已经存在",124:"块指针为空",125:"块的父级不存在",126:"块的父级无效，因为哈希和块号不匹配",127:"块的时间戳不满足单调递增的要求",128:"块的交易根哈希未正确计算",129:"块的交易接收根哈希未正确计算",130:"块的共识证明无效",131:"其他错误",132:"不满足交易的 group id 约束要求",133:"不满足交易的版本约束要求",134:"账户为空",135:"合约为空",136:"验证权限失败",137:"锚数据验证失败",140:"验证预留ID失败",141:"已打开受管理的应用程序合同",142:"更新合同无效",143:"更新合同状态无效",144:"不允许更新数据合同",145:"当前交易的合同代码无效",146:"已打开受管理的系统合约",400:"插件不存在",401:"消息转换失败",402:"本地交易执行失败",403:"无法将交易推送至缓存队列",404:"查询无结果",405:"业务不支持",406:"事件不存在",407:"日志实例不存在",408:"交易验证失败",409:"无节点可转发请求",410:"请求转发超时",411:"响应转发超时",412:"添加群链失败",413:"交易尚未验证",414:"交易已验证，等待执行",415:"节点无法提供服务，可能有两种原因：<br>1. 当前链在指定时间内无法成块；<br>2. 当前链内请求积压超过设定限制",416:"用于根据时间戳查询区块，请求中的时间戳小于创世块的时间戳",417:"转发请求查询无结果，可能是被转发节点处于无法服务状态",418:"注册事件失败，可能是触发事件注册单个 session 事件注册数限制或者节点支持最大事件注册数限制",419:"参数无效",420:"请求权限校验不通过，可能原因有：<br>1. 管理类请求需要校验签名，校验签名不通过；<br>2. 交易内账户涉及黑名单，被节点拒绝",421:"内部错误",422:"故障点不可用",423:"更新故障点案例失败",424:"超出了请求限制",425:"子网不存在",426:"子网不可用",1e3:"世界状态（WS）数据库未初始化",1001:"世界状态中找不到合约的代码哈希",1002:"世界状态中未找到该状态对象",1003:"状态对象（ID）被占用",1004:"指定的状态对象（ID）已删除",1005:"指定的状态对象余额不足",1006:"转账失败",1007:"指定的公钥不存在",1008:"余额溢出",1009:"未知故障",1010:"指定的权重值无效",1012:"发布资产失败",1013:"回收资产失败",2e3:"交易执行无法从交易获取足够的燃料",2001:"交易执行无法在区块链中定位到标识",2002:"负载中的权重值无效",2003:"交易负载无效",2004:"恢复时间无效",2005:"交易执行出现未知错误",3e3:"块不存在",3001:"数据库没有数据",3002:"写入数据库失败",3003:"从数据库读取数据失败",3004:"RLP存储解析失败",3005:"无效的ID",3006:"当前数据库的根目录状态无效",3007:"设置根目录失败",3008:"当前数据库数据丢失",3009:"数据覆盖失败",3010:"当前事件状态为空",3011:"最近块为空",3012:"区块编码无效",3013:"存储快照版本失败",3014:"对象状态初始化失败",3015:"对象状态接收无效",3016:"交易上下文为空",3017:"处理内容为空",3018:"merkle 树初始化失败",3019:"清理所有 merkle 树的缓存失败",3020:"清空所有merkle 树的状态失败",4e3:"超过要求的限制",4001:"创建group ID失败",4002:"获取公私钥失败",4003:"存储有关信息失败",4004:"发送已创建分组账号的交易失败",4005:"发送合约分组交易失败",4006:"获取公钥失败",4007:"公钥匹配出错",4008:"节点信息解码错误",4009:"获取密钥对失败",1e4:"虚拟机一般故障",10001:"错误的指令，包含create/create2/suicide/…",10002:"请调整堆栈",10003:"请调整堆栈",10004:"内存错误",10005:"代码为空",10006:"强制重启",10010:"虚拟机版本无效",10025:"由虚拟机参数不匹配引起的错误",10026:"虚拟机更新合约失败",10100:"虚拟机消耗超出限制",10101:"虚拟机创建失败",10102:"虚拟机参数代码为空",10103:"虚拟机参数代码为空",10200:"燃料不足",10201:"由 revert 指令触发的错误",10202:"由 toUint64 方法触发的错误",10203:"由虚拟机上下文static_call为true引起的错误",10204:"虚拟机方法引起的错误",10300:"获取余额失败",10301:"设置存储失败= 108，一般由存储引起",10302:"获取存储失败，一般由加载引起",10303:"转账失败，一般由evm_call调用方法引起",10304:"获取代码失败，一般由extcodecopy/extcodesize instruction or evm_call调用方法引起",10305:"获取块哈希失败，一般由哈希指令引起",10306:"获取代码哈希失败，由用户不存在引起",10307:"受获取燃料受限，由genesis.json设置",10308:"删除存储失败，原因是客户端收到删除存储结果失败",10309:"帐户被冻结，无法调用",10310:"虚拟机获取交易数据失败",10311:"虚拟机获取交易发送方失败",10312:"虚拟机获取交易交易接收器失败",10313:"虚拟机获取交易时间戳失败",10314:"虚拟机获取交易块索引失败",10315:"虚拟机从min_query_block中获取交易",10316:"交易类型不是TX_NATIVE_DEPOSIT_DATA和TX_RELATED_DEPOSIT_DATA",10317:"虚拟机获取交易存款标志失败",10318:"虚拟机获取恢复密钥失败",10319:"虚拟机获取身份验证映射失败",10350:"获得相关交易失败",10500:"虚拟内部错误",10600:"虚拟机创建动态库失败，可能是由本机合约创建动态库引起的",10601:"虚拟机创建socket失败，可能是由本机合约创建的socket方法引起的",10602:"虚拟机绑定socket失败，可能是由于客户端绑定到mychain时的本机协定引起的",10603:"虚拟机侦听socket失败，可能是由于mychain侦听客户端时的本机协定引起的",10604:"虚拟机响应失败，可能是由本机合同响应将数据发送给客户端造成的",10605:"虚拟机读取数据失败，可能是由于mychian读取客户端数据时的本机协定引起的",10606:"虚拟机执行子进程运行客户端失败",10607:"虚拟机fork进程失败，可能是由fork子进程时的本机合约引起的",10608:"虚拟机写入数据失败，可能是由于mychain将数据写入客户端时的幼稚合同引起的",10620:"虚拟机不支持本机合约，可能是由genesis.json中的native_enable引起的",10622:"虚拟机初始化失败，可能是由本地合约初始化方法引起",10623:"虚拟机不部署失败，可能是由于本地合约code引起部署失败",10700:"vm不支持本机预编译协定，没有使用ENABLE_NATIVE_PRECOMPILE_CONTRACT构建",10701:"虚拟机初始化失败，可能是由本机预编译协定init方法引起的",10702:"虚拟机部署失败，可能是由本机预编译合同部署代码引起的",10703:"虚拟机响应失败，可能是由本机预编译合同响应将数据发送给客户端引起的",10750:"合约 ID 不存在",10751:"数据库 ID 不存在",10752:"没有阅读数据合同的许可",10753:"没有写入数据合同的许可",10754:"没有删除数据合同的许可",10755:"数据协定API的输出是固定的，数据流反序列化输出失败",10756:"之前的schema不存在",10757:"当前的schema不存在",10758:"ACL ID不存在",10760:"数据不存在",10900:"参数格式错误",10901:"JSON/XML 的目标路径不存在",10902:"传入的 handler 参数不存在，检查 property_parse 是否执行成功",10903:"数据类型不匹配，当前使用的方法不能获取目标类型的数据",2e4:"SDK 内部错误",20001:"IPC/网络参数错误：协议族不支持的地址族",20002:"IPC/网络参数错误：该地址已被使用",20003:"IPC/网络参数错误：无法分配请求的地址",20004:"IPC/网络运行出错：套接口已连接",20005:"参数列表太长",20006:"数值参数不在域内",20007:"地址不详",20008:"文件描述符不详",20009:"程序加载错误：消息不详",20010:"管道破损",20011:"IPC/网络运行出错：软件问题导致连接中断",20012:"非阻塞和中断 I/O：操作进行中",20013:"IPC/网络运行出错：连接被拒绝",20014:"连接被对方重设",20015:"跨设备链接",20016:"IPC/网络参数错误：目标地址不得为空",20017:"设备或资源忙",20018:"目录不为空，需重新安排",20019:"执行格式错误",20020:"文件已存在",20021:"文件太大",20022:"IPC/网络运行出错：文件名太长",20023:"网络文件系统：功能未实现",20024:"无主机路由，需重新安排",20025:"程序加载错误：标识已被删除",20026:"程序加载错误：非法字节序列",20027:"ioctl 不适合设备",20028:"系统调用中断",20029:"参数无效",20030:"非法寻求",20031:"输入/输出错误",20032:"此为目录",20033:"IPC/网络参数错误：消息太长",20034:"IPC/网络运行出错：网络故障",20035:"IPC/网络运行出错：重置时网络断开连接",20036:"IPC/网络运行出错：网络无法访问",20037:"IPC/网络运行出错：无缓冲空间",20038:"无子程序",20039:"程序加载错误：已保留",20040:"网络文件系统，无锁可用",20041:"程序加载错误：消息流上无消息",20042:"程序加载错误：无预期类型的消息",20043:"IPC/网络参数错误：协议不可用",20044:"设备空间不足",20045:"程序加载错误：无流资源",20046:"设备未配置",20047:"设备不支持该操作",20048:"该文件或目录不存在",20049:"该程序不存在",20050:"非目录",20051:"IPC/网络参数错误：未在套接口上执行套接口操作",20052:"程序加载错误：非流",20053:"IPC/网络运行出错：套接口未连接",20054:"无法分配内存",20055:"IPC/网络参数错误：不支持该操作",20056:"程序加载错误：操作已取消",20057:"非阻塞和中断 I/O：操作进行中",20058:"操作不允许",20059:"仅当编译 __DARWIN_UNIX03 时该值为离散值，或 KERNE：套接口不支持该操作",20060:"非阻塞和中断 I/O：操作将阻塞",20061:"程序加载错误：之前的 Owner 已去世",20062:"权限不足",20063:"程序加载错误：协议错误",20064:"IPC/网络参数错误：不支持该协议",20065:"只读文件系统",20066:"避免资源死锁",20067:"非阻塞和中断 I/O：资源暂时不可用",20068:"结果太大",20069:"程序加载错误：状态不可恢复",20070:"程序加载错误：流 ioctl 超时",20071:"文本文件忙",20072:"IPC/网络运行出错：运行超时",20073:"系统打开的文件太多",20074:"打开的文件太多",20075:"太多链接",20076:"IPC/网络运行出错：符号链接级别太多",20077:"智能设备错误：值太大导致无法存储在数据类型中",20078:"IPC/网络参数错误：套接口协议类型错误",3e4:"SDK 参数无效",30001:"SDK 私钥无效",30002:"SDK 签名工具验证出错",30003:"SDK 不支持编码",30004:"SDK 获取文件输入流失败",30005:"SDK 查找线程失败",30006:"SDK 字节操作失败",30007:"SDK 转换公钥失败",30008:"SDK 消息编码失败",30009:"SDK 读取客户端配置失败",30010:"SDK 初始化失败",30011:"SDK 连接网络失败",30012:"SDK 解码出错",30013:"SDK 不支持该消息类型",30014:"未做握手",30015:"初始化 SSL 上下文失败",30016:"SDK 正在握手",30017:"SDK 无效的公钥",30018:"邮件已达到最大队列大小",60001:"加密交易解密失败",60002:"加密交易中内嵌的不是明文交易",60003:"待处理的交易非加密交易",60004:"TEE 中不支持 native 类型的合约",60005:"加密交易反序列化失败",60006:"合约账户的状态反序列化失败",60007:"非法访问加密的账户数据",60008:"TEE 内不支持的交易类型",60009:"加密回执中的 log 信息失败",60010:"非法访问加密的合约代码",60011:"加密交易的 hash 和时间戳不合法",60012:"交易回执过大",60013:"TEE 内部错误",60014:"合约代码加密失败",60015:"合约代码解密失败",60016:"合约状态加密失败",60017:"合约状态解密失败",60018:"合约状态反序列化失败",60019:"合约状态序列化失败",60020:"合约账户基本信息解密失败",60021:"合约账户基本信息加密失败",60022:"TEE 中不允许执行明文合约",60023:"TEE 中不允许更新明文合约",60024:"按不存在的方法类型进行查询",60025:"查询时使用的 hash 不存在",60026:"不允许查询",60027:"解密隐私交易回执失败",60028:"对象状态初始化失败",60029:"获取代码状态失败",60030:"删除存储状态失败",60031:"错误的虚拟机类型",60032:"设置代码状态失败",60033:"查询时交易不匹配",60034:"从块获取交易列表失败",60035:"查询时调用虚拟机失败",60036:"查询时不被允许",60037:"查询RLP失败",60038:"更新合约无效",60039:"查询时该方法不支持",60040:"加密交易的期望合约代码哈希值不匹配",60041:"更新存款合同时，获取公钥失败",7e4:"通用错误",70001:"无效的提供者",70002:"无效的密钥类型",70003:"无效的类",70004:"无效的公钥",70005:"无效的私钥",70006:"无效的消息",70007:"无效的纯文本",70008:"无效的密文",70009:"无效的签名",70010:"无效的对称密钥",70011:"无效的文件路径",70012:"无效的密钥文件",70013:"无效的x509",70101:"算法未初始化",70102:"提供者错误",8e4:"注册失败"};(exports.ChainIds||(exports.ChainIds={})).OpenLab="0b06e2744ad341538b7a3b3cc5ad9e57";class fs{constructor(e){this.requestConfig=void 0,this.tokenPromise=void 0,this.requestConfig=e,this.tokenPromise=this.getToken()}getToken(){var e=this;return z((function*(){const t=e.requestConfig,r=t.accessId,n=t.accessSecret,o=t.baseUrl;ee("[RestRequest] getToken accessId:",r),ee("[RestRequest] getToken accessSecret:",n);const s=""+Date.now(),a=Lo(n,`${r}${s}`),i=yield us(o+"/api/contract/shakeHand",{method:"POST",body:{time:s,accessId:r,secret:a}}),c=i.data,u=i.message;if(i.success&&"200"===i.code)return ee("[RestRequest] getToken token:",c),c;throw Error(u)}))()}request(e,t={},r=1){var n=this;return z((function*(){const o=n.requestConfig.baseUrl+e,s=yield n.tokenPromise,a=t.requestStr?{requestStr:JSON.stringify(t.requestStr)}:{},i=j(j(j({},t),a),{},{token:s});ee("[RestRequest] request url & tokenTimeoutRetryTimes:",o,r),ee("[RestRequest] request body:",i);const c=yield us(o,{method:"POST",body:i});if(ee("[RestRequest] response body:",c),!c.success||!("200"===c.code||"0"===c.code&&t.secretKey)){if("202"===c.code&&r>0)return ee("[RestRequest] token timeout, retry get token, tokenTimeoutRetryTimes: "+r),n.tokenPromise=n.getToken(),n.request(e,t,r-1);{let e,t=ps[c.code]||c.code,r=c.data;if(/\{.+\}/.test(c.data))try{r=JSON.parse(c.data),r.output&&(e=""+Buffer.from(r.output,"base64"))}catch(e){}throw e?t=`${t} ${e}`:c.data?t=`${t} ${c.data}`:c.message&&(t=`${t} ${c.message}`),new ue(`[RestRequest] request failed, code: ${c.code}, detail: ${t}`,c.code,r)}}if(!/\{.+\}/.test(c.data))return c.data;try{return JSON.parse(c.data)}catch(e){throw new ue("response parse error, code: "+c.code,c.code)}}))()}}function ys(e,t){return t.request("/api/contract/chainCallForBiz",e)}function ds(e,t){return t.request("/api/contract/chainCall",e)}function hs(e,t){return t.request("/api/contract/chainCall",e)}function ls(e,t){return t.request("/api/contract/chainCall",e)}function ms(e,t){return t.request("/api/contract/chainCall",e)}function gs(e,t){return t.request("/api/contract/chainCall",e)}function _s(e,t){return t.request("/api/contract/chainCall",e)}function vs(e,t){return t.request("/api/contract/chainCallForBiz",e)}function bs(e,t){return t.request("/api/contract/chainCall",e)}function Cs(e,t){return t.request("/api/contract/chainCall",e)}function qs(e,t){return t.request("/api/contract/chainCall",e)}function Es(e,t){return t.request("/api/contract/chainCallForBiz",e)}function ws(e,t){return t.request("/api/contract/chainCallForBiz",e)}function xs(e,t){return t.request("/api/contract/chainCall",e)}var Ts=Object.freeze({__proto__:null,deployContractForBiz:ys,deployContract:ds,queryAccount:hs,queryBlockHeader:ls,queryBlock:ms,queryLastBlock:gs,queryTransaction:_s,callContractForBiz:vs,callContract:bs,queryContract:Cs,queryTransactionReceipt:qs,createAccountForBiz:Es,updateContractForBiz:ws,updateContract:xs});function ks(e){return Buffer.from(e,"base64").toString("hex")}function Ss(e){return"0x"+function(e){const t=K.default.md.sha256.create();return t.update(e),t.digest().toHex()}(e)}class Ps extends Qo{getToken(){return this.request.getToken()}constructor(e){super(),this.majorVersion=1,this.config=void 0,this.request=void 0,this.config=e,this.request=new fs({baseUrl:this.config.restUrl,accessId:this.config.accessId,accessSecret:this.config.accessSecret})}generateOrderId(){return`order_myfish_${this.config.accessId}_${v.nanoid()}`}watchContractEvent(e,t,r){throw Error("Not support yet.")}createAccount(){return z((function*(){throw Error("托管密钥方式请使用 createAccountWithKms")}))()}createAccountWithKms(e){var t=this;return z((function*(){const r=`${t.config.tenantId}${C.v4()}`;return{kmsId:r,authKey:yield Es({newAccountId:e.newAccountName,newAccountKmsId:r,method:exports.RestMethods.createAccountForBiz,accessId:t.config.accessId,bizid:t.config.bizid,account:t.config.account,tenantid:t.config.tenantId,mykmsKeyId:t.config.kmsId,orderId:t.generateOrderId()},t.request)}}))()}transferBalance(e){return z((function*(){throw Error("Not support yet.")}))()}setRecoverkey(e){return z((function*(){throw Error("Not support yet.")}))()}preResetPubKey(e){return z((function*(){throw Error("Not support yet.")}))()}resetPubKey(e){return z((function*(){throw Error("Not support yet.")}))()}freezeAccount(e){return z((function*(){throw Error("Not support yet.")}))()}freezeContract(e){return z((function*(){throw Error("Not support yet.")}))()}nativeDepositData(e){return z((function*(){throw Error("Not support yet.")}))()}queryLastBlockHeader(){return z((function*(){throw Error("Not support yet.")}))()}queryTransactionList(e){return z((function*(){throw Error("Not support yet.")}))()}queryTransactionAndReceipt(e){return z((function*(){throw Error("Not support yet.")}))()}queryTimestamp(e){return z((function*(){throw Error("Not support yet.")}))()}queryP2PStatus(e){return z((function*(){throw Error("Not support yet.")}))()}queryConsensusStatus(e){return z((function*(){throw Error("Not support yet.")}))()}queryCommonConsensusStatus(e){return z((function*(){throw Error("Not support yet.")}))()}querySyncStatus(e){return z((function*(){throw Error("Not support yet.")}))()}queryTransactionCacheStatus(e){return z((function*(){throw Error("Not support yet.")}))()}queryBlockCacheStatus(e){return z((function*(){throw Error("Not support yet.")}))()}queryContractNodesStatus(e){return z((function*(){throw Error("Not support yet.")}))()}queryContractConfigStatus(e){return z((function*(){throw Error("Not support yet.")}))()}queryLogLevel(e){return z((function*(){throw Error("Not support yet.")}))()}updateBlackList(e){return z((function*(){throw Error("Not support yet.")}))()}queryBlockProof(e){return z((function*(){throw Error("Not support yet.")}))()}queryBlockHeaderProof(e){return z((function*(){throw Error("Not support yet.")}))()}queryStateProof(e){return z((function*(){throw Error("Not support yet.")}))()}queryTransactionProof(e){return z((function*(){throw Error("Not support yet.")}))()}queryReceiptProof(e){return z((function*(){throw Error("Not support yet.")}))()}queryBlockHeaderInfos(e){return z((function*(){throw Error("Not support yet.")}))()}queryBlockReceiptInfos(e){return z((function*(){throw Error("Not support yet.")}))()}queryBlockBodyInfos(e){return z((function*(){throw Error("Not support yet.")}))()}queryAccount({account:e}){var t=this;return z((function*(){const r=yield hs({method:exports.RestMethods.queryAccount,requestStr:{queryAccount:e},bizid:t.config.bizid,accessId:t.config.accessId},t.request);return{address:r.id,balance:r.balance,encryptionKey:r.encryption_key,recoveryKey:r.recovery_key,recoveryTime:r.recovery_time,authMap:r.auth_map.map((e=>({key:e.key,weight:e.value}))),status:r.status,version:r.version}}))()}updateAuthMap(){return z((function*(){throw Error("Rest 暂不支持 updateAuthMap")}))()}queryBlockHeader({blockNumber:e}){var t=this;return z((function*(){return(yield ls({method:exports.RestMethods.queryBlockHeader,requestStr:e,bizid:t.config.bizid,accessId:t.config.accessId},t.request)).block.blockHeader}))()}queryBlock({blockNumber:e}){var t=this;return z((function*(){const r=yield ms({method:exports.RestMethods.queryBlock,requestStr:e,bizid:t.config.bizid,accessId:t.config.accessId},t.request);return{gasUsed:r.header.gas_used,hash:r.header.hash,logBloom:r.header.log_bloom,number:r.header.number,parentHash:r.header.parent_hash,receiptRoot:r.header.receipt_root,stateRoot:r.header.state_root,timestamp:r.header.timestamp,transactionRoot:r.header.transaction_root,version:r.header.version,receiptList:r.body.receipt_list,consensusProof:r.body.consensus_proof,transactionList:r.body.transaction_list}}))()}queryLastBlock(){var e=this;return z((function*(){return(yield gs({method:exports.RestMethods.queryLastBlock,bizid:e.config.bizid,accessId:e.config.accessId},e.request)).block.blockHeader}))()}queryTransaction({hash:e,tee:t}){var r=this;return z((function*(){const n=yield _s({method:exports.RestMethods.queryTransactionFromBlockchain,hash:e,bizid:r.config.bizid,accessId:r.config.accessId,secretKey:t?r.config.teePassword:void 0},r.request);return{blockNumber:n.blockHeight,hash:"0x"+n.hash,data:n.transactionV10.data,from:"0x"+n.transactionV10.from,to:"0x"+n.transactionV10.to}}))()}queryTransactionReceipt(e){var t=this;return z((function*(){const r=yield qs({method:exports.RestMethods.queryTransactionReceipt,hash:e.hash,bizid:t.config.bizid,accessId:t.config.accessId,secretKey:e.tee?t.config.teePassword:void 0},t.request);return ee("[CloudCryptoRestProvider] queryTransactionReceipt gas used:",r.gasUsed),{blockNumber:r.blockNumber,gasUsed:r.gasUsed,output:ks(r.output),code:r.result,logs:r.logs.map((e=>({from:Po(e.from.value),to:Po(e.to.value),logData:ks(e.logData),topics:e.topics})))}}))()}deployContract(e,t,r){var n=this;return z((function*(){let o;if(e.vmType===exports.VmType.WASM){var s;o=null===(s=t.code)||void 0===s?void 0:s.toString("base64")}else{if(e.vmType!==exports.VmType.EVM)throw Error(`[deployContract] vmType must be ${exports.VmType.WASM} or ${exports.VmType.EVM}`);var a;o=null===(a=t.code)||void 0===a?void 0:a.toString("utf-8")}const i={accessId:n.config.accessId,bizid:n.config.bizid,contractCode:o,account:n.config.account,tenantid:n.config.tenantId,mykmsKeyId:n.config.kmsId,orderId:n.generateOrderId(),contractName:e.contractName,gas:t.gas,secretKey:t.tee?n.config.teePassword:void 0};let c;c=r?yield ws(j(j({},i),{},{method:e.vmType===exports.VmType.WASM?exports.RestMethods.updateWasmContractForBiz:exports.RestMethods.updateSolidityContractForBizAsync}),n.request):yield ys(j(j({},i),{},{method:e.vmType===exports.VmType.WASM?exports.RestMethods.deployWasmContractForBiz:exports.RestMethods.deploySolidityContractForBizAsync}),n.request);let u=e.vmType===exports.VmType.WASM?c.txData.txHash:c;if(t.tee){u=Buffer.from(u.value,"base64").toString("hex");return{txHash:u,teeSecret:qt(n.config.teePassword,u).toString("hex")}}return{txHash:u}}))()}updateContract(e,t){var r=this;return z((function*(){return r.deployContract(e,t,!0)}))()}callContract(e,{methodName:t,args:r=[],argsType:n=[],returnType:o,gas:s,tee:a,local:i,timeout:c}){var u=this;return z((function*(){const p=e.contractName,f=e.abi;if(e.vmType===exports.VmType.EVM)throw Error("[callContract] Rest 托管密钥方式暂时不支持调用 Solidity 合约");const y=yield vs({methodSignature:`${t}(${n?n.join(","):""})`,inputParamListStr:JSON.stringify(r),outTypes:o?`["${o}"]`:"[]",method:exports.RestMethods.callWasmContractForBizAsync,accessId:u.config.accessId,bizid:u.config.bizid,account:u.config.account,tenantid:u.config.tenantId,mykmsKeyId:u.config.kmsId,orderId:u.generateOrderId(),contractName:p,isLocalTransaction:i,gas:s,secretKey:a?u.config.teePassword:void 0},u.request),d="0x"+y,h=a?qt(u.config.teePassword,d).toString("hex"):"";ee("[CloudCryptoRestProvider] callContract txHash:",y),ee("[CloudCryptoRestProvider] callContract teeSecret:",h);const l=yield u.queryTransactionReceiptWithRetry({hash:d,tee:a},c?Date.now()+c:void 0),m=l.output,g=l.code;let _=m;ee("[CloudCryptoRestProvider] callContract output:",_);const v=Wo(p,f);a&&m&&(_=Tt(m,u.config.teePassword,y));const b=function(e,t,r){var n,o,s;if(!r)return;ee("[RestProvider] parseReceiptReturnOutput methodName:",e),ee("[RestProvider] parseReceiptReturnOutput output:",r);const a=null===(n=t.schema)||void 0===n||null===(o=n[e])||void 0===o||null===(s=o.results)||void 0===s?void 0:s[0];if(ee("[RestProvider] parseReceiptReturnOutput type:",a),!t||!a)throw Error("[RestProvider] parseReceiptReturnOutput not find abi schema for parse output: "+r);return"function"!=typeof t.fromBuffer?null:t.fromBuffer(a,Buffer.from(r,"hex"))}(t,v,_);return{returnValue:b,txHash:d,teeSecret:a?h:void 0,receiptCode:g}}))()}queryContract(e){var t=this;return z((function*(){return{code:(yield Cs({method:exports.RestMethods.queryContract,bizid:t.config.bizid,contractName:e.contractName,accessId:t.config.accessId},t.request)).contract.code}}))()}sign(e){return z((function*(){throw Error("暂不支持")}))()}}function Bs(e){console.warn(`[myfish] WalletProvider.${e} 方法暂不支持 TEE 合约`)}exports.AntchainSDKError=ue,exports.BaseProvider=Qo,exports.ChainProvider=class extends Qo{constructor(e={}){var t,r;super(),this.majorVersion=1,this.config=void 0,this.teeExtraParams=void 0,this.connector=void 0,this.eventsId=[],this.EVENTLOOPTIME=6e3,this.eventTimeout=void 0,this.config=e,this.teeExtraParams={aesKey:null===(t=this.config)||void 0===t?void 0:t.teePassword,encrypt:!0,encryptType:"02",publicKey:null===(r=this.config)||void 0===r?void 0:r.teePublicKey},this.connector=new Go({host:this.config.host,port:this.config.port,cert:this.config.cert,ca:this.config.ca,passphrase:this.config.privateKeyPassword,key:this.config.privateKey,account:this.config.account,accountPrivateKey:this.config.accountPrivateKey,accountPrivateKeyPassword:this.config.accountPrivateKeyPassword,accountRecoverPrivateKey:this.config.accountRecoverPrivateKey,accountRecoverPrivateKeyPassword:this.config.accountRecoverPrivateKeyPassword})}startEventLoop(){this.eventTimeout||0===this.eventsId.length||this.fetchEvents()}fetchEvents(){var e=this;this.eventsId.forEach(function(){var t=z((function*(t){const r=yield function(e,t){return cs.apply(this,arguments)}({filterId:t},e.connector);ee("get res with event id and res",t,r),e.emit(t,r)}));return function(e){return t.apply(this,arguments)}}()),this.eventTimeout=setTimeout((()=>{this.fetchEvents()}),this.EVENTLOOPTIME)}watchContractEvent(e,t,r){(function(e,t){const r=t.getSequence(),n={sequence:r,event_type:e.type,identity:go(e.contractName)},o=Co(yo,n);return t.send(o,r)})({contractName:e.contractName,type:exports.EventListenerType.CONTRACT},this.connector).then((({filter_id:e})=>{this.on(e,r),this.eventsId.push(e),this.startEventLoop()}))}createAccount(e){var t=this;return z((function*(){const r=yield function(e,t){return Zo.apply(this,arguments)}({from:t.config.account,to:e.newAccountName,recoveryKey:e.recoveryKey,authMap:[{authKey:e.authKey,authWeight:100}]},t.connector);return yield t.queryTransactionReceiptWithRetry({hash:r.hash}),{txHash:r.hash}}))()}transferBalance(e){var t=this;return z((function*(){const r=yield function(e,t){return os.apply(this,arguments)}({from:e.from||t.config.account,to:e.to,value:e.value},t.connector);return{txHash:r.hash}}))()}setRecoverkey(e){var t=this;return z((function*(){const r=yield function(e,t){return ss.apply(this,arguments)}({account:e.account||t.config.account,recoverKey:e.recoverKey},t.connector);return{txHash:r.hash}}))()}preResetPubKey(e){var t=this;return z((function*(){const r=yield function(e,t){return as.apply(this,arguments)}({account:e.account||t.config.account},t.connector);return{txHash:r.hash}}))()}resetPubKey(e){var t=this;return z((function*(){const r=yield function(e,t){return is.apply(this,arguments)}({account:e.account||t.config.account,authKey:e.authKey},t.connector);return{txHash:r.hash}}))()}freezeAccount(e){return z((function*(){throw Error("Not support yet.")}))()}freezeContract(e){return z((function*(){throw Error("Not support yet.")}))()}nativeDepositData(e){return z((function*(){throw Error("Not support yet.")}))()}queryLastBlockHeader(){var e=this;return z((function*(){const t=yield function(e,t){const r=t.getSequence(),n=Co(no,{sequence:r});return t.send(n,r)}(0,e.connector),r=t.block_header;return{gasUsed:r.gas_used,hash:r.hash,logBloom:r.log_bloom,number:r.block_number,parentHash:r.parent_hash,receiptRoot:r.receipt_root,stateRoot:r.state_root,timestamp:r.timestamp,transactionRoot:r.transaction_root,version:r.version}}))()}queryTransactionList(e){return z((function*(){throw Error("Not support yet.")}))()}queryTransactionAndReceipt(e){return z((function*(){throw Error("Not support yet.")}))()}queryTimestamp(e){return z((function*(){throw Error("Not support yet.")}))()}queryP2PStatus(e){return z((function*(){throw Error("Not support yet.")}))()}queryConsensusStatus(e){return z((function*(){throw Error("Not support yet.")}))()}queryCommonConsensusStatus(e){return z((function*(){throw Error("Not support yet.")}))()}querySyncStatus(e){return z((function*(){throw Error("Not support yet.")}))()}queryTransactionCacheStatus(e){return z((function*(){throw Error("Not support yet.")}))()}queryBlockCacheStatus(e){return z((function*(){throw Error("Not support yet.")}))()}queryContractNodesStatus(e){return z((function*(){throw Error("Not support yet.")}))()}queryContractConfigStatus(e){return z((function*(){throw Error("Not support yet.")}))()}queryLogLevel(e){return z((function*(){throw Error("Not support yet.")}))()}updateBlackList(e){return z((function*(){throw Error("Not support yet.")}))()}queryBlockProof(e){return z((function*(){throw Error("Not support yet.")}))()}queryBlockHeaderProof(e){return z((function*(){throw Error("Not support yet.")}))()}queryStateProof(e){return z((function*(){throw Error("Not support yet.")}))()}queryTransactionProof(e){return z((function*(){throw Error("Not support yet.")}))()}queryReceiptProof(e){return z((function*(){throw Error("Not support yet.")}))()}queryBlockHeaderInfos(e){return z((function*(){throw Error("Not support yet.")}))()}queryBlockReceiptInfos(e){return z((function*(){throw Error("Not support yet.")}))()}queryBlockBodyInfos(e){return z((function*(){throw Error("Not support yet.")}))()}queryAccount({account:e}){var t=this;return z((function*(){return function(e,t){const r=t.getSequence(),n={sequence:r,group_id:e.groupId||"0x0000000000000000000000000000000000000000",hash:go(e.account)},o=Co(ao,n);return t.send(o,r)}({account:e},t.connector).then((({data:e})=>{var t;return{address:e.identity,balance:e.balance,encryptionKey:e.encryption_key,recoveryKey:e.recover_key,recoveryTime:e.recover_time,authMap:null===(t=e.auth_map)||void 0===t?void 0:t.map((e=>({key:e.auth_key,weight:e.auth_weight}))),status:e.status,version:e.acc_version}}))}))()}updateAuthMap(e){var t=this;return z((function*(){const r=yield function(e,t){return es.apply(this,arguments)}(e,t.connector),n=r.hash;return yield t.queryTransactionReceiptWithRetry({hash:n}),{txHash:n}}))()}queryBlockHeader({blockNumber:e,hash:t}){var r=this;return z((function*(){return function(e,t){const r=t.getSequence(),n=Co(ro,{sequence:r,block_number:e.blockNumber||0,hash:e.hash||"0x0"});return t.send(n,r)}({blockNumber:e,hash:t},r.connector).then((({block_header:e})=>({gasUsed:e.gas_used,hash:e.hash,logBloom:e.log_bloom,number:e.block_number,parentHash:e.parent_hash,receiptRoot:e.receipt_root,stateRoot:e.state_root,timestamp:e.timestamp,transactionRoot:e.transaction_root,version:e.version})))}))()}queryBlock({blockNumber:e,hash:t}){var r=this;return z((function*(){return function(e,t){const r=t.getSequence(),n=Co(oo,{sequence:r,block_number:e.blockNumber||0,hash:e.hash||"0x0"});return t.send(n,r)}({blockNumber:e,hash:t},r.connector).then((({block:e})=>{const t=e.block_header,r=e.block_body;return{gasUsed:t.gas_used,hash:t.hash,logBloom:t.log_bloom,number:t.block_number,parentHash:t.parent_hash,receiptRoot:t.receipt_root,stateRoot:t.state_root,timestamp:t.timestamp,transactionRoot:t.transaction_root,version:t.version,transactionList:r.transaction_list,receiptList:r.receipt_list,consensusProof:r.consensus_proof}}))}))()}queryLastBlock(){var e=this;return z((function*(){return function(e,t){const r=t.getSequence(),n=Co(to,{sequence:r});return t.send(n,r)}(0,e.connector).then((e=>{const t=e.block.block_header;return{gasUsed:t.gas_used,hash:t.hash,logBloom:t.log_bloom,number:t.block_number,parentHash:t.parent_hash,receiptRoot:t.receipt_root,stateRoot:t.state_root,timestamp:t.timestamp,transactionRoot:t.transaction_root,version:t.version}}))}))()}queryTransaction({hash:e,tee:t}){var r=this;return z((function*(){return function(e,t){const r=t.getSequence(),n={sequence:r,group_id:e.groupId||"0x0000000000000000000000000000000000000000",hash:go(e.hash)},o=Co(so,n);return t.send(o,r)}({hash:e},r.connector).then((e=>{const n=t?To(e.transaction.data,r.config.teePassword,e.transaction.hash):e.transaction.data;return{blockNumber:e.block_number,hash:e.transaction.hash,data:n,to:e.transaction.to,from:e.transaction.from}}))}))()}queryTransactionReceipt(e){var t=this;return z((function*(){return function(e,t){return Xo.apply(this,arguments)}({hash:e.hash},t.connector).then((e=>({blockNumber:e.block_number,gasUsed:e.receipt.gas_used,output:e.receipt.output,code:e.receipt.result,logs:e.receipt.log_entry.map((e=>({from:e.from,to:e.to,logData:e.log_data,topics:e.topics})))})))}))()}deployContract(e,t){var r=this;return z((function*(){const n={};t.tee&&Object.assign(n,r.teeExtraParams);const o=yield function(e,t){return ts.apply(this,arguments)}(j({contract:e,code:t.code,from:r.config.account},n),r.connector),s=o.hash;return yield r.queryTransactionReceiptWithRetry({hash:s}),{txHash:s,teeSecret:t.tee?qt(r.config.teePassword,s).toString("hex"):void 0}}))()}updateContract(e,t){var r=this;return z((function*(){const n=yield function(e,t){return rs.apply(this,arguments)}({contractName:e.contractName,code:e.vmType===exports.VmType.WASM?"0x"+t.code.toString("hex"):t.code.toString("utf-8"),vm:e.vmType},r.connector),o=n.hash;return yield r.queryTransactionReceiptWithRetry({hash:o}),{txHash:o}}))()}callContract(e,t){var r=this;return z((function*(){const n={};t.tee&&Object.assign(n,r.teeExtraParams);const o=yield function(e,t){return ns.apply(this,arguments)}(j({contract:e,from:r.config.account,args:t.args,methodName:t.methodName},n),r.connector),s=o.hash,a=yield r.queryTransactionReceiptWithRetry({hash:s},t.timeout?Date.now()+t.timeout:void 0),i=t.tee?Tt(a.output,r.config.teePassword,s):a.output,c=e.parseReturnOutput(t.methodName,Fo(i));return{txHash:s,receiptCode:a.code,returnValue:c,teeSecret:t.tee?qt(r.config.teePassword,s).toString("hex"):void 0}}))()}queryContract(e){var t=this;return z((function*(){const r=yield function(e,t){const r=t.getSequence(),n={sequence:r,hash:go(e.contractName)},o=Co(io,n);return t.send(o,r)}(e,t.connector);return{code:r.data.code,authMap:r.data.auth_map.map((e=>({key:e.auth_key,weight:e.auth_weight})))}}))()}sign(e){return z((function*(){throw Error("暂不支持")}))()}},exports.CloudCryptoRestProvider=Ps,exports.Contract=pe,exports.LocalCryptoRestProvider=class extends Ps{constructor(e){super({bizid:e.bizid,restUrl:e.restUrl,accessId:e.accessId,accessSecret:e.accessSecret}),this.localConfig=void 0,this.localConfig=e}getBaseData(){var e=this;return z((function*(){const t=yield jo(e.localConfig.accountPrivateKey,e.localConfig.accountPrivateKeyPassword);return{isSign:!0,from:e.localConfig.account,userPublicKey:t.publicKey,userPrivateKey:t.privateKey}}))()}sign(e){var t=this;return z((function*(){const r=yield t.getBaseData();return{signature:Ct(e.payload,r.userPrivateKey).toString("hex")}}))()}createAccount(){return z((function*(){throw Error("Rest 非托管密钥方式暂不支持创建账户")}))()}deployContract(e,t,r){var n=this;return z((function*(){const o=yield n.getBaseData(),s=e.generateDeployCode(t.code),a=Bo(r?exports.MychainMethods.updateContract:exports.MychainMethods.deployContract,{from:r?e.contractName:o.from,to:e.contractName,gas:t.gas,data:{code:s}},o,(e=>e[1])),i=a.txData,c=a.rlpData;let u;t.tee&&(u=qt(n.localConfig.teePassword,i.hash).toString("hex"));const p={accessId:n.config.accessId,bizid:n.config.bizid,hash:i.hash,method:exports.RestMethods.deployWasmContract,requestStr:{hash:i.hash,timestamp:i.timestamp,vmTypeEnum:e.vmType,secretKey:t.tee?n.localConfig.teePassword:void 0}};let f;return f=r?yield xs(j(j({},p),{},{method:exports.RestMethods.updateWasmContract,requestStr:j(j({},p.requestStr),{},{contractName:Ss(e.contractName),contractCode:s,vmType:e.vmType,updateContractRaw:c.toString("base64")})}),n.request):yield ds(j(j({},p),{},{method:exports.RestMethods.deployWasmContract,requestStr:j(j({},p.requestStr),{},{deployContractRaw:c.toString("base64")})}),n.request),yield n.queryTransactionReceiptWithRetry({hash:i.hash,tee:t.tee}),{txHash:f,teeSecret:u}}))()}callContract(e,{methodName:t,args:r=[],gas:n,argsType:o=[],local:s,tee:a,timeout:i}){var c=this;return z((function*(){const u=e.contractName,p=e.vmType,f=e.generateCallCode(t,r),y=yield c.getBaseData(),d=Bo(exports.MychainMethods.callContract,{from:y.from,to:u,gas:n,data:{parameter:f}},y,(e=>e[1])),h=d.txData,l=d.rlpData;let m;a&&(m=qt(c.localConfig.teePassword,h.hash).toString("hex")),p===exports.VmType.WASM&&(yield bs({accessId:c.config.accessId,bizid:c.config.bizid,hash:h.hash,method:exports.RestMethods.callWasmContract,requestStr:{acctId:{data:zo(h.from)},contractId:{data:zo(h.to)},callWasmContractRaw:l.toString("base64"),methodSignature:`${t}(${o?o.join(","):""})`,hash:h.hash,timestamp:h.timestamp,nonceV:Date.now(),vmTypeEnum:exports.VmType.WASM,isLocalTransaction:s,teePublicKey:a?c.localConfig.teePublicKey:void 0,secretKey:a?c.localConfig.teePassword:void 0}},c.request)),p===exports.VmType.EVM&&(yield bs({accessId:c.config.accessId,bizid:c.config.bizid,hash:h.hash,contractName:u,method:exports.RestMethods.callContract,requestStr:{callContractRaw:l.toString("base64"),hash:h.hash,timestamp:h.timestamp,nonceV:Date.now(),vmTypeEnum:exports.VmType.EVM}},c.request));const g=yield c.queryTransactionReceiptWithRetry({hash:h.hash,tee:a},i?Date.now()+i:void 0),_=g.output,v=g.code;let b=_;if(a&&_){b=zo(Tt("0x"+Buffer.from(_,"base64").toString("hex"),c.localConfig.teePassword,h.hash))}return{returnValue:e.parseReturnOutput(t,b),txHash:h.hash,teeSecret:a?m:void 0,receiptCode:v}}))()}},exports.RestMethodsUrlMap=ae,exports.RestServices=Ts,exports.SolContract=class extends pe{constructor(e,t){super(j({contractType:exports.ContractType.solidity},e),t)}generateDeployCode(e,t){if(t)throw Error("还未支持参数");return"0x01"+e.toString("utf-8")}generateCallCode(e,t=[]){let r="";const n=JSON.parse(this.abi);for(let o=0;n.length>o;o++){const s=n[o];let a=[];Se(s.inputs)&&(a=s.inputs);const i=[],c=[];for(let e=0;a.length>e;e++){const t=a[e];i.push(t.type),c.push(t.name)}if("function"===s.type&&s.name===e&&t.length===i.length){const e="0x"+qe(kt(s,i)).slice(0,8);Ro(t,i),r=e+or.encodeParams(i,t);break}}if(!r)throw Error("未找到对应的方法，请检查方法名和参数是否正确。");return r}parseReturnOutput(e,t){return function(e,t,r){if(!r)return"";const n=t.find((({name:t})=>t===e)),o=(Se(n.outputs)?n.outputs:[]).map((({type:e})=>e)),s=or.decodeParams(o,r);return 1===s.length?s[0]:s}(e,JSON.parse(this.abi),t)}},exports.WalletProvider=class extends Qo{constructor(e){super(),this.majorVersion=1,this.config=void 0,this.rpcEngine=void 0,this.rpcConnection=void 0,this.state={chainId:"",accounts:[],isConnected:!1},this.config=e,this.initRpcEngine(),this.initState()}initRpcEngine(){this.rpcEngine=new q.JsonRpcEngine,this.rpcConnection=E.createStreamMiddleware(),this.rpcEngine.push(this.rpcConnection.middleware),M.default(this.config.connectionStream,this.rpcConnection.stream,this.config.connectionStream,(e=>{console.error("[WalletProvider] stream disconnect",e)}))}initState(){var e=this;return z((function*(){const t=yield e.request({method:exports.WalletMethods.getProviderState});e.state=j(j({},e.state),t),e.state.isConnected=!0,ee("[WalletProvider] initState:",e.state),e.emit("connect",e.state)}))()}request({method:e,params:t}){var r=this;return z((function*(){ee("[WalletProvider] request method:",e),ee("[WalletProvider] request params:",t);const n=yield r.rpcEngine.handle({jsonrpc:"2.0",id:v.nanoid(),method:e,params:t}),o=n.error,s=n.result;if(o)throw ee("[WalletProvider] request error:",o),o;return ee("[WalletProvider] request result:",s),s}))()}watchContractEvent(e,t,r){throw Error("Not support yet.")}requestAccounts(){var e=this;return z((function*(){const t=yield e.request({method:exports.WalletMethods.requestAccounts});return e.state.accounts=t,e.emit("accountsChanged",t),t}))()}createAccount(){return z((function*(){throw Error("WalletProvider 暂不支持创建账户")}))()}transferBalance(e){return z((function*(){throw Error("Not support yet.")}))()}setRecoverkey(e){return z((function*(){throw Error("Not support yet.")}))()}preResetPubKey(e){return z((function*(){throw Error("Not support yet.")}))()}resetPubKey(e){return z((function*(){throw Error("Not support yet.")}))()}freezeAccount(e){return z((function*(){throw Error("Not support yet.")}))()}freezeContract(e){return z((function*(){throw Error("Not support yet.")}))()}nativeDepositData(e){return z((function*(){throw Error("Not support yet.")}))()}queryLastBlockHeader(){return z((function*(){throw Error("Not support yet.")}))()}queryTransactionList(e){return z((function*(){throw Error("Not support yet.")}))()}queryTransactionAndReceipt(e){return z((function*(){throw Error("Not support yet.")}))()}queryTimestamp(e){return z((function*(){throw Error("Not support yet.")}))()}queryP2PStatus(e){return z((function*(){throw Error("Not support yet.")}))()}queryConsensusStatus(e){return z((function*(){throw Error("Not support yet.")}))()}queryCommonConsensusStatus(e){return z((function*(){throw Error("Not support yet.")}))()}querySyncStatus(e){return z((function*(){throw Error("Not support yet.")}))()}queryTransactionCacheStatus(e){return z((function*(){throw Error("Not support yet.")}))()}queryBlockCacheStatus(e){return z((function*(){throw Error("Not support yet.")}))()}queryContractNodesStatus(e){return z((function*(){throw Error("Not support yet.")}))()}queryContractConfigStatus(e){return z((function*(){throw Error("Not support yet.")}))()}queryLogLevel(e){return z((function*(){throw Error("Not support yet.")}))()}updateBlackList(e){return z((function*(){throw Error("Not support yet.")}))()}queryBlockProof(e){return z((function*(){throw Error("Not support yet.")}))()}queryBlockHeaderProof(e){return z((function*(){throw Error("Not support yet.")}))()}queryStateProof(e){return z((function*(){throw Error("Not support yet.")}))()}queryTransactionProof(e){return z((function*(){throw Error("Not support yet.")}))()}queryReceiptProof(e){return z((function*(){throw Error("Not support yet.")}))()}queryBlockHeaderInfos(e){return z((function*(){throw Error("Not support yet.")}))()}queryBlockReceiptInfos(e){return z((function*(){throw Error("Not support yet.")}))()}queryBlockBodyInfos(e){return z((function*(){throw Error("Not support yet.")}))()}updateAuthMap(){return z((function*(){throw Error("WalletProvider 暂不支持 updateAuthMap")}))()}queryAccount(e){return this.request({method:exports.WalletMethods.queryAccount,params:e})}queryBlockHeader(e){return this.request({method:exports.WalletMethods.queryBlockHeader,params:e})}queryBlock(e){return this.request({method:exports.WalletMethods.queryBlock,params:e})}queryLastBlock(){return this.request({method:exports.WalletMethods.queryLastBlock})}queryTransaction(e){return e.tee&&Bs("queryTransaction"),this.request({method:exports.WalletMethods.queryTransaction,params:e})}queryTransactionReceipt(e){return e.tee&&Bs("queryTransactionReceipt"),this.request({method:exports.WalletMethods.queryTransactionReceipt,params:e})}deployContract(e,t){return t.tee&&Bs("deployContract"),this.request({method:exports.WalletMethods.deployWasmContract,params:j(j({},e),{},{contractName:e.contractName,contractType:e.contractType,abi:e.abi})})}updateContract(){throw Error("wallet provider 暂不支持 updateContract")}callContract(e,t){return(null==t?void 0:t.tee)&&Bs("callContract"),this.request({method:e.contractType===exports.ContractType.solidity?exports.WalletMethods.callSolidityContract:exports.WalletMethods.callWasmContract,params:j(j({methodName:e.methodName,args:e.args},t),{},{contractName:e.contractName,contractType:e.contractType,abi:e.abi})})}queryContract(e){return this.request({method:exports.WalletMethods.queryContract,params:e})}sign(e){return z((function*(){throw Error("暂不支持")}))()}},exports.WasmContract=class extends pe{constructor(e,t){super(j({contractType:exports.ContractType.assemblyscript},e),t),this.abier=void 0,this.abier=Wo(e.contractName,this.abi)}generateDeployCode(e,t){if(t)throw Error("还未支持参数");const r=e.toString("hex"),n=function(e){const t=new o.Buffer(4);return t.writeUInt32BE(e),t.toString("hex")}(r.length/2);return"0x02"+n+r}generateCallCode(e,t){let r="";const n=this.abier.schema[e].fields||{},o=[];for(const e in n)o.push({key:e,type:n[e]});return r=Io.encodeParams(e,this.abier,t||[]),r&&(r="0x"+r),r}parseReturnOutput(e,t){var r;if(!t)return;let n=t;0===n.indexOf("0x")&&(n=n.slice(2));const o=null===(r=this.abier.schema[e])||void 0===r?void 0:r.results,s=Io.decodeParam(this.abier,o&&o.length>0&&o[0],Buffer.from(n,"hex"));return 1===s.length?s[0]:s}},exports.convertHex2Base64=zo,exports.createDebug=Z,exports.debug=ee,exports.decryptAESWithPassword=Tt,exports.decryptTXWithAES=To,exports.errorCodeMessages=ps,exports.generateAESKey=qt,exports.getAbier=Wo,exports.getUserInfo=jo,exports.isChromeBackground=G,exports.isDebug=Q,exports.isDev=$,exports.isElectron=Y,exports.isNode=J,exports.maxQueryTransactionReceiptRetryInterval=3e4,exports.parsePrivateKeyToAES=Mo,exports.queryTransactionReceiptRetryInterval=Vo,exports.remove0x=Fo,exports.signMessage=Lo,exports.toUTF8=function(e){return Le(e)};
