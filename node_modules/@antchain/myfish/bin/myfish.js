#!/usr/bin/env node

const chalk = require('chalk');
const updater = require('npm-updater');
const { program } = require('commander');
const { initCommands } = require('../dist');

// 检查更新
const tag = 'latest';
updater({
  // 从本地 package.json 里面读数据
  package: require('../package.json'),
  // 当 repository 里面的版本和本地版本不一样时，不会终止
  abort: false,
  // 提示的间隔
  interval: '10m',
  // 和 repository 的哪个 tag 版本做比较
  tag,
  // 提示信息
  formatter: ({ version, current }) => {
    const array = ['😀', '😛', '🤪', '🤩'];
    return chalk.yellow(
      `${array[Math.floor(Math.random() * array.length)]} 检测到 Myfish 新版本: ${chalk.magenta(
        current,
      )} (当前版本) → ${chalk.magenta(
        version,
      )} (最新版本)\n🚚 你可以执行 npm install @antchain/myfish@${tag} --save-dev 升级到最新版本\n`,
    );
  },
}).catch((e) => {
  console.error(chalk.red('版本检测错误，无法判断当前是否是最新版本'));
  console.error(e);
});

// 初始化命令行
initCommands(program);
