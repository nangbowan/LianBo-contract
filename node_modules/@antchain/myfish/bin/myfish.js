#!/usr/bin/env node

const chalk = require('chalk');
const updater = require('npm-updater');
const { program } = require('commander');
const { initCommands } = require('../dist');

// æ£€æŸ¥æ›´æ–°
const tag = 'latest';
updater({
  // ä»æœ¬åœ° package.json é‡Œé¢è¯»æ•°æ®
  package: require('../package.json'),
  // å½“ repository é‡Œé¢çš„ç‰ˆæœ¬å’Œæœ¬åœ°ç‰ˆæœ¬ä¸ä¸€æ ·æ—¶ï¼Œä¸ä¼šç»ˆæ­¢
  abort: false,
  // æç¤ºçš„é—´éš”
  interval: '10m',
  // å’Œ repository çš„å“ªä¸ª tag ç‰ˆæœ¬åšæ¯”è¾ƒ
  tag,
  // æç¤ºä¿¡æ¯
  formatter: ({ version, current }) => {
    const array = ['ğŸ˜€', 'ğŸ˜›', 'ğŸ¤ª', 'ğŸ¤©'];
    return chalk.yellow(
      `${array[Math.floor(Math.random() * array.length)]} æ£€æµ‹åˆ° Myfish æ–°ç‰ˆæœ¬: ${chalk.magenta(
        current,
      )} (å½“å‰ç‰ˆæœ¬) â†’ ${chalk.magenta(
        version,
      )} (æœ€æ–°ç‰ˆæœ¬)\nğŸšš ä½ å¯ä»¥æ‰§è¡Œ npm install @antchain/myfish@${tag} --save-dev å‡çº§åˆ°æœ€æ–°ç‰ˆæœ¬\n`,
    );
  },
}).catch((e) => {
  console.error(chalk.red('ç‰ˆæœ¬æ£€æµ‹é”™è¯¯ï¼Œæ— æ³•åˆ¤æ–­å½“å‰æ˜¯å¦æ˜¯æœ€æ–°ç‰ˆæœ¬'));
  console.error(e);
});

// åˆå§‹åŒ–å‘½ä»¤è¡Œ
initCommands(program);
