"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("debug"),t=require("bignumber.js"),r=require("crypto-js"),n=require("crypto-js/sha3"),o=require("safe-buffer"),s=require("@ethersproject/abi"),a=require("fcbuffer"),i=require("node-forge"),c=require("rlp"),u=require("secp256k1"),p=require("md5.js"),y=require("public-encrypt/browser"),d=require("browserify-aes/browser"),f=require("create-hash"),l=require("js-encoding-utils"),h=require("elliptic"),m=require("asn1.js"),g=require("bn.js"),_=require("events"),v=require("tls"),b=require("nanoid"),C=require("axios"),q=require("uuid"),E=require("json-rpc-engine"),x=require("json-rpc-middleware-stream"),w=require("pump");function T(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var k=T(e),S=T(t),B=T(n),R=T(a),P=T(i),N=T(p),I=T(y),A=T(f),K=T(l),O=T(g),D=T(_),M=T(v),L=T(C),W=T(w);function j(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function U(e){for(var t=1;arguments.length>t;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?j(Object(r),!0).forEach((function(t){V(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):j(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function z(e,t,r,n,o,s,a){try{var i=e[s](a),c=i.value}catch(e){return void r(e)}i.done?t(c):Promise.resolve(c).then(n,o)}function H(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var s=e.apply(t,r);function a(e){z(s,n,o,a,i,"next",e)}function i(e){z(s,n,o,a,i,"throw",e)}a(void 0)}))}}function V(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Q(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);t>r;r++)n[r]=e[r];return n}function F(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return Q(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?Q(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,o=function(){};return{s:o,n:function(){return e.length>n?{done:!1,value:e[n++]}:{done:!0}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,a=!0,i=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return a=e.done,e},e:function(e){i=!0,s=e},f:function(){try{a||null==r.return||r.return()}finally{if(i)throw s}}}}const Y="1"===process.env.MYFISH_DEBUG,$="development"===process.env.NODE_ENV,J=require("is-electron")(),G="undefined"==typeof window&&"undefined"==typeof chrome&&!J,X="undefined"!=typeof chrome&&"undefined"==typeof window,Z=()=>k.default.enable("antchain:*");function ee(e){return($||Y)&&Z(),k.default(e)}"undefined"!=typeof window&&(window.enableDebug=Z),"undefined"!=typeof globalThis&&(globalThis.enableDebug=Z);const te=ee("antchain:jssdk");var re,ne,oe,se,ae;(re=exports.ContractType||(exports.ContractType={})).assemblyscript="assemblyscript",re.solidity="solidity",(ne=exports.VmType||(exports.VmType={})).WASM="WASM",ne.EVM="EVM",(oe=exports.TxType||(exports.TxType={})).TX_DEPLOY_CONTRACT="TX_DEPLOY_CONTRACT",oe.CALL_CONTRACT="CALL_CONTRACT",(se=exports.MychainMethods||(exports.MychainMethods={})).queryBlock="QueryBlock",se.queryLastBlock="QueryLastBlock",se.queryTransaction="QueryTransaction",se.queryTransactionReceipt="QueryTransactionReceipt",se.queryAccount="QueryAccount",se.queryContract="QueryContract",se.deployContract="DeployContract",se.updateContract="UpdateContract",se.callContract="CallContract",se.encryptedTransaction="EncryptedTransaction",se.LocalTransaction="LocalTransaction",(ae=exports.RestMethods||(exports.RestMethods={})).queryBlock="QUERYBLOCKBODY",ae.queryBlockHeader="QUERYBLOCK",ae.queryLastBlock="QUERYLASTBLOCK",ae.queryTransactionFromBlockchain="QUERYTRANSACTIONFROMBLOCKCHAIN",ae.queryTransactionReceipt="QUERYRECEIPT",ae.queryAccount="QUERYACCOUNT",ae.queryContract="QUERYCONTRACT",ae.deploySolidityContractForBizAsync="DEPLOYCONTRACTFORBIZASYNC",ae.updateSolidityContractForBizAsync="UPDATECONTRACTFORBIZASYNC",ae.deployWasmContractForBiz="DEPLOYWASMCONTRACT",ae.updateWasmContractForBiz="UPDATECONTRACTFORBIZ",ae.deployWasmContract="DEPLOYCONTRACT",ae.updateWasmContract="UPDATECONTRACT",ae.callWasmContractForBiz="CALLWASMCONTRACT",ae.callWasmContractForBizAsync="CALLWASMCONTRACTASYNC",ae.callWasmContract="CALLWASMCONTRACT",ae.callContract="CALLCONTRACT",ae.createAccountForBiz="TENANTCREATEACCUNT";const ie={default:"/api/contract/chainCall",[exports.RestMethods.callWasmContract]:"/api/contract/chainCallForBiz"};var ce,ue;(ce=exports.WalletMethods||(exports.WalletMethods={})).queryBlockHeader="antchain_queryBlockHeader",ce.queryBlock="antchain_queryBlock",ce.queryLastBlock="antchain_queryLastBlock",ce.queryTransaction="antchain_queryTransaction",ce.queryTransactionReceipt="antchain_queryTransactionReceipt",ce.queryAccount="antchain_queryAccount",ce.queryContract="antchain_queryContract",ce.sign="antchain_sign",ce.deployContract="antchain_deployContract",ce.deployWasmContract="antchain_deployWasmContract",ce.deploySolidityContract="antchain_deploySolidityContract",ce.callContract="antchain_callContract",ce.callWasmContract="antchain_callWasmContract",ce.callSolidityContract="antchain_callSolidityContract",ce.getProviderState="antchain_getProviderState",ce.requestAccounts="antchain_requestAccounts",ce.subscription="antchain_subscription";class pe extends Error{constructor(e,t,r){super(e),this.code=void 0,this.data=void 0,this.name="AntchainSDKError",this.code=t,this.data=r}}(ue=exports.EventListenerType||(exports.EventListenerType={}))[ue.ACCOUNT=0]="ACCOUNT",ue[ue.CONTRACT=1]="CONTRACT",ue[ue.TOPICS=2]="TOPICS",ue[ue.BLOCK=3]="BLOCK";class ye{constructor(e,t){this.options=void 0,this.provider=void 0,this.contractName=void 0,this.contractType=void 0,this.vmType=void 0,this.abi=void 0,te("[Contract] new contarct with options:",e),this.options=e,this.provider=t;const r=e.contractType,n=void 0===r?exports.ContractType.assemblyscript:r,o=e.abi;this.contractName=e.contractName,this.contractType=n,this.vmType=n===exports.ContractType.solidity?exports.VmType.EVM:exports.VmType.WASM,this.abi="object"==typeof o?JSON.stringify(o):o}on(e,t){this.provider.watchContractEvent(this,e,t)}deploy(e,t){var r=this;return H((function*(){return(t||{}).update?r.provider.updateContract(r,e):r.provider.deployContract(r,e)}))()}call(e){var t=this;return H((function*(){if(1!==t.provider.majorVersion){if(t.vmType===exports.VmType.EVM)throw Error("当前版本的连接器不支持调用 Solidity 合约，请升级。");return t.provider.callContract(U({contractName:t.contractName,vmType:t.vmType,abi:t.abi},e))}return t.provider.callContract(t,e)}))()}generateDeployCode(e,t){throw Error("不能直接调用 Contract 类的 generateDeployCode")}generateCallCode(e,t){throw Error("不能直接调用 Contract 类的 generateCallCode")}parseReturnOutput(e,t){throw Error("不能直接调用 Contract 类的 generateCallCode")}}var de,fe,le,he=String.fromCharCode;function me(e){for(var t,r,n=[],o=0,s=e.length;s>o;)55296>(t=e.charCodeAt(o++))||t>56319||o>=s?n.push(t):56320==(64512&(r=e.charCodeAt(o++)))?n.push(((1023&t)<<10)+(1023&r)+65536):(n.push(t),o--);return n}function ge(e){if(e>=55296&&57343>=e)throw Error("Lone surrogate U+"+e.toString(16).toUpperCase()+" is not a scalar value")}function _e(e,t){return he(e>>t&63|128)}function ve(e){if(0==(4294967168&e))return he(e);var t="";return 0==(4294965248&e)?t=he(e>>6&31|192):0==(4294901760&e)?(ge(e),t=he(e>>12&15|224),t+=_e(e,6)):0==(4292870144&e)&&(t=he(e>>18&7|240),t+=_e(e,12),t+=_e(e,6)),t+=he(63&e|128)}function be(){if(le>=fe)throw Error("Invalid byte index");var e=255&de[le];if(le++,128==(192&e))return 63&e;throw Error("Invalid continuation byte")}const Ce=function(e){for(var t=me(e),r=t.length,n=-1,o="";++n<r;)o+=ve(t[n]);return o},qe=function(e){de=me(e),fe=de.length,le=0;for(var t,r,n,o=[];!1!==(r=void 0,n=void 0,t=le!=fe&&(r=255&de[le],le++,0==(128&r)?r:192!=(224&r)||128>(n=(31&r)<<6|be())?224!=(240&r)||2048>(n=(15&r)<<12|be()<<6|be())?240!=(248&r)||65536>(n=(7&r)<<18|be()<<12|be()<<6|be())||n>1114111?void 0:n:(ge(n),n):n));)o.push(t);return function(e){for(var t,r=e.length,n=-1,o="";++n<r;)(t=e[n])>65535&&(o+=he((t-=65536)>>>10&1023|55296),t=56320|1023&t),o+=he(t);return o}(o)};function Ee(e,t){let n=e;return"hex"===t&&(n.length>2&&"0x"===n.substr(0,2)&&(n=n.substr(2)),n=r.enc.Hex.parse(n)),""+B.default(n,{outputLength:256})}function xe(e,t){let n="0x";t&&(n="");let o=e.toString("hex");if(ke(e)){if("0x"!==e.substr(0,2))return n+""+r.SHA256(e);o=e.substr(2)}const s=r.enc.Hex.parse(o);return n+r.SHA256(s).toString(r.enc.Hex)}function we(e){return o.Buffer.isBuffer(e)}function Te(e){return e&&(e instanceof S.default||e.constructor&&"BigNumber"===e.constructor.name)}function ke(e){return"string"==typeof e||e&&e.constructor&&"String"===e.constructor.name}function Se(e){return null!==e&&!Array.isArray(e)&&"object"==typeof e}function Be(e){return Array.isArray(e)}function Re(e,t){let r=e,n=t;if(we(r))return r;"number"==typeof r&&(r=r.toString(16)),ke(r)&&0===r.indexOf("0x")&&(r=r.slice(2)),n||(n=Math.ceil(r.length/2));const s=o.Buffer.alloc(n);for(let e=0;n>e;e++){const t=r.slice(2*e,2*e+2)||"00";s.write(t,e,1,"hex")}return s}function Pe(e,t,r){return parseInt(t)>e.length?e+Array(parseInt(t)-e.length+1).join(r||"0"):e}function Ne(e,t){const r=e||0;return Te(r)?r:ke(r)?0===r.indexOf("0x")||0===r.indexOf("-0x")?new S.default(r.replace("0x",""),16):new S.default(r,t||16):new S.default(r.toString(10),10)}function Ie(e,t){return Ne(e,t).toNumber()}function Ae(e,t){let r="0x";t&&(r="");const n=Ne(e),o=n.toString(16);return n.lessThan(0)?"-"+r+o.substr(1):r+o}function Ke(e,t,r){const n=Ce(e);let o="";for(let e=0;n.length>e;e++){const r=n.charCodeAt(e);if(0===r){if(!t)break;o+="00"}else{const e=r.toString(16);o+=2>e.length?"0"+e:e}}let s="0x";return r&&(s=""),s+o}function Oe(e,t){let r="0x";return t&&(r=""),we(e)?r+e.toString("hex"):Me(e,t)}function De(e){return qe(function(e,t){let r="",n=0;for("0x"===e.substring(0,2)&&(n=2);e.length>n;n+=2){const o=parseInt(e.substr(n,2),16);if(t&&0===o)break;r+=String.fromCharCode(o)}return r}(e))}function Me(e,t){return"boolean"==typeof e?Ae(+e,t):Te(e)?Ae(e,t):"object"==typeof e?Ke(JSON.stringify(e),!1,t):ke(e)?0===e.indexOf("-0x")?function(e,t){return Ae(e,t)}(e,t):0===e.indexOf("0x")?e:Ke(e,1,t):Ae(e,t)}function Le(e){let t=e;return ke(t)?("0x"===t.substr(0,2)&&(t=t.substr(2)),o.Buffer.from(t,"hex")):t}const We={name:"uint64",Identity:"bytes",checksum160:"fixed_bytes20",checksum256:"fixed_bytes32",checksum512:"fixed_bytes64",signature:"fixed_bytes65",public_key:"fixed_bytes33",message_type:"fixed_string16",symbol:"uint64",symbol_code:"uint64",field_name:"string",account_name:"name",permission_name:"name",type_name:"string",table_name:"name",scope_name:"name",action_name:"string",time_point:"int64",time_point_sec:"time",timestamp:"uint32",block_timestamp_type:"timestamp",block_id:"fixed_bytes32",checksum_type:"fixed_bytes32",checksum256_type:"fixed_bytes32",checksum512_type:"fixed_bytes64",checksum160_type:"fixed_bytes20",sha256:"fixed_bytes32",sha512:"fixed_bytes64",sha160:"fixed_bytes20",weight_type:"uint16",block_num_type:"uint32",share_type:"int64",digest_type:"checksum_type",context_free_type:"bytes",unsigned_int:"varuint32",bool:"uint8",extensions_type:{base:"",fields:{type:"uint16",data:"bytes"}},transaction_header:{base:"",fields:{expiration:"time",ref_block_num:"uint16",ref_block_prefix:"uint32",max_net_usage_words:"unsigned_int",max_cpu_usage_ms:"uint8",delay_sec:"unsigned_int"}},transaction:{base:"transaction_header",fields:{context_free_actions:"action[]",actions:"action[]",transaction_extensions:"extensions_type[]"}},signed_transaction:{base:"transaction",fields:{signatures:"signature[]",context_free_data:"bytes[]"}},fields:"field_def[]",field_def:{fields:{name:"field_name",type:"type_name"}},type_def:{base:"",fields:{new_type_name:"type_name",type:"type_name"}},struct_def:{base:"",fields:{name:"type_name",base:"type_name",fields:"field_def[]"}},clause_pair:{base:"",fields:{id:"string",body:"string"}},error_message:{base:"",fields:{error_code:"uint64",error_msg:"string"}},abi_def:{base:"",fields:{version:"string",types:"type_def[]",structs:"struct_def[]",actions:"action_def[]",tables:"table_def[]",ricardian_clauses:"clause_pair[]",error_messages:"error_message[]",abi_extensions:"extensions_type[]"}},table_def:{base:"",fields:{name:"table_name",index_type:"type_name",key_names:"field_name[]",key_types:"type_name[]",type:"type_name"}},permission_level:{base:"",fields:{actor:"account_name",permission:"permission_name"}},action:{base:"",fields:{name:"action_name"}},action_def:{base:"",fields:{name:"string",type:"type_name"}}};const je=e=>({"abi_def.fromObject":e=>{if("string"==typeof e){let t=""+o.Buffer.from(e,"hex");return 0===t.length&&(t=""+o.Buffer.from(e)),JSON.parse(t)}return o.Buffer.isBuffer(e)?JSON.parse(""+e):null}}),Ue=e=>({"setcode.code.fromObject":({object:t,result:r})=>{try{const n=""+t.code;if(/^\s*\(module/.test(n)){const t=e.binaryen;e.debug&&console.log("Assembling WASM..");const s=o.Buffer.from(t.parseText(n).emitBinary());r.code=s}else r.code=t.code}catch(e){throw console.error(e,t.code),e}}});function ze(e){null==e&&(e={}),e.abiCache={abi:function(e,n){if(n){o.Buffer.isBuffer(n)&&(n=JSON.parse(n));const s=function(e,t){const r={};e.types&&e.types.forEach((e=>{r[e.new_type_name]=e.type}));e.structs&&e.structs.forEach((e=>{const t={};var n,o=F(e.fields);try{for(o.s();!(n=o.n()).done;){const e=n.value;t[e.name]=e.type}}catch(e){o.e(e)}finally{o.f()}r[e.name]={base:e.base,fields:t,results:e.results},""===e.base&&delete r[e.name].base}));e.interfaces&&e.interfaces.forEach((e=>{const n=r[e.type];n?n.interface={name:e.name}:console.error("Missing abiSchema type",e.type,t)}));return r}(n,e),a=((e={},t)=>{const r=Object.assign({},je(),Ue(e),e.override),n=Object.assign({},{},e.customTypes);(e=Object.assign({override:r},{customTypes:n},e)).sort=Object.assign({},e.sort);const o=Object.assign({},We,t),s=R.default(o,e),a=s.structs,i=s.types,c=s.errors,u=s.fromBuffer,p=s.toBuffer;if(0!==c.length)throw Error(JSON.stringify(c,null,4));return{structs:a,types:i,fromBuffer:u,toBuffer:p}})(t,s);return r[e]=Object.assign({abi:n,schema:s},a)}const s=r[e];if(null==s)throw Error(`Abi '${e}' is not cached`);return s}};const t=Object.assign({},{defaults:!0},e),r={};return e.abiCache}function He(e,t){const r=P.default.md.sha256.create().update(t,"utf8");te("[signMessage] message hash:",r.digest().toHex());const n=""+P.default.pki.privateKeyFromPem(e).sign(r),o=Buffer.from(P.default.util.binary.raw.decode(n)).toString("hex");return te("[signMessage] result:",o),o}function Ve(e,t){if(te("[parsePrivateKeyToAES] privateKey:",e),te("[parsePrivateKeyToAES] passphrase:",t),G){const r=require("crypto").createPrivateKey({format:"pem",key:e,passphrase:t}).export({type:"sec1",format:"pem",cipher:"aes-256-cbc",passphrase:t});return te("[parsePrivateKeyToAES] use node crypto, result:",r),r}return te("[parsePrivateKeyToAES] 浏览器端需要用户手动进行转换"),e}function Qe(e){return e.readInt32BE(0)}function Fe(e){return c.encode(e)}function Ye(e,t){return Oe(Fe(e),t)}function $e(e){return c.decode(e)}function Je(e,t,r){this.tag=t,o.Buffer.isBuffer(e)?this.encode(e,t,r):e&&this.decode(e.toString("ascii").trim(),r)}Je.prototype.toString=function(){return this.pem},Je.prototype.toBuffer=function(){return this.buf},Je.prototype.decode=function(e,t){e&&(this.pem=e.toString("ascii").trim());const n=this.pem.split(/\r?\n/),s=n[0].match(/\-\-\-\-\-\s*BEGIN ?([^-]+)?\-\-\-\-\-/);if(!s)throw Error("parse PEM: BEGIN not found");let a;if(this.tag=s[1],n.shift(),"Proc-Type: 4,ENCRYPTED"===n[0]){if("string"!=typeof t)throw Error("PEM is encrypted but no passphrase given");a=n[1].match(/DEK-Info: ([^,]+),([0-9A-F]+)/i),n.splice(0,3);const e=a[1].toLowerCase(),s=o.Buffer(a[2],"hex"),i=function(e,t,r){let n=r,s=Ge[e];if(!s){throw new TypeError("Unsupported type. Allowed: "+Object.keys(Ge))}let a=n.length;const i=8;n.length!==i&&(n=n.slice(0,i));const c=16;let u,p=!1;const y=new o.Buffer(s);let d=0;for(;;){const e=new N.default;p?e.update(u):p=!0,e.update(t),e.update(n),u=e.digest();let r=0;for(;s&&c>r;)y[d++]=u[r],s--,r++;const o=Math.min(a,c-r);if(a-=o,r+=o,0==s&&0==a)break}return y}
/**
 * @fileOverview
 * @name base64x-1.1.js
 * @author Kenji Urushima kenji.urushima@gmail.com
 * @version jsrsasign 8.0.12 base64x 1.1.14 (2018-Apr-22)
 * @since jsrsasign 2.1
 * @license <a href="https://kjur.github.io/jsrsasign/license/">MIT License</a>
 */(e.toUpperCase(),t,s);n.pop();const c=n.join("").toString("hex"),u=r.enc.Hex.parse(i.toString("hex")),p=r.AES.decrypt(c,u,{iv:r.enc.Hex.parse(s.toString("hex")),padding:r.pad.NoPadding,mode:r.mode.CBC});a&&(this.buf=o.Buffer(p.toString(r.enc.Hex),"hex"))}return this.pem="-----BEGIN"+(this.tag?" "+this.tag:"")+"-----\n"+o.Buffer(this.buf).toString("base64").match(/.{1,64}/g).join("\n")+"\n-----END"+(this.tag?" "+this.tag:"")+"-----",this.pem};const Ge={"DES-EDE3-CBC":24,"DES-CBC":8,"AES-128-CBC":16,"AES-192-CBC":24,"AES-256-CBC":32};function Xe(e,t){return"-----BEGIN "+t+"-----\r\n"+function(e){let t=function(e){return function(e){let t,r,n="";for(t=0;e.length>=t+3;t+=3)r=parseInt(e.substring(t,t+3),16),n+=Ze.charAt(r>>6)+Ze.charAt(63&r);t+1==e.length?(r=parseInt(e.substring(t,t+1),16),n+=Ze.charAt(r<<2)):t+2==e.length&&(r=parseInt(e.substring(t,t+2),16),n+=Ze.charAt(r>>2)+Ze.charAt((3&r)<<4));for(;(3&n.length)>0;)n+="=";return n}(e)}
/*! (c) Tom Wu | http://www-cs-students.stanford.edu/~tjw/jsbn/
 */(e).replace(/(.{64})/g,"$1\r\n");return t=t.replace(/\r\n$/,""),t}(e)+"\r\n-----END "+t+"-----\r\n"}const Ze="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";const et=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"];function tt(e){if(e>65536)throw Error("requested too many random bytes");const t=o.Buffer.allocUnsafe(e);return e>0&&function(e){const t=e.length;for(let r=0;t>r;r++)e[r]="0x"+et[parseInt(16*Math.random())]+et[parseInt(16*Math.random())]}(t),t}const rt=new h.ec("secp256k1"),nt=Buffer.from("fffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141","hex"),ot=Buffer.alloc(32,0);function st(e,t){if(!e)throw Error(t||"Assertion failed")}function at(e){return t=e,!(!Buffer.isBuffer(t)||32!==t.length)&&(e.compare(ot)>0&&0>e.compare(nt));var t}function it(e){return Buffer.from(tt(e))}function ct(e,t,r={}){let n=r.ephemPrivateKey||it(32);for(;!at(n);)n=r.ephemPrivateKey||it(32);const o=(st(32===(s=n).length,"Bad private key"),st(at(s),"Bad private key"),Buffer.from(rt.keyFromPrivate(s).getPublic("arr")));var s;const a=function(e,t){st(Buffer.isBuffer(e),"Bad private key"),st(Buffer.isBuffer(t),"Bad public key"),st(32===e.length,"Bad private key"),st(at(e),"Bad private key"),st(65===t.length||33===t.length,"Bad public key"),65===t.length&&st(4===t[0],"Bad public key"),33===t.length&&st(2===t[0]||3===t[0],"Bad public key");const r=rt.keyFromPrivate(e),n=rt.keyFromPublic(t),o=r.derive(n.getPublic());return Buffer.from(o.toArray())}(n,e),i=Buffer.alloc(36);a.copy(i,0,0,32),i[35]=1;const c=function(e){const t=A.default("sha256").update(e).digest();return new Uint8Array(t)}(i),u=r.iv||it(12),p=function(e,t,r){if(!t||!r)throw Error("aes empty key or iv!");const n=d.createCipheriv("aes-128-gcm",t,r);n.setAutoPadding(!1);const o=n.update(e).toString("hex");return n.final(),{data:o,authTag:n.getAuthTag().toString("hex")}}(t,Buffer.from(c.slice(0,16)),u),y=Le(p.data),f=Le(p.authTag);return Buffer.concat([o,u,f,y])}const ut="02",pt={prime256v1:32,secp256k1:32,secp384r1:48,secp521r1:66},yt={prime256v1:"P-256",secp256k1:"P-256K",secp384r1:"P-384",secp521r1:"P-521"},dt={"P-256":"prime256v1","P-256K":"secp256k1","P-384":"secp384r1","P-521":"secp521r1"},ft=m.define("Rfc5915Key",(function(){this.seq().obj(this.key("version").int(),this.key("privateKey").octstr(),this.key("parameters").optional().explicit(0).objid({"1 2 840 10045 3 1 7":"prime256v1","1 3 132 0 10":"secp256k1","1 3 132 0 34":"secp384r1","1 3 132 0 35":"secp521r1"}),this.key("publicKey").optional().explicit(1).bitstr())})),lt=m.define("Pkcs8Key",(function(){this.seq().obj(this.key("version").int(),this.key("algorithmIdentifier").seq().obj(this.key("privateKeyType").objid({"1 2 840 10045 2 1":"EC"}),this.key("parameters").objid({"1 2 840 10045 3 1 7":"prime256v1","1 3 132 0 10":"secp256k1","1 3 132 0 34":"secp384r1","1 3 132 0 35":"secp521r1"})),this.key("privateKey").octstr())})),ht=m.define("SpkiKey",(function(){this.seq().obj(this.key("algorithmIdentifier").seq().obj(this.key("publicKeyType").objid({"1 2 840 10045 2 1":"EC"}),this.key("parameters").objid({"1 2 840 10045 3 1 7":"prime256v1","1 3 132 0 10":"secp256k1","1 3 132 0 34":"secp384r1","1 3 132 0 35":"secp521r1"})),this.key("publicKey").bitstr())}));function mt(e,t){var r=pt[e];if(4==t[0]){if(t.length!=2*r+1)throw new TypeError("Invalid uncompressed key size");return{c:e,x:t.slice(1,r+1),y:t.slice(r+1)}}throw new TypeError("Compressed key unsupported")}function gt(e){var t=lt.decode(e,"der"),r=ft.decode(t.privateKey,"der"),n=t.algorithmIdentifier.parameters,o=pt[n],s=r.privateKey;if(s.length>o)throw new TypeError("Invalid private key size: expected "+o+" gotten "+s.length);var a=mt(n,r.publicKey.data);return a.d=s,a}function _t(e){var t=ht.decode(e,"der");return mt(t.algorithmIdentifier.parameters,t.publicKey.data)}const vt=/-+BEGIN EC PRIVATE KEY-+([\s\S]+)-+END EC PRIVATE KEY-+/m,bt=/-+BEGIN PRIVATE KEY-+([\s\S]*)-+END PRIVATE KEY-+/m,Ct=/-+BEGIN PUBLIC KEY-+([\s\S]*)-+END PUBLIC KEY-+/m;function qt(e){if("string"!=typeof e)throw new TypeError("PEM must be a string");var t=null;if(t=e.match(vt))return function(e){var t=ft.decode(e,"der"),r=pt[t.parameters],n=t.privateKey;if(n.length>r)throw new TypeError("Invalid private key size: expected "+r+" gotten "+n.length);var o=mt(t.parameters,t.publicKey.data);return o.d=n,o}(new o.Buffer(t[1].replace(/[\s-]/gm,""),"base64"));if(t=e.match(bt))return gt(new o.Buffer(t[1].replace(/[\s-]/gm,""),"base64"));if(t=e.match(Ct))return _t(new o.Buffer(t[1].replace(/[\s-]/gm,""),"base64"));throw new TypeError("Unrecognized PEM key structure")}function Et(e,t){if(!(this instanceof Et))return new Et(e,t);var r,n,s,a,i;if(t||(t="pem"),o.Buffer.isBuffer(e))if("pem"==t)r=(c=qt(e.toString("ascii"))).c,s=c.x,a=c.y,n=c.d;else if("pkcs8"==t||"rfc5208"==t){r=(c=gt(e)).c,s=c.x,a=c.y,n=c.d}else{if("spki"!=t&&"rfc5280"!=t)throw new TypeError('Unknown format for EC Key "'+t+'"');r=(c=_t(e)).c,s=c.x,a=c.y,n=c.d}else if("string"==typeof e){if("pem"==t)r=(c=qt(e)).c,s=c.x,a=c.y,n=c.d;else if("pkcs8"==t||"rfc5208"==t){r=(c=gt(new o.Buffer(e,"base64"))).c,s=c.x,a=c.y,n=c.d}else{if("spki"!=t&&"rfc5280"!=t)throw new TypeError('Unknown format for EC Key "'+t+'"');r=(c=_t(new o.Buffer(e,"base64"))).c,s=c.x,a=c.y,n=c.d}}else{if(!(i=e)||i.constructor!==Object)throw new TypeError("Unrecognized format for EC key");if("string"==typeof e.curve?r=e.curve:"string"==typeof e.crv&&(r=dt[e.crv]||e.crv),o.Buffer.isBuffer(e.privateKey)?n=e.privateKey:"string"==typeof e.privateKey?n=new o.Buffer(e.privateKey,"base64"):o.Buffer.isBuffer(e.d)?n=e.d:"string"==typeof e.d&&(n=new o.Buffer(e.d,"base64")),o.Buffer.isBuffer(e.publicKey)){var c=mt(r,e.publicKey);s=c.x,a=c.y}else if("string"==typeof e.publicKey){c=mt(r,new o.Buffer(e.publicKey,"base64"));s=c.x,a=c.y}else o.Buffer.isBuffer(e.x)?s=e.x:"string"==typeof e.x&&(s=new o.Buffer(e.x,"base64")),o.Buffer.isBuffer(e.y)?a=e.y:"string"==typeof e.y&&(a=new o.Buffer(e.y,"base64"))}if(!r)throw new TypeError("EC Key curve not specified");if(!s||!a)throw new TypeError("Public EC Key point unavailable");var u=pt[r];if(!u)throw new TypeError('EC Key curve "'+r+'" invalid');if(s.length!=u)throw new TypeError("Public EC Key point X of wrong length");if(a.length!=u)throw new TypeError("Public EC Key point Y of wrong length");if(n&&a.length!=u)throw new TypeError("Private EC Key of wrong length");Object.defineProperties(this,{curve:{enumerable:!0,configurable:!1,value:r},isPrivateECKey:{enumerable:!0,configurable:!1,value:null!=n},x:{enumerable:!0,configurable:!1,get:function(){return new o.Buffer(s)}},y:{enumerable:!0,configurable:!1,get:function(){return new o.Buffer(a)}},jsonCurve:{enumerable:!1,configurable:!1,value:yt[r]},publicCodePoint:{enumerable:!1,configurable:!1,get:function(){return o.Buffer.concat([new o.Buffer([4]),s,a])}}}),n&&Object.defineProperty(this,"d",{enumerable:!0,configurable:!1,get:function(){return new o.Buffer(n)}})}function xt(e,t){return function(e,t){const r=new Et(function(e,t,r){return new Je(e,t,r)}(e,"EC PRIVATE KEY",t).pem,"pem"),n=r.d;let o=r.publicCodePoint;o.length>64&&(o=o.slice(1));return{privateKey:n,publicKey:o}}(e,t)}function wt(e,t){let r=e;we(r)?32!==r.length&&(r=Re(xe(r))):r=ke(r)&&0===r.indexOf("0x")?Re(r):Re(xe(r));const n=u.sign(r,t);return o.Buffer.concat([n.signature,o.Buffer.from([n.recovery])],65)}function Tt(e,t){let r=e,n=t;if(!r||!n)throw Error("aes password or tx hash is invalid"+r+"..."+n);if(ke(r)&&(r="0x"===r.substr(0,2)?o.Buffer.from(r.substr(2),"hex"):o.Buffer.from(r,"ascii")),!we(r))throw Error("aes password is invalid");n=Le(n);return A.default("sha256").update(o.Buffer.concat([r,n])).digest().slice(0,16)}function kt(){return tt(4).readUInt32BE(0)}function St(e,t,r,n,s){return s===ut?function(e,t,r){let n=r,s=e;if(!s)throw Error("ecc_pub_key is invalid");n||(n=tt(16));n=Le(n);const a=tt(12),i=Bt(t,n,a),c=o.Buffer.from(i.authTag,"hex"),u=o.Buffer.from(i.data,"hex"),p={iv:a},y=K.default.formatter.pemToBin(""+s),d=o.Buffer.from(y);s=d.slice(d.byteLength-65,d.byteLength),s=Le(s);let f=ct(s,n,p);if(109>f.length){const e=o.Buffer.alloc(109);f.copy(e,109-f.length),f=e}const l=new o.Buffer(2);l.writeUInt16BE(320,0),f=Le(f);return"0x"+o.Buffer.concat([l,f,a,c,u]).toString("hex")}(e,t,Tt(r,n)):function(e,t,r){let n=r,s=e;n||(n=tt(16));if(n=Le(n),!s)throw Error("rsa_pub_key is invalid");ke(s)&&-1===s.indexOf("PUBLIC KEY")&&("0x"===s.substr(0,2)&&(s=s.substr(2)),s=Xe(s,"PUBLIC KEY"));const a=tt(12),i=Bt(t,n,a);let c=I.default.publicEncrypt(s,n);if(256>c.length){const e=o.Buffer.alloc(256);c.copy(e,256-c.length),c=e}const u=new o.Buffer(2);u.writeUInt16BE(1,0);return"0x"+o.Buffer.concat([u,c,a,o.Buffer.from(i.authTag,"hex"),o.Buffer.from(i.data,"hex")]).toString("hex")}(e,t,Tt(r,n))}function Bt(e,t,r){if(!t||!r)throw Error("aes empty key or iv!");let n=e,o=t;n=Le(n),o=Le(o);const s=d.createCipheriv("aes-128-gcm",o,r);s.setAutoPadding(!1);const a=s.update(n).toString("hex");s.final();return{data:a,authTag:s.getAuthTag().toString("hex")}}function Rt(e,t,r){return function(e,t){if(!t||!e)throw Error("aes empty key or data!");let r=e,n=t;r=Le(r),n=Le(n);let o=r.length-16,s=r.length;const a=r.slice(o,s);o-=12,s-=16;const i=r.slice(o,s),c=r.slice(0,o),u=d.createDecipheriv("aes-128-gcm",n,i);return u.setAuthTag(a),"0x"+u.update(c).toString("hex")}(e,Tt(t,r))}function Pt(e,t){if(-1!==e.name.indexOf("("))return e.name;let r="";return r=t?t.join(","):e.inputs.map((function(e){return e.type})).join(","),e.name+"("+r+")"}Et.prototype.asPublicECKey=function(){return this.isPrivateECKey?new Et({curve:this.curve,x:this.x,y:this.y}):this},Et.prototype.toBuffer=function(e){if(e||(e="pem"),"pem"==e)return new o.Buffer(this.toString("pem"),"ascii");if(this.isPrivateECKey){for(var t=this.d;0==t[0];)t=t.slice(1);if("pkcs8"==e||"rfc5208"==e)return lt.encode({version:0,algorithmIdentifier:{privateKeyType:"EC",parameters:this.curve},privateKey:ft.encode({version:1,privateKey:t,publicKey:{data:this.publicCodePoint}},"der")},"der");if("rfc5915"==e)return ft.encode({version:1,privateKey:t,parameters:this.curve,publicKey:{data:this.publicCodePoint}},"der");throw new TypeError('Unknown format for private key "'+e+'"')}if("spki"==e||"rfc5280"==e)return ht.encode({algorithmIdentifier:{publicKeyType:"EC",parameters:this.curve},publicKey:{data:this.publicCodePoint}},"der");throw new TypeError('Unknown format for public key "'+e+'"')},Et.prototype.toString=function(e){if(e||(e="pem"),this.isPrivateECKey){if("pem"==e)return"-----BEGIN PRIVATE KEY-----\n"+this.toBuffer("pkcs8").toString("base64").match(/.{1,64}/g).join("\n")+"\n-----END PRIVATE KEY-----\n";if("rfc5915"==e)return"-----BEGIN EC PRIVATE KEY-----\n"+this.toBuffer("rfc5915").toString("base64").match(/.{1,64}/g).join("\n")+"\n-----END EC PRIVATE KEY-----\n";if("pkcs8"==e||"rfc5208"==e)return this.toBuffer("pkcs8").toString("base64");if("spki"==e||"rfc5280"==e)return this.toBuffer("spki").toString("base64");throw new TypeError('Unknown format for private key "'+e+'"')}if("pem"==e)return"-----BEGIN PUBLIC KEY-----\n"+this.toBuffer("spki").toString("base64").match(/.{1,64}/g).join("\n")+"\n-----END PUBLIC KEY-----\n";if("spki"==e||"rfc5280"==e)return this.toBuffer("spki").toString("base64");throw new TypeError('Unknown format for public key "'+e+'"')},Et.prototype.toJSON=function(){function e(e){return e.toString("base64").replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")}var t={kty:"EC",crv:yt[this.curve],x:e(this.x),y:e(this.y)},r=this.d;if(r){var n=pt[this.curve];if(n>r.length)r=o.Buffer.concat([new o.Buffer(n-r.length).fill(0),r]);t.d=e(r)}return t};var Nt;!function(e){e.CONNECTION="connection",e.RESPONSE_NOT_JSON="responseNotJSON",e.RETURNCODE_ERROR="returnCode",e.RECEIPT_ERROR="receiptResult"}(Nt||(Nt={}));class It extends Error{constructor(e,t){super(e),this.type=void 0,this.code=void 0,this.returnCode=void 0,this.receiptCode=void 0,this.hash=void 0,this.output=void 0,t&&(this.type=t.type,this.code=t.code,this.returnCode=t.returnCode,this.receiptCode=t.receiptCode,this.hash=t.hash,this.output=t.output)}}const At={InvalidNumberOfSolidityArgs:()=>new It("Invalid number of arguments to Solidity function"),connection:e=>new It("CONNECTION ERROR: Could not connect "+e+".",{type:Nt.CONNECTION}),response:()=>new It("Response ERROR: Response is not JSON",{type:Nt.RESPONSE_NOT_JSON}),timeout:()=>new It("CONNECTION TIMEOUT"),unauthorized:()=>new It("CONNECTION UNAUTHORIZED"),api:e=>new It("API ERROR: "+e+" is not API"),param:e=>new It("PARAMETER ERROR: The value of "+e+" is error"),contractDeploy:e=>new It("CONTRACT ERROR: The contract of "+e+" is not deploy"),returnCode:e=>new It("ERROR: The return_code is "+e,{type:Nt.RETURNCODE_ERROR,code:e,returnCode:e}),receiptResult:(e,t,r)=>new It("ERROR: The Receipt result is "+e,{type:Nt.RECEIPT_ERROR,code:e,receiptCode:e,hash:t,output:r}),codeResult:(e,t)=>new It("ERROR: The return_code is "+e+". The Receipt result is "+t,{type:Nt.RETURNCODE_ERROR,code:`${e}-${t}`,returnCode:e,receiptCode:t})};function Kt(e){let t=e;return we(t)&&(t=t.toString("hex")),t?"0x"+t:""}var Ot=Object.freeze({__proto__:null,inputdecimal:function(e){return Ie(e)},inputhash:function e(t){if(ke(t)){if(0===t.indexOf("0x")){if(66===t.length)return t;if(66>t.length)return"0x"+Pe(Me(t).slice(2),64)}return xe(t)}if(we(t))return Oe(t);if(Be(t)){const r=[];for(let n=0;t.length>n;n++)r[n]=e(t[n]);return r}return"0x"+Pe(Me(t).slice(2),64)},inputbytes:function(e){return we(e)?Oe(e):ke(e)&&0===e.indexOf("0x")?e:Me(e)},inputcode:function(e,t,r){let n=t,o=r;n||(n="01"),o||(o="");let s="",a="",i=0;if(we(e)?(i=e.length,s=e.toString("hex")):ke(e)&&(s=e,0===s.indexOf("0x")&&(s=s.slice(2)),i=s.length/2),"wasm"===n){n="02";const e=new Buffer(4);e.writeUInt32BE(i),a=e.toString("hex")}if(""===s)throw At.param("code");return"0x"+n+a+s+o},inputbignumber:function(e){return O.default.isBN(e)?e:ke(e)&&0===e.indexOf("0x")?new O.default(e.slice(2),16):new O.default(e,10)},outputdecimal:function(e,t){let r=e;return we(r)&&(r=r.toString("hex")),Ie(r,t)},outputbytes:Kt,outputhash:function(e){return Kt(e)},outputstring:function(e){let t=e;return we(t)&&(t=t.toString("hex")),De(t)},outputbignumber:function(e){let t=e;return"number"==typeof t?t:we(t)?(t=t.toString("hex"),new O.default(t,16).toNumber()):ke(t)&&0===t.indexOf("0x")?new O.default(t.slice(2),16).toNumber():new O.default(t).toNumber()}});const Dt=[[{name:"session_id"}]],Mt={name:"hash",type:"hash"},Lt=Array(Mt);Lt.value=[],Lt.name="hashes",Lt.type="array";const Wt=[{name:"key",type:"bytes"},{name:"value",type:"bytes"}];Wt.name="configs",Wt.type="array";const jt={name:"timestamp",type:"decimal"},Ut={name:"from",type:"hash"},zt={name:"to",type:"hash"},Ht={name:"gas_used",type:"decimal"},Vt={name:"identity",type:"hash"},Qt={name:"transaction_index",type:"decimal"},Ft={name:"topic",type:"string"},Yt={name:"msg_type",type:"decimal"},$t={name:"sequence",type:"decimal"},Jt={name:"group_id",type:"bytes"},Gt={name:"return_code",type:"decimal"},Xt=[Yt],Zt=[Xt,$t,Jt],er=[Xt,$t,Gt,Jt],tr={name:"block_number",type:"bignumber"},rr=[Ft];rr.name="topics",rr.type="array",rr.array_type="one";const nr=[Ut,zt,rr,{name:"log_data",type:"bytes"}];nr.name="log_entry",nr.value=[],nr.type="array";const or=[{name:"result",type:"decimal"},Ht,nr,{name:"output",type:"bytes"}];or.name="receipt";const sr=[or];sr.name="receipts",sr.type="array";const ar={name:"transaction_type",type:"decimal"},ir={name:"nonce"},cr={name:"period",type:"decimal"},ur={name:"value",type:"decimal"},pr={name:"gas",type:"decimal"},yr={name:"version",type:"decimal",value:2},dr=[];dr.name="extensions",dr.type="array";const fr={name:"data",type:"bytes"},lr=[{name:"signature",type:"bytes"}];lr.name="signature",lr.type="array",lr.array_type="one";const hr=[Mt,ar,jt,ir,cr,Ut,zt,ur,pr,Jt,yr,fr,lr,dr];hr.name="transaction";const mr=[Mt,ar,jt,ir,cr,Ut,zt,ur,pr,Jt,yr,fr,lr,dr];mr.name="transactions",mr.type="array";const gr=[hr,or,tr,Qt];gr.name="transaction_infos",gr.type="array";const _r=[...hr];_r.type="array",_r.value=[],_r.name="transaction_list";const vr=[...or];vr.type="array",vr.value=[],vr.name="receipt_list";const br=[Mt,{name:"version",type:"decimal"},tr,{name:"parent_hash",type:"hash"},{name:"transaction_root",type:"bytes"},{name:"receipt_root",type:"bytes"},{name:"state_root",type:"bytes"},Ht,jt,{name:"log_bloom",type:"bytes"}];br.name="block_header";const Cr=[_r,vr,{name:"consensus_proof",type:"bytes"}];Cr.name="block_body";const qr=[br,Cr];qr.name="block";const Er={name:"balance",value:"",type:"decimal"},xr={name:"recover_key",type:"bytes"},wr={name:"recover_time",type:"decimal"},Tr={name:"status",type:"decimal"},kr={name:"code",type:"bytes"},Sr={name:"storage_root",type:"bytes"},Br={name:"code_hash",type:"hash"},Rr={name:"encryption_key",type:"bytes"},Pr={name:"auth_key",type:"bytes"},Nr={name:"auth_weight",type:"decimal"},Ir=[Pr,Nr];Ir.name="auth_map",Ir.type="array",Ir.array_type=2,Ir.rlp=!0,Ir.mapInfo={key:Pr,value:Nr};const Ar=[Vt,Er,xr,wr,Tr,kr,Sr,Br,Rr,[{name:"acc_version",type:"decimal",value:2}],Ir],Kr=[Vt,Er,xr,wr,Tr,kr,Sr,Br,Rr,Pr,Nr];Ar.name="data";const Or=Ar,Dr={name:"node_id",type:"bytes",value:"0x00"},Mr={name:"public_key",type:"bytes"},Lr={name:"node_role",type:"decimal"},Wr={name:"node_state",type:"decimal"},jr=[{name:"ip",type:"string"},{name:"port",type:"decimal"}];jr.name="endpoints",jr.type="array";const Ur=[[Dr,Mr,Lr,Wr,jr],{name:"isConnected",type:"decimal"}];Ur.name="node_status",Ur.type="array";const zr=[{name:"total_node_count",type:"decimal"},{name:"total_consensus_node_count",type:"decimal"},{name:"total_non_consensus_node_count",type:"decimal"},{name:"total_connected_consensus_node_count",type:"decimal"},{name:"total_connected_non_consensus_node_count",type:"decimal"},Ur];zr.name="p2p_status";const Hr=[Dr,Mr,Lr,Wr,jr];Hr.name="node_info",Hr.type="array";const Vr=[{name:"syncing",type:"decimal"},{name:"my_best",type:"decimal"},{name:"target",type:"decimal"}];Vr.name="sync_status";const Qr={name:"unverified_queue_limit",type:"decimal"},Fr={name:"verified_queue_limit",type:"decimal"},Yr={name:"unverified_queue_usage",type:"decimal"},$r={name:"verified_queue_usage",type:"decimal"},Jr=[Qr,Fr,Yr,$r];Jr.name="transaction_cache_info";const Gr=[Qr,Fr,{name:"verified_parent_not_found_queue_limit",type:"decimal"},Yr,$r,{name:"verified_parent_not_found_queue_usage",type:"decimal"},{name:"unverified_max_block_number",type:"decimal"},{name:"verified_max_block_number",type:"decimal"},{name:"verified_parent_not_found_max_block_number",type:"decimal"}];Gr.name="block_cache_info";const Xr={name:"code",type:"bytes"},Zr={name:"type",type:"decimal",value:0},en={name:"filter_id",type:"decimal"},tn=[{name:"type",type:"bytes"},{name:"phase",type:"string"},{name:"n",type:"decimal"},{name:"f",type:"decimal"},{name:"current_leader",type:"bytes"},{name:"my_id",type:"bytes"},{name:"current_view",type:"decimal"},{name:"last_exec_seq",type:"decimal"},{name:"propose_size",type:"decimal"},{name:"propose_timeout_interval",type:"decimal"},{name:"normal_timeout_interval",type:"decimal"},{name:"viewchange_timeout_interval",type:"decimal"}];tn.name="info";const rn=[{name:"black_list",type:"hash"}];rn.name="black_list",rn.type="array";const nn=[{name:"type",type:"decimal"},{name:"proof",type:"bytes"}];nn.name="block_proof_info";const on={name:"block_number",type:"decimal"},sn=[{name:"data",type:"bytes"},{name:"next_key_begin_index",type:"decimal"},{name:"next_key_end_index",type:"decimal"}];sn.name="nodes",sn.type="array";const an=[on,{name:"state_root",type:"bytes"},sn];an.name="proof";const cn={name:"root",type:"bytes"},un={name:"index",type:"decimal"},pn={name:"size",type:"decimal"},yn={name:"branch",type:"decimal"},dn=[on,cn,un,pn,yn];dn.name="proof";const fn=[on,cn,un,pn,yn];fn.name="receipt_proof";const ln=[nn,br];ln.name="header_infos",ln.type="array";const hn={name:"block_hash",type:"hash"},mn=[hn,sr];mn.name="block_receipts",mn.type="array";const gn=[mr,sr,{name:"consensus_proof",type:"bytes"}];gn.name="body";const _n=[hn,gn];_n.name="block_body",_n.type="array";const vn=25,bn=124,Cn="CreateAccount",qn="QueryTransactionReceipt",En="TransferBalance",xn="SetRecoverkey",wn="PreResetPubKey",Tn="ResetPubKey",kn="UpdateAuthMap",Sn="QueryLastBlock",Bn="QueryBlockHeader",Rn="QueryLastBlockHeader",Pn="QueryBlock",Nn="QueryTransaction",In="QueryAccount",An="QueryContract",Kn="DeployContract",On="UpdateContract",Dn="CallContract",Mn="EncryptedTransaction",Ln="EventContract",Wn="EventFetch",jn={},Un={};function zn(e,t){return ke(e)&&"0x"===e.substr(0,2)&&66===e.length?t?e.substr(2):e:xe(e,t)}function Hn(e,t){const r=[];for(let n=0;e.length>n;n++){const o=e[n];if(!Array.isArray(o)||o.rlp){let e=t[o.name]||o.value||"",s=o.type;o.rlp&&(s="bytes");const a=Ot["input"+s];a&&(e="code"===s&&t.type?a(e,t.type,t.parameters):a(e)),r[n]=e}else r[n]=Hn(o,t)}return r}function Vn(e,t){const r=Un[e];if(!r)throw Error(e+" is not api");return Hn(r.data,t)}function Qn(e,t,r){const n=[];for(let o=0;r.length>o;o++){const s=r[o];if(!Array.isArray(s)||s.rlp){const r=s.name;let a=t[r]||s.value||"";if("msg_type"===r)a=Un[e].request_msg_type;else if("transaction_type"===r)a=Un[e].transaction_type,e===exports.MychainMethods.LocalTransaction&&(a=t.type);else{let e=s.type;s.rlp&&(e="bytes");const t=Ot["input"+e];t&&(a=t(a))}n[o]=a}else n[o]=Qn(e,t,s)}return n}function Fn(e,t){te("RequestProcess "+e,t);const r=Un[e];if(!r)throw Error(e+" is not api");return Qn(e,t,r.request)}function Yn(e,t){if(we(t)){const r=Ot["output"+e.type];return r?r(t):t.toString("hex")}return t||e.value||""}function $n(e,t,r={}){const n=t.name,o=t.type;let s=r;if(Array.isArray(t)&&e)if("array"===o&&Array.isArray(e)){const r=[];if("one"===t.array_type)e.forEach((e=>{r.push(Yn(t[0],e))}));else if("number"==typeof t.array_type){const n=t.slice(0);for(let t=0;e.length>t;t+=2)r.push(Jn([e[t],e[t+1]],n))}else e.forEach((e=>{r.push(Jn(e,t))}));s[n||"arr"]=r}else if(t.rlp){s=$n($e(e),t,s)}else n?s[n]=Jn(e,t):s=Jn(e,t,s);else s[n]=Yn(t,e);return s}function Jn(e,t,r={}){let n=r;for(let r=0;t.length>r;r++){n=$n((Array.isArray(e)?e[r]:e)||"",t[r],n)}return n}function Gn(e,t){switch(e){case exports.EventListenerType.ACCOUNT:return function(e){return Jn(e,[[Kr]])}(t);case exports.EventListenerType.CONTRACT:return function(e){return Jn(e,[[Ar]])}(t);case exports.EventListenerType.TOPICS:return function(e){return Jn(e,[[[Ft,{name:"data",type:"bytes"}]]])}(t);case exports.EventListenerType.BLOCK:return function(e){return Jn(e,[[br]])}(t)}}function Xn(e,t,r){let n=e;if(!n)throw Error("aes empty key or iv or tag!");n=Le(n);const o=function(e,t){if(!t||!e)throw Error("aes empty key or data!");let r=e,n=t;r=Le(r),n=Le(n);let o=0,s=12;const a=r.slice(o,s);o+=12,s+=16;const i=r.slice(o,s);o+=16,s=r.length;const c=r.slice(o,s),u=d.createDecipheriv("aes-128-gcm",n,a);return u.setAuthTag(i),"0x"+u.update(c).toString("hex")}(n.slice(258,n.length),Tt(t,r));return Jn($e(o),hr)}function Zn(e,t,r,n){const o=function(e){return Un[e].transaction_type}(e);te("[NEW JS SDK] getTxData:",t);const s={type:o,group_id:t.group_id||"0x0000000000000000000000000000000000000000",timestamp:Date.now(),nonce:t.nonce||kt(),period:t.period||100,from:t.from||r.from,to:t.to,value:t.value||0,gas:t.gas||1e10,version:t.tx_version||2,extensions:[],data:t.data};r.sequence&&(s.sequence=r.sequence);const a=t.hash||xe(Ye([s.type,s.timestamp,s.nonce,s.period,s.from,s.to,s.value,s.gas,s.group_id,s.version,s.data,s.extensions])),i=wt(a,n||r.userPrivateKey);return s.hash=a,s.signature=r.isSign?Oe(i):"",te("[NEW JS SDK] getTxData return param:",s),s}function eo(e,t,r,n){return{type:t.transaction_type,group_id:e.group_id||"0x0000000000000000000000000000000000000000",timestamp:r,nonce:e.nonce||kt(),period:e.period||100,from:"0x0",to:"0x0",value:e.value||0,gas:e.gas||1e7,version:e.tx_version||2,extensions:[],data:e.data||"0x0",sequence:t.sequence,hash:n,signature:"0x0"}}function to(e,t){return ze().abi(e,Buffer.from(t))}function ro(e,t){return no.apply(this,arguments)}function no(){return(no=H((function*(e,t){te("[utils/mychain] getUserInfo");const r=xt(Ve(e,t),t);if(!r)throw Error("[utils/mychain] 获取用户信息失败，请检查 account 相关配置");return r}))).apply(this,arguments)}function oo(e){const t=e.startsWith("0x")?e.substring(2):e;return Buffer.from(t,"hex")}function so(e){return oo(e).toString("base64")}function ao(e){return e.startsWith("0x")?e.substring(2):e}[{name:Cn,topics:"create_account",request_msg_type:2,response_msg_type:14,transaction_type:0,request:[Yt,[Zt,hr]],response:[Yt,[er,Mt]],data:Ar},{name:En,topics:"transfer_balance",request_msg_type:3,response_msg_type:15,transaction_type:1,request:[Yt,[Zt,hr]],response:[Yt,[er,Mt]],data:[]},{name:xn,topics:"set_recover_key",request_msg_type:4,response_msg_type:16,transaction_type:20,request:[Yt,[Zt,hr]],response:[Yt,[er,Mt]],data:[xr]},{name:wn,topics:"",request_msg_type:5,response_msg_type:17,transaction_type:21,request:[Yt,[Zt,hr]],response:[Yt,[er,Mt]],data:[]},{name:Tn,topics:"",request_msg_type:6,response_msg_type:18,transaction_type:22,request:[Yt,[Zt,hr]],response:[Yt,[er,Mt]],data:[Pr,Nr]},{name:kn,topics:"",request_msg_type:7,response_msg_type:19,transaction_type:23,request:[Yt,[Zt,hr]],response:[Yt,[er,Mt]],data:[Pr,Nr]},{name:"FreezeAccount",topics:"",request_msg_type:24,response_msg_type:25,transaction_type:vn,request:[Yt,[Zt,hr]],response:[Yt,[er,Mt]],data:[]},{name:"FreezeContract",topics:"",request_msg_type:28,response_msg_type:29,transaction_type:vn,request:[Yt,[Zt,hr]],response:[Yt,[er,Mt]],data:[]},{name:"NativeDepositData",request_msg_type:36,response_msg_type:37,transaction_type:40,request:[Yt,[Zt,hr]],response:[Yt,[er,Mt]],data:[{name:"payload",type:"bytes"}]},{name:Sn,request_msg_type:51,response_msg_type:58,transaction_type:"",request:[Yt,Zt],response:[Yt,[er,qr]],data:[]},{name:Bn,request_msg_type:52,response_msg_type:59,transaction_type:"",request:[Yt,[Zt,tr,Mt]],response:[Yt,[er,br]],data:[]},{name:Rn,request_msg_type:66,response_msg_type:67,transaction_type:"",request:[Yt,Zt],response:[Yt,[er,br]],data:[]},{name:Pn,request_msg_type:53,response_msg_type:60,transaction_type:"",request:[Yt,[Zt,tr,Mt]],response:[Yt,[er,qr]],data:[]},{name:Nn,request_msg_type:55,response_msg_type:62,transaction_type:"",request:[Yt,[Zt,Mt]],response:[Yt,[er,hr,tr,Qt]],data:[]},{name:qn,request_msg_type:56,response_msg_type:63,transaction_type:"",request:[Yt,[Zt,Mt]],response:[Yt,[er,or,tr,Qt]],data:[]},{name:"QueryTransactionList",request_msg_type:94,response_msg_type:95,transaction_type:"",request:[Yt,[Zt,Mt]],response:[Yt,[er,mr]],data:[]},{name:"QueryTransactionAndReceipt",request_msg_type:96,response_msg_type:97,transaction_type:"",request:[Yt,[Zt,Mt]],response:[Yt,[er,gr]],data:[]},{name:In,request_msg_type:54,response_msg_type:61,transaction_type:"",request:[Yt,[Zt,Mt]],response:[Yt,[er,Ar]],data:[]},{name:An,request_msg_type:64,response_msg_type:65,transaction_type:"",request:[Yt,[Zt,Mt]],response:[Yt,[er,Or]],data:[]},{name:"QueryTimestamp",request_msg_type:50,response_msg_type:57,transaction_type:"",request:[Yt,Zt],response:[Yt,[er,jt]],data:[]},{name:"QueryP2PStatus",request_msg_type:100,response_msg_type:101,transaction_type:"",request:[Yt,Zt,Dr],response:[Yt,[er,zr]],data:[]},{name:"QueryConsensusStatus",request_msg_type:102,response_msg_type:103,transaction_type:"",request:[Yt,[Zt,Dr]],response:[Yt,[er,tn]],data:[]},{name:"QueryCommonConsensusStatus",request_msg_type:200,response_msg_type:201,transaction_type:"",request:[Yt,[Zt,Dr]],response:[Yt,[er,{name:"type",type:"decimal"},{name:"info",type:"bytes"}]],data:[]},{name:"QuerySyncStatus",request_msg_type:104,response_msg_type:105,transaction_type:"",request:[Yt,[Zt,Dr]],response:[Yt,[er,Vr]],data:[]},{name:"QueryTransactionCacheStatus",request_msg_type:106,response_msg_type:107,transaction_type:"",request:[Yt,[Zt,Dr]],response:[Yt,[er,Jr]],data:[]},{name:"QueryBlockCacheStatus",request_msg_type:108,response_msg_type:109,transaction_type:"",request:[Yt,[Zt,Dr]],response:[Yt,[er,Gr]],data:[]},{name:"QueryContractNodesStatus",request_msg_type:110,response_msg_type:111,transaction_type:"",request:[Yt,Zt],response:[Yt,[er,Hr]],data:[]},{name:"QueryContractConfigStatus",request_msg_type:112,response_msg_type:113,transaction_type:"",request:[Yt,Zt],response:[Yt,[er,Wt]],data:[]},{name:"QueryLogLevel",request_msg_type:152,response_msg_type:153,transaction_type:"",request:[Yt,Zt],response:[Yt,[er,{name:"level",type:"decimal"}]],data:[]},{name:"UpdateBlackList",request_msg_type:158,response_msg_type:159,transaction_type:"",request:[Yt,[Zt,rn,lr]],response:[Yt,er],data:[]},{name:"QueryBlockProof",request_msg_type:68,response_msg_type:69,transaction_type:"",request:[Yt,[Zt,tr,Mt]],response:[Yt,[er,nn]],data:[]},{name:"QueryLatestStateProof",request_msg_type:70,response_msg_type:71,transaction_type:"",request:[Yt,[Zt,Vt]],response:[Yt,[er,an]],data:[]},{name:"QueryStateProof",request_msg_type:80,response_msg_type:81,transaction_type:"",request:[Yt,[Zt,Vt]],response:[Yt,[er,an]],data:[]},{name:"QueryTransactionProof",request_msg_type:72,response_msg_type:73,transaction_type:"",request:[Yt,[Zt,Mt]],response:[Yt,[er,dn]],data:[]},{name:"QueryReceiptProof",request_msg_type:82,response_msg_type:83,transaction_type:"",request:[Yt,[Zt,Mt]],response:[Yt,[er,fn]],data:[]},{name:"QueryBlockHeaderInfos",request_msg_type:74,response_msg_type:75,transaction_type:"",request:[Yt,[Zt,Mt,tr,{name:"max_amount",type:"decimal"},{name:"reverse",type:"decimal"}]],response:[Yt,[er,ln]],data:[]},{name:"QueryBlockReceiptInfos",request_msg_type:76,response_msg_type:77,transaction_type:"",request:[Yt,[Zt,Mt]],response:[Yt,[er,mn]],data:[]},{name:"QueryBlockBodyInfos",request_msg_type:78,response_msg_type:79,transaction_type:"",request:[Yt,[Zt,Mt]],response:[Yt,[er,_n]],data:[]},{name:Kn,request_msg_type:8,response_msg_type:20,transaction_type:10,request:[Yt,[Zt,hr]],response:[Yt,[er,Mt]],data:[Xr]},{name:On,request_msg_type:10,response_msg_type:22,transaction_type:12,request:[Yt,[Zt,hr]],response:[Yt,[er,Mt]],data:[Xr]},{name:Dn,request_msg_type:9,response_msg_type:21,transaction_type:11,request:[Yt,[Zt,hr]],response:[Yt,[er,Mt]],data:[{name:"parameter",type:"bytes"}]},{name:"EventAccount",request_msg_type:120,response_msg_type:bn,transaction_type:"",request:[Yt,[Zt,Zr,Vt]],response:[Yt,[er,en]],data:[]},{name:Ln,request_msg_type:121,response_msg_type:bn,transaction_type:"",request:[Yt,[Zt,Zr,Vt]],response:[Yt,[er,en]],data:[]},{name:"EventTopics",request_msg_type:122,response_msg_type:bn,transaction_type:"",request:[Yt,[Zt,Zr,[Ft]]],response:[Yt,[er,en]],data:[]},{name:"EventBlock",request_msg_type:123,response_msg_type:bn,transaction_type:"",request:[Yt,[Zt,Zr,$t]],response:[Yt,[er,en]],data:[]},{name:Wn,request_msg_type:125,response_msg_type:136,transaction_type:"",request:[Yt,[Zt,en]],response:[Yt,[er,{name:"event_type",type:"decimal"},{name:"event_data",type:"bytes"}]],data:[]},{name:"EventCancel",request_msg_type:134,response_msg_type:135,transaction_type:"",request:[Yt,[Zt,[en]]],response:[Yt,[Xt,$t,Gt,Jt]],data:[]},{name:"LocalTransaction",request_msg_type:1,response_msg_type:13,request:[Yt,[Zt,tr,hr]],response:[Yt,[er,Mt,or]],data:[]},{name:Mn,request_msg_type:800,response_msg_type:801,transaction_type:500,request:[Yt,[Zt,hr]],response:[Yt,[er,Mt]],data:[{name:"encrypted_tx",type:"bytes"}]}].forEach((e=>{Un[e.name]=e,jn[e.response_msg_type]=e}));const io=new s.AbiCoder;function co(e,t){return io.encode(e,t).slice(2)}function uo(e){return"0x"+Buffer.from(e,"base64").toString("hex")}function po(e,t,r,n=(e=>e)){te("[RestProvider] getTransactionRequest args:",e,t,r);const o=Zn(e,U(U({},t),{},{to:zn(t.to),from:zn(t.from),data:Vn(e,t.data)[0]||""}),r);te("[RestProvider] getTransactionRequest txData:",o);const s=Fn(e,o);te("[RestProvider] getTransactionRequest rlpRawData:",s);const a=c.encode(n(s));return te("[RestProvider] getTransactionRequest rlpData:",a),{txData:o,rlpData:a}}function yo(e,t,r){if(!r)return"";const n=t.find((({name:t})=>t===e)),o=(Be(n.outputs)?n.outputs:[]).map((({type:e})=>e)),s=function(e,t){return io.decode(e,oo(t))}(o,r);return 1===s.length?s[0]:s}function fo(e,t){if(e.filter((function(e){return!(!0===Se(e)&&!1===Be(e)&&!1===Te(e))})).length!==t.length)throw At.InvalidNumberOfSolidityArgs()}var lo=function(){};lo.prototype.encodeParams=function(e,t,r,n){let s="";if(!1===ke(e)||!1===Se(t)||!1===Be(r))return s;if(!1===Se(t.schema)||!t.schema[e]||!r)return s;if(!1===Se(t.schema[e])||!1===Se(t.schema[e].fields))return s;let a=Object.keys(t.schema[e].fields);if(Be(r)&&a.length!==r.length)return s;let i={},c=0;r&&Be(r)&&a.forEach((function(e){i[e]=r[c],c++}));const u=t.toBuffer(e,i),p=t.toBuffer("string",e),y=t.toBuffer("bytes",u),d=o.Buffer.concat([p,y]);if(n){let e=new o.Buffer(4);e.writeUInt32BE(d.length),s=e.toString("hex")+d.toString("hex")}else s=d.toString("hex");return s},lo.prototype.decodeParam=function(e,t,r){return e&&t&&r?!1==("function"==typeof e.fromBuffer)?null:e.fromBuffer(t,r):null};var ho=new lo;function mo(e){return new Promise((t=>{setTimeout((()=>{t()}),e)}))}const go=[3e4,1e4,5e3,2e3,1e3];class _o extends D.default{queryTransactionReceiptWithRetry(e,t,r=go.length-1){var n=this;return H((function*(){0>r?yield mo(3e4):yield mo(go[r]);try{return yield n.queryTransactionReceipt(e)}catch(o){if("404"!==o.code&&"414"!==o.code)throw te(`code is ${o.code}, stop retry`),o;if(t){if(Date.now()>t)throw Error("queryTransactionReceipt timeout")}else if(0===r)throw Error("queryTransactionReceipt retry times out");return yield n.queryTransactionReceiptWithRetry(e,t,r-1)}}))()}}const vo={ecdhCurve:"secp256k1:prime256v1"};class bo{constructor({host:e,port:t,clients:r,timeout:n,cert:o,ca:s,key:a,passphrase:i,checkServerIdentity:c,sendCallback:u},p){this.callback=void 0,this.sendCallback=void 0,this.retryNum=void 0,this.clients=void 0,this.currentClient=void 0,this.host=void 0,this.port=void 0,this.timeout=void 0,this.cert=void 0,this.ca=void 0,this.key=void 0,this.passphrase=void 0,this.checkServerIdentity=void 0,this.socket=void 0,this.callback=p,this.sendCallback=u||"",this.retryNum=0;let y=e,d=t,f=r;y&&d?(Array.isArray(r)||(f=[]),f=[{host:y,port:d}].concat(f)):Array.isArray(r)&&r.length&&(y=r[0].host,d=r[0].port),this.clients=f||[],this.currentClient=0,this.resetConnect({host:e,port:t,timeout:n,cert:o,ca:s,key:a,passphrase:i,checkServerIdentity:c})}doCallback(e,t){"function"==typeof this.callback&&this.callback(e,t)}setConfig({host:e,port:t,timeout:r,cert:n,ca:o,key:s,passphrase:a,checkServerIdentity:i}){this.host=e||"localhost",this.port=t||"18130",this.timeout=r||3e4,this.cert=n||"",this.ca=o||"",this.key=s||"",this.passphrase=a||"",this.checkServerIdentity=i}connect(){const e=M.default.createSecureContext({cert:this.cert,ca:[this.ca],key:this.key,passphrase:this.passphrase,ciphers:"ALL",ecdhCurve:vo.ecdhCurve}),t={host:this.host,port:this.port,secureContext:e,checkServerIdentity:void 0};this.checkServerIdentity||(t.checkServerIdentity=()=>{});const r=M.default.connect(t,(()=>{r.authorized?(this.retryNum=0,this.doCallback()):this.doCallback(At.unauthorized)}));return r}resetConnect(e){this.setConfig(e),this.socket=this.connect();let t=null;this.socket.on("readable",(e=>{if(t||(t=this.socket.read(16)),!t)return;const r=Qe(t),n=this.socket.read(r-16);if(!n)return;const o=function(e,t){return{total_len:Qe(e),version:e.readInt16BE(4),magic1:e.readInt8(6),magic2:e.readInt8(7),reserved1:e.readInt32BE(8),reserved2:e.readInt32BE(12),data:$e(t)}}(t,n);t=null,"function"==typeof this.sendCallback&&this.sendCallback(e,o.data)})),this.socket.on("close",(()=>{if(4>this.retryNum)this.retryNum++,setTimeout((()=>{this.resetConnect(e)}),1e3);else{this.currentClient++;const t=this.clients[this.currentClient];t&&setTimeout((()=>{this.retryNum=0,this.resetConnect(U(U({},e),{},{host:t.host,port:t.port}))}),1e3)}})),this.socket.on("error",(e=>{console.error(e)}))}send(e){const t=function(e){const t=Array.isArray(e)?Fe(e):e,r=16+t.length,n=o.Buffer.alloc(16);return n.writeInt32BE(r,0),n.writeInt16BE(2,4),n.writeInt8(51,6),n.writeInt8(119,7),n.writeInt32BE(0,8),n.writeInt32BE(0,12),o.Buffer.concat([n,t],r)}(e);this.socket.write(t,"buffer",(()=>{}))}}const Co=function(e,t){return new bo(e,t)};Co.setEcdhCurve=function(e){vo.ecdhCurve=e},Co.setPrime256v1EcdhCurve=function(){this.setEcdhCurve("prime256v1")};class qo{constructor(e,t){var r=this;this.sender=null,this.callbacks={},this.sendCache=[],this.sessionId="",this.callback=null,this.currentSequence=1,this.userPublicKey=void 0,this.userSignature=void 0,this.userPrivateKey=void 0,this.userRecoverPrivateKey=void 0,this.userRecoverPublicKey=void 0,this.options=void 0,this.userKeySeted=!1,this.setUserKey=H((function*(){if(r.userKeySeted)return;const e=r.options,t=e.accountPrivateKey,n=e.accountPrivateKeyPassword,o=e.accountRecoverPrivateKey,s=e.accountRecoverPrivateKeyPassword,a=yield ro(t,n);if(o){const e=yield ro(o,s);r.userRecoverPrivateKey=Re(e.privateKey),r.userRecoverPublicKey=Re(e.publicKey)}r.userPublicKey=Re(a.publicKey||"0x97466f2b32bc3bb76d4741ae51cd1d8578b48d3f1e68da206d47321aec267ce78549b514e4453d74ef11b0cd5e4e4c364effddac8b51bcfc8de80682f952896f"),r.userPrivateKey=Re(a.privateKey||"0x3ecb44df2159c26e0f995712d4f39b6f6e499b40749b1cf1246c37f9516cb6a4"),r.userKeySeted=!0})),this.sendCallback=(e,t)=>{const r=function(e){let t=parseInt(e[0],16);e[0]&&we(e[0])&&(t=parseInt(e[0].toString("hex"),16));const r=jn[t];if(!r){if(e[0]&&e[0][0]){const t="Handshake",r=Jn(e,Dt);return r.api=t,r}throw Error('msg_type "'+t+'" is not error')}const n=r.name,o=Jn(e,r.response);return o.api=n,o}(t);if(te("[TSL connector] sendCallback get data",r),"Handshake"===r.api){if(this.sessionId=r.session_id||"","function"==typeof this.callback&&(this.callback(e,r),this.callback=null),this.sendCache.length){let e=this.sendCache.shift();for(;e;)this._send(e.rlpData),e=this.sendCache.shift()}}else{const t=this.callbacks[r.sequence];"function"==typeof t&&t(0!==r.return_code?new pe("[TLSConnector] request failed, code: "+r.return_code,r.return_code+"",r):e,r)}},this.getSequence=()=>this.currentSequence++,this.getBaseData=H((function*(){return yield r.setUserKey(),{isSign:void 0===r.options.isSign||r.options.isSign,from:r.options.account,userPrivateKey:r.userPrivateKey,userPublicKey:r.userPublicKey,userRecoverPrivateKey:r.userRecoverPrivateKey,userRecoverPublicKey:r.userRecoverPublicKey}})),this._send=e=>{te("[TSL connector] send data",e),this.sender.send(e)},this.handshake=H((function*(){te("[TSL connector] handshake...");const e=r.options.nonce,t=void 0===e?"hello world":e;yield r.setUserKey(),r.userSignature=wt(t,r.userPrivateKey),r.sender.send([t,r.userPrivateKey,r.userSignature,0])})),this.callback=t,this.options=e,this.sender=Co(U(U({},e),{},{sendCallback:this.sendCallback}),(e=>{e&&(console.error(e),t&&t(e)),this.handshake()}))}send(e,t){var r=this;return H((function*(){return new Promise(((n,o)=>{r.callbacks[t]=(e,t)=>{e?o(e):n(t)},r.sessionId?r._send(e):r.sendCache.push({sequence:t+"",rlpData:e})}))}))()}}function Eo(){return Eo=H((function*(e,t){const r=t.getSequence(),n={sequence:r,group_id:e.groupId||"0x0000000000000000000000000000000000000000",hash:zn(e.hash)},o=Fn(qn,n);return yield t.send(o,r)})),Eo.apply(this,arguments)}function xo(){return xo=H((function*(e,t){const r=t.getSequence(),n=zn(e.from),o=zn(e.to),s=yield t.getBaseData();s.sequence=r;const a=[];e.authMap.forEach((e=>{a.push(e.authKey),a.push(e.authWeight)}));const i={identity:o,recover_key:e.recoveryKey,auth_map:Ye(a)},c=Zn(Cn,{from:n,to:o,data:Ye(Vn(Cn,i))},s),u=Fn(Cn,c);return yield t.send(u,r)})),xo.apply(this,arguments)}function wo(){return wo=H((function*(e,t){const r=t.getSequence(),n=zn(e.account),o=yield t.getBaseData();o.sequence=r;const s=Zn(kn,{from:n,to:n,data:Ye(Vn(kn,{auth_key:e.authMap[0].key,auth_weight:100}))},o),a=Fn(kn,s);return yield t.send(a,r)})),wo.apply(this,arguments)}function To(){return To=H((function*(e,t){const r=t.getSequence(),n=e.contract,o=yield t.getBaseData();o.sequence=r;const s=n.generateDeployCode(e.code),a=Zn(Kn,{from:zn(e.from),to:zn(n.contractName),data:Vn(Kn,{code:s})[0]||""},o),i=Fn(Kn,a);if(e.encrypt){const s=eo({from:zn(e.from),to:zn(n.contractName),data:Vn(Mn,{encrypted_tx:St(e.publicKey,i,e.aesKey,a.hash,e.encryptType)})[0]||""},o,a.timestamp,a.hash);return yield t.send(Fn(Mn,s),r)}return yield t.send(i,r)})),To.apply(this,arguments)}function ko(){return ko=H((function*(e,t){const r=t.getSequence(),n=yield t.getBaseData();n.sequence=r;let o,s=e.code;0===s.indexOf("0x")&&(s=s.slice(2)),o=e.vm===exports.VmType.EVM?"01":"02",s="0x"+o+s;const a=Zn(On,{from:zn(e.contractName),to:zn(e.contractName),data:Vn(On,{code:s})[0]||""},n),i=Fn(On,a);return yield t.send(i,r)})),ko.apply(this,arguments)}function So(){return So=H((function*(e,t){const r=t.getSequence(),n=e.contract,o=yield t.getBaseData();o.sequence=r;const s=n.generateCallCode(e.methodName,e.args),a=Zn(Dn,{from:zn(e.from),to:zn(n.contractName),data:Vn(Dn,{parameter:s})[0]||""},o),i=Fn(Dn,a);if(e.encrypt){const s=eo({to:zn(n.contractName),data:Vn(Mn,{encrypted_tx:St(e.publicKey,i,e.aesKey,a.hash,e.encryptType)})[0]||""},o,a.timestamp,a.hash);return yield t.send(Fn(Mn,s),r)}return yield t.send(i,r)})),So.apply(this,arguments)}function Bo(){return Bo=H((function*(e,t){const r=t.getSequence(),n=yield t.getBaseData();n.sequence=r;const o=Zn(En,{from:zn(e.from),to:zn(e.to),data:"0x0",value:e.value},n),s=Fn(En,o);return yield t.send(s,r)})),Bo.apply(this,arguments)}function Ro(){return Ro=H((function*(e,t){const r=zn(e.account),n=t.getSequence(),o=yield t.getBaseData();o.sequence=n;const s=Zn(xn,{from:r,to:r,data:Vn(xn,{recover_key:e.recoverKey})[0]||""},o),a=Fn(xn,s);return yield t.send(a,n)})),Ro.apply(this,arguments)}function Po(){return Po=H((function*(e,t){const r=zn(e.account),n=t.getSequence(),o=yield t.getBaseData();if(!o.userRecoverPrivateKey)throw Error("userRecoverPrivateKey is not set");o.sequence=n;const s=Zn(wn,{from:r,to:r},o,o.userRecoverPrivateKey),a=Fn(wn,s);return yield t.send(a,n)})),Po.apply(this,arguments)}function No(){return No=H((function*(e,t){const r=zn(e.account),n=t.getSequence(),o=yield t.getBaseData();if(!o.userRecoverPrivateKey)throw Error("userRecoverPrivateKey is not set");o.sequence=n;const s=Zn(Tn,{from:r,to:r,data:Ye(Vn(Tn,{auth_key:e.authKey,auth_weight:100}))},o,o.userRecoverPrivateKey),a=Fn(Tn,s);return yield t.send(a,n)})),No.apply(this,arguments)}function Io(){return Io=H((function*(e,t){const r=t.getSequence(),n=Fn(Wn,{sequence:r,filter_id:e.filterId}),o=yield t.send(n,r);if(o.event_data){const e=$e(Le(o.event_data));return U(U({},o),{},{event_data:Gn(o.event_type,e)})}return o})),Io.apply(this,arguments)}var Ao=function(){var e=H((function*(e,t){const r=t.method,n=void 0===r?"GET":r,o=t.body,s=void 0===o?{}:o,a=t.headers,i=void 0===a?{}:a;if("undefined"!=typeof fetch){const t=yield fetch(e,{method:n,body:JSON.stringify(s),headers:U({"Content-Type":"application/json"},i)});if(!t.ok)throw Error("[utils/fetch] res.ok is false");return t.json()}return(yield L.default(e,{method:n,data:s,headers:i})).data}));return function(t,r){return e.apply(this,arguments)}}();const Ko={100:"哈希计算错误",101:"交易指针为空指针",102:"交易的 data 字段不满足类型约束",103:"签名不可用",104:"交易的发送账户余额不足",105:"交易的时间戳所在时间段无效，合约平台会对时间戳做检查，不在特定的时间范围内将被认为不可用",106:"交易的目标账户不包含可用的合约哈希",107:"交易的目标账户为空",108:"创建账户的交易不满足需求",109:"部署合约的交易不满足需求",110:"基本的交易类型需求校验失败",111:"交易类型未知",112:"恢复时间未知",113:"交易被重放",114:"交易的 data 字段太大，超过系统限制",115:"交易消耗的 gas 太大，超过系统限制",116:"交易的提交账户在区块链上不存在，提交账户是交易数据结构中的 from 字段",117:"交易的提交账户为空",118:"交易的提交账户被冻结",119:"交易的提交账户正在恢复中",120:"交易的目标账户在区块链上不存在，目标账户是交易数据结构中的 to 字段",121:"交易的目标账户被冻结",122:"交易的签名权重不足",123:"交易的目标账户已经存在",124:"块指针为空",125:"块的父级不存在",126:"块的父级无效，因为哈希和块号不匹配",127:"块的时间戳不满足单调递增的要求",128:"块的交易根哈希未正确计算",129:"块的交易接收根哈希未正确计算",130:"块的共识证明无效",131:"其他错误",132:"不满足交易的 group id 约束要求",133:"不满足交易的版本约束要求",134:"账户为空",135:"合约为空",136:"验证权限失败",137:"锚数据验证失败",140:"验证预留ID失败",141:"已打开受管理的应用程序合同",142:"更新合同无效",143:"更新合同状态无效",144:"不允许更新数据合同",145:"当前交易的合同代码无效",146:"已打开受管理的系统合约",400:"插件不存在",401:"消息转换失败",402:"本地交易执行失败",403:"无法将交易推送至缓存队列",404:"查询无结果",405:"业务不支持",406:"事件不存在",407:"日志实例不存在",408:"交易验证失败",409:"无节点可转发请求",410:"请求转发超时",411:"响应转发超时",412:"添加群链失败",413:"交易尚未验证",414:"交易已验证，等待执行",415:"节点无法提供服务，可能有两种原因：<br>1. 当前链在指定时间内无法成块；<br>2. 当前链内请求积压超过设定限制",416:"用于根据时间戳查询区块，请求中的时间戳小于创世块的时间戳",417:"转发请求查询无结果，可能是被转发节点处于无法服务状态",418:"注册事件失败，可能是触发事件注册单个 session 事件注册数限制或者节点支持最大事件注册数限制",419:"参数无效",420:"请求权限校验不通过，可能原因有：<br>1. 管理类请求需要校验签名，校验签名不通过；<br>2. 交易内账户涉及黑名单，被节点拒绝",421:"内部错误",422:"故障点不可用",423:"更新故障点案例失败",424:"超出了请求限制",425:"子网不存在",426:"子网不可用",1e3:"世界状态（WS）数据库未初始化",1001:"世界状态中找不到合约的代码哈希",1002:"世界状态中未找到该状态对象",1003:"状态对象（ID）被占用",1004:"指定的状态对象（ID）已删除",1005:"指定的状态对象余额不足",1006:"转账失败",1007:"指定的公钥不存在",1008:"余额溢出",1009:"未知故障",1010:"指定的权重值无效",1012:"发布资产失败",1013:"回收资产失败",2e3:"交易执行无法从交易获取足够的燃料",2001:"交易执行无法在区块链中定位到标识",2002:"负载中的权重值无效",2003:"交易负载无效",2004:"恢复时间无效",2005:"交易执行出现未知错误",3e3:"块不存在",3001:"数据库没有数据",3002:"写入数据库失败",3003:"从数据库读取数据失败",3004:"RLP存储解析失败",3005:"无效的ID",3006:"当前数据库的根目录状态无效",3007:"设置根目录失败",3008:"当前数据库数据丢失",3009:"数据覆盖失败",3010:"当前事件状态为空",3011:"最近块为空",3012:"区块编码无效",3013:"存储快照版本失败",3014:"对象状态初始化失败",3015:"对象状态接收无效",3016:"交易上下文为空",3017:"处理内容为空",3018:"merkle 树初始化失败",3019:"清理所有 merkle 树的缓存失败",3020:"清空所有merkle 树的状态失败",4e3:"超过要求的限制",4001:"创建group ID失败",4002:"获取公私钥失败",4003:"存储有关信息失败",4004:"发送已创建分组账号的交易失败",4005:"发送合约分组交易失败",4006:"获取公钥失败",4007:"公钥匹配出错",4008:"节点信息解码错误",4009:"获取密钥对失败",1e4:"虚拟机一般故障",10001:"错误的指令，包含create/create2/suicide/…",10002:"请调整堆栈",10003:"请调整堆栈",10004:"内存错误",10005:"代码为空",10006:"强制重启",10010:"虚拟机版本无效",10025:"由虚拟机参数不匹配引起的错误",10026:"虚拟机更新合约失败",10100:"虚拟机消耗超出限制",10101:"虚拟机创建失败",10102:"虚拟机参数代码为空",10103:"虚拟机参数代码为空",10200:"燃料不足",10201:"由 revert 指令触发的错误",10202:"由 toUint64 方法触发的错误",10203:"由虚拟机上下文static_call为true引起的错误",10204:"虚拟机方法引起的错误",10300:"获取余额失败",10301:"设置存储失败= 108，一般由存储引起",10302:"获取存储失败，一般由加载引起",10303:"转账失败，一般由evm_call调用方法引起",10304:"获取代码失败，一般由extcodecopy/extcodesize instruction or evm_call调用方法引起",10305:"获取块哈希失败，一般由哈希指令引起",10306:"获取代码哈希失败，由用户不存在引起",10307:"受获取燃料受限，由genesis.json设置",10308:"删除存储失败，原因是客户端收到删除存储结果失败",10309:"帐户被冻结，无法调用",10310:"虚拟机获取交易数据失败",10311:"虚拟机获取交易发送方失败",10312:"虚拟机获取交易交易接收器失败",10313:"虚拟机获取交易时间戳失败",10314:"虚拟机获取交易块索引失败",10315:"虚拟机从min_query_block中获取交易",10316:"交易类型不是TX_NATIVE_DEPOSIT_DATA和TX_RELATED_DEPOSIT_DATA",10317:"虚拟机获取交易存款标志失败",10318:"虚拟机获取恢复密钥失败",10319:"虚拟机获取身份验证映射失败",10350:"获得相关交易失败",10500:"虚拟内部错误",10600:"虚拟机创建动态库失败，可能是由本机合约创建动态库引起的",10601:"虚拟机创建socket失败，可能是由本机合约创建的socket方法引起的",10602:"虚拟机绑定socket失败，可能是由于客户端绑定到mychain时的本机协定引起的",10603:"虚拟机侦听socket失败，可能是由于mychain侦听客户端时的本机协定引起的",10604:"虚拟机响应失败，可能是由本机合同响应将数据发送给客户端造成的",10605:"虚拟机读取数据失败，可能是由于mychian读取客户端数据时的本机协定引起的",10606:"虚拟机执行子进程运行客户端失败",10607:"虚拟机fork进程失败，可能是由fork子进程时的本机合约引起的",10608:"虚拟机写入数据失败，可能是由于mychain将数据写入客户端时的幼稚合同引起的",10620:"虚拟机不支持本机合约，可能是由genesis.json中的native_enable引起的",10622:"虚拟机初始化失败，可能是由本地合约初始化方法引起",10623:"虚拟机不部署失败，可能是由于本地合约code引起部署失败",10700:"vm不支持本机预编译协定，没有使用ENABLE_NATIVE_PRECOMPILE_CONTRACT构建",10701:"虚拟机初始化失败，可能是由本机预编译协定init方法引起的",10702:"虚拟机部署失败，可能是由本机预编译合同部署代码引起的",10703:"虚拟机响应失败，可能是由本机预编译合同响应将数据发送给客户端引起的",10750:"合约 ID 不存在",10751:"数据库 ID 不存在",10752:"没有阅读数据合同的许可",10753:"没有写入数据合同的许可",10754:"没有删除数据合同的许可",10755:"数据协定API的输出是固定的，数据流反序列化输出失败",10756:"之前的schema不存在",10757:"当前的schema不存在",10758:"ACL ID不存在",10760:"数据不存在",10900:"参数格式错误",10901:"JSON/XML 的目标路径不存在",10902:"传入的 handler 参数不存在，检查 property_parse 是否执行成功",10903:"数据类型不匹配，当前使用的方法不能获取目标类型的数据",2e4:"SDK 内部错误",20001:"IPC/网络参数错误：协议族不支持的地址族",20002:"IPC/网络参数错误：该地址已被使用",20003:"IPC/网络参数错误：无法分配请求的地址",20004:"IPC/网络运行出错：套接口已连接",20005:"参数列表太长",20006:"数值参数不在域内",20007:"地址不详",20008:"文件描述符不详",20009:"程序加载错误：消息不详",20010:"管道破损",20011:"IPC/网络运行出错：软件问题导致连接中断",20012:"非阻塞和中断 I/O：操作进行中",20013:"IPC/网络运行出错：连接被拒绝",20014:"连接被对方重设",20015:"跨设备链接",20016:"IPC/网络参数错误：目标地址不得为空",20017:"设备或资源忙",20018:"目录不为空，需重新安排",20019:"执行格式错误",20020:"文件已存在",20021:"文件太大",20022:"IPC/网络运行出错：文件名太长",20023:"网络文件系统：功能未实现",20024:"无主机路由，需重新安排",20025:"程序加载错误：标识已被删除",20026:"程序加载错误：非法字节序列",20027:"ioctl 不适合设备",20028:"系统调用中断",20029:"参数无效",20030:"非法寻求",20031:"输入/输出错误",20032:"此为目录",20033:"IPC/网络参数错误：消息太长",20034:"IPC/网络运行出错：网络故障",20035:"IPC/网络运行出错：重置时网络断开连接",20036:"IPC/网络运行出错：网络无法访问",20037:"IPC/网络运行出错：无缓冲空间",20038:"无子程序",20039:"程序加载错误：已保留",20040:"网络文件系统，无锁可用",20041:"程序加载错误：消息流上无消息",20042:"程序加载错误：无预期类型的消息",20043:"IPC/网络参数错误：协议不可用",20044:"设备空间不足",20045:"程序加载错误：无流资源",20046:"设备未配置",20047:"设备不支持该操作",20048:"该文件或目录不存在",20049:"该程序不存在",20050:"非目录",20051:"IPC/网络参数错误：未在套接口上执行套接口操作",20052:"程序加载错误：非流",20053:"IPC/网络运行出错：套接口未连接",20054:"无法分配内存",20055:"IPC/网络参数错误：不支持该操作",20056:"程序加载错误：操作已取消",20057:"非阻塞和中断 I/O：操作进行中",20058:"操作不允许",20059:"仅当编译 __DARWIN_UNIX03 时该值为离散值，或 KERNE：套接口不支持该操作",20060:"非阻塞和中断 I/O：操作将阻塞",20061:"程序加载错误：之前的 Owner 已去世",20062:"权限不足",20063:"程序加载错误：协议错误",20064:"IPC/网络参数错误：不支持该协议",20065:"只读文件系统",20066:"避免资源死锁",20067:"非阻塞和中断 I/O：资源暂时不可用",20068:"结果太大",20069:"程序加载错误：状态不可恢复",20070:"程序加载错误：流 ioctl 超时",20071:"文本文件忙",20072:"IPC/网络运行出错：运行超时",20073:"系统打开的文件太多",20074:"打开的文件太多",20075:"太多链接",20076:"IPC/网络运行出错：符号链接级别太多",20077:"智能设备错误：值太大导致无法存储在数据类型中",20078:"IPC/网络参数错误：套接口协议类型错误",3e4:"SDK 参数无效",30001:"SDK 私钥无效",30002:"SDK 签名工具验证出错",30003:"SDK 不支持编码",30004:"SDK 获取文件输入流失败",30005:"SDK 查找线程失败",30006:"SDK 字节操作失败",30007:"SDK 转换公钥失败",30008:"SDK 消息编码失败",30009:"SDK 读取客户端配置失败",30010:"SDK 初始化失败",30011:"SDK 连接网络失败",30012:"SDK 解码出错",30013:"SDK 不支持该消息类型",30014:"未做握手",30015:"初始化 SSL 上下文失败",30016:"SDK 正在握手",30017:"SDK 无效的公钥",30018:"邮件已达到最大队列大小",60001:"加密交易解密失败",60002:"加密交易中内嵌的不是明文交易",60003:"待处理的交易非加密交易",60004:"TEE 中不支持 native 类型的合约",60005:"加密交易反序列化失败",60006:"合约账户的状态反序列化失败",60007:"非法访问加密的账户数据",60008:"TEE 内不支持的交易类型",60009:"加密回执中的 log 信息失败",60010:"非法访问加密的合约代码",60011:"加密交易的 hash 和时间戳不合法",60012:"交易回执过大",60013:"TEE 内部错误",60014:"合约代码加密失败",60015:"合约代码解密失败",60016:"合约状态加密失败",60017:"合约状态解密失败",60018:"合约状态反序列化失败",60019:"合约状态序列化失败",60020:"合约账户基本信息解密失败",60021:"合约账户基本信息加密失败",60022:"TEE 中不允许执行明文合约",60023:"TEE 中不允许更新明文合约",60024:"按不存在的方法类型进行查询",60025:"查询时使用的 hash 不存在",60026:"不允许查询",60027:"解密隐私交易回执失败",60028:"对象状态初始化失败",60029:"获取代码状态失败",60030:"删除存储状态失败",60031:"错误的虚拟机类型",60032:"设置代码状态失败",60033:"查询时交易不匹配",60034:"从块获取交易列表失败",60035:"查询时调用虚拟机失败",60036:"查询时不被允许",60037:"查询RLP失败",60038:"更新合约无效",60039:"查询时该方法不支持",60040:"加密交易的期望合约代码哈希值不匹配",60041:"更新存款合同时，获取公钥失败",7e4:"通用错误",70001:"无效的提供者",70002:"无效的密钥类型",70003:"无效的类",70004:"无效的公钥",70005:"无效的私钥",70006:"无效的消息",70007:"无效的纯文本",70008:"无效的密文",70009:"无效的签名",70010:"无效的对称密钥",70011:"无效的文件路径",70012:"无效的密钥文件",70013:"无效的x509",70101:"算法未初始化",70102:"提供者错误",8e4:"注册失败"};(exports.ChainIds||(exports.ChainIds={})).OpenLab="0b06e2744ad341538b7a3b3cc5ad9e57";class Oo{constructor(e){this.requestConfig=void 0,this.tokenPromise=void 0,this.requestConfig=e,this.tokenPromise=this.getToken()}getToken(){var e=this;return H((function*(){const t=e.requestConfig,r=t.accessId,n=t.accessSecret,o=t.baseUrl;te("[RestRequest] getToken accessId:",r),te("[RestRequest] getToken accessSecret:",n);const s=""+Date.now(),a=He(n,`${r}${s}`),i=yield Ao(o+"/api/contract/shakeHand",{method:"POST",body:{time:s,accessId:r,secret:a}}),c=i.data,u=i.message;if(i.success&&"200"===i.code)return te("[RestRequest] getToken token:",c),c;throw Error(u)}))()}request(e,t={},r=1){var n=this;return H((function*(){const o=n.requestConfig.baseUrl+e,s=yield n.tokenPromise,a=t.requestStr?{requestStr:JSON.stringify(t.requestStr)}:{},i=U(U(U({},t),a),{},{token:s});te("[RestRequest] request url & tokenTimeoutRetryTimes:",o,r),te("[RestRequest] request body:",i);const c=yield Ao(o,{method:"POST",body:i});if(te("[RestRequest] response body:",c),!c.success||!("200"===c.code||"0"===c.code&&t.secretKey)){if("202"===c.code&&r>0)return te("[RestRequest] token timeout, retry get token, tokenTimeoutRetryTimes: "+r),n.tokenPromise=n.getToken(),n.request(e,t,r-1);{let e,t=Ko[c.code]||c.code,r=c.data;if(/\{.+\}/.test(c.data))try{r=JSON.parse(c.data),r.output&&(e=""+Buffer.from(r.output,"base64"))}catch(e){}throw e?t=`${t} ${e}`:c.data?t=`${t} ${c.data}`:c.message&&(t=`${t} ${c.message}`),new pe(`[RestRequest] request failed, code: ${c.code}, detail: ${t}`,c.code,r)}}if(!/\{.+\}/.test(c.data))return c.data;try{return JSON.parse(c.data)}catch(e){throw new pe("response parse error, code: "+c.code,c.code)}}))()}}function Do(e,t){return t.request("/api/contract/chainCallForBiz",e)}function Mo(e,t){return t.request("/api/contract/chainCall",e)}function Lo(e,t){return t.request("/api/contract/chainCall",e)}function Wo(e,t){return t.request("/api/contract/chainCall",e)}function jo(e,t){return t.request("/api/contract/chainCall",e)}function Uo(e,t){return t.request("/api/contract/chainCall",e)}function zo(e,t){return t.request("/api/contract/chainCall",e)}function Ho(e,t){return t.request("/api/contract/chainCallForBiz",e)}function Vo(e,t){return t.request("/api/contract/chainCall",e)}function Qo(e,t){return t.request("/api/contract/chainCall",e)}function Fo(e,t){return t.request("/api/contract/chainCall",e)}function Yo(e,t){return t.request("/api/contract/chainCallForBiz",e)}function $o(e,t){return t.request("/api/contract/chainCallForBiz",e)}function Jo(e,t){return t.request("/api/contract/chainCall",e)}var Go=Object.freeze({__proto__:null,deployContractForBiz:Do,deployContract:Mo,queryAccount:Lo,queryBlockHeader:Wo,queryBlock:jo,queryLastBlock:Uo,queryTransaction:zo,callContractForBiz:Ho,callContract:Vo,queryContract:Qo,queryTransactionReceipt:Fo,createAccountForBiz:Yo,updateContractForBiz:$o,updateContract:Jo});function Xo(e){return Buffer.from(e,"base64").toString("hex")}function Zo(e){return"0x"+function(e){const t=P.default.md.sha256.create();return t.update(e),t.digest().toHex()}(e)}class es extends _o{getToken(){return this.request.getToken()}constructor(e){super(),this.majorVersion=1,this.config=void 0,this.request=void 0,this.config=e,this.request=new Oo({baseUrl:this.config.restUrl,accessId:this.config.accessId,accessSecret:this.config.accessSecret})}generateOrderId(){return`order_myfish_${this.config.accessId}_${b.nanoid()}`}watchContractEvent(e,t,r){throw Error("Not support yet.")}createAccount(){return H((function*(){throw Error("托管密钥方式请使用 createAccountWithKms")}))()}createAccountWithKms(e){var t=this;return H((function*(){const r=`${t.config.tenantId}${q.v4()}`;return{kmsId:r,authKey:yield Yo({newAccountId:e.newAccountName,newAccountKmsId:r,method:exports.RestMethods.createAccountForBiz,accessId:t.config.accessId,bizid:t.config.bizid,account:t.config.account,tenantid:t.config.tenantId,mykmsKeyId:t.config.kmsId,orderId:t.generateOrderId()},t.request)}}))()}transferBalance(e){return H((function*(){throw Error("Not support yet.")}))()}setRecoverkey(e){return H((function*(){throw Error("Not support yet.")}))()}preResetPubKey(e){return H((function*(){throw Error("Not support yet.")}))()}resetPubKey(e){return H((function*(){throw Error("Not support yet.")}))()}freezeAccount(e){return H((function*(){throw Error("Not support yet.")}))()}freezeContract(e){return H((function*(){throw Error("Not support yet.")}))()}nativeDepositData(e){return H((function*(){throw Error("Not support yet.")}))()}queryLastBlockHeader(){return H((function*(){throw Error("Not support yet.")}))()}queryTransactionList(e){return H((function*(){throw Error("Not support yet.")}))()}queryTransactionAndReceipt(e){return H((function*(){throw Error("Not support yet.")}))()}queryTimestamp(e){return H((function*(){throw Error("Not support yet.")}))()}queryP2PStatus(e){return H((function*(){throw Error("Not support yet.")}))()}queryConsensusStatus(e){return H((function*(){throw Error("Not support yet.")}))()}queryCommonConsensusStatus(e){return H((function*(){throw Error("Not support yet.")}))()}querySyncStatus(e){return H((function*(){throw Error("Not support yet.")}))()}queryTransactionCacheStatus(e){return H((function*(){throw Error("Not support yet.")}))()}queryBlockCacheStatus(e){return H((function*(){throw Error("Not support yet.")}))()}queryContractNodesStatus(e){return H((function*(){throw Error("Not support yet.")}))()}queryContractConfigStatus(e){return H((function*(){throw Error("Not support yet.")}))()}queryLogLevel(e){return H((function*(){throw Error("Not support yet.")}))()}updateBlackList(e){return H((function*(){throw Error("Not support yet.")}))()}queryBlockProof(e){return H((function*(){throw Error("Not support yet.")}))()}queryBlockHeaderProof(e){return H((function*(){throw Error("Not support yet.")}))()}queryStateProof(e){return H((function*(){throw Error("Not support yet.")}))()}queryTransactionProof(e){return H((function*(){throw Error("Not support yet.")}))()}queryReceiptProof(e){return H((function*(){throw Error("Not support yet.")}))()}queryBlockHeaderInfos(e){return H((function*(){throw Error("Not support yet.")}))()}queryBlockReceiptInfos(e){return H((function*(){throw Error("Not support yet.")}))()}queryBlockBodyInfos(e){return H((function*(){throw Error("Not support yet.")}))()}queryAccount({account:e}){var t=this;return H((function*(){const r=yield Lo({method:exports.RestMethods.queryAccount,requestStr:{queryAccount:e},bizid:t.config.bizid,accessId:t.config.accessId},t.request);return{address:r.id,balance:r.balance,encryptionKey:r.encryption_key,recoveryKey:r.recovery_key,recoveryTime:r.recovery_time,authMap:r.auth_map.map((e=>({key:e.key,weight:e.value}))),status:r.status,version:r.version}}))()}updateAuthMap(){return H((function*(){throw Error("Rest 暂不支持 updateAuthMap")}))()}queryBlockHeader({blockNumber:e}){var t=this;return H((function*(){return(yield Wo({method:exports.RestMethods.queryBlockHeader,requestStr:e,bizid:t.config.bizid,accessId:t.config.accessId},t.request)).block.blockHeader}))()}queryBlock({blockNumber:e}){var t=this;return H((function*(){const r=yield jo({method:exports.RestMethods.queryBlock,requestStr:e,bizid:t.config.bizid,accessId:t.config.accessId},t.request);return{gasUsed:r.header.gas_used,hash:r.header.hash,logBloom:r.header.log_bloom,number:r.header.number,parentHash:r.header.parent_hash,receiptRoot:r.header.receipt_root,stateRoot:r.header.state_root,timestamp:r.header.timestamp,transactionRoot:r.header.transaction_root,version:r.header.version,receiptList:r.body.receipt_list,consensusProof:r.body.consensus_proof,transactionList:r.body.transaction_list}}))()}queryLastBlock(){var e=this;return H((function*(){return(yield Uo({method:exports.RestMethods.queryLastBlock,bizid:e.config.bizid,accessId:e.config.accessId},e.request)).block.blockHeader}))()}queryTransaction({hash:e,tee:t}){var r=this;return H((function*(){const n=yield zo({method:exports.RestMethods.queryTransactionFromBlockchain,hash:e,bizid:r.config.bizid,accessId:r.config.accessId,secretKey:t?r.config.teePassword:void 0},r.request);return{blockNumber:n.blockHeight,hash:"0x"+n.hash,data:n.transactionV10.data,from:"0x"+n.transactionV10.from,to:"0x"+n.transactionV10.to}}))()}queryTransactionReceipt(e){var t=this;return H((function*(){const r=yield Fo({method:exports.RestMethods.queryTransactionReceipt,hash:e.hash,bizid:t.config.bizid,accessId:t.config.accessId,secretKey:e.tee?t.config.teePassword:void 0},t.request);return te("[CloudCryptoRestProvider] queryTransactionReceipt gas used:",r.gasUsed),{blockNumber:r.blockNumber,gasUsed:r.gasUsed,output:Xo(r.output),code:r.result,logs:r.logs.map((e=>({from:uo(e.from.value),to:uo(e.to.value),logData:Xo(e.logData),topics:e.topics})))}}))()}deployContract(e,t,r){var n=this;return H((function*(){let o;if(e.vmType===exports.VmType.WASM){var s;o=null===(s=t.code)||void 0===s?void 0:s.toString("base64")}else{if(e.vmType!==exports.VmType.EVM)throw Error(`[deployContract] vmType must be ${exports.VmType.WASM} or ${exports.VmType.EVM}`);var a;o=null===(a=t.code)||void 0===a?void 0:a.toString("utf-8")}const i={accessId:n.config.accessId,bizid:n.config.bizid,contractCode:o,account:n.config.account,tenantid:n.config.tenantId,mykmsKeyId:n.config.kmsId,orderId:n.generateOrderId(),contractName:e.contractName,gas:t.gas,secretKey:t.tee?n.config.teePassword:void 0};let c;c=r?yield $o(U(U({},i),{},{method:e.vmType===exports.VmType.WASM?exports.RestMethods.updateWasmContractForBiz:exports.RestMethods.updateSolidityContractForBizAsync}),n.request):yield Do(U(U({},i),{},{method:e.vmType===exports.VmType.WASM?exports.RestMethods.deployWasmContractForBiz:exports.RestMethods.deploySolidityContractForBizAsync}),n.request);let u=e.vmType===exports.VmType.WASM?c.txData.txHash:c;if(t.tee){u=Buffer.from(u.value,"base64").toString("hex");return{txHash:u,teeSecret:Tt(n.config.teePassword,u).toString("hex")}}return{txHash:u}}))()}updateContract(e,t){var r=this;return H((function*(){return r.deployContract(e,t,!0)}))()}callContract(e,{methodName:t,args:r=[],argsType:n=[],returnType:o,gas:s,tee:a,local:i,timeout:c}){var u=this;return H((function*(){const p=e.contractName,y=e.abi;if(e.vmType===exports.VmType.EVM)throw Error("[callContract] Rest 托管密钥方式暂时不支持调用 Solidity 合约");const d=yield Ho({methodSignature:`${t}(${n?n.join(","):""})`,inputParamListStr:JSON.stringify(r),outTypes:o?`["${o}"]`:"[]",method:exports.RestMethods.callWasmContractForBizAsync,accessId:u.config.accessId,bizid:u.config.bizid,account:u.config.account,tenantid:u.config.tenantId,mykmsKeyId:u.config.kmsId,orderId:u.generateOrderId(),contractName:p,isLocalTransaction:i,gas:s,secretKey:a?u.config.teePassword:void 0},u.request),f="0x"+d,l=a?Tt(u.config.teePassword,f).toString("hex"):"";te("[CloudCryptoRestProvider] callContract txHash:",d),te("[CloudCryptoRestProvider] callContract teeSecret:",l);const h=yield u.queryTransactionReceiptWithRetry({hash:f,tee:a},c?Date.now()+c:void 0),m=h.output,g=h.code;let _=m;te("[CloudCryptoRestProvider] callContract output:",_);const v=to(p,y);a&&m&&(_=Rt(m,u.config.teePassword,d));const b=function(e,t,r){var n,o,s;if(!r)return;te("[RestProvider] parseReceiptReturnOutput methodName:",e),te("[RestProvider] parseReceiptReturnOutput output:",r);const a=null===(n=t.schema)||void 0===n||null===(o=n[e])||void 0===o||null===(s=o.results)||void 0===s?void 0:s[0];if(te("[RestProvider] parseReceiptReturnOutput type:",a),!t||!a)throw Error("[RestProvider] parseReceiptReturnOutput not find abi schema for parse output: "+r);return"function"!=typeof t.fromBuffer?null:t.fromBuffer(a,Buffer.from(r,"hex"))}(t,v,_);return{returnValue:b,txHash:f,teeSecret:a?l:void 0,receiptCode:g}}))()}queryContract(e){var t=this;return H((function*(){return{code:(yield Qo({method:exports.RestMethods.queryContract,bizid:t.config.bizid,contractName:e.contractName,accessId:t.config.accessId},t.request)).contract.code}}))()}sign(e){return H((function*(){throw Error("暂不支持")}))()}}function ts(e){console.warn(`[myfish] WalletProvider.${e} 方法暂不支持 TEE 合约`)}exports.AntchainSDKError=pe,exports.BaseProvider=_o,exports.ChainProvider=class extends _o{constructor(e={}){var t,r;super(),this.majorVersion=1,this.config=void 0,this.teeExtraParams=void 0,this.connector=void 0,this.eventsId=[],this.EVENTLOOPTIME=6e3,this.eventTimeout=void 0,this.config=e,this.teeExtraParams={aesKey:null===(t=this.config)||void 0===t?void 0:t.teePassword,encrypt:!0,encryptType:"02",publicKey:null===(r=this.config)||void 0===r?void 0:r.teePublicKey},this.connector=new qo({host:this.config.host,port:this.config.port,cert:this.config.cert,ca:this.config.ca,passphrase:this.config.privateKeyPassword,key:this.config.privateKey,account:this.config.account,accountPrivateKey:this.config.accountPrivateKey,accountPrivateKeyPassword:this.config.accountPrivateKeyPassword,accountRecoverPrivateKey:this.config.accountRecoverPrivateKey,accountRecoverPrivateKeyPassword:this.config.accountRecoverPrivateKeyPassword})}startEventLoop(){this.eventTimeout||0===this.eventsId.length||this.fetchEvents()}fetchEvents(){var e=this;this.eventsId.forEach(function(){var t=H((function*(t){const r=yield function(e,t){return Io.apply(this,arguments)}({filterId:t},e.connector);te("get res with event id and res",t,r),e.emit(t,r)}));return function(e){return t.apply(this,arguments)}}()),this.eventTimeout=setTimeout((()=>{this.fetchEvents()}),this.EVENTLOOPTIME)}watchContractEvent(e,t,r){(function(e,t){const r=t.getSequence(),n={sequence:r,event_type:e.type,identity:zn(e.contractName)},o=Fn(Ln,n);return t.send(o,r)})({contractName:e.contractName,type:exports.EventListenerType.CONTRACT},this.connector).then((({filter_id:e})=>{this.on(e,r),this.eventsId.push(e),this.startEventLoop()}))}createAccount(e){var t=this;return H((function*(){const r=yield function(e,t){return xo.apply(this,arguments)}({from:t.config.account,to:e.newAccountName,recoveryKey:e.recoveryKey,authMap:[{authKey:e.authKey,authWeight:100}]},t.connector);return yield t.queryTransactionReceiptWithRetry({hash:r.hash}),{txHash:r.hash}}))()}transferBalance(e){var t=this;return H((function*(){const r=yield function(e,t){return Bo.apply(this,arguments)}({from:e.from||t.config.account,to:e.to,value:e.value},t.connector);return{txHash:r.hash}}))()}setRecoverkey(e){var t=this;return H((function*(){const r=yield function(e,t){return Ro.apply(this,arguments)}({account:e.account||t.config.account,recoverKey:e.recoverKey},t.connector);return{txHash:r.hash}}))()}preResetPubKey(e){var t=this;return H((function*(){const r=yield function(e,t){return Po.apply(this,arguments)}({account:e.account||t.config.account},t.connector);return{txHash:r.hash}}))()}resetPubKey(e){var t=this;return H((function*(){const r=yield function(e,t){return No.apply(this,arguments)}({account:e.account||t.config.account,authKey:e.authKey},t.connector);return{txHash:r.hash}}))()}freezeAccount(e){return H((function*(){throw Error("Not support yet.")}))()}freezeContract(e){return H((function*(){throw Error("Not support yet.")}))()}nativeDepositData(e){return H((function*(){throw Error("Not support yet.")}))()}queryLastBlockHeader(){var e=this;return H((function*(){const t=yield function(e,t){const r=t.getSequence(),n=Fn(Rn,{sequence:r});return t.send(n,r)}(0,e.connector),r=t.block_header;return{gasUsed:r.gas_used,hash:r.hash,logBloom:r.log_bloom,number:r.block_number,parentHash:r.parent_hash,receiptRoot:r.receipt_root,stateRoot:r.state_root,timestamp:r.timestamp,transactionRoot:r.transaction_root,version:r.version}}))()}queryTransactionList(e){return H((function*(){throw Error("Not support yet.")}))()}queryTransactionAndReceipt(e){return H((function*(){throw Error("Not support yet.")}))()}queryTimestamp(e){return H((function*(){throw Error("Not support yet.")}))()}queryP2PStatus(e){return H((function*(){throw Error("Not support yet.")}))()}queryConsensusStatus(e){return H((function*(){throw Error("Not support yet.")}))()}queryCommonConsensusStatus(e){return H((function*(){throw Error("Not support yet.")}))()}querySyncStatus(e){return H((function*(){throw Error("Not support yet.")}))()}queryTransactionCacheStatus(e){return H((function*(){throw Error("Not support yet.")}))()}queryBlockCacheStatus(e){return H((function*(){throw Error("Not support yet.")}))()}queryContractNodesStatus(e){return H((function*(){throw Error("Not support yet.")}))()}queryContractConfigStatus(e){return H((function*(){throw Error("Not support yet.")}))()}queryLogLevel(e){return H((function*(){throw Error("Not support yet.")}))()}updateBlackList(e){return H((function*(){throw Error("Not support yet.")}))()}queryBlockProof(e){return H((function*(){throw Error("Not support yet.")}))()}queryBlockHeaderProof(e){return H((function*(){throw Error("Not support yet.")}))()}queryStateProof(e){return H((function*(){throw Error("Not support yet.")}))()}queryTransactionProof(e){return H((function*(){throw Error("Not support yet.")}))()}queryReceiptProof(e){return H((function*(){throw Error("Not support yet.")}))()}queryBlockHeaderInfos(e){return H((function*(){throw Error("Not support yet.")}))()}queryBlockReceiptInfos(e){return H((function*(){throw Error("Not support yet.")}))()}queryBlockBodyInfos(e){return H((function*(){throw Error("Not support yet.")}))()}queryAccount({account:e}){var t=this;return H((function*(){return function(e,t){const r=t.getSequence(),n={sequence:r,group_id:e.groupId||"0x0000000000000000000000000000000000000000",hash:zn(e.account)},o=Fn(In,n);return t.send(o,r)}({account:e},t.connector).then((({data:e})=>{var t;return{address:e.identity,balance:e.balance,encryptionKey:e.encryption_key,recoveryKey:e.recover_key,recoveryTime:e.recover_time,authMap:null===(t=e.auth_map)||void 0===t?void 0:t.map((e=>({key:e.auth_key,weight:e.auth_weight}))),status:e.status,version:e.acc_version}}))}))()}updateAuthMap(e){var t=this;return H((function*(){const r=yield function(e,t){return wo.apply(this,arguments)}(e,t.connector),n=r.hash;return yield t.queryTransactionReceiptWithRetry({hash:n}),{txHash:n}}))()}queryBlockHeader({blockNumber:e,hash:t}){var r=this;return H((function*(){return function(e,t){const r=t.getSequence(),n=Fn(Bn,{sequence:r,block_number:e.blockNumber||0,hash:e.hash||"0x0"});return t.send(n,r)}({blockNumber:e,hash:t},r.connector).then((({block_header:e})=>({gasUsed:e.gas_used,hash:e.hash,logBloom:e.log_bloom,number:e.block_number,parentHash:e.parent_hash,receiptRoot:e.receipt_root,stateRoot:e.state_root,timestamp:e.timestamp,transactionRoot:e.transaction_root,version:e.version})))}))()}queryBlock({blockNumber:e,hash:t}){var r=this;return H((function*(){return function(e,t){const r=t.getSequence(),n=Fn(Pn,{sequence:r,block_number:e.blockNumber||0,hash:e.hash||"0x0"});return t.send(n,r)}({blockNumber:e,hash:t},r.connector).then((({block:e})=>{const t=e.block_header,r=e.block_body;return{gasUsed:t.gas_used,hash:t.hash,logBloom:t.log_bloom,number:t.block_number,parentHash:t.parent_hash,receiptRoot:t.receipt_root,stateRoot:t.state_root,timestamp:t.timestamp,transactionRoot:t.transaction_root,version:t.version,transactionList:r.transaction_list,receiptList:r.receipt_list,consensusProof:r.consensus_proof}}))}))()}queryLastBlock(){var e=this;return H((function*(){return function(e,t){const r=t.getSequence(),n=Fn(Sn,{sequence:r});return t.send(n,r)}(0,e.connector).then((e=>{const t=e.block.block_header;return{gasUsed:t.gas_used,hash:t.hash,logBloom:t.log_bloom,number:t.block_number,parentHash:t.parent_hash,receiptRoot:t.receipt_root,stateRoot:t.state_root,timestamp:t.timestamp,transactionRoot:t.transaction_root,version:t.version}}))}))()}queryTransaction({hash:e,tee:t}){var r=this;return H((function*(){return function(e,t){const r=t.getSequence(),n={sequence:r,group_id:e.groupId||"0x0000000000000000000000000000000000000000",hash:zn(e.hash)},o=Fn(Nn,n);return t.send(o,r)}({hash:e},r.connector).then((e=>{const n=t?Xn(e.transaction.data,r.config.teePassword,e.transaction.hash):e.transaction.data;return{blockNumber:e.block_number,hash:e.transaction.hash,data:n,to:e.transaction.to,from:e.transaction.from}}))}))()}queryTransactionReceipt(e){var t=this;return H((function*(){return function(e,t){return Eo.apply(this,arguments)}({hash:e.hash},t.connector).then((e=>({blockNumber:e.block_number,gasUsed:e.receipt.gas_used,output:e.receipt.output,code:e.receipt.result,logs:e.receipt.log_entry.map((e=>({from:e.from,to:e.to,logData:e.log_data,topics:e.topics})))})))}))()}deployContract(e,t){var r=this;return H((function*(){const n={};t.tee&&Object.assign(n,r.teeExtraParams);const o=yield function(e,t){return To.apply(this,arguments)}(U({contract:e,code:t.code,from:r.config.account},n),r.connector),s=o.hash;return yield r.queryTransactionReceiptWithRetry({hash:s}),{txHash:s,teeSecret:t.tee?Tt(r.config.teePassword,s).toString("hex"):void 0}}))()}updateContract(e,t){var r=this;return H((function*(){const n=yield function(e,t){return ko.apply(this,arguments)}({contractName:e.contractName,code:e.vmType===exports.VmType.WASM?"0x"+t.code.toString("hex"):t.code.toString("utf-8"),vm:e.vmType},r.connector),o=n.hash;return yield r.queryTransactionReceiptWithRetry({hash:o}),{txHash:o}}))()}callContract(e,t){var r=this;return H((function*(){const n={};t.tee&&Object.assign(n,r.teeExtraParams);const o=yield function(e,t){return So.apply(this,arguments)}(U({contract:e,from:r.config.account,args:t.args,methodName:t.methodName},n),r.connector),s=o.hash,a=yield r.queryTransactionReceiptWithRetry({hash:s},t.timeout?Date.now()+t.timeout:void 0),i=t.tee?Rt(a.output,r.config.teePassword,s):a.output,c=e.parseReturnOutput(t.methodName,ao(i));return{txHash:s,receiptCode:a.code,returnValue:c,teeSecret:t.tee?Tt(r.config.teePassword,s).toString("hex"):void 0}}))()}queryContract(e){var t=this;return H((function*(){const r=yield function(e,t){const r=t.getSequence(),n={sequence:r,hash:zn(e.contractName)},o=Fn(An,n);return t.send(o,r)}(e,t.connector);return{code:r.data.code,authMap:r.data.auth_map.map((e=>({key:e.auth_key,weight:e.auth_weight})))}}))()}sign(e){return H((function*(){throw Error("暂不支持")}))()}},exports.CloudCryptoRestProvider=es,exports.Contract=ye,exports.LocalCryptoRestProvider=class extends es{constructor(e){super({bizid:e.bizid,restUrl:e.restUrl,accessId:e.accessId,accessSecret:e.accessSecret}),this.localConfig=void 0,this.localConfig=e}getBaseData(){var e=this;return H((function*(){const t=yield ro(e.localConfig.accountPrivateKey,e.localConfig.accountPrivateKeyPassword);return{isSign:!0,from:e.localConfig.account,userPublicKey:t.publicKey,userPrivateKey:t.privateKey}}))()}sign(e){var t=this;return H((function*(){const r=yield t.getBaseData();return{signature:wt(e.payload,r.userPrivateKey).toString("hex")}}))()}createAccount(){return H((function*(){throw Error("Rest 非托管密钥方式暂不支持创建账户")}))()}deployContract(e,t,r){var n=this;return H((function*(){const o=yield n.getBaseData(),s=e.generateDeployCode(t.code),a=po(r?exports.MychainMethods.updateContract:exports.MychainMethods.deployContract,{from:r?e.contractName:o.from,to:e.contractName,gas:t.gas,data:{code:s}},o,(e=>e[1])),i=a.txData,c=a.rlpData;let u;t.tee&&(u=Tt(n.localConfig.teePassword,i.hash).toString("hex"));const p={accessId:n.config.accessId,bizid:n.config.bizid,hash:i.hash,method:exports.RestMethods.deployWasmContract,requestStr:{hash:i.hash,timestamp:i.timestamp,vmTypeEnum:e.vmType,secretKey:t.tee?n.localConfig.teePassword:void 0}};let y;return y=r?yield Jo(U(U({},p),{},{method:exports.RestMethods.updateWasmContract,requestStr:U(U({},p.requestStr),{},{contractName:Zo(e.contractName),contractCode:s,vmType:e.vmType,updateContractRaw:c.toString("base64")})}),n.request):yield Mo(U(U({},p),{},{method:exports.RestMethods.deployWasmContract,requestStr:U(U({},p.requestStr),{},{deployContractRaw:c.toString("base64")})}),n.request),yield n.queryTransactionReceiptWithRetry({hash:i.hash,tee:t.tee}),{txHash:y,teeSecret:u}}))()}callContract(e,{methodName:t,args:r=[],gas:n,argsType:o=[],local:s,tee:a,timeout:i}){var c=this;return H((function*(){const u=e.contractName,p=e.vmType,y=e.generateCallCode(t,r),d=yield c.getBaseData(),f=po(exports.MychainMethods.callContract,{from:d.from,to:u,gas:n,data:{parameter:y}},d,(e=>e[1])),l=f.txData,h=f.rlpData;let m;a&&(m=Tt(c.localConfig.teePassword,l.hash).toString("hex")),p===exports.VmType.WASM&&(yield Vo({accessId:c.config.accessId,bizid:c.config.bizid,hash:l.hash,method:exports.RestMethods.callWasmContract,requestStr:{acctId:{data:so(l.from)},contractId:{data:so(l.to)},callWasmContractRaw:h.toString("base64"),methodSignature:`${t}(${o?o.join(","):""})`,hash:l.hash,timestamp:l.timestamp,nonceV:Date.now(),vmTypeEnum:exports.VmType.WASM,isLocalTransaction:s,teePublicKey:a?c.localConfig.teePublicKey:void 0,secretKey:a?c.localConfig.teePassword:void 0}},c.request)),p===exports.VmType.EVM&&(yield Vo({accessId:c.config.accessId,bizid:c.config.bizid,hash:l.hash,contractName:u,method:exports.RestMethods.callContract,requestStr:{callContractRaw:h.toString("base64"),hash:l.hash,timestamp:l.timestamp,nonceV:Date.now(),vmTypeEnum:exports.VmType.EVM}},c.request));const g=yield c.queryTransactionReceiptWithRetry({hash:l.hash,tee:a},i?Date.now()+i:void 0),_=g.output,v=g.code;let b=_;if(a&&_){b=so(Rt("0x"+Buffer.from(_,"base64").toString("hex"),c.localConfig.teePassword,l.hash))}return{returnValue:e.parseReturnOutput(t,b),txHash:l.hash,teeSecret:a?m:void 0,receiptCode:v}}))()}},exports.RestMethodsUrlMap=ie,exports.RestServices=Go,exports.SolContract=class extends ye{constructor(e,t){super(U({contractType:exports.ContractType.solidity},e),t)}generateDeployCode(e,t){if(t)throw Error("还未支持参数");return"0x01"+e.toString("utf-8")}generateCallCode(e,t=[]){let r="";const n=JSON.parse(this.abi);for(let o=0;n.length>o;o++){const s=n[o];let a=[];Be(s.inputs)&&(a=s.inputs);const i=[],c=[];for(let e=0;a.length>e;e++){const t=a[e];i.push(t.type),c.push(t.name)}if("function"===s.type&&s.name===e&&t.length===i.length){const e="0x"+Ee(Pt(s,i)).slice(0,8);fo(t,i),r=e+co(i,t);break}}if(!r)throw Error("未找到对应的方法，请检查方法名和参数是否正确。");return r}parseReturnOutput(e,t){return yo(e,JSON.parse(this.abi),t)}},exports.WalletProvider=class extends _o{constructor(e){super(),this.majorVersion=1,this.config=void 0,this.rpcEngine=void 0,this.rpcConnection=void 0,this.state={chainId:"",accounts:[],isConnected:!1},this.config=e,this.initRpcEngine(),this.initState()}initRpcEngine(){this.rpcEngine=new E.JsonRpcEngine,this.rpcConnection=x.createStreamMiddleware(),this.rpcEngine.push(this.rpcConnection.middleware),W.default(this.config.connectionStream,this.rpcConnection.stream,this.config.connectionStream,(e=>{console.error("[WalletProvider] stream disconnect",e)}))}initState(){var e=this;return H((function*(){const t=yield e.request({method:exports.WalletMethods.getProviderState});e.state=U(U({},e.state),t),e.state.isConnected=!0,te("[WalletProvider] initState:",e.state),e.emit("connect",e.state)}))()}request({method:e,params:t}){var r=this;return H((function*(){te("[WalletProvider] request method:",e),te("[WalletProvider] request params:",t);const n=yield r.rpcEngine.handle({jsonrpc:"2.0",id:b.nanoid(),method:e,params:t}),o=n.error,s=n.result;if(o)throw te("[WalletProvider] request error:",o),o;return te("[WalletProvider] request result:",s),s}))()}watchContractEvent(e,t,r){throw Error("Not support yet.")}requestAccounts(){var e=this;return H((function*(){const t=yield e.request({method:exports.WalletMethods.requestAccounts});return e.state.accounts=t,e.emit("accountsChanged",t),t}))()}createAccount(){return H((function*(){throw Error("WalletProvider 暂不支持创建账户")}))()}transferBalance(e){return H((function*(){throw Error("Not support yet.")}))()}setRecoverkey(e){return H((function*(){throw Error("Not support yet.")}))()}preResetPubKey(e){return H((function*(){throw Error("Not support yet.")}))()}resetPubKey(e){return H((function*(){throw Error("Not support yet.")}))()}freezeAccount(e){return H((function*(){throw Error("Not support yet.")}))()}freezeContract(e){return H((function*(){throw Error("Not support yet.")}))()}nativeDepositData(e){return H((function*(){throw Error("Not support yet.")}))()}queryLastBlockHeader(){return H((function*(){throw Error("Not support yet.")}))()}queryTransactionList(e){return H((function*(){throw Error("Not support yet.")}))()}queryTransactionAndReceipt(e){return H((function*(){throw Error("Not support yet.")}))()}queryTimestamp(e){return H((function*(){throw Error("Not support yet.")}))()}queryP2PStatus(e){return H((function*(){throw Error("Not support yet.")}))()}queryConsensusStatus(e){return H((function*(){throw Error("Not support yet.")}))()}queryCommonConsensusStatus(e){return H((function*(){throw Error("Not support yet.")}))()}querySyncStatus(e){return H((function*(){throw Error("Not support yet.")}))()}queryTransactionCacheStatus(e){return H((function*(){throw Error("Not support yet.")}))()}queryBlockCacheStatus(e){return H((function*(){throw Error("Not support yet.")}))()}queryContractNodesStatus(e){return H((function*(){throw Error("Not support yet.")}))()}queryContractConfigStatus(e){return H((function*(){throw Error("Not support yet.")}))()}queryLogLevel(e){return H((function*(){throw Error("Not support yet.")}))()}updateBlackList(e){return H((function*(){throw Error("Not support yet.")}))()}queryBlockProof(e){return H((function*(){throw Error("Not support yet.")}))()}queryBlockHeaderProof(e){return H((function*(){throw Error("Not support yet.")}))()}queryStateProof(e){return H((function*(){throw Error("Not support yet.")}))()}queryTransactionProof(e){return H((function*(){throw Error("Not support yet.")}))()}queryReceiptProof(e){return H((function*(){throw Error("Not support yet.")}))()}queryBlockHeaderInfos(e){return H((function*(){throw Error("Not support yet.")}))()}queryBlockReceiptInfos(e){return H((function*(){throw Error("Not support yet.")}))()}queryBlockBodyInfos(e){return H((function*(){throw Error("Not support yet.")}))()}updateAuthMap(){return H((function*(){throw Error("WalletProvider 暂不支持 updateAuthMap")}))()}queryAccount(e){return this.request({method:exports.WalletMethods.queryAccount,params:e})}queryBlockHeader(e){return this.request({method:exports.WalletMethods.queryBlockHeader,params:e})}queryBlock(e){return this.request({method:exports.WalletMethods.queryBlock,params:e})}queryLastBlock(){return this.request({method:exports.WalletMethods.queryLastBlock})}queryTransaction(e){return e.tee&&ts("queryTransaction"),this.request({method:exports.WalletMethods.queryTransaction,params:e})}queryTransactionReceipt(e){return e.tee&&ts("queryTransactionReceipt"),this.request({method:exports.WalletMethods.queryTransactionReceipt,params:e})}deployContract(e,t){return t.tee&&ts("deployContract"),this.request({method:exports.WalletMethods.deployWasmContract,params:U(U({},e),{},{contractName:e.contractName,contractType:e.contractType,abi:e.abi})})}updateContract(){throw Error("wallet provider 暂不支持 updateContract")}callContract(e,t){return(null==t?void 0:t.tee)&&ts("callContract"),this.request({method:e.contractType===exports.ContractType.solidity?exports.WalletMethods.callSolidityContract:exports.WalletMethods.callWasmContract,params:U(U({methodName:e.methodName,args:e.args},t),{},{contractName:e.contractName,contractType:e.contractType,abi:e.abi})})}queryContract(e){return this.request({method:exports.WalletMethods.queryContract,params:e})}sign(e){return H((function*(){throw Error("暂不支持")}))()}},exports.WasmContract=class extends ye{constructor(e,t){super(U({contractType:exports.ContractType.assemblyscript},e),t),this.abier=void 0,this.abier=to(e.contractName,this.abi)}generateDeployCode(e,t){if(t)throw Error("还未支持参数");const r=e.toString("hex"),n=function(e){const t=new o.Buffer(4);return t.writeUInt32BE(e),t.toString("hex")}(r.length/2);return"0x02"+n+r}generateCallCode(e,t){let r="";const n=this.abier.schema[e].fields||{},o=[];for(const e in n)o.push({key:e,type:n[e]});return r=ho.encodeParams(e,this.abier,t||[]),r&&(r="0x"+r),r}parseReturnOutput(e,t){var r;if(!t)return;let n=t;0===n.indexOf("0x")&&(n=n.slice(2));const o=null===(r=this.abier.schema[e])||void 0===r?void 0:r.results,s=ho.decodeParam(this.abier,o&&o.length>0&&o[0],Buffer.from(n,"hex"));return 1===s.length?s[0]:s}},exports.convertHex2Base64=so,exports.convertHex2Buffer=oo,exports.createDebug=ee,exports.debug=te,exports.decryptAESWithPassword=Rt,exports.decryptTXWithAES=Xn,exports.errorCodeMessages=Ko,exports.generateAESKey=Tt,exports.getAbier=to,exports.getUserInfo=ro,exports.isChromeBackground=X,exports.isDebug=Y,exports.isDev=$,exports.isElectron=J,exports.isNode=G,exports.maxQueryTransactionReceiptRetryInterval=3e4,exports.parsePrivateKeyToAES=Ve,exports.queryTransactionReceiptRetryInterval=go,exports.remove0x=ao,exports.signMessage=He,exports.toUTF8=function(e){return De(e)};
