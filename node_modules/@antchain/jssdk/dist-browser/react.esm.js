import e from"@babel/runtime/helpers/esm/objectSpread2";import t from"@babel/runtime/helpers/esm/slicedToArray";import{jsx as r}from"react/jsx-runtime";import{useState as n,useCallback as a,useEffect as o,useContext as s,createContext as c}from"react";import i from"debug";import u from"@babel/runtime/regenerator";import p from"@babel/runtime/helpers/esm/asyncToGenerator";import f from"@babel/runtime/helpers/esm/typeof";import h from"@babel/runtime/helpers/esm/classCallCheck";import y from"@babel/runtime/helpers/esm/createClass";import l from"@babel/runtime/helpers/esm/inherits";import d from"@babel/runtime/helpers/esm/createSuper";import m from"@babel/runtime/helpers/esm/wrapNativeSuper";import v from"@babel/runtime/helpers/esm/defineProperty";import g from"bignumber.js";import{enc as k,SHA256 as b,AES as _,pad as w,mode as x}from"crypto-js";import C from"crypto-js/sha3";import{Buffer as q}from"safe-buffer";import{AbiCoder as E}from"@ethersproject/abi";import S from"@babel/runtime/helpers/esm/createForOfIteratorHelper";import T from"fcbuffer";import P from"node-forge";import{decode as N,encode as B}from"rlp";import{sign as I}from"secp256k1";import R from"md5.js";import K from"public-encrypt/browser";import{createCipheriv as A,createDecipheriv as O}from"browserify-aes/browser";import D from"create-hash";import L from"js-encoding-utils";import{ec as U}from"elliptic";import{define as z}from"asn1.js";import W from"bn.js";import j from"@babel/runtime/helpers/esm/toConsumableArray";import H from"events";import M from"tls";import{nanoid as Q}from"nanoid";import F from"axios";import{v4 as V}from"uuid";import{JsonRpcEngine as Y}from"json-rpc-engine";import{createStreamMiddleware as J}from"json-rpc-middleware-stream";import G from"pump";var X="1"===process.env.MYFISH_DEBUG,Z="development"===process.env.NODE_ENV,$=require("is-electron")(),ee="undefined"==typeof window&&"undefined"==typeof chrome&&!$,te="undefined"!=typeof chrome&&"undefined"==typeof window,re=function(){return i.enable("antchain:*")};function ne(e){return(Z||X)&&re(),i(e)}"undefined"!=typeof window&&(window.enableDebug=re),"undefined"!=typeof globalThis&&(globalThis.enableDebug=re);var ae,oe,se,ce,ie,ue=ne("antchain:jssdk"),pe={isConnected:!1,chainId:"",accounts:[]},fe=c(null),he=function(s){var c=s.children,i=n(!0),u=t(i,2),p=u[0],f=u[1],h=n(!0),y=t(h,2),l=y[0],d=y[1],m=n(null),v=t(m,2),g=v[0],k=v[1],b=n(pe),_=t(b,2),w=_[0],x=_[1],C=a((function(){var t=window.antchain||null;if(t){f(!1),k(t);var r=function(){x(e({},t.state)),ue("[useAntchain] update provider state:",t.state)};t.state.isConnected&&r(),t.on("connect",r),t.on("disconnect",r),t.on("chainChanged",r),t.on("accountsChanged",r)}return t}),[]);return o((function(){var e=1,t=C();ue("[useAntchain] detect provider (".concat(e,") :"),t);var r=null;return t||(r=setInterval((function(){e++;var t=C();ue("[useAntchain] detect provider (".concat(e,") :"),t),t?clearInterval(r):5>e||(clearInterval(r),f(!1),d(!1))}),500)),function(){return r&&clearInterval(r)}}),[C]),r(fe.Provider,Object.assign({value:{loading:p,isInstalled:l,antchain:g,data:w}},{children:c}),void 0)},ye=function(){return s(fe)};!function(e){e.assemblyscript="assemblyscript",e.solidity="solidity"}(ae||(ae={})),function(e){e.WASM="WASM",e.EVM="EVM"}(oe||(oe={})),function(e){e.TX_DEPLOY_CONTRACT="TX_DEPLOY_CONTRACT",e.CALL_CONTRACT="CALL_CONTRACT"}(se||(se={})),function(e){e.queryBlock="QueryBlock",e.queryLastBlock="QueryLastBlock",e.queryTransaction="QueryTransaction",e.queryTransactionReceipt="QueryTransactionReceipt",e.queryAccount="QueryAccount",e.queryContract="QueryContract",e.deployContract="DeployContract",e.updateContract="UpdateContract",e.callContract="CallContract",e.encryptedTransaction="EncryptedTransaction",e.LocalTransaction="LocalTransaction"}(ce||(ce={})),function(e){e.queryBlock="QUERYBLOCKBODY",e.queryBlockHeader="QUERYBLOCK",e.queryLastBlock="QUERYLASTBLOCK",e.queryTransactionFromBlockchain="QUERYTRANSACTIONFROMBLOCKCHAIN",e.queryTransactionReceipt="QUERYRECEIPT",e.queryAccount="QUERYACCOUNT",e.queryContract="QUERYCONTRACT",e.deploySolidityContractForBizAsync="DEPLOYCONTRACTFORBIZASYNC",e.updateSolidityContractForBizAsync="UPDATECONTRACTFORBIZASYNC",e.deployWasmContractForBiz="DEPLOYWASMCONTRACT",e.updateWasmContractForBiz="UPDATECONTRACTFORBIZ",e.deployWasmContract="DEPLOYCONTRACT",e.updateWasmContract="UPDATECONTRACT",e.callWasmContractForBiz="CALLWASMCONTRACT",e.callWasmContractForBizAsync="CALLWASMCONTRACTASYNC",e.callWasmContract="CALLWASMCONTRACT",e.callContract="CALLCONTRACT",e.createAccountForBiz="TENANTCREATEACCUNT"}(ie||(ie={}));var le,de=v({default:"/api/contract/chainCall"},ie.callWasmContract,"/api/contract/chainCallForBiz");!function(e){e.queryBlockHeader="antchain_queryBlockHeader",e.queryBlock="antchain_queryBlock",e.queryLastBlock="antchain_queryLastBlock",e.queryTransaction="antchain_queryTransaction",e.queryTransactionReceipt="antchain_queryTransactionReceipt",e.queryAccount="antchain_queryAccount",e.queryContract="antchain_queryContract",e.sign="antchain_sign",e.deployContract="antchain_deployContract",e.deployWasmContract="antchain_deployWasmContract",e.deploySolidityContract="antchain_deploySolidityContract",e.callContract="antchain_callContract",e.callWasmContract="antchain_callWasmContract",e.callSolidityContract="antchain_callSolidityContract",e.getProviderState="antchain_getProviderState",e.requestAccounts="antchain_requestAccounts",e.subscription="antchain_subscription"}(le||(le={}));var me,ve=function(e){l(r,m(Error));var t=d(r);function r(e,n,a){var o;return h(this,r),(o=t.call(this,e)).code=void 0,o.data=void 0,o.name="AntchainSDKError",o.code=n,o.data=a,o}return y(r)}();!function(e){e[e.ACCOUNT=0]="ACCOUNT",e[e.CONTRACT=1]="CONTRACT",e[e.TOPICS=2]="TOPICS",e[e.BLOCK=3]="BLOCK"}(me||(me={}));var ge,ke,be,_e=function(){function t(e,r){h(this,t),this.options=void 0,this.provider=void 0,this.contractName=void 0,this.contractType=void 0,this.vmType=void 0,this.abi=void 0,ue("[Contract] new contarct with options:",e),this.options=e,this.provider=r;var n=e.contractType,a=void 0===n?ae.assemblyscript:n,o=e.abi;this.contractName=e.contractName,this.contractType=a,this.vmType=a===ae.solidity?oe.EVM:oe.WASM,this.abi="object"===f(o)?JSON.stringify(o):o}var r,n;return y(t,[{key:"on",value:function(e,t){this.provider.watchContractEvent(this,e,t)}},{key:"deploy",value:(n=p(u.mark((function e(t,r){return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(r||{}).update){e.next=5;break}return e.abrupt("return",this.provider.updateContract(this,t));case 5:return e.abrupt("return",this.provider.deployContract(this,t));case 6:case"end":return e.stop()}}),e,this)}))),function(e,t){return n.apply(this,arguments)})},{key:"call",value:(r=p(u.mark((function t(r){return u.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(1===this.provider.majorVersion){t.next=4;break}if(this.vmType!==oe.EVM){t.next=3;break}throw Error("当前版本的连接器不支持调用 Solidity 合约，请升级。");case 3:return t.abrupt("return",this.provider.callContract(e({contractName:this.contractName,vmType:this.vmType,abi:this.abi},r)));case 4:return t.abrupt("return",this.provider.callContract(this,r));case 5:case"end":return t.stop()}}),t,this)}))),function(e){return r.apply(this,arguments)})},{key:"generateDeployCode",value:function(e,t){throw Error("不能直接调用 Contract 类的 generateDeployCode")}},{key:"generateCallCode",value:function(e,t){throw Error("不能直接调用 Contract 类的 generateCallCode")}},{key:"parseReturnOutput",value:function(e,t){throw Error("不能直接调用 Contract 类的 generateCallCode")}}]),t}(),we=String.fromCharCode;function xe(e){for(var t,r,n=[],a=0,o=e.length;o>a;)55296>(t=e.charCodeAt(a++))||t>56319||a>=o?n.push(t):56320==(64512&(r=e.charCodeAt(a++)))?n.push(((1023&t)<<10)+(1023&r)+65536):(n.push(t),a--);return n}function Ce(e){if(e>=55296&&57343>=e)throw Error("Lone surrogate U+"+e.toString(16).toUpperCase()+" is not a scalar value")}function qe(e,t){return we(e>>t&63|128)}function Ee(e){if(0==(4294967168&e))return we(e);var t="";return 0==(4294965248&e)?t=we(e>>6&31|192):0==(4294901760&e)?(Ce(e),t=we(e>>12&15|224),t+=qe(e,6)):0==(4292870144&e)&&(t=we(e>>18&7|240),t+=qe(e,12),t+=qe(e,6)),t+=we(63&e|128)}function Se(){if(be>=ke)throw Error("Invalid byte index");var e=255&ge[be];if(be++,128==(192&e))return 63&e;throw Error("Invalid continuation byte")}var Te=function(e){for(var t=xe(e),r=t.length,n=-1,a="";++n<r;)a+=Ee(t[n]);return a},Pe=function(e){ge=xe(e),ke=ge.length,be=0;for(var t,r,n,a=[];!1!==(r=void 0,n=void 0,t=be!=ke&&(r=255&ge[be],be++,0==(128&r)?r:192!=(224&r)||128>(n=(31&r)<<6|Se())?224!=(240&r)||2048>(n=(15&r)<<12|Se()<<6|Se())?240!=(248&r)||65536>(n=(7&r)<<18|Se()<<12|Se()<<6|Se())||n>1114111?void 0:n:(Ce(n),n):n));)a.push(t);return function(e){for(var t,r=e.length,n=-1,a="";++n<r;)(t=e[n])>65535&&(a+=we((t-=65536)>>>10&1023|55296),t=56320|1023&t),a+=we(t);return a}(a)};function Ne(e,t){var r=e;return"hex"===t&&(r.length>2&&"0x"===r.substr(0,2)&&(r=r.substr(2)),r=k.Hex.parse(r)),""+C(r,{outputLength:256})}function Be(e,t){var r="0x";t&&(r="");var n=e.toString("hex");if(Ke(e)){if("0x"!==e.substr(0,2))return r+""+b(e);n=e.substr(2)}var a=k.Hex.parse(n);return r+b(a).toString(k.Hex)}function Ie(e){return q.isBuffer(e)}function Re(e){return e&&(e instanceof g||e.constructor&&"BigNumber"===e.constructor.name)}function Ke(e){return"string"==typeof e||e&&e.constructor&&"String"===e.constructor.name}function Ae(e){return null!==e&&!Array.isArray(e)&&"object"===f(e)}function Oe(e){return Array.isArray(e)}function De(e,t){var r=e,n=t;if(Ie(r))return r;"number"==typeof r&&(r=r.toString(16)),Ke(r)&&0===r.indexOf("0x")&&(r=r.slice(2)),n||(n=Math.ceil(r.length/2));for(var a=q.alloc(n),o=0;n>o;o++){var s=r.slice(2*o,2*o+2)||"00";a.write(s,o,1,"hex")}return a}function Le(e,t,r){return parseInt(t)>e.length?e+Array(parseInt(t)-e.length+1).join(r||"0"):e}function Ue(e,t){var r=e||0;return Re(r)?r:Ke(r)?0===r.indexOf("0x")||0===r.indexOf("-0x")?new g(r.replace("0x",""),16):new g(r,t||16):new g(r.toString(10),10)}function ze(e,t){return Ue(e,t).toNumber()}function We(e,t){var r="0x";t&&(r="");var n=Ue(e),a=n.toString(16);return n.lessThan(0)?"-"+r+a.substr(1):r+a}function je(e,t,r){for(var n=Te(e),a="",o=0;n.length>o;o++){var s=n.charCodeAt(o);if(0===s){if(!t)break;a+="00"}else{var c=s.toString(16);a+=2>c.length?"0"+c:c}}var i="0x";return r&&(i=""),i+a}function He(e,t){var r="0x";return t&&(r=""),Ie(e)?r+e.toString("hex"):Qe(e,t)}function Me(e){return Pe(function(e,t){var r="",n=0;for("0x"===e.substring(0,2)&&(n=2);e.length>n;n+=2){var a=parseInt(e.substr(n,2),16);if(t&&0===a)break;r+=String.fromCharCode(a)}return r}(e))}function Qe(e,t){return"boolean"==typeof e?We(+e,t):Re(e)?We(e,t):"object"===f(e)?je(JSON.stringify(e),!1,t):Ke(e)?0===e.indexOf("-0x")?function(e,t){return We(e,t)}(e,t):0===e.indexOf("0x")?e:je(e,1,t):We(e,t)}function Fe(e){var t=e;return Ke(t)?("0x"===t.substr(0,2)&&(t=t.substr(2)),q.from(t,"hex")):t}var Ve={name:"uint64",Identity:"bytes",checksum160:"fixed_bytes20",checksum256:"fixed_bytes32",checksum512:"fixed_bytes64",signature:"fixed_bytes65",public_key:"fixed_bytes33",message_type:"fixed_string16",symbol:"uint64",symbol_code:"uint64",field_name:"string",account_name:"name",permission_name:"name",type_name:"string",table_name:"name",scope_name:"name",action_name:"string",time_point:"int64",time_point_sec:"time",timestamp:"uint32",block_timestamp_type:"timestamp",block_id:"fixed_bytes32",checksum_type:"fixed_bytes32",checksum256_type:"fixed_bytes32",checksum512_type:"fixed_bytes64",checksum160_type:"fixed_bytes20",sha256:"fixed_bytes32",sha512:"fixed_bytes64",sha160:"fixed_bytes20",weight_type:"uint16",block_num_type:"uint32",share_type:"int64",digest_type:"checksum_type",context_free_type:"bytes",unsigned_int:"varuint32",bool:"uint8",extensions_type:{base:"",fields:{type:"uint16",data:"bytes"}},transaction_header:{base:"",fields:{expiration:"time",ref_block_num:"uint16",ref_block_prefix:"uint32",max_net_usage_words:"unsigned_int",max_cpu_usage_ms:"uint8",delay_sec:"unsigned_int"}},transaction:{base:"transaction_header",fields:{context_free_actions:"action[]",actions:"action[]",transaction_extensions:"extensions_type[]"}},signed_transaction:{base:"transaction",fields:{signatures:"signature[]",context_free_data:"bytes[]"}},fields:"field_def[]",field_def:{fields:{name:"field_name",type:"type_name"}},type_def:{base:"",fields:{new_type_name:"type_name",type:"type_name"}},struct_def:{base:"",fields:{name:"type_name",base:"type_name",fields:"field_def[]"}},clause_pair:{base:"",fields:{id:"string",body:"string"}},error_message:{base:"",fields:{error_code:"uint64",error_msg:"string"}},abi_def:{base:"",fields:{version:"string",types:"type_def[]",structs:"struct_def[]",actions:"action_def[]",tables:"table_def[]",ricardian_clauses:"clause_pair[]",error_messages:"error_message[]",abi_extensions:"extensions_type[]"}},table_def:{base:"",fields:{name:"table_name",index_type:"type_name",key_names:"field_name[]",key_types:"type_name[]",type:"type_name"}},permission_level:{base:"",fields:{actor:"account_name",permission:"permission_name"}},action:{base:"",fields:{name:"action_name"}},action_def:{base:"",fields:{name:"string",type:"type_name"}}},Ye=function(e){return{"abi_def.fromObject":function(e){if("string"==typeof e){var t=""+q.from(e,"hex");return 0===t.length&&(t=""+q.from(e)),JSON.parse(t)}return q.isBuffer(e)?JSON.parse(""+e):null}}},Je=function(e){return{"setcode.code.fromObject":function(t){var r=t.object,n=t.result;try{var a=""+r.code;if(/^\s*\(module/.test(a)){var o=e.binaryen;e.debug&&console.log("Assembling WASM..");var s=q.from(o.parseText(a).emitBinary());n.code=s}else n.code=r.code}catch(e){throw console.error(e,r.code),e}}}};function Ge(e){null==e&&(e={}),e.abiCache={abi:function(e,n){if(n){q.isBuffer(n)&&(n=JSON.parse(n));var a=function(e,t){var r={};e.types&&e.types.forEach((function(e){r[e.new_type_name]=e.type}));e.structs&&e.structs.forEach((function(e){var t,n={},a=S(e.fields);try{for(a.s();!(t=a.n()).done;){var o=t.value;n[o.name]=o.type}}catch(e){a.e(e)}finally{a.f()}r[e.name]={base:e.base,fields:n,results:e.results},""===e.base&&delete r[e.name].base}));e.interfaces&&e.interfaces.forEach((function(e){var n=r[e.type];n?n.interface={name:e.name}:console.error("Missing abiSchema type",e.type,t)}));return r}(n,e),o=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0,r=Object.assign({},Ye(),Je(e),e.override),n=Object.assign({},{},e.customTypes);(e=Object.assign({override:r},{customTypes:n},e)).sort=Object.assign({},e.sort);var a=Object.assign({},Ve,t),o=T(a,e),s=o.structs,c=o.types,i=o.errors,u=o.fromBuffer,p=o.toBuffer;if(0!==i.length)throw Error(JSON.stringify(i,null,4));return{structs:s,types:c,fromBuffer:u,toBuffer:p}}(t,a);return r[e]=Object.assign({abi:n,schema:a},o)}var s=r[e];if(null==s)throw Error("Abi '".concat(e,"' is not cached"));return s}};var t=Object.assign({},{defaults:!0},e),r={};return e.abiCache}function Xe(e,t){var r=P.md.sha256.create().update(t,"utf8");ue("[signMessage] message hash:",r.digest().toHex());var n=""+P.pki.privateKeyFromPem(e).sign(r),a=Buffer.from(P.util.binary.raw.decode(n)).toString("hex");return ue("[signMessage] result:",a),a}function Ze(e,t){if(ue("[parsePrivateKeyToAES] privateKey:",e),ue("[parsePrivateKeyToAES] passphrase:",t),ee){var r=require("crypto").createPrivateKey({format:"pem",key:e,passphrase:t}).export({type:"sec1",format:"pem",cipher:"aes-256-cbc",passphrase:t});return ue("[parsePrivateKeyToAES] use node crypto, result:",r),r}return ue("[parsePrivateKeyToAES] 浏览器端需要用户手动进行转换"),e}function $e(e){return e.readInt32BE(0)}function et(e){return B(e)}function tt(e,t){return He(et(e),t)}function rt(e){return N(e)}function nt(e,t,r){this.tag=t,q.isBuffer(e)?this.encode(e,t,r):e&&this.decode(e.toString("ascii").trim(),r)}nt.prototype.toString=function(){return this.pem},nt.prototype.toBuffer=function(){return this.buf},nt.prototype.decode=function(e,t){e&&(this.pem=e.toString("ascii").trim());var r,n=this.pem.split(/\r?\n/),a=n[0].match(/\-\-\-\-\-\s*BEGIN ?([^-]+)?\-\-\-\-\-/);if(!a)throw Error("parse PEM: BEGIN not found");if(this.tag=a[1],n.shift(),"Proc-Type: 4,ENCRYPTED"===n[0]){if("string"!=typeof t)throw Error("PEM is encrypted but no passphrase given");r=n[1].match(/DEK-Info: ([^,]+),([0-9A-F]+)/i),n.splice(0,3);var o=r[1].toLowerCase(),s=q(r[2],"hex"),c=function(e,t,r){var n=r,a=at[e];if(!a){throw new TypeError("Unsupported type. Allowed: "+Object.keys(at))}var o=n.length,s=8;n.length!==s&&(n=n.slice(0,s));var c,i=16,u=!1,p=new q(a),f=0;for(;;){var h=new R;u?h.update(c):u=!0,h.update(t),h.update(n),c=h.digest();for(var y=0;a&&i>y;)p[f++]=c[y],a--,y++;var l=Math.min(o,i-y);if(o-=l,y+=l,0==a&&0==o)break}return p}
/**
 * @fileOverview
 * @name base64x-1.1.js
 * @author Kenji Urushima kenji.urushima@gmail.com
 * @version jsrsasign 8.0.12 base64x 1.1.14 (2018-Apr-22)
 * @since jsrsasign 2.1
 * @license <a href="https://kjur.github.io/jsrsasign/license/">MIT License</a>
 */(o.toUpperCase(),t,s);n.pop();var i=n.join("").toString("hex"),u=k.Hex.parse(c.toString("hex")),p=_.decrypt(i,u,{iv:k.Hex.parse(s.toString("hex")),padding:w.NoPadding,mode:x.CBC});r&&(this.buf=q(p.toString(k.Hex),"hex"))}return this.pem="-----BEGIN"+(this.tag?" "+this.tag:"")+"-----\n"+q(this.buf).toString("base64").match(/.{1,64}/g).join("\n")+"\n-----END"+(this.tag?" "+this.tag:"")+"-----",this.pem};var at={"DES-EDE3-CBC":24,"DES-CBC":8,"AES-128-CBC":16,"AES-192-CBC":24,"AES-256-CBC":32};function ot(e,t){return"-----BEGIN "+t+"-----\r\n"+function(e){return function(e){var t,r,n="";for(t=0;e.length>=t+3;t+=3)r=parseInt(e.substring(t,t+3),16),n+=st.charAt(r>>6)+st.charAt(63&r);for(t+1==e.length?(r=parseInt(e.substring(t,t+1),16),n+=st.charAt(r<<2)):t+2==e.length&&(r=parseInt(e.substring(t,t+2),16),n+=st.charAt(r>>2)+st.charAt((3&r)<<4));(3&n.length)>0;)n+="=";return n}(e)}
/*! (c) Tom Wu | http://www-cs-students.stanford.edu/~tjw/jsbn/
 */(e).replace(/(.{64})/g,"$1\r\n").replace(/\r\n$/,"")+"\r\n-----END "+t+"-----\r\n"}var st="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";var ct=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"];function it(e){if(e>65536)throw Error("requested too many random bytes");var t=q.allocUnsafe(e);return e>0&&function(e){for(var t=e.length,r=0;t>r;r++)e[r]="0x"+ct[parseInt(16*Math.random())]+ct[parseInt(16*Math.random())]}(t),t}var ut=new U("secp256k1"),pt=Buffer.from("fffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141","hex"),ft=Buffer.alloc(32,0);function ht(e,t){if(!e)throw Error(t||"Assertion failed")}function yt(e){return t=e,!(!Buffer.isBuffer(t)||32!==t.length)&&(e.compare(ft)>0&&0>e.compare(pt));var t}function lt(e){return Buffer.from(it(e))}function dt(e,t,r){if(!t||!r)throw Error("aes empty key or iv!");var n=A("aes-128-gcm",t,r);n.setAutoPadding(!1);var a=n.update(e).toString("hex");return n.final(),{data:a,authTag:n.getAuthTag().toString("hex")}}function mt(e){var t=D("sha256").update(e).digest();return new Uint8Array(t)}function vt(e){return ht(32===e.length,"Bad private key"),ht(yt(e),"Bad private key"),Buffer.from(ut.keyFromPrivate(e).getPublic("arr"))}function gt(e,t){ht(Buffer.isBuffer(e),"Bad private key"),ht(Buffer.isBuffer(t),"Bad public key"),ht(32===e.length,"Bad private key"),ht(yt(e),"Bad private key"),ht(65===t.length||33===t.length,"Bad public key"),65===t.length&&ht(4===t[0],"Bad public key"),33===t.length&&ht(2===t[0]||3===t[0],"Bad public key");var r=ut.keyFromPrivate(e),n=ut.keyFromPublic(t),a=r.derive(n.getPublic());return Buffer.from(a.toArray())}var kt="02",bt={prime256v1:32,secp256k1:32,secp384r1:48,secp521r1:66},_t={prime256v1:"P-256",secp256k1:"P-256K",secp384r1:"P-384",secp521r1:"P-521"},wt={"P-256":"prime256v1","P-256K":"secp256k1","P-384":"secp384r1","P-521":"secp521r1"},xt=z("Rfc5915Key",(function(){this.seq().obj(this.key("version").int(),this.key("privateKey").octstr(),this.key("parameters").optional().explicit(0).objid({"1 2 840 10045 3 1 7":"prime256v1","1 3 132 0 10":"secp256k1","1 3 132 0 34":"secp384r1","1 3 132 0 35":"secp521r1"}),this.key("publicKey").optional().explicit(1).bitstr())})),Ct=z("Pkcs8Key",(function(){this.seq().obj(this.key("version").int(),this.key("algorithmIdentifier").seq().obj(this.key("privateKeyType").objid({"1 2 840 10045 2 1":"EC"}),this.key("parameters").objid({"1 2 840 10045 3 1 7":"prime256v1","1 3 132 0 10":"secp256k1","1 3 132 0 34":"secp384r1","1 3 132 0 35":"secp521r1"})),this.key("privateKey").octstr())})),qt=z("SpkiKey",(function(){this.seq().obj(this.key("algorithmIdentifier").seq().obj(this.key("publicKeyType").objid({"1 2 840 10045 2 1":"EC"}),this.key("parameters").objid({"1 2 840 10045 3 1 7":"prime256v1","1 3 132 0 10":"secp256k1","1 3 132 0 34":"secp384r1","1 3 132 0 35":"secp521r1"})),this.key("publicKey").bitstr())}));function Et(e,t){var r=bt[e];if(4==t[0]){if(t.length!=2*r+1)throw new TypeError("Invalid uncompressed key size");return{c:e,x:t.slice(1,r+1),y:t.slice(r+1)}}throw new TypeError("Compressed key unsupported")}function St(e){var t=Ct.decode(e,"der"),r=xt.decode(t.privateKey,"der"),n=t.algorithmIdentifier.parameters,a=bt[n],o=r.privateKey;if(o.length>a)throw new TypeError("Invalid private key size: expected "+a+" gotten "+o.length);var s=Et(n,r.publicKey.data);return s.d=o,s}function Tt(e){var t=qt.decode(e,"der");return Et(t.algorithmIdentifier.parameters,t.publicKey.data)}var Pt=/-+BEGIN EC PRIVATE KEY-+([\s\S]+)-+END EC PRIVATE KEY-+/m,Nt=/-+BEGIN PRIVATE KEY-+([\s\S]*)-+END PRIVATE KEY-+/m,Bt=/-+BEGIN PUBLIC KEY-+([\s\S]*)-+END PUBLIC KEY-+/m;function It(e){if("string"!=typeof e)throw new TypeError("PEM must be a string");var t=null;if(t=e.match(Pt))return function(e){var t=xt.decode(e,"der"),r=bt[t.parameters],n=t.privateKey;if(n.length>r)throw new TypeError("Invalid private key size: expected "+r+" gotten "+n.length);var a=Et(t.parameters,t.publicKey.data);return a.d=n,a}(new q(t[1].replace(/[\s-]/gm,""),"base64"));if(t=e.match(Nt))return St(new q(t[1].replace(/[\s-]/gm,""),"base64"));if(t=e.match(Bt))return Tt(new q(t[1].replace(/[\s-]/gm,""),"base64"));throw new TypeError("Unrecognized PEM key structure")}function Rt(e,t){if(!(this instanceof Rt))return new Rt(e,t);var r,n,a,o,s;if(t||(t="pem"),q.isBuffer(e))if("pem"==t)r=(c=It(e.toString("ascii"))).c,a=c.x,o=c.y,n=c.d;else if("pkcs8"==t||"rfc5208"==t){r=(c=St(e)).c,a=c.x,o=c.y,n=c.d}else{if("spki"!=t&&"rfc5280"!=t)throw new TypeError('Unknown format for EC Key "'+t+'"');r=(c=Tt(e)).c,a=c.x,o=c.y,n=c.d}else if("string"==typeof e){if("pem"==t)r=(c=It(e)).c,a=c.x,o=c.y,n=c.d;else if("pkcs8"==t||"rfc5208"==t){r=(c=St(new q(e,"base64"))).c,a=c.x,o=c.y,n=c.d}else{if("spki"!=t&&"rfc5280"!=t)throw new TypeError('Unknown format for EC Key "'+t+'"');r=(c=Tt(new q(e,"base64"))).c,a=c.x,o=c.y,n=c.d}}else{if(!(s=e)||s.constructor!==Object)throw new TypeError("Unrecognized format for EC key");if("string"==typeof e.curve?r=e.curve:"string"==typeof e.crv&&(r=wt[e.crv]||e.crv),q.isBuffer(e.privateKey)?n=e.privateKey:"string"==typeof e.privateKey?n=new q(e.privateKey,"base64"):q.isBuffer(e.d)?n=e.d:"string"==typeof e.d&&(n=new q(e.d,"base64")),q.isBuffer(e.publicKey)){var c=Et(r,e.publicKey);a=c.x,o=c.y}else if("string"==typeof e.publicKey){c=Et(r,new q(e.publicKey,"base64"));a=c.x,o=c.y}else q.isBuffer(e.x)?a=e.x:"string"==typeof e.x&&(a=new q(e.x,"base64")),q.isBuffer(e.y)?o=e.y:"string"==typeof e.y&&(o=new q(e.y,"base64"))}if(!r)throw new TypeError("EC Key curve not specified");if(!a||!o)throw new TypeError("Public EC Key point unavailable");var i=bt[r];if(!i)throw new TypeError('EC Key curve "'+r+'" invalid');if(a.length!=i)throw new TypeError("Public EC Key point X of wrong length");if(o.length!=i)throw new TypeError("Public EC Key point Y of wrong length");if(n&&o.length!=i)throw new TypeError("Private EC Key of wrong length");Object.defineProperties(this,{curve:{enumerable:!0,configurable:!1,value:r},isPrivateECKey:{enumerable:!0,configurable:!1,value:null!=n},x:{enumerable:!0,configurable:!1,get:function(){return new q(a)}},y:{enumerable:!0,configurable:!1,get:function(){return new q(o)}},jsonCurve:{enumerable:!1,configurable:!1,value:_t[r]},publicCodePoint:{enumerable:!1,configurable:!1,get:function(){return q.concat([new q([4]),a,o])}}}),n&&Object.defineProperty(this,"d",{enumerable:!0,configurable:!1,get:function(){return new q(n)}})}function Kt(e,t){return function(e,t){var r=new Rt(function(e,t,r){return new nt(e,t,r)}(e,"EC PRIVATE KEY",t).pem,"pem"),n=r.d,a=r.publicCodePoint;a.length>64&&(a=a.slice(1));return{privateKey:n,publicKey:a}}(e,t)}function At(e,t){var r=e;Ie(r)?32!==r.length&&(r=De(Be(r))):r=Ke(r)&&0===r.indexOf("0x")?De(r):De(Be(r));var n=I(r,t);return q.concat([n.signature,q.from([n.recovery])],65)}function Ot(e,t){var r=e,n=t;if(!r||!n)throw Error("aes password or tx hash is invalid"+r+"..."+n);if(Ke(r)&&(r="0x"===r.substr(0,2)?q.from(r.substr(2),"hex"):q.from(r,"ascii")),!Ie(r))throw Error("aes password is invalid");return n=Fe(n),D("sha256").update(q.concat([r,n])).digest().slice(0,16)}function Dt(){return it(4).readUInt32BE(0)}function Lt(e,t,r,n,a){return a===kt?function(e,t,r){var n=r,a=e;if(!a)throw Error("ecc_pub_key is invalid");n||(n=it(16));n=Fe(n);var o=it(12),s=Ut(t,n,o),c=q.from(s.authTag,"hex"),i=q.from(s.data,"hex"),u={iv:o},p=L.formatter.pemToBin(""+a),f=q.from(p),h=function(e,t){for(var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=r.ephemPrivateKey||lt(32);!yt(n);)n=r.ephemPrivateKey||lt(32);var a=vt(n),o=gt(n,e),s=Buffer.alloc(36);o.copy(s,0,0,32),s[35]=1;var c=mt(s),i=r.iv||lt(12),u=Buffer.from(c.slice(0,16)),p=dt(t,u,i),f=Fe(p.data),h=Fe(p.authTag);return Buffer.concat([a,i,h,f])}(a=Fe(a=f.slice(f.byteLength-65,f.byteLength)),n,u);if(109>h.length){var y=q.alloc(109);h.copy(y,109-h.length),h=y}var l=new q(2);return l.writeUInt16BE(320,0),h=Fe(h),"0x"+q.concat([l,h,o,c,i]).toString("hex")}(e,t,Ot(r,n)):function(e,t,r){var n=r,a=e;n||(n=it(16));if(n=Fe(n),!a)throw Error("rsa_pub_key is invalid");Ke(a)&&-1===a.indexOf("PUBLIC KEY")&&("0x"===a.substr(0,2)&&(a=a.substr(2)),a=ot(a,"PUBLIC KEY"));var o=it(12),s=Ut(t,n,o),c=K.publicEncrypt(a,n);if(256>c.length){var i=q.alloc(256);c.copy(i,256-c.length),c=i}var u=new q(2);return u.writeUInt16BE(1,0),"0x"+q.concat([u,c,o,q.from(s.authTag,"hex"),q.from(s.data,"hex")]).toString("hex")}(e,t,Ot(r,n))}function Ut(e,t,r){if(!t||!r)throw Error("aes empty key or iv!");var n=e,a=t;n=Fe(n),a=Fe(a);var o=A("aes-128-gcm",a,r);o.setAutoPadding(!1);var s=o.update(n).toString("hex");return o.final(),{data:s,authTag:o.getAuthTag().toString("hex")}}function zt(e,t,r){return function(e,t){if(!t||!e)throw Error("aes empty key or data!");var r=e,n=t;r=Fe(r),n=Fe(n);var a=r.length-16,o=r.length,s=r.slice(a,o),c=r.slice(a-=12,o-=16),i=r.slice(0,a),u=O("aes-128-gcm",n,c);return u.setAuthTag(s),"0x"+u.update(i).toString("hex")}(e,Ot(t,r))}function Wt(e,t){if(-1!==e.name.indexOf("("))return e.name;var r="";return r=t?t.join(","):e.inputs.map((function(e){return e.type})).join(","),e.name+"("+r+")"}Rt.prototype.asPublicECKey=function(){return this.isPrivateECKey?new Rt({curve:this.curve,x:this.x,y:this.y}):this},Rt.prototype.toBuffer=function(e){if(e||(e="pem"),"pem"==e)return new q(this.toString("pem"),"ascii");if(this.isPrivateECKey){for(var t=this.d;0==t[0];)t=t.slice(1);if("pkcs8"==e||"rfc5208"==e)return Ct.encode({version:0,algorithmIdentifier:{privateKeyType:"EC",parameters:this.curve},privateKey:xt.encode({version:1,privateKey:t,publicKey:{data:this.publicCodePoint}},"der")},"der");if("rfc5915"==e)return xt.encode({version:1,privateKey:t,parameters:this.curve,publicKey:{data:this.publicCodePoint}},"der");throw new TypeError('Unknown format for private key "'+e+'"')}if("spki"==e||"rfc5280"==e)return qt.encode({algorithmIdentifier:{publicKeyType:"EC",parameters:this.curve},publicKey:{data:this.publicCodePoint}},"der");throw new TypeError('Unknown format for public key "'+e+'"')},Rt.prototype.toString=function(e){if(e||(e="pem"),this.isPrivateECKey){if("pem"==e)return"-----BEGIN PRIVATE KEY-----\n"+this.toBuffer("pkcs8").toString("base64").match(/.{1,64}/g).join("\n")+"\n-----END PRIVATE KEY-----\n";if("rfc5915"==e)return"-----BEGIN EC PRIVATE KEY-----\n"+this.toBuffer("rfc5915").toString("base64").match(/.{1,64}/g).join("\n")+"\n-----END EC PRIVATE KEY-----\n";if("pkcs8"==e||"rfc5208"==e)return this.toBuffer("pkcs8").toString("base64");if("spki"==e||"rfc5280"==e)return this.toBuffer("spki").toString("base64");throw new TypeError('Unknown format for private key "'+e+'"')}if("pem"==e)return"-----BEGIN PUBLIC KEY-----\n"+this.toBuffer("spki").toString("base64").match(/.{1,64}/g).join("\n")+"\n-----END PUBLIC KEY-----\n";if("spki"==e||"rfc5280"==e)return this.toBuffer("spki").toString("base64");throw new TypeError('Unknown format for public key "'+e+'"')},Rt.prototype.toJSON=function(){function e(e){return e.toString("base64").replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")}var t={kty:"EC",crv:_t[this.curve],x:e(this.x),y:e(this.y)},r=this.d;if(r){var n=bt[this.curve];if(n>r.length)r=q.concat([new q(n-r.length).fill(0),r]);t.d=e(r)}return t};var jt;!function(e){e.CONNECTION="connection",e.RESPONSE_NOT_JSON="responseNotJSON",e.RETURNCODE_ERROR="returnCode",e.RECEIPT_ERROR="receiptResult"}(jt||(jt={}));var Ht=function(e){l(r,m(Error));var t=d(r);function r(e,n){var a;return h(this,r),(a=t.call(this,e)).type=void 0,a.code=void 0,a.returnCode=void 0,a.receiptCode=void 0,a.hash=void 0,a.output=void 0,n&&(a.type=n.type,a.code=n.code,a.returnCode=n.returnCode,a.receiptCode=n.receiptCode,a.hash=n.hash,a.output=n.output),a}return y(r)}(),Mt=function(){return new Ht("Invalid number of arguments to Solidity function")},Qt=function(){return new Ht("CONNECTION UNAUTHORIZED")},Ft=function(e){return new Ht("PARAMETER ERROR: The value of "+e+" is error")};function Vt(e){var t=e;return Ie(t)&&(t=t.toString("hex")),t?"0x"+t:""}var Yt=Object.freeze({__proto__:null,inputdecimal:function(e){return ze(e)},inputhash:function e(t){if(Ke(t)){if(0===t.indexOf("0x")){if(66===t.length)return t;if(66>t.length)return"0x"+Le(Qe(t).slice(2),64)}return Be(t)}if(Ie(t))return He(t);if(Oe(t)){for(var r=[],n=0;t.length>n;n++)r[n]=e(t[n]);return r}return"0x"+Le(Qe(t).slice(2),64)},inputbytes:function(e){return Ie(e)?He(e):Ke(e)&&0===e.indexOf("0x")?e:Qe(e)},inputcode:function(e,t,r){var n=t,a=r;n||(n="01"),a||(a="");var o="",s="",c=0;if(Ie(e)?(c=e.length,o=e.toString("hex")):Ke(e)&&(0===(o=e).indexOf("0x")&&(o=o.slice(2)),c=o.length/2),"wasm"===n){n="02";var i=new Buffer(4);i.writeUInt32BE(c),s=i.toString("hex")}if(""===o)throw Ft("code");return"0x"+n+s+o+a},inputbignumber:function(e){return W.isBN(e)?e:Ke(e)&&0===e.indexOf("0x")?new W(e.slice(2),16):new W(e,10)},outputdecimal:function(e,t){var r=e;return Ie(r)&&(r=r.toString("hex")),ze(r,t)},outputbytes:Vt,outputhash:function(e){return Vt(e)},outputstring:function(e){var t=e;return Ie(t)&&(t=t.toString("hex")),Me(t)},outputbignumber:function(e){var t=e;return"number"==typeof t?t:Ie(t)?new W(t=t.toString("hex"),16).toNumber():Ke(t)&&0===t.indexOf("0x")?new W(t.slice(2),16).toNumber():new W(t).toNumber()}}),Jt=[[{name:"session_id"}]],Gt={name:"hash",type:"hash"},Xt=Array(Gt);Xt.value=[],Xt.name="hashes",Xt.type="array";var Zt=[{name:"key",type:"bytes"},{name:"value",type:"bytes"}];Zt.name="configs",Zt.type="array";var $t={name:"timestamp",type:"decimal"},er={name:"from",type:"hash"},tr={name:"to",type:"hash"},rr={name:"gas_used",type:"decimal"},nr={name:"identity",type:"hash"},ar={name:"transaction_index",type:"decimal"},or={name:"topic",type:"string"},sr={name:"msg_type",type:"decimal"},cr={name:"sequence",type:"decimal"},ir={name:"group_id",type:"bytes"},ur={name:"return_code",type:"decimal"},pr=[sr],fr=[pr,cr,ir],hr=[pr,cr,ur,ir],yr={name:"block_number",type:"bignumber"},lr=[or];lr.name="topics",lr.type="array",lr.array_type="one";var dr=[er,tr,lr,{name:"log_data",type:"bytes"}];dr.name="log_entry",dr.value=[],dr.type="array";var mr=[{name:"result",type:"decimal"},rr,dr,{name:"output",type:"bytes"}];mr.name="receipt";var vr=[mr];vr.name="receipts",vr.type="array";var gr={name:"transaction_type",type:"decimal"},kr={name:"nonce"},br={name:"period",type:"decimal"},_r={name:"value",type:"decimal"},wr={name:"gas",type:"decimal"},xr={name:"version",type:"decimal",value:2},Cr=[];Cr.name="extensions",Cr.type="array";var qr={name:"data",type:"bytes"},Er=[{name:"signature",type:"bytes"}];Er.name="signature",Er.type="array",Er.array_type="one";var Sr=[Gt,gr,$t,kr,br,er,tr,_r,wr,ir,xr,qr,Er,Cr];Sr.name="transaction";var Tr=[Gt,gr,$t,kr,br,er,tr,_r,wr,ir,xr,qr,Er,Cr];Tr.name="transactions",Tr.type="array";var Pr=[Sr,mr,yr,ar];Pr.name="transaction_infos",Pr.type="array";var Nr=j(Sr);Nr.type="array",Nr.value=[],Nr.name="transaction_list";var Br=j(mr);Br.type="array",Br.value=[],Br.name="receipt_list";var Ir=[Gt,{name:"version",type:"decimal"},yr,{name:"parent_hash",type:"hash"},{name:"transaction_root",type:"bytes"},{name:"receipt_root",type:"bytes"},{name:"state_root",type:"bytes"},rr,$t,{name:"log_bloom",type:"bytes"}];Ir.name="block_header";var Rr=[Nr,Br,{name:"consensus_proof",type:"bytes"}];Rr.name="block_body";var Kr=[Ir,Rr];Kr.name="block";var Ar={name:"balance",value:"",type:"decimal"},Or={name:"recover_key",type:"bytes"},Dr={name:"recover_time",type:"decimal"},Lr={name:"status",type:"decimal"},Ur={name:"code",type:"bytes"},zr={name:"storage_root",type:"bytes"},Wr={name:"code_hash",type:"hash"},jr={name:"encryption_key",type:"bytes"},Hr={name:"auth_key",type:"bytes"},Mr={name:"auth_weight",type:"decimal"},Qr=[Hr,Mr];Qr.name="auth_map",Qr.type="array",Qr.array_type=2,Qr.rlp=!0,Qr.mapInfo={key:Hr,value:Mr};var Fr=[nr,Ar,Or,Dr,Lr,Ur,zr,Wr,jr,[{name:"acc_version",type:"decimal",value:2}],Qr],Vr=[nr,Ar,Or,Dr,Lr,Ur,zr,Wr,jr,Hr,Mr];Fr.name="data";var Yr=Fr,Jr={name:"node_id",type:"bytes",value:"0x00"},Gr={name:"public_key",type:"bytes"},Xr={name:"node_role",type:"decimal"},Zr={name:"node_state",type:"decimal"},$r=[{name:"ip",type:"string"},{name:"port",type:"decimal"}];$r.name="endpoints",$r.type="array";var en=[[Jr,Gr,Xr,Zr,$r],{name:"isConnected",type:"decimal"}];en.name="node_status",en.type="array";var tn=[{name:"total_node_count",type:"decimal"},{name:"total_consensus_node_count",type:"decimal"},{name:"total_non_consensus_node_count",type:"decimal"},{name:"total_connected_consensus_node_count",type:"decimal"},{name:"total_connected_non_consensus_node_count",type:"decimal"},en];tn.name="p2p_status";var rn=[Jr,Gr,Xr,Zr,$r];rn.name="node_info",rn.type="array";var nn=[{name:"syncing",type:"decimal"},{name:"my_best",type:"decimal"},{name:"target",type:"decimal"}];nn.name="sync_status";var an={name:"unverified_queue_limit",type:"decimal"},on={name:"verified_queue_limit",type:"decimal"},sn={name:"unverified_queue_usage",type:"decimal"},cn={name:"verified_queue_usage",type:"decimal"},un=[an,on,sn,cn];un.name="transaction_cache_info";var pn=[an,on,{name:"verified_parent_not_found_queue_limit",type:"decimal"},sn,cn,{name:"verified_parent_not_found_queue_usage",type:"decimal"},{name:"unverified_max_block_number",type:"decimal"},{name:"verified_max_block_number",type:"decimal"},{name:"verified_parent_not_found_max_block_number",type:"decimal"}];pn.name="block_cache_info";var fn={name:"code",type:"bytes"},hn={name:"type",type:"decimal",value:0},yn={name:"filter_id",type:"decimal"},ln=[{name:"type",type:"bytes"},{name:"phase",type:"string"},{name:"n",type:"decimal"},{name:"f",type:"decimal"},{name:"current_leader",type:"bytes"},{name:"my_id",type:"bytes"},{name:"current_view",type:"decimal"},{name:"last_exec_seq",type:"decimal"},{name:"propose_size",type:"decimal"},{name:"propose_timeout_interval",type:"decimal"},{name:"normal_timeout_interval",type:"decimal"},{name:"viewchange_timeout_interval",type:"decimal"}];ln.name="info";var dn=[{name:"black_list",type:"hash"}];dn.name="black_list",dn.type="array";var mn=[{name:"type",type:"decimal"},{name:"proof",type:"bytes"}];mn.name="block_proof_info";var vn={name:"block_number",type:"decimal"},gn=[{name:"data",type:"bytes"},{name:"next_key_begin_index",type:"decimal"},{name:"next_key_end_index",type:"decimal"}];gn.name="nodes",gn.type="array";var kn=[vn,{name:"state_root",type:"bytes"},gn];kn.name="proof";var bn={name:"root",type:"bytes"},_n={name:"index",type:"decimal"},wn={name:"size",type:"decimal"},xn={name:"branch",type:"decimal"},Cn=[vn,bn,_n,wn,xn];Cn.name="proof";var qn=[vn,bn,_n,wn,xn];qn.name="receipt_proof";var En=[mn,Ir];En.name="header_infos",En.type="array";var Sn={name:"block_hash",type:"hash"},Tn=[Sn,vr];Tn.name="block_receipts",Tn.type="array";var Pn=[Tr,vr,{name:"consensus_proof",type:"bytes"}];Pn.name="body";var Nn=[Sn,Pn];Nn.name="block_body",Nn.type="array";var Bn=25,In=124,Rn="CreateAccount",Kn="QueryTransactionReceipt",An="TransferBalance",On="SetRecoverkey",Dn="PreResetPubKey",Ln="ResetPubKey",Un="UpdateAuthMap",zn="QueryLastBlock",Wn="QueryBlockHeader",jn="QueryLastBlockHeader",Hn="QueryBlock",Mn="QueryTransaction",Qn="QueryAccount",Fn="QueryContract",Vn="DeployContract",Yn="UpdateContract",Jn="CallContract",Gn="EncryptedTransaction",Xn="EventContract",Zn="EventFetch",$n={},ea={};function ta(e,t){return Ke(e)&&"0x"===e.substr(0,2)&&66===e.length?t?e.substr(2):e:Be(e,t)}function ra(e,t){for(var r=[],n=0;e.length>n;n++){var a=e[n];if(!Array.isArray(a)||a.rlp){var o=t[a.name]||a.value||"",s=a.type;a.rlp&&(s="bytes");var c=Yt["input"+s];c&&(o="code"===s&&t.type?c(o,t.type,t.parameters):c(o)),r[n]=o}else r[n]=ra(a,t)}return r}function na(e,t){var r=ea[e];if(!r)throw Error(e+" is not api");return ra(r.data,t)}function aa(e,t,r){for(var n=[],a=0;r.length>a;a++){var o=r[a];if(!Array.isArray(o)||o.rlp){var s=o.name,c=t[s]||o.value||"";if("msg_type"===s)c=ea[e].request_msg_type;else if("transaction_type"===s)c=ea[e].transaction_type,e===ce.LocalTransaction&&(c=t.type);else{var i=o.type;o.rlp&&(i="bytes");var u=Yt["input"+i];u&&(c=u(c))}n[a]=c}else n[a]=aa(e,t,o)}return n}function oa(e,t){ue("RequestProcess ".concat(e),t);var r=ea[e];if(!r)throw Error(e+" is not api");return aa(e,t,r.request)}function sa(e,t){if(Ie(t)){var r=Yt["output"+e.type];return r?r(t):t.toString("hex")}return t||e.value||""}function ca(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=t.name,a=t.type,o=r;if(Array.isArray(t)&&e)if("array"===a&&Array.isArray(e)){var s=[];if("one"===t.array_type)e.forEach((function(e){s.push(sa(t[0],e))}));else if("number"==typeof t.array_type)for(var c=t.slice(0),i=0;e.length>i;i+=2)s.push(ia([e[i],e[i+1]],c));else e.forEach((function(e){s.push(ia(e,t))}));var u=n||"arr";o[u]=s}else if(t.rlp){var p=rt(e);o=ca(p,t,o)}else n?o[n]=ia(e,t):o=ia(e,t,o);else o[n]=sa(t,e);return o}function ia(e,t){for(var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=r,a=0;t.length>a;a++){var o=(Array.isArray(e)?e[a]:e)||"",s=t[a];n=ca(o,s,n)}return n}function ua(e,t){switch(e){case me.ACCOUNT:return function(e){return ia(e,[[Vr]])}(t);case me.CONTRACT:return function(e){return ia(e,[[Fr]])}(t);case me.TOPICS:return function(e){return ia(e,[[[or,{name:"data",type:"bytes"}]]])}(t);case me.BLOCK:return function(e){return ia(e,[[Ir]])}(t)}}function pa(e,t,r){var n=e;if(!n)throw Error("aes empty key or iv or tag!");var a=function(e,t){if(!t||!e)throw Error("aes empty key or data!");var r=e,n=t;r=Fe(r),n=Fe(n);var a=0,o=12,s=r.slice(a,o),c=r.slice(a+=12,o+=16),i=r.slice(a+=16,o=r.length),u=O("aes-128-gcm",n,s);return u.setAuthTag(c),"0x"+u.update(i).toString("hex")}((n=Fe(n)).slice(258,n.length),Ot(t,r));return ia(rt(a),Sr)}function fa(e,t,r,n){var a=function(e){return ea[e].transaction_type}(e);ue("[NEW JS SDK] getTxData:",t);var o={type:a,group_id:t.group_id||"0x0000000000000000000000000000000000000000",timestamp:Date.now(),nonce:t.nonce||Dt(),period:t.period||100,from:t.from||r.from,to:t.to,value:t.value||0,gas:t.gas||1e10,version:t.tx_version||2,extensions:[],data:t.data};r.sequence&&(o.sequence=r.sequence);var s=t.hash||Be(tt([o.type,o.timestamp,o.nonce,o.period,o.from,o.to,o.value,o.gas,o.group_id,o.version,o.data,o.extensions])),c=At(s,n||r.userPrivateKey);return o.hash=s,o.signature=r.isSign?He(c):"",ue("[NEW JS SDK] getTxData return param:",o),o}function ha(e,t,r,n){return{type:t.transaction_type,group_id:e.group_id||"0x0000000000000000000000000000000000000000",timestamp:r,nonce:e.nonce||Dt(),period:e.period||100,from:"0x0",to:"0x0",value:e.value||0,gas:e.gas||1e7,version:e.tx_version||2,extensions:[],data:e.data||"0x0",sequence:t.sequence,hash:n,signature:"0x0"}}function ya(e,t){return oa(e,t)}function la(e,t){return Ge().abi(e,Buffer.from(t))}function da(e,t){return ma.apply(this,arguments)}function ma(){return(ma=p(u.mark((function e(t,r){var n;return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(ue("[utils/mychain] getUserInfo"),n=Kt(Ze(t,r),r)){e.next=4;break}throw Error("[utils/mychain] 获取用户信息失败，请检查 account 相关配置");case 4:return e.abrupt("return",n);case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function va(e){return Me(e)}function ga(e){var t=e.startsWith("0x")?e.substring(2):e;return Buffer.from(t,"hex")}function ka(e){return ga(e).toString("base64")}function ba(e){return e.startsWith("0x")?e.substring(2):e}[{name:Rn,topics:"create_account",request_msg_type:2,response_msg_type:14,transaction_type:0,request:[sr,[fr,Sr]],response:[sr,[hr,Gt]],data:Fr},{name:An,topics:"transfer_balance",request_msg_type:3,response_msg_type:15,transaction_type:1,request:[sr,[fr,Sr]],response:[sr,[hr,Gt]],data:[]},{name:On,topics:"set_recover_key",request_msg_type:4,response_msg_type:16,transaction_type:20,request:[sr,[fr,Sr]],response:[sr,[hr,Gt]],data:[Or]},{name:Dn,topics:"",request_msg_type:5,response_msg_type:17,transaction_type:21,request:[sr,[fr,Sr]],response:[sr,[hr,Gt]],data:[]},{name:Ln,topics:"",request_msg_type:6,response_msg_type:18,transaction_type:22,request:[sr,[fr,Sr]],response:[sr,[hr,Gt]],data:[Hr,Mr]},{name:Un,topics:"",request_msg_type:7,response_msg_type:19,transaction_type:23,request:[sr,[fr,Sr]],response:[sr,[hr,Gt]],data:[Hr,Mr]},{name:"FreezeAccount",topics:"",request_msg_type:24,response_msg_type:25,transaction_type:Bn,request:[sr,[fr,Sr]],response:[sr,[hr,Gt]],data:[]},{name:"FreezeContract",topics:"",request_msg_type:28,response_msg_type:29,transaction_type:Bn,request:[sr,[fr,Sr]],response:[sr,[hr,Gt]],data:[]},{name:"NativeDepositData",request_msg_type:36,response_msg_type:37,transaction_type:40,request:[sr,[fr,Sr]],response:[sr,[hr,Gt]],data:[{name:"payload",type:"bytes"}]},{name:zn,request_msg_type:51,response_msg_type:58,transaction_type:"",request:[sr,fr],response:[sr,[hr,Kr]],data:[]},{name:Wn,request_msg_type:52,response_msg_type:59,transaction_type:"",request:[sr,[fr,yr,Gt]],response:[sr,[hr,Ir]],data:[]},{name:jn,request_msg_type:66,response_msg_type:67,transaction_type:"",request:[sr,fr],response:[sr,[hr,Ir]],data:[]},{name:Hn,request_msg_type:53,response_msg_type:60,transaction_type:"",request:[sr,[fr,yr,Gt]],response:[sr,[hr,Kr]],data:[]},{name:Mn,request_msg_type:55,response_msg_type:62,transaction_type:"",request:[sr,[fr,Gt]],response:[sr,[hr,Sr,yr,ar]],data:[]},{name:Kn,request_msg_type:56,response_msg_type:63,transaction_type:"",request:[sr,[fr,Gt]],response:[sr,[hr,mr,yr,ar]],data:[]},{name:"QueryTransactionList",request_msg_type:94,response_msg_type:95,transaction_type:"",request:[sr,[fr,Gt]],response:[sr,[hr,Tr]],data:[]},{name:"QueryTransactionAndReceipt",request_msg_type:96,response_msg_type:97,transaction_type:"",request:[sr,[fr,Gt]],response:[sr,[hr,Pr]],data:[]},{name:Qn,request_msg_type:54,response_msg_type:61,transaction_type:"",request:[sr,[fr,Gt]],response:[sr,[hr,Fr]],data:[]},{name:Fn,request_msg_type:64,response_msg_type:65,transaction_type:"",request:[sr,[fr,Gt]],response:[sr,[hr,Yr]],data:[]},{name:"QueryTimestamp",request_msg_type:50,response_msg_type:57,transaction_type:"",request:[sr,fr],response:[sr,[hr,$t]],data:[]},{name:"QueryP2PStatus",request_msg_type:100,response_msg_type:101,transaction_type:"",request:[sr,fr,Jr],response:[sr,[hr,tn]],data:[]},{name:"QueryConsensusStatus",request_msg_type:102,response_msg_type:103,transaction_type:"",request:[sr,[fr,Jr]],response:[sr,[hr,ln]],data:[]},{name:"QueryCommonConsensusStatus",request_msg_type:200,response_msg_type:201,transaction_type:"",request:[sr,[fr,Jr]],response:[sr,[hr,{name:"type",type:"decimal"},{name:"info",type:"bytes"}]],data:[]},{name:"QuerySyncStatus",request_msg_type:104,response_msg_type:105,transaction_type:"",request:[sr,[fr,Jr]],response:[sr,[hr,nn]],data:[]},{name:"QueryTransactionCacheStatus",request_msg_type:106,response_msg_type:107,transaction_type:"",request:[sr,[fr,Jr]],response:[sr,[hr,un]],data:[]},{name:"QueryBlockCacheStatus",request_msg_type:108,response_msg_type:109,transaction_type:"",request:[sr,[fr,Jr]],response:[sr,[hr,pn]],data:[]},{name:"QueryContractNodesStatus",request_msg_type:110,response_msg_type:111,transaction_type:"",request:[sr,fr],response:[sr,[hr,rn]],data:[]},{name:"QueryContractConfigStatus",request_msg_type:112,response_msg_type:113,transaction_type:"",request:[sr,fr],response:[sr,[hr,Zt]],data:[]},{name:"QueryLogLevel",request_msg_type:152,response_msg_type:153,transaction_type:"",request:[sr,fr],response:[sr,[hr,{name:"level",type:"decimal"}]],data:[]},{name:"UpdateBlackList",request_msg_type:158,response_msg_type:159,transaction_type:"",request:[sr,[fr,dn,Er]],response:[sr,hr],data:[]},{name:"QueryBlockProof",request_msg_type:68,response_msg_type:69,transaction_type:"",request:[sr,[fr,yr,Gt]],response:[sr,[hr,mn]],data:[]},{name:"QueryLatestStateProof",request_msg_type:70,response_msg_type:71,transaction_type:"",request:[sr,[fr,nr]],response:[sr,[hr,kn]],data:[]},{name:"QueryStateProof",request_msg_type:80,response_msg_type:81,transaction_type:"",request:[sr,[fr,nr]],response:[sr,[hr,kn]],data:[]},{name:"QueryTransactionProof",request_msg_type:72,response_msg_type:73,transaction_type:"",request:[sr,[fr,Gt]],response:[sr,[hr,Cn]],data:[]},{name:"QueryReceiptProof",request_msg_type:82,response_msg_type:83,transaction_type:"",request:[sr,[fr,Gt]],response:[sr,[hr,qn]],data:[]},{name:"QueryBlockHeaderInfos",request_msg_type:74,response_msg_type:75,transaction_type:"",request:[sr,[fr,Gt,yr,{name:"max_amount",type:"decimal"},{name:"reverse",type:"decimal"}]],response:[sr,[hr,En]],data:[]},{name:"QueryBlockReceiptInfos",request_msg_type:76,response_msg_type:77,transaction_type:"",request:[sr,[fr,Gt]],response:[sr,[hr,Tn]],data:[]},{name:"QueryBlockBodyInfos",request_msg_type:78,response_msg_type:79,transaction_type:"",request:[sr,[fr,Gt]],response:[sr,[hr,Nn]],data:[]},{name:Vn,request_msg_type:8,response_msg_type:20,transaction_type:10,request:[sr,[fr,Sr]],response:[sr,[hr,Gt]],data:[fn]},{name:Yn,request_msg_type:10,response_msg_type:22,transaction_type:12,request:[sr,[fr,Sr]],response:[sr,[hr,Gt]],data:[fn]},{name:Jn,request_msg_type:9,response_msg_type:21,transaction_type:11,request:[sr,[fr,Sr]],response:[sr,[hr,Gt]],data:[{name:"parameter",type:"bytes"}]},{name:"EventAccount",request_msg_type:120,response_msg_type:In,transaction_type:"",request:[sr,[fr,hn,nr]],response:[sr,[hr,yn]],data:[]},{name:Xn,request_msg_type:121,response_msg_type:In,transaction_type:"",request:[sr,[fr,hn,nr]],response:[sr,[hr,yn]],data:[]},{name:"EventTopics",request_msg_type:122,response_msg_type:In,transaction_type:"",request:[sr,[fr,hn,[or]]],response:[sr,[hr,yn]],data:[]},{name:"EventBlock",request_msg_type:123,response_msg_type:In,transaction_type:"",request:[sr,[fr,hn,cr]],response:[sr,[hr,yn]],data:[]},{name:Zn,request_msg_type:125,response_msg_type:136,transaction_type:"",request:[sr,[fr,yn]],response:[sr,[hr,{name:"event_type",type:"decimal"},{name:"event_data",type:"bytes"}]],data:[]},{name:"EventCancel",request_msg_type:134,response_msg_type:135,transaction_type:"",request:[sr,[fr,[yn]]],response:[sr,[pr,cr,ur,ir]],data:[]},{name:"LocalTransaction",request_msg_type:1,response_msg_type:13,request:[sr,[fr,yr,Sr]],response:[sr,[hr,Gt,mr]],data:[]},{name:Gn,request_msg_type:800,response_msg_type:801,transaction_type:500,request:[sr,[fr,Sr]],response:[sr,[hr,Gt]],data:[{name:"encrypted_tx",type:"bytes"}]}].forEach((function(e){ea[e.name]=e,$n[e.response_msg_type]=e}));var _a=new E;function wa(e,t){return _a.encode(e,t).slice(2)}function xa(e,t,r){var n,a,o;if(r){ue("[RestProvider] parseReceiptReturnOutput methodName:",e),ue("[RestProvider] parseReceiptReturnOutput output:",r);var s=null===(n=t.schema)||void 0===n||null===(a=n[e])||void 0===a||null===(o=a.results)||void 0===o?void 0:o[0];if(ue("[RestProvider] parseReceiptReturnOutput type:",s),!t||!s)throw Error("[RestProvider] parseReceiptReturnOutput not find abi schema for parse output: ".concat(r));return"function"!=typeof t.fromBuffer?null:t.fromBuffer(s,Buffer.from(r,"hex"))}}function Ca(e){return"0x".concat(Buffer.from(e,"base64").toString("hex"))}function qa(t,r,n){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:function(e){return e};ue("[RestProvider] getTransactionRequest args:",t,r,n);var o=fa(t,e(e({},r),{},{to:ta(r.to),from:ta(r.from),data:na(t,r.data)[0]||""}),n);ue("[RestProvider] getTransactionRequest txData:",o);var s=ya(t,o);ue("[RestProvider] getTransactionRequest rlpRawData:",s);var c=B(a(s));return ue("[RestProvider] getTransactionRequest rlpData:",c),{txData:o,rlpData:c}}function Ea(e,t,r){if(!r)return"";var n=t.find((function(t){return t.name===e})),a=function(e,t){return _a.decode(e,ga(t))}((Oe(n.outputs)?n.outputs:[]).map((function(e){return e.type})),r);return 1===a.length?a[0]:a}function Sa(e,t){if(e.filter((function(e){return!(!0===Ae(e)&&!1===Oe(e)&&!1===Re(e))})).length!==t.length)throw Mt()}var Ta=function(t){l(n,_e);var r=d(n);function n(t,a){return h(this,n),r.call(this,e({contractType:ae.solidity},t),a)}return y(n,[{key:"generateDeployCode",value:function(e,t){if(t)throw Error("还未支持参数");return"0x01"+e.toString("utf-8")}},{key:"generateCallCode",value:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],r="",n=JSON.parse(this.abi),a=0;n.length>a;a++){var o=n[a],s=[];Oe(o.inputs)&&(s=o.inputs);for(var c=[],i=[],u=0;s.length>u;u++){var p=s[u];c.push(p.type),i.push(p.name)}if("function"===o.type&&o.name===e&&t.length===c.length){var f=Wt(o,c),h="0x"+Ne(f).slice(0,8);Sa(t,c),r=h+wa(c,t);break}}if(!r)throw Error("未找到对应的方法，请检查方法名和参数是否正确。");return r}},{key:"parseReturnOutput",value:function(e,t){return Ea(e,JSON.parse(this.abi),t)}}]),n}(),Pa=function(){};Pa.prototype.encodeParams=function(e,t,r,n){var a="";if(!1===Ke(e)||!1===Ae(t)||!1===Oe(r))return a;if(!1===Ae(t.schema)||!t.schema[e]||!r)return a;if(!1===Ae(t.schema[e])||!1===Ae(t.schema[e].fields))return a;var o=Object.keys(t.schema[e].fields);if(Oe(r)&&o.length!==r.length)return a;var s={},c=0;r&&Oe(r)&&o.forEach((function(e){s[e]=r[c],c++}));var i=t.toBuffer(e,s),u=t.toBuffer("string",e),p=t.toBuffer("bytes",i),f=q.concat([u,p]);if(n){var h=new q(4);h.writeUInt32BE(f.length),a=h.toString("hex")+f.toString("hex")}else a=f.toString("hex");return a},Pa.prototype.decodeParam=function(e,t,r){return e&&t&&r?!1==("function"==typeof e.fromBuffer)?null:e.fromBuffer(t,r):null};var Na=new Pa,Ba=function(t){l(n,_e);var r=d(n);function n(t,a){var o;return h(this,n),(o=r.call(this,e({contractType:ae.assemblyscript},t),a)).abier=void 0,o.abier=la(t.contractName,o.abi),o}return y(n,[{key:"generateDeployCode",value:function(e,t){if(t)throw Error("还未支持参数");var r=e.toString("hex"),n=function(e){var t=new q(4);return t.writeUInt32BE(e),t.toString("hex")}(r.length/2);return"0x02"+n+r}},{key:"generateCallCode",value:function(e,t){var r="",n=this.abier.schema[e].fields||{},a=[];for(var o in n)a.push({key:o,type:n[o]});return(r=Na.encodeParams(e,this.abier,t||[]))&&(r="0x"+r),r}},{key:"parseReturnOutput",value:function(e,t){var r;if(t){var n=t;0===n.indexOf("0x")&&(n=n.slice(2));var a=null===(r=this.abier.schema[e])||void 0===r?void 0:r.results,o=Na.decodeParam(this.abier,a&&a.length>0&&a[0],Buffer.from(n,"hex"));return 1===o.length?o[0]:o}}}]),n}();function Ia(e){return new Promise((function(t){setTimeout((function(){t()}),e)}))}var Ra=3e4,Ka=[3e4,1e4,5e3,2e3,1e3],Aa=function(e){l(n,H);var t,r=d(n);function n(){return h(this,n),r.apply(this,arguments)}return y(n,[{key:"queryTransactionReceiptWithRetry",value:(t=p(u.mark((function e(t,r){var n,a=arguments;return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((n=a.length>2&&void 0!==a[2]?a[2]:Ka.length-1)>=0){e.next=6;break}return e.next=4,Ia(3e4);case 4:e.next=8;break;case 6:return e.next=8,Ia(Ka[n]);case 8:return e.prev=8,e.next=11,this.queryTransactionReceipt(t);case 11:case 28:return e.abrupt("return",e.sent);case 14:if(e.prev=14,e.t0=e.catch(8),"404"===e.t0.code||"414"===e.t0.code){e.next=19;break}throw ue("code is ".concat(e.t0.code,", stop retry")),e.t0;case 19:if(!r){e.next=24;break}if(Date.now()<=r){e.next=22;break}throw Error("queryTransactionReceipt timeout");case 22:e.next=26;break;case 24:if(0!==n){e.next=26;break}throw Error("queryTransactionReceipt retry times out");case 26:return e.next=28,this.queryTransactionReceiptWithRetry(t,r,n-1);case 29:case"end":return e.stop()}}),e,this,[[8,14]])}))),function(e,r){return t.apply(this,arguments)})}]),n}(),Oa={ecdhCurve:"secp256k1:prime256v1"},Da=function(){function t(e,r){var n=e.host,a=e.port,o=e.clients,s=e.timeout,c=e.cert,i=e.ca,u=e.key,p=e.passphrase,f=e.checkServerIdentity,y=e.sendCallback;h(this,t),this.callback=void 0,this.sendCallback=void 0,this.retryNum=void 0,this.clients=void 0,this.currentClient=void 0,this.host=void 0,this.port=void 0,this.timeout=void 0,this.cert=void 0,this.ca=void 0,this.key=void 0,this.passphrase=void 0,this.checkServerIdentity=void 0,this.socket=void 0,this.callback=r,this.sendCallback=y||"",this.retryNum=0;var l=n,d=a,m=o;l&&d?(Array.isArray(o)||(m=[]),m=[{host:l,port:d}].concat(m)):Array.isArray(o)&&o.length&&(l=o[0].host,d=o[0].port),this.clients=m||[],this.currentClient=0,this.resetConnect({host:n,port:a,timeout:s,cert:c,ca:i,key:u,passphrase:p,checkServerIdentity:f})}return y(t,[{key:"doCallback",value:function(e,t){"function"==typeof this.callback&&this.callback(e,t)}},{key:"setConfig",value:function(e){var t=e.port,r=e.timeout,n=e.cert,a=e.ca,o=e.key,s=e.passphrase,c=e.checkServerIdentity;this.host=e.host||"localhost",this.port=t||"18130",this.timeout=r||3e4,this.cert=n||"",this.ca=a||"",this.key=o||"",this.passphrase=s||"",this.checkServerIdentity=c}},{key:"connect",value:function(){var e=this,t=M.createSecureContext({cert:this.cert,ca:[this.ca],key:this.key,passphrase:this.passphrase,ciphers:"ALL",ecdhCurve:Oa.ecdhCurve}),r={host:this.host,port:this.port,secureContext:t,checkServerIdentity:void 0};this.checkServerIdentity||(r.checkServerIdentity=function(){});var n=M.connect(r,(function(){n.authorized?(e.retryNum=0,e.doCallback()):e.doCallback(Qt)}));return n}},{key:"resetConnect",value:function(t){var r=this;this.setConfig(t),this.socket=this.connect();var n=null;this.socket.on("readable",(function(e){if(n||(n=r.socket.read(16)),n){var t=$e(n),a=r.socket.read(t-16);if(a){var o=function(e,t){return{total_len:$e(e),version:e.readInt16BE(4),magic1:e.readInt8(6),magic2:e.readInt8(7),reserved1:e.readInt32BE(8),reserved2:e.readInt32BE(12),data:rt(t)}}(n,a);n=null,"function"==typeof r.sendCallback&&r.sendCallback(e,o.data)}}})),this.socket.on("close",(function(){if(4>r.retryNum)r.retryNum++,setTimeout((function(){r.resetConnect(t)}),1e3);else{r.currentClient++;var n=r.clients[r.currentClient];n&&setTimeout((function(){r.retryNum=0,r.resetConnect(e(e({},t),{},{host:n.host,port:n.port}))}),1e3)}})),this.socket.on("error",(function(e){console.error(e)}))}},{key:"send",value:function(e){var t=function(e){var t=Array.isArray(e)?et(e):e,r=16+t.length,n=q.alloc(16);return n.writeInt32BE(r,0),n.writeInt16BE(2,4),n.writeInt8(51,6),n.writeInt8(119,7),n.writeInt32BE(0,8),n.writeInt32BE(0,12),q.concat([n,t],r)}(e);this.socket.write(t,"buffer",(function(){}))}}]),t}(),La=function(e,t){return new Da(e,t)};La.setEcdhCurve=function(e){Oa.ecdhCurve=e},La.setPrime256v1EcdhCurve=function(){this.setEcdhCurve("prime256v1")};var Ua=function(){function t(r,n){var a=this;h(this,t),this.sender=null,this.callbacks={},this.sendCache=[],this.sessionId="",this.callback=null,this.currentSequence=1,this.userPublicKey=void 0,this.userSignature=void 0,this.userPrivateKey=void 0,this.userRecoverPrivateKey=void 0,this.userRecoverPublicKey=void 0,this.options=void 0,this.userKeySeted=!1,this.setUserKey=p(u.mark((function e(){var t,r,n,o,s,c,i;return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!a.userKeySeted){e.next=2;break}return e.abrupt("return");case 2:return r=(t=a.options).accountPrivateKey,n=t.accountPrivateKeyPassword,o=t.accountRecoverPrivateKey,s=t.accountRecoverPrivateKeyPassword,e.next=5,da(r,n);case 5:if(c=e.sent,!o){e.next=12;break}return e.next=9,da(o,s);case 9:a.userRecoverPrivateKey=De((i=e.sent).privateKey),a.userRecoverPublicKey=De(i.publicKey);case 12:a.userPublicKey=De(c.publicKey||"0x97466f2b32bc3bb76d4741ae51cd1d8578b48d3f1e68da206d47321aec267ce78549b514e4453d74ef11b0cd5e4e4c364effddac8b51bcfc8de80682f952896f"),a.userPrivateKey=De(c.privateKey||"0x3ecb44df2159c26e0f995712d4f39b6f6e499b40749b1cf1246c37f9516cb6a4"),a.userKeySeted=!0;case 15:case"end":return e.stop()}}),e)}))),this.sendCallback=function(e,t){var r=function(e){var t=parseInt(e[0],16);e[0]&&Ie(e[0])&&(t=parseInt(e[0].toString("hex"),16));var r=$n[t];if(!r){if(e[0]&&e[0][0]){var n=ia(e,Jt);return n.api="Handshake",n}throw Error('msg_type "'+t+'" is not error')}var a=r.name,o=ia(e,r.response);return o.api=a,o}(t);if(ue("[TSL connector] sendCallback get data",r),"Handshake"===r.api){if(a.sessionId=r.session_id||"","function"==typeof a.callback&&(a.callback(e,r),a.callback=null),a.sendCache.length)for(var n=a.sendCache.shift();n;)a._send(n.rlpData),n=a.sendCache.shift()}else{var o=a.callbacks[r.sequence];"function"==typeof o&&o(0!==r.return_code?new ve("[TLSConnector] request failed, code: ".concat(r.return_code),r.return_code+"",r):e,r)}},this.getSequence=function(){return a.currentSequence++},this.getBaseData=p(u.mark((function e(){return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.setUserKey();case 2:return e.abrupt("return",{isSign:void 0===a.options.isSign||a.options.isSign,from:a.options.account,userPrivateKey:a.userPrivateKey,userPublicKey:a.userPublicKey,userRecoverPrivateKey:a.userRecoverPrivateKey,userRecoverPublicKey:a.userRecoverPublicKey});case 3:case"end":return e.stop()}}),e)}))),this._send=function(e){ue("[TSL connector] send data",e),a.sender.send(e)},this.handshake=p(u.mark((function e(){var t,r;return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return ue("[TSL connector] handshake..."),r=void 0===(t=a.options.nonce)?"hello world":t,e.next=4,a.setUserKey();case 4:a.userSignature=At(r,a.userPrivateKey),a.sender.send([r,a.userPrivateKey,a.userSignature,0]);case 6:case"end":return e.stop()}}),e)}))),this.callback=n,this.options=r,this.sender=La(e(e({},r),{},{sendCallback:this.sendCallback}),(function(e){e&&(console.error(e),n&&n(e)),a.handshake()}))}var r;return y(t,[{key:"send",value:(r=p(u.mark((function e(t,r){var n=this;return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,a){n.callbacks[r]=function(t,r){t?a(t):e(r)},n.sessionId?n._send(t):n.sendCache.push({sequence:r+"",rlpData:t})})));case 1:case"end":return e.stop()}}),e)}))),function(e,t){return r.apply(this,arguments)})}]),t}();function za(e,t){var r=t.getSequence(),n=oa(zn,{sequence:r});return t.send(n,r)}function Wa(e,t){var r=t.getSequence(),n=oa(Wn,{sequence:r,block_number:e.blockNumber||0,hash:e.hash||"0x0"});return t.send(n,r)}function ja(e,t){var r=t.getSequence(),n=oa(jn,{sequence:r});return t.send(n,r)}function Ha(e,t){var r=t.getSequence(),n=oa(Hn,{sequence:r,block_number:e.blockNumber||0,hash:e.hash||"0x0"});return t.send(n,r)}function Ma(e,t){var r=t.getSequence(),n={sequence:r,group_id:e.groupId||"0x0000000000000000000000000000000000000000",hash:ta(e.account)},a=oa(Qn,n);return t.send(a,r)}function Qa(e,t){var r=t.getSequence(),n={sequence:r,group_id:e.groupId||"0x0000000000000000000000000000000000000000",hash:ta(e.hash)},a=oa(Mn,n);return t.send(a,r)}function Fa(e,t){return Va.apply(this,arguments)}function Va(){return Va=p(u.mark((function e(t,r){var n,a,o;return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.getSequence(),a={sequence:n,group_id:t.groupId||"0x0000000000000000000000000000000000000000",hash:ta(t.hash)},o=oa(Kn,a),e.next=5,r.send(o,n);case 5:return e.abrupt("return",e.sent);case 7:case"end":return e.stop()}}),e)}))),Va.apply(this,arguments)}function Ya(e,t){var r=t.getSequence(),n={sequence:r,hash:ta(e.contractName)},a=oa(Fn,n);return t.send(a,r)}function Ja(e,t){return Ga.apply(this,arguments)}function Ga(){return Ga=p(u.mark((function e(t,r){var n,a,o,s,c,i,p,f;return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.getSequence(),a=ta(t.from),o=ta(t.to),e.next=5,r.getBaseData();case 5:return(s=e.sent).sequence=n,c=[],t.authMap.forEach((function(e){c.push(e.authKey),c.push(e.authWeight)})),i={identity:o,recover_key:t.recoveryKey,auth_map:tt(c)},p=fa(Rn,{from:a,to:o,data:tt(na(Rn,i))},s),f=oa(Rn,p),e.next=14,r.send(f,n);case 14:return e.abrupt("return",e.sent);case 16:case"end":return e.stop()}}),e)}))),Ga.apply(this,arguments)}function Xa(e,t){return Za.apply(this,arguments)}function Za(){return Za=p(u.mark((function e(t,r){var n,a,o,s,c;return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.getSequence(),a=ta(t.account),e.next=4,r.getBaseData();case 4:return(o=e.sent).sequence=n,s=fa(Un,{from:a,to:a,data:tt(na(Un,{auth_key:t.authMap[0].key,auth_weight:100}))},o),c=oa(Un,s),e.next=12,r.send(c,n);case 12:return e.abrupt("return",e.sent);case 14:case"end":return e.stop()}}),e)}))),Za.apply(this,arguments)}function $a(e,t){return eo.apply(this,arguments)}function eo(){return eo=p(u.mark((function e(t,r){var n,a,o,s,c,i,p;return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.getSequence(),a=t.contract,e.next=4,r.getBaseData();case 4:if((o=e.sent).sequence=n,s=a.generateDeployCode(t.code),c=fa(Vn,{from:ta(t.from),to:ta(a.contractName),data:na(Vn,{code:s})[0]||""},o),i=oa(Vn,c),!t.encrypt){e.next=17;break}return p=ha({from:ta(t.from),to:ta(a.contractName),data:na(Gn,{encrypted_tx:Lt(t.publicKey,i,t.aesKey,c.hash,t.encryptType)})[0]||""},o,c.timestamp,c.hash),e.next=13,r.send(oa(Gn,p),n);case 13:return e.abrupt("return",e.sent);case 17:return e.next=19,r.send(i,n);case 19:return e.abrupt("return",e.sent);case 21:case"end":return e.stop()}}),e)}))),eo.apply(this,arguments)}function to(e,t){return ro.apply(this,arguments)}function ro(){return ro=p(u.mark((function e(t,r){var n,a,o,s,c;return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.getSequence(),e.next=3,r.getBaseData();case 3:return(a=e.sent).sequence=n,0===(o=t.code).indexOf("0x")&&(o=o.slice(2)),o="0x"+(t.vm===oe.EVM?"01":"02")+o,s=fa(Yn,{from:ta(t.contractName),to:ta(t.contractName),data:na(Yn,{code:o})[0]||""},a),c=oa(Yn,s),e.next=13,r.send(c,n);case 13:return e.abrupt("return",e.sent);case 15:case"end":return e.stop()}}),e)}))),ro.apply(this,arguments)}function no(e,t){return ao.apply(this,arguments)}function ao(){return ao=p(u.mark((function e(t,r){var n,a,o,s,c,i,p;return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.getSequence(),a=t.contract,e.next=4,r.getBaseData();case 4:if((o=e.sent).sequence=n,s=a.generateCallCode(t.methodName,t.args),c=fa(Jn,{from:ta(t.from),to:ta(a.contractName),data:na(Jn,{parameter:s})[0]||""},o),i=oa(Jn,c),!t.encrypt){e.next=18;break}return p=ha({to:ta(a.contractName),data:na(Gn,{encrypted_tx:Lt(t.publicKey,i,t.aesKey,c.hash,t.encryptType)})[0]||""},o,c.timestamp,c.hash),e.next=14,r.send(oa(Gn,p),n);case 14:return e.abrupt("return",e.sent);case 18:return e.next=20,r.send(i,n);case 20:return e.abrupt("return",e.sent);case 22:case"end":return e.stop()}}),e)}))),ao.apply(this,arguments)}function oo(e,t){return so.apply(this,arguments)}function so(){return so=p(u.mark((function e(t,r){var n,a,o,s;return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.getSequence(),e.next=3,r.getBaseData();case 3:return(a=e.sent).sequence=n,o=fa(An,{from:ta(t.from),to:ta(t.to),data:"0x0",value:t.value},a),s=oa(An,o),e.next=9,r.send(s,n);case 9:return e.abrupt("return",e.sent);case 10:case"end":return e.stop()}}),e)}))),so.apply(this,arguments)}function co(e,t){return io.apply(this,arguments)}function io(){return io=p(u.mark((function e(t,r){var n,a,o,s,c;return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=ta(t.account),a=r.getSequence(),e.next=4,r.getBaseData();case 4:return(o=e.sent).sequence=a,s=fa(On,{from:n,to:n,data:na(On,{recover_key:t.recoverKey})[0]||""},o),c=oa(On,s),e.next=10,r.send(c,a);case 10:return e.abrupt("return",e.sent);case 12:case"end":return e.stop()}}),e)}))),io.apply(this,arguments)}function uo(e,t){return po.apply(this,arguments)}function po(){return po=p(u.mark((function e(t,r){var n,a,o,s,c;return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=ta(t.account),a=r.getSequence(),e.next=4,r.getBaseData();case 4:if((o=e.sent).userRecoverPrivateKey){e.next=7;break}throw Error("userRecoverPrivateKey is not set");case 7:return o.sequence=a,s=fa(Dn,{from:n,to:n},o,o.userRecoverPrivateKey),c=oa(Dn,s),e.next=12,r.send(c,a);case 12:return e.abrupt("return",e.sent);case 14:case"end":return e.stop()}}),e)}))),po.apply(this,arguments)}function fo(e,t){return ho.apply(this,arguments)}function ho(){return ho=p(u.mark((function e(t,r){var n,a,o,s,c;return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=ta(t.account),a=r.getSequence(),e.next=4,r.getBaseData();case 4:if((o=e.sent).userRecoverPrivateKey){e.next=7;break}throw Error("userRecoverPrivateKey is not set");case 7:return o.sequence=a,s=fa(Ln,{from:n,to:n,data:tt(na(Ln,{auth_key:t.authKey,auth_weight:100}))},o,o.userRecoverPrivateKey),c=oa(Ln,s),e.next=13,r.send(c,a);case 13:return e.abrupt("return",e.sent);case 15:case"end":return e.stop()}}),e)}))),ho.apply(this,arguments)}function yo(e,t){return lo.apply(this,arguments)}function lo(){return lo=p(u.mark((function t(r,n){var a,o,s,c,i;return u.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=n.getSequence(),o=oa(Zn,{sequence:a,filter_id:r.filterId}),t.next=5,n.send(o,a);case 5:if(!(s=t.sent).event_data){t.next=10;break}return c=Fe(s.event_data),i=rt(c),t.abrupt("return",e(e({},s),{},{event_data:ua(s.event_type,i)}));case 10:return t.abrupt("return",s);case 11:case"end":return t.stop()}}),t)}))),lo.apply(this,arguments)}var mo,vo=function(t){l(X,Aa);var r,n,a,o,s,c,i,f,m,v,g,k,b,_,w,x,C,q,E,S,T,P,N,B,I,R,K,A,O,D,L,U,z,W,j,H,M,Q,F,V,Y,J,G=d(X);function X(){var e,t,r,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return h(this,X),(r=G.call(this)).majorVersion=1,r.config=void 0,r.teeExtraParams=void 0,r.connector=void 0,r.eventsId=[],r.EVENTLOOPTIME=6e3,r.eventTimeout=void 0,r.config=n,r.teeExtraParams={aesKey:null===(e=r.config)||void 0===e?void 0:e.teePassword,encrypt:!0,encryptType:"02",publicKey:null===(t=r.config)||void 0===t?void 0:t.teePublicKey},r.connector=new Ua({host:r.config.host,port:r.config.port,cert:r.config.cert,ca:r.config.ca,passphrase:r.config.privateKeyPassword,key:r.config.privateKey,account:r.config.account,accountPrivateKey:r.config.accountPrivateKey,accountPrivateKeyPassword:r.config.accountPrivateKeyPassword,accountRecoverPrivateKey:r.config.accountRecoverPrivateKey,accountRecoverPrivateKeyPassword:r.config.accountRecoverPrivateKeyPassword}),r}return y(X,[{key:"startEventLoop",value:function(){this.eventTimeout||0===this.eventsId.length||this.fetchEvents()}},{key:"fetchEvents",value:function(){var e=this;this.eventsId.forEach(function(){var t=p(u.mark((function t(r){var n;return u.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,yo({filterId:r},e.connector);case 2:ue("get res with event id and res",r,n=t.sent),e.emit(r,n);case 5:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()),this.eventTimeout=setTimeout((function(){e.fetchEvents()}),this.EVENTLOOPTIME)}},{key:"watchContractEvent",value:function(e,t,r){var n=this;(function(e,t){var r=t.getSequence(),n={sequence:r,event_type:e.type,identity:ta(e.contractName)},a=oa(Xn,n);return t.send(a,r)})({contractName:e.contractName,type:me.CONTRACT},this.connector).then((function(e){var t=e.filter_id;n.on(t,r),n.eventsId.push(t),n.startEventLoop()}))}},{key:"createAccount",value:(J=p(u.mark((function e(t){var r;return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Ja({from:this.config.account,to:t.newAccountName,recoveryKey:t.recoveryKey,authMap:[{authKey:t.authKey,authWeight:100}]},this.connector);case 2:return r=e.sent,e.next=5,this.queryTransactionReceiptWithRetry({hash:r.hash});case 5:return e.abrupt("return",{txHash:r.hash});case 6:case"end":return e.stop()}}),e,this)}))),function(e){return J.apply(this,arguments)})},{key:"transferBalance",value:(Y=p(u.mark((function e(t){return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,oo({from:t.from||this.config.account,to:t.to,value:t.value},this.connector);case 2:return e.abrupt("return",{txHash:e.sent.hash});case 4:case"end":return e.stop()}}),e,this)}))),function(e){return Y.apply(this,arguments)})},{key:"setRecoverkey",value:(V=p(u.mark((function e(t){return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,co({account:t.account||this.config.account,recoverKey:t.recoverKey},this.connector);case 2:return e.abrupt("return",{txHash:e.sent.hash});case 4:case"end":return e.stop()}}),e,this)}))),function(e){return V.apply(this,arguments)})},{key:"preResetPubKey",value:(F=p(u.mark((function e(t){return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,uo({account:t.account||this.config.account},this.connector);case 2:return e.abrupt("return",{txHash:e.sent.hash});case 4:case"end":return e.stop()}}),e,this)}))),function(e){return F.apply(this,arguments)})},{key:"resetPubKey",value:(Q=p(u.mark((function e(t){return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fo({account:t.account||this.config.account,authKey:t.authKey},this.connector);case 2:return e.abrupt("return",{txHash:e.sent.hash});case 4:case"end":return e.stop()}}),e,this)}))),function(e){return Q.apply(this,arguments)})},{key:"freezeAccount",value:(M=p(u.mark((function e(t){return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw Error("Not support yet.");case 1:case"end":return e.stop()}}),e)}))),function(e){return M.apply(this,arguments)})},{key:"freezeContract",value:(H=p(u.mark((function e(t){return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw Error("Not support yet.");case 1:case"end":return e.stop()}}),e)}))),function(e){return H.apply(this,arguments)})},{key:"nativeDepositData",value:(j=p(u.mark((function e(t){return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw Error("Not support yet.");case 1:case"end":return e.stop()}}),e)}))),function(e){return j.apply(this,arguments)})},{key:"queryLastBlockHeader",value:(W=p(u.mark((function e(){var t;return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,ja(0,this.connector);case 2:return e.abrupt("return",{gasUsed:(t=e.sent.block_header).gas_used,hash:t.hash,logBloom:t.log_bloom,number:t.block_number,parentHash:t.parent_hash,receiptRoot:t.receipt_root,stateRoot:t.state_root,timestamp:t.timestamp,transactionRoot:t.transaction_root,version:t.version});case 5:case"end":return e.stop()}}),e,this)}))),function(){return W.apply(this,arguments)})},{key:"queryTransactionList",value:(z=p(u.mark((function e(t){return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw Error("Not support yet.");case 1:case"end":return e.stop()}}),e)}))),function(e){return z.apply(this,arguments)})},{key:"queryTransactionAndReceipt",value:(U=p(u.mark((function e(t){return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw Error("Not support yet.");case 1:case"end":return e.stop()}}),e)}))),function(e){return U.apply(this,arguments)})},{key:"queryTimestamp",value:(L=p(u.mark((function e(t){return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw Error("Not support yet.");case 1:case"end":return e.stop()}}),e)}))),function(e){return L.apply(this,arguments)})},{key:"queryP2PStatus",value:(D=p(u.mark((function e(t){return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw Error("Not support yet.");case 1:case"end":return e.stop()}}),e)}))),function(e){return D.apply(this,arguments)})},{key:"queryConsensusStatus",value:(O=p(u.mark((function e(t){return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw Error("Not support yet.");case 1:case"end":return e.stop()}}),e)}))),function(e){return O.apply(this,arguments)})},{key:"queryCommonConsensusStatus",value:(A=p(u.mark((function e(t){return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw Error("Not support yet.");case 1:case"end":return e.stop()}}),e)}))),function(e){return A.apply(this,arguments)})},{key:"querySyncStatus",value:(K=p(u.mark((function e(t){return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw Error("Not support yet.");case 1:case"end":return e.stop()}}),e)}))),function(e){return K.apply(this,arguments)})},{key:"queryTransactionCacheStatus",value:(R=p(u.mark((function e(t){return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw Error("Not support yet.");case 1:case"end":return e.stop()}}),e)}))),function(e){return R.apply(this,arguments)})},{key:"queryBlockCacheStatus",value:(I=p(u.mark((function e(t){return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw Error("Not support yet.");case 1:case"end":return e.stop()}}),e)}))),function(e){return I.apply(this,arguments)})},{key:"queryContractNodesStatus",value:(B=p(u.mark((function e(t){return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw Error("Not support yet.");case 1:case"end":return e.stop()}}),e)}))),function(e){return B.apply(this,arguments)})},{key:"queryContractConfigStatus",value:(N=p(u.mark((function e(t){return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw Error("Not support yet.");case 1:case"end":return e.stop()}}),e)}))),function(e){return N.apply(this,arguments)})},{key:"queryLogLevel",value:(P=p(u.mark((function e(t){return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw Error("Not support yet.");case 1:case"end":return e.stop()}}),e)}))),function(e){return P.apply(this,arguments)})},{key:"updateBlackList",value:(T=p(u.mark((function e(t){return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw Error("Not support yet.");case 1:case"end":return e.stop()}}),e)}))),function(e){return T.apply(this,arguments)})},{key:"queryBlockProof",value:(S=p(u.mark((function e(t){return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw Error("Not support yet.");case 1:case"end":return e.stop()}}),e)}))),function(e){return S.apply(this,arguments)})},{key:"queryBlockHeaderProof",value:(E=p(u.mark((function e(t){return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw Error("Not support yet.");case 1:case"end":return e.stop()}}),e)}))),function(e){return E.apply(this,arguments)})},{key:"queryStateProof",value:(q=p(u.mark((function e(t){return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw Error("Not support yet.");case 1:case"end":return e.stop()}}),e)}))),function(e){return q.apply(this,arguments)})},{key:"queryTransactionProof",value:(C=p(u.mark((function e(t){return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw Error("Not support yet.");case 1:case"end":return e.stop()}}),e)}))),function(e){return C.apply(this,arguments)})},{key:"queryReceiptProof",value:(x=p(u.mark((function e(t){return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw Error("Not support yet.");case 1:case"end":return e.stop()}}),e)}))),function(e){return x.apply(this,arguments)})},{key:"queryBlockHeaderInfos",value:(w=p(u.mark((function e(t){return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw Error("Not support yet.");case 1:case"end":return e.stop()}}),e)}))),function(e){return w.apply(this,arguments)})},{key:"queryBlockReceiptInfos",value:(_=p(u.mark((function e(t){return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw Error("Not support yet.");case 1:case"end":return e.stop()}}),e)}))),function(e){return _.apply(this,arguments)})},{key:"queryBlockBodyInfos",value:(b=p(u.mark((function e(t){return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw Error("Not support yet.");case 1:case"end":return e.stop()}}),e)}))),function(e){return b.apply(this,arguments)})},{key:"queryAccount",value:(k=p(u.mark((function e(t){return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Ma({account:t.account},this.connector).then((function(e){var t,r=e.data;return{address:r.identity,balance:r.balance,encryptionKey:r.encryption_key,recoveryKey:r.recover_key,recoveryTime:r.recover_time,authMap:null===(t=r.auth_map)||void 0===t?void 0:t.map((function(e){return{key:e.auth_key,weight:e.auth_weight}})),status:r.status,version:r.acc_version}})));case 2:case"end":return e.stop()}}),e,this)}))),function(e){return k.apply(this,arguments)})},{key:"updateAuthMap",value:(g=p(u.mark((function e(t){var r;return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Xa(t,this.connector);case 2:return r=e.sent.hash,e.next=6,this.queryTransactionReceiptWithRetry({hash:r});case 6:return e.abrupt("return",{txHash:r});case 7:case"end":return e.stop()}}),e,this)}))),function(e){return g.apply(this,arguments)})},{key:"queryBlockHeader",value:(v=p(u.mark((function e(t){return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Wa({blockNumber:t.blockNumber,hash:t.hash},this.connector).then((function(e){var t=e.block_header;return{gasUsed:t.gas_used,hash:t.hash,logBloom:t.log_bloom,number:t.block_number,parentHash:t.parent_hash,receiptRoot:t.receipt_root,stateRoot:t.state_root,timestamp:t.timestamp,transactionRoot:t.transaction_root,version:t.version}})));case 2:case"end":return e.stop()}}),e,this)}))),function(e){return v.apply(this,arguments)})},{key:"queryBlock",value:(m=p(u.mark((function e(t){return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Ha({blockNumber:t.blockNumber,hash:t.hash},this.connector).then((function(e){var t=e.block,r=t.block_header,n=t.block_body;return{gasUsed:r.gas_used,hash:r.hash,logBloom:r.log_bloom,number:r.block_number,parentHash:r.parent_hash,receiptRoot:r.receipt_root,stateRoot:r.state_root,timestamp:r.timestamp,transactionRoot:r.transaction_root,version:r.version,transactionList:n.transaction_list,receiptList:n.receipt_list,consensusProof:n.consensus_proof}})));case 2:case"end":return e.stop()}}),e,this)}))),function(e){return m.apply(this,arguments)})},{key:"queryLastBlock",value:(f=p(u.mark((function e(){return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",za(0,this.connector).then((function(e){var t=e.block.block_header;return{gasUsed:t.gas_used,hash:t.hash,logBloom:t.log_bloom,number:t.block_number,parentHash:t.parent_hash,receiptRoot:t.receipt_root,stateRoot:t.state_root,timestamp:t.timestamp,transactionRoot:t.transaction_root,version:t.version}})));case 1:case"end":return e.stop()}}),e,this)}))),function(){return f.apply(this,arguments)})},{key:"queryTransaction",value:(i=p(u.mark((function e(t){var r,n=this;return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.tee,e.abrupt("return",Qa({hash:t.hash},this.connector).then((function(e){var t=r?pa(e.transaction.data,n.config.teePassword,e.transaction.hash):e.transaction.data;return{blockNumber:e.block_number,hash:e.transaction.hash,data:t,to:e.transaction.to,from:e.transaction.from}})));case 2:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})},{key:"queryTransactionReceipt",value:(c=p(u.mark((function e(t){return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Fa({hash:t.hash},this.connector).then((function(e){return{blockNumber:e.block_number,gasUsed:e.receipt.gas_used,output:e.receipt.output,code:e.receipt.result,logs:e.receipt.log_entry.map((function(e){return{from:e.from,to:e.to,logData:e.log_data,topics:e.topics}}))}})));case 1:case"end":return e.stop()}}),e,this)}))),function(e){return c.apply(this,arguments)})},{key:"deployContract",value:(s=p(u.mark((function t(r,n){var a,o;return u.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a={},n.tee&&Object.assign(a,this.teeExtraParams),t.next=4,$a(e({contract:r,code:n.code,from:this.config.account},a),this.connector);case 4:return o=t.sent.hash,t.next=8,this.queryTransactionReceiptWithRetry({hash:o});case 8:return t.abrupt("return",{txHash:o,teeSecret:n.tee?Ot(this.config.teePassword,o).toString("hex"):void 0});case 9:case"end":return t.stop()}}),t,this)}))),function(e,t){return s.apply(this,arguments)})},{key:"updateContract",value:(o=p(u.mark((function e(t,r){var n;return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,to({contractName:t.contractName,code:t.vmType===oe.WASM?"0x".concat(r.code.toString("hex")):r.code.toString("utf-8"),vm:t.vmType},this.connector);case 2:return n=e.sent.hash,e.next=6,this.queryTransactionReceiptWithRetry({hash:n});case 6:return e.abrupt("return",{txHash:n});case 7:case"end":return e.stop()}}),e,this)}))),function(e,t){return o.apply(this,arguments)})},{key:"callContract",value:(a=p(u.mark((function t(r,n){var a,o,s,c,i;return u.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a={},n.tee&&Object.assign(a,this.teeExtraParams),t.next=4,no(e({contract:r,from:this.config.account,args:n.args,methodName:n.methodName},a),this.connector);case 4:return o=t.sent.hash,t.next=8,this.queryTransactionReceiptWithRetry({hash:o},n.timeout?Date.now()+n.timeout:void 0);case 8:return s=t.sent,c=n.tee?zt(s.output,this.config.teePassword,o):s.output,i=r.parseReturnOutput(n.methodName,ba(c)),t.abrupt("return",{txHash:o,receiptCode:s.code,returnValue:i,teeSecret:n.tee?Ot(this.config.teePassword,o).toString("hex"):void 0});case 12:case"end":return t.stop()}}),t,this)}))),function(e,t){return a.apply(this,arguments)})},{key:"queryContract",value:(n=p(u.mark((function e(t){var r;return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Ya(t,this.connector);case 2:return e.abrupt("return",{code:(r=e.sent).data.code,authMap:r.data.auth_map.map((function(e){return{key:e.auth_key,weight:e.auth_weight}}))});case 4:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"sign",value:(r=p(u.mark((function e(t){return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw Error("暂不支持");case 1:case"end":return e.stop()}}),e)}))),function(e){return r.apply(this,arguments)})}]),X}(),go=function(){var t=p(u.mark((function t(r,n){var a,o,s,c,i,p,f;return u.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(o=void 0===(a=n.method)?"GET":a,c=void 0===(s=n.body)?{}:s,p=void 0===(i=n.headers)?{}:i,"undefined"==typeof fetch){t.next=8;break}return t.next=4,fetch(r,{method:o,body:JSON.stringify(c),headers:e({"Content-Type":"application/json"},p)});case 4:if((f=t.sent).ok){t.next=7;break}throw Error("[utils/fetch] res.ok is false");case 7:return t.abrupt("return",f.json());case 8:return t.next=10,F(r,{method:o,data:c,headers:p});case 10:return t.abrupt("return",t.sent.data);case 12:case"end":return t.stop()}}),t)})));return function(e,r){return t.apply(this,arguments)}}(),ko={100:"哈希计算错误",101:"交易指针为空指针",102:"交易的 data 字段不满足类型约束",103:"签名不可用",104:"交易的发送账户余额不足",105:"交易的时间戳所在时间段无效，合约平台会对时间戳做检查，不在特定的时间范围内将被认为不可用",106:"交易的目标账户不包含可用的合约哈希",107:"交易的目标账户为空",108:"创建账户的交易不满足需求",109:"部署合约的交易不满足需求",110:"基本的交易类型需求校验失败",111:"交易类型未知",112:"恢复时间未知",113:"交易被重放",114:"交易的 data 字段太大，超过系统限制",115:"交易消耗的 gas 太大，超过系统限制",116:"交易的提交账户在区块链上不存在，提交账户是交易数据结构中的 from 字段",117:"交易的提交账户为空",118:"交易的提交账户被冻结",119:"交易的提交账户正在恢复中",120:"交易的目标账户在区块链上不存在，目标账户是交易数据结构中的 to 字段",121:"交易的目标账户被冻结",122:"交易的签名权重不足",123:"交易的目标账户已经存在",124:"块指针为空",125:"块的父级不存在",126:"块的父级无效，因为哈希和块号不匹配",127:"块的时间戳不满足单调递增的要求",128:"块的交易根哈希未正确计算",129:"块的交易接收根哈希未正确计算",130:"块的共识证明无效",131:"其他错误",132:"不满足交易的 group id 约束要求",133:"不满足交易的版本约束要求",134:"账户为空",135:"合约为空",136:"验证权限失败",137:"锚数据验证失败",140:"验证预留ID失败",141:"已打开受管理的应用程序合同",142:"更新合同无效",143:"更新合同状态无效",144:"不允许更新数据合同",145:"当前交易的合同代码无效",146:"已打开受管理的系统合约",400:"插件不存在",401:"消息转换失败",402:"本地交易执行失败",403:"无法将交易推送至缓存队列",404:"查询无结果",405:"业务不支持",406:"事件不存在",407:"日志实例不存在",408:"交易验证失败",409:"无节点可转发请求",410:"请求转发超时",411:"响应转发超时",412:"添加群链失败",413:"交易尚未验证",414:"交易已验证，等待执行",415:"节点无法提供服务，可能有两种原因：<br>1. 当前链在指定时间内无法成块；<br>2. 当前链内请求积压超过设定限制",416:"用于根据时间戳查询区块，请求中的时间戳小于创世块的时间戳",417:"转发请求查询无结果，可能是被转发节点处于无法服务状态",418:"注册事件失败，可能是触发事件注册单个 session 事件注册数限制或者节点支持最大事件注册数限制",419:"参数无效",420:"请求权限校验不通过，可能原因有：<br>1. 管理类请求需要校验签名，校验签名不通过；<br>2. 交易内账户涉及黑名单，被节点拒绝",421:"内部错误",422:"故障点不可用",423:"更新故障点案例失败",424:"超出了请求限制",425:"子网不存在",426:"子网不可用",1e3:"世界状态（WS）数据库未初始化",1001:"世界状态中找不到合约的代码哈希",1002:"世界状态中未找到该状态对象",1003:"状态对象（ID）被占用",1004:"指定的状态对象（ID）已删除",1005:"指定的状态对象余额不足",1006:"转账失败",1007:"指定的公钥不存在",1008:"余额溢出",1009:"未知故障",1010:"指定的权重值无效",1012:"发布资产失败",1013:"回收资产失败",2e3:"交易执行无法从交易获取足够的燃料",2001:"交易执行无法在区块链中定位到标识",2002:"负载中的权重值无效",2003:"交易负载无效",2004:"恢复时间无效",2005:"交易执行出现未知错误",3e3:"块不存在",3001:"数据库没有数据",3002:"写入数据库失败",3003:"从数据库读取数据失败",3004:"RLP存储解析失败",3005:"无效的ID",3006:"当前数据库的根目录状态无效",3007:"设置根目录失败",3008:"当前数据库数据丢失",3009:"数据覆盖失败",3010:"当前事件状态为空",3011:"最近块为空",3012:"区块编码无效",3013:"存储快照版本失败",3014:"对象状态初始化失败",3015:"对象状态接收无效",3016:"交易上下文为空",3017:"处理内容为空",3018:"merkle 树初始化失败",3019:"清理所有 merkle 树的缓存失败",3020:"清空所有merkle 树的状态失败",4e3:"超过要求的限制",4001:"创建group ID失败",4002:"获取公私钥失败",4003:"存储有关信息失败",4004:"发送已创建分组账号的交易失败",4005:"发送合约分组交易失败",4006:"获取公钥失败",4007:"公钥匹配出错",4008:"节点信息解码错误",4009:"获取密钥对失败",1e4:"虚拟机一般故障",10001:"错误的指令，包含create/create2/suicide/…",10002:"请调整堆栈",10003:"请调整堆栈",10004:"内存错误",10005:"代码为空",10006:"强制重启",10010:"虚拟机版本无效",10025:"由虚拟机参数不匹配引起的错误",10026:"虚拟机更新合约失败",10100:"虚拟机消耗超出限制",10101:"虚拟机创建失败",10102:"虚拟机参数代码为空",10103:"虚拟机参数代码为空",10200:"燃料不足",10201:"由 revert 指令触发的错误",10202:"由 toUint64 方法触发的错误",10203:"由虚拟机上下文static_call为true引起的错误",10204:"虚拟机方法引起的错误",10300:"获取余额失败",10301:"设置存储失败= 108，一般由存储引起",10302:"获取存储失败，一般由加载引起",10303:"转账失败，一般由evm_call调用方法引起",10304:"获取代码失败，一般由extcodecopy/extcodesize instruction or evm_call调用方法引起",10305:"获取块哈希失败，一般由哈希指令引起",10306:"获取代码哈希失败，由用户不存在引起",10307:"受获取燃料受限，由genesis.json设置",10308:"删除存储失败，原因是客户端收到删除存储结果失败",10309:"帐户被冻结，无法调用",10310:"虚拟机获取交易数据失败",10311:"虚拟机获取交易发送方失败",10312:"虚拟机获取交易交易接收器失败",10313:"虚拟机获取交易时间戳失败",10314:"虚拟机获取交易块索引失败",10315:"虚拟机从min_query_block中获取交易",10316:"交易类型不是TX_NATIVE_DEPOSIT_DATA和TX_RELATED_DEPOSIT_DATA",10317:"虚拟机获取交易存款标志失败",10318:"虚拟机获取恢复密钥失败",10319:"虚拟机获取身份验证映射失败",10350:"获得相关交易失败",10500:"虚拟内部错误",10600:"虚拟机创建动态库失败，可能是由本机合约创建动态库引起的",10601:"虚拟机创建socket失败，可能是由本机合约创建的socket方法引起的",10602:"虚拟机绑定socket失败，可能是由于客户端绑定到mychain时的本机协定引起的",10603:"虚拟机侦听socket失败，可能是由于mychain侦听客户端时的本机协定引起的",10604:"虚拟机响应失败，可能是由本机合同响应将数据发送给客户端造成的",10605:"虚拟机读取数据失败，可能是由于mychian读取客户端数据时的本机协定引起的",10606:"虚拟机执行子进程运行客户端失败",10607:"虚拟机fork进程失败，可能是由fork子进程时的本机合约引起的",10608:"虚拟机写入数据失败，可能是由于mychain将数据写入客户端时的幼稚合同引起的",10620:"虚拟机不支持本机合约，可能是由genesis.json中的native_enable引起的",10622:"虚拟机初始化失败，可能是由本地合约初始化方法引起",10623:"虚拟机不部署失败，可能是由于本地合约code引起部署失败",10700:"vm不支持本机预编译协定，没有使用ENABLE_NATIVE_PRECOMPILE_CONTRACT构建",10701:"虚拟机初始化失败，可能是由本机预编译协定init方法引起的",10702:"虚拟机部署失败，可能是由本机预编译合同部署代码引起的",10703:"虚拟机响应失败，可能是由本机预编译合同响应将数据发送给客户端引起的",10750:"合约 ID 不存在",10751:"数据库 ID 不存在",10752:"没有阅读数据合同的许可",10753:"没有写入数据合同的许可",10754:"没有删除数据合同的许可",10755:"数据协定API的输出是固定的，数据流反序列化输出失败",10756:"之前的schema不存在",10757:"当前的schema不存在",10758:"ACL ID不存在",10760:"数据不存在",10900:"参数格式错误",10901:"JSON/XML 的目标路径不存在",10902:"传入的 handler 参数不存在，检查 property_parse 是否执行成功",10903:"数据类型不匹配，当前使用的方法不能获取目标类型的数据",2e4:"SDK 内部错误",20001:"IPC/网络参数错误：协议族不支持的地址族",20002:"IPC/网络参数错误：该地址已被使用",20003:"IPC/网络参数错误：无法分配请求的地址",20004:"IPC/网络运行出错：套接口已连接",20005:"参数列表太长",20006:"数值参数不在域内",20007:"地址不详",20008:"文件描述符不详",20009:"程序加载错误：消息不详",20010:"管道破损",20011:"IPC/网络运行出错：软件问题导致连接中断",20012:"非阻塞和中断 I/O：操作进行中",20013:"IPC/网络运行出错：连接被拒绝",20014:"连接被对方重设",20015:"跨设备链接",20016:"IPC/网络参数错误：目标地址不得为空",20017:"设备或资源忙",20018:"目录不为空，需重新安排",20019:"执行格式错误",20020:"文件已存在",20021:"文件太大",20022:"IPC/网络运行出错：文件名太长",20023:"网络文件系统：功能未实现",20024:"无主机路由，需重新安排",20025:"程序加载错误：标识已被删除",20026:"程序加载错误：非法字节序列",20027:"ioctl 不适合设备",20028:"系统调用中断",20029:"参数无效",20030:"非法寻求",20031:"输入/输出错误",20032:"此为目录",20033:"IPC/网络参数错误：消息太长",20034:"IPC/网络运行出错：网络故障",20035:"IPC/网络运行出错：重置时网络断开连接",20036:"IPC/网络运行出错：网络无法访问",20037:"IPC/网络运行出错：无缓冲空间",20038:"无子程序",20039:"程序加载错误：已保留",20040:"网络文件系统，无锁可用",20041:"程序加载错误：消息流上无消息",20042:"程序加载错误：无预期类型的消息",20043:"IPC/网络参数错误：协议不可用",20044:"设备空间不足",20045:"程序加载错误：无流资源",20046:"设备未配置",20047:"设备不支持该操作",20048:"该文件或目录不存在",20049:"该程序不存在",20050:"非目录",20051:"IPC/网络参数错误：未在套接口上执行套接口操作",20052:"程序加载错误：非流",20053:"IPC/网络运行出错：套接口未连接",20054:"无法分配内存",20055:"IPC/网络参数错误：不支持该操作",20056:"程序加载错误：操作已取消",20057:"非阻塞和中断 I/O：操作进行中",20058:"操作不允许",20059:"仅当编译 __DARWIN_UNIX03 时该值为离散值，或 KERNE：套接口不支持该操作",20060:"非阻塞和中断 I/O：操作将阻塞",20061:"程序加载错误：之前的 Owner 已去世",20062:"权限不足",20063:"程序加载错误：协议错误",20064:"IPC/网络参数错误：不支持该协议",20065:"只读文件系统",20066:"避免资源死锁",20067:"非阻塞和中断 I/O：资源暂时不可用",20068:"结果太大",20069:"程序加载错误：状态不可恢复",20070:"程序加载错误：流 ioctl 超时",20071:"文本文件忙",20072:"IPC/网络运行出错：运行超时",20073:"系统打开的文件太多",20074:"打开的文件太多",20075:"太多链接",20076:"IPC/网络运行出错：符号链接级别太多",20077:"智能设备错误：值太大导致无法存储在数据类型中",20078:"IPC/网络参数错误：套接口协议类型错误",3e4:"SDK 参数无效",30001:"SDK 私钥无效",30002:"SDK 签名工具验证出错",30003:"SDK 不支持编码",30004:"SDK 获取文件输入流失败",30005:"SDK 查找线程失败",30006:"SDK 字节操作失败",30007:"SDK 转换公钥失败",30008:"SDK 消息编码失败",30009:"SDK 读取客户端配置失败",30010:"SDK 初始化失败",30011:"SDK 连接网络失败",30012:"SDK 解码出错",30013:"SDK 不支持该消息类型",30014:"未做握手",30015:"初始化 SSL 上下文失败",30016:"SDK 正在握手",30017:"SDK 无效的公钥",30018:"邮件已达到最大队列大小",60001:"加密交易解密失败",60002:"加密交易中内嵌的不是明文交易",60003:"待处理的交易非加密交易",60004:"TEE 中不支持 native 类型的合约",60005:"加密交易反序列化失败",60006:"合约账户的状态反序列化失败",60007:"非法访问加密的账户数据",60008:"TEE 内不支持的交易类型",60009:"加密回执中的 log 信息失败",60010:"非法访问加密的合约代码",60011:"加密交易的 hash 和时间戳不合法",60012:"交易回执过大",60013:"TEE 内部错误",60014:"合约代码加密失败",60015:"合约代码解密失败",60016:"合约状态加密失败",60017:"合约状态解密失败",60018:"合约状态反序列化失败",60019:"合约状态序列化失败",60020:"合约账户基本信息解密失败",60021:"合约账户基本信息加密失败",60022:"TEE 中不允许执行明文合约",60023:"TEE 中不允许更新明文合约",60024:"按不存在的方法类型进行查询",60025:"查询时使用的 hash 不存在",60026:"不允许查询",60027:"解密隐私交易回执失败",60028:"对象状态初始化失败",60029:"获取代码状态失败",60030:"删除存储状态失败",60031:"错误的虚拟机类型",60032:"设置代码状态失败",60033:"查询时交易不匹配",60034:"从块获取交易列表失败",60035:"查询时调用虚拟机失败",60036:"查询时不被允许",60037:"查询RLP失败",60038:"更新合约无效",60039:"查询时该方法不支持",60040:"加密交易的期望合约代码哈希值不匹配",60041:"更新存款合同时，获取公钥失败",7e4:"通用错误",70001:"无效的提供者",70002:"无效的密钥类型",70003:"无效的类",70004:"无效的公钥",70005:"无效的私钥",70006:"无效的消息",70007:"无效的纯文本",70008:"无效的密文",70009:"无效的签名",70010:"无效的对称密钥",70011:"无效的文件路径",70012:"无效的密钥文件",70013:"无效的x509",70101:"算法未初始化",70102:"提供者错误",8e4:"注册失败"};!function(e){e.OpenLab="0b06e2744ad341538b7a3b3cc5ad9e57"}(mo||(mo={}));var bo=function(){function t(e){h(this,t),this.requestConfig=void 0,this.tokenPromise=void 0,this.requestConfig=e,this.tokenPromise=this.getToken()}var r,n;return y(t,[{key:"getToken",value:(n=p(u.mark((function e(){var t,r,n,a,o,s,c,i,p,f;return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=(t=this.requestConfig).accessSecret,a=t.baseUrl,ue("[RestRequest] getToken accessId:",r=t.accessId),ue("[RestRequest] getToken accessSecret:",n),o=""+Date.now(),s=Xe(n,"".concat(r).concat(o)),e.next=7,go("".concat(a,"/api/contract/shakeHand"),{method:"POST",body:{time:o,accessId:r,secret:s}});case 7:if(i=(c=e.sent).code,p=c.data,f=c.message,!c.success||"200"!==i){e.next=15;break}return ue("[RestRequest] getToken token:",p),e.abrupt("return",p);case 15:throw Error(f);case 16:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"request",value:(r=p(u.mark((function t(r){var n,a,o,s,c,i,p,f,h,y,l=arguments;return u.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=l.length>1&&void 0!==l[1]?l[1]:{},a=l.length>2&&void 0!==l[2]?l[2]:1,o=this.requestConfig.baseUrl+r,t.next=5,this.tokenPromise;case 5:return s=t.sent,c=n.requestStr?{requestStr:JSON.stringify(n.requestStr)}:{},i=e(e(e({},n),c),{},{token:s}),ue("[RestRequest] request url & tokenTimeoutRetryTimes:",o,a),ue("[RestRequest] request body:",i),t.next=12,go(o,{method:"POST",body:i});case 12:if(ue("[RestRequest] response body:",p=t.sent),!p.success||!("200"===p.code||"0"===p.code&&n.secretKey)){t.next=28;break}if(!/\{.+\}/.test(p.data)){t.next=25;break}return t.prev=16,t.abrupt("return",JSON.parse(p.data));case 20:throw t.prev=20,t.t0=t.catch(16),new ve("response parse error, code: ".concat(p.code),p.code);case 23:t.next=26;break;case 25:return t.abrupt("return",p.data);case 26:t.next=39;break;case 28:if("202"!==p.code||0>=a){t.next=34;break}return ue("[RestRequest] token timeout, retry get token, tokenTimeoutRetryTimes: ".concat(a)),this.tokenPromise=this.getToken(),t.abrupt("return",this.request(r,n,a-1));case 34:if(f=ko[p.code]||p.code,y=p.data,/\{.+\}/.test(p.data))try{(y=JSON.parse(p.data)).output&&(h=""+Buffer.from(y.output,"base64"))}catch(e){}throw h?f="".concat(f," ").concat(h):p.data?f="".concat(f," ").concat(p.data):p.message&&(f="".concat(f," ").concat(p.message)),new ve("[RestRequest] request failed, code: ".concat(p.code,", detail: ").concat(f),p.code,y);case 39:case"end":return t.stop()}}),t,this,[[16,20]])}))),function(e){return r.apply(this,arguments)})}]),t}();function _o(e,t){return t.request("/api/contract/chainCallForBiz",e)}function wo(e,t){return t.request("/api/contract/chainCall",e)}function xo(e,t){return t.request("/api/contract/chainCall",e)}function Co(e,t){return t.request("/api/contract/chainCall",e)}function qo(e,t){return t.request("/api/contract/chainCall",e)}function Eo(e,t){return t.request("/api/contract/chainCall",e)}function So(e,t){return t.request("/api/contract/chainCall",e)}function To(e,t){return t.request("/api/contract/chainCallForBiz",e)}function Po(e,t){return t.request("/api/contract/chainCall",e)}function No(e,t){return t.request("/api/contract/chainCall",e)}function Bo(e,t){return t.request("/api/contract/chainCall",e)}function Io(e,t){return t.request("/api/contract/chainCallForBiz",e)}function Ro(e,t){return t.request("/api/contract/chainCallForBiz",e)}function Ko(e,t){return t.request("/api/contract/chainCall",e)}var Ao=Object.freeze({__proto__:null,deployContractForBiz:_o,deployContract:wo,queryAccount:xo,queryBlockHeader:Co,queryBlock:qo,queryLastBlock:Eo,queryTransaction:So,callContractForBiz:To,callContract:Po,queryContract:No,queryTransactionReceipt:Bo,createAccountForBiz:Io,updateContractForBiz:Ro,updateContract:Ko});function Oo(e){return Buffer.from(e,"base64").toString("hex")}function Do(e){return"0x".concat(function(e){var t=P.md.sha256.create();return t.update(e),t.digest().toHex()}(e))}var Lo=function(t){l(H,Aa);var r,n,a,o,s,c,i,f,m,v,g,k,b,_,w,x,C,q,E,S,T,P,N,B,I,R,K,A,O,D,L,U,z,W,j=d(H);function H(e){var t;return h(this,H),(t=j.call(this)).majorVersion=1,t.config=void 0,t.request=void 0,t.config=e,t.request=new bo({baseUrl:t.config.restUrl,accessId:t.config.accessId,accessSecret:t.config.accessSecret}),t}return y(H,[{key:"getToken",value:function(){return this.request.getToken()}},{key:"generateOrderId",value:function(){return"order_myfish_".concat(this.config.accessId,"_").concat(Q())}},{key:"watchContractEvent",value:function(e,t,r){throw Error("Not support yet.")}},{key:"createAccount",value:function(){var e=p(u.mark((function e(){return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw Error("托管密钥方式请使用 createAccountWithKms");case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"createAccountWithKms",value:(W=p(u.mark((function e(t){var r;return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r="".concat(this.config.tenantId).concat(V()),e.next=3,Io({newAccountId:t.newAccountName,newAccountKmsId:r,method:ie.createAccountForBiz,accessId:this.config.accessId,bizid:this.config.bizid,account:this.config.account,tenantid:this.config.tenantId,mykmsKeyId:this.config.kmsId,orderId:this.generateOrderId()},this.request);case 3:return e.abrupt("return",{kmsId:r,authKey:e.sent});case 5:case"end":return e.stop()}}),e,this)}))),function(e){return W.apply(this,arguments)})},{key:"transferBalance",value:function(){var e=p(u.mark((function e(t){return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw Error("Not support yet.");case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"setRecoverkey",value:function(){var e=p(u.mark((function e(t){return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw Error("Not support yet.");case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"preResetPubKey",value:function(){var e=p(u.mark((function e(t){return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw Error("Not support yet.");case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"resetPubKey",value:function(){var e=p(u.mark((function e(t){return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw Error("Not support yet.");case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"freezeAccount",value:(z=p(u.mark((function e(t){return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw Error("Not support yet.");case 1:case"end":return e.stop()}}),e)}))),function(e){return z.apply(this,arguments)})},{key:"freezeContract",value:(U=p(u.mark((function e(t){return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw Error("Not support yet.");case 1:case"end":return e.stop()}}),e)}))),function(e){return U.apply(this,arguments)})},{key:"nativeDepositData",value:(L=p(u.mark((function e(t){return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw Error("Not support yet.");case 1:case"end":return e.stop()}}),e)}))),function(e){return L.apply(this,arguments)})},{key:"queryLastBlockHeader",value:(D=p(u.mark((function e(){return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw Error("Not support yet.");case 1:case"end":return e.stop()}}),e)}))),function(){return D.apply(this,arguments)})},{key:"queryTransactionList",value:(O=p(u.mark((function e(t){return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw Error("Not support yet.");case 1:case"end":return e.stop()}}),e)}))),function(e){return O.apply(this,arguments)})},{key:"queryTransactionAndReceipt",value:(A=p(u.mark((function e(t){return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw Error("Not support yet.");case 1:case"end":return e.stop()}}),e)}))),function(e){return A.apply(this,arguments)})},{key:"queryTimestamp",value:(K=p(u.mark((function e(t){return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw Error("Not support yet.");case 1:case"end":return e.stop()}}),e)}))),function(e){return K.apply(this,arguments)})},{key:"queryP2PStatus",value:(R=p(u.mark((function e(t){return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw Error("Not support yet.");case 1:case"end":return e.stop()}}),e)}))),function(e){return R.apply(this,arguments)})},{key:"queryConsensusStatus",value:(I=p(u.mark((function e(t){return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw Error("Not support yet.");case 1:case"end":return e.stop()}}),e)}))),function(e){return I.apply(this,arguments)})},{key:"queryCommonConsensusStatus",value:(B=p(u.mark((function e(t){return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw Error("Not support yet.");case 1:case"end":return e.stop()}}),e)}))),function(e){return B.apply(this,arguments)})},{key:"querySyncStatus",value:(N=p(u.mark((function e(t){return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw Error("Not support yet.");case 1:case"end":return e.stop()}}),e)}))),function(e){return N.apply(this,arguments)})},{key:"queryTransactionCacheStatus",value:(P=p(u.mark((function e(t){return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw Error("Not support yet.");case 1:case"end":return e.stop()}}),e)}))),function(e){return P.apply(this,arguments)})},{key:"queryBlockCacheStatus",value:(T=p(u.mark((function e(t){return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw Error("Not support yet.");case 1:case"end":return e.stop()}}),e)}))),function(e){return T.apply(this,arguments)})},{key:"queryContractNodesStatus",value:(S=p(u.mark((function e(t){return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw Error("Not support yet.");case 1:case"end":return e.stop()}}),e)}))),function(e){return S.apply(this,arguments)})},{key:"queryContractConfigStatus",value:(E=p(u.mark((function e(t){return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw Error("Not support yet.");case 1:case"end":return e.stop()}}),e)}))),function(e){return E.apply(this,arguments)})},{key:"queryLogLevel",value:(q=p(u.mark((function e(t){return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw Error("Not support yet.");case 1:case"end":return e.stop()}}),e)}))),function(e){return q.apply(this,arguments)})},{key:"updateBlackList",value:(C=p(u.mark((function e(t){return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw Error("Not support yet.");case 1:case"end":return e.stop()}}),e)}))),function(e){return C.apply(this,arguments)})},{key:"queryBlockProof",value:(x=p(u.mark((function e(t){return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw Error("Not support yet.");case 1:case"end":return e.stop()}}),e)}))),function(e){return x.apply(this,arguments)})},{key:"queryBlockHeaderProof",value:(w=p(u.mark((function e(t){return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw Error("Not support yet.");case 1:case"end":return e.stop()}}),e)}))),function(e){return w.apply(this,arguments)})},{key:"queryStateProof",value:(_=p(u.mark((function e(t){return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw Error("Not support yet.");case 1:case"end":return e.stop()}}),e)}))),function(e){return _.apply(this,arguments)})},{key:"queryTransactionProof",value:(b=p(u.mark((function e(t){return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw Error("Not support yet.");case 1:case"end":return e.stop()}}),e)}))),function(e){return b.apply(this,arguments)})},{key:"queryReceiptProof",value:(k=p(u.mark((function e(t){return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw Error("Not support yet.");case 1:case"end":return e.stop()}}),e)}))),function(e){return k.apply(this,arguments)})},{key:"queryBlockHeaderInfos",value:(g=p(u.mark((function e(t){return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw Error("Not support yet.");case 1:case"end":return e.stop()}}),e)}))),function(e){return g.apply(this,arguments)})},{key:"queryBlockReceiptInfos",value:(v=p(u.mark((function e(t){return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw Error("Not support yet.");case 1:case"end":return e.stop()}}),e)}))),function(e){return v.apply(this,arguments)})},{key:"queryBlockBodyInfos",value:(m=p(u.mark((function e(t){return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw Error("Not support yet.");case 1:case"end":return e.stop()}}),e)}))),function(e){return m.apply(this,arguments)})},{key:"queryAccount",value:(f=p(u.mark((function e(t){var r,n;return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.account,e.next=3,xo({method:ie.queryAccount,requestStr:{queryAccount:r},bizid:this.config.bizid,accessId:this.config.accessId},this.request);case 3:return e.abrupt("return",{address:(n=e.sent).id,balance:n.balance,encryptionKey:n.encryption_key,recoveryKey:n.recovery_key,recoveryTime:n.recovery_time,authMap:n.auth_map.map((function(e){return{key:e.key,weight:e.value}})),status:n.status,version:n.version});case 5:case"end":return e.stop()}}),e,this)}))),function(e){return f.apply(this,arguments)})},{key:"updateAuthMap",value:function(){var e=p(u.mark((function e(){return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw Error("Rest 暂不支持 updateAuthMap");case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"queryBlockHeader",value:(i=p(u.mark((function e(t){var r;return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.blockNumber,e.next=3,Co({method:ie.queryBlockHeader,requestStr:r,bizid:this.config.bizid,accessId:this.config.accessId},this.request);case 3:return e.abrupt("return",e.sent.block.blockHeader);case 5:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})},{key:"queryBlock",value:(c=p(u.mark((function e(t){var r,n;return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.blockNumber,e.next=3,qo({method:ie.queryBlock,requestStr:r,bizid:this.config.bizid,accessId:this.config.accessId},this.request);case 3:return e.abrupt("return",{gasUsed:(n=e.sent).header.gas_used,hash:n.header.hash,logBloom:n.header.log_bloom,number:n.header.number,parentHash:n.header.parent_hash,receiptRoot:n.header.receipt_root,stateRoot:n.header.state_root,timestamp:n.header.timestamp,transactionRoot:n.header.transaction_root,version:n.header.version,receiptList:n.body.receipt_list,consensusProof:n.body.consensus_proof,transactionList:n.body.transaction_list});case 5:case"end":return e.stop()}}),e,this)}))),function(e){return c.apply(this,arguments)})},{key:"queryLastBlock",value:(s=p(u.mark((function e(){return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Eo({method:ie.queryLastBlock,bizid:this.config.bizid,accessId:this.config.accessId},this.request);case 2:return e.abrupt("return",e.sent.block.blockHeader);case 4:case"end":return e.stop()}}),e,this)}))),function(){return s.apply(this,arguments)})},{key:"queryTransaction",value:(o=p(u.mark((function e(t){var r,n,a;return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.hash,n=t.tee,e.next=3,So({method:ie.queryTransactionFromBlockchain,hash:r,bizid:this.config.bizid,accessId:this.config.accessId,secretKey:n?this.config.teePassword:void 0},this.request);case 3:return e.abrupt("return",{blockNumber:(a=e.sent).blockHeight,hash:"0x".concat(a.hash),data:a.transactionV10.data,from:"0x".concat(a.transactionV10.from),to:"0x".concat(a.transactionV10.to)});case 5:case"end":return e.stop()}}),e,this)}))),function(e){return o.apply(this,arguments)})},{key:"queryTransactionReceipt",value:(a=p(u.mark((function e(t){var r;return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Bo({method:ie.queryTransactionReceipt,hash:t.hash,bizid:this.config.bizid,accessId:this.config.accessId,secretKey:t.tee?this.config.teePassword:void 0},this.request);case 2:return ue("[CloudCryptoRestProvider] queryTransactionReceipt gas used:",(r=e.sent).gasUsed),e.abrupt("return",{blockNumber:r.blockNumber,gasUsed:r.gasUsed,output:Oo(r.output),code:r.result,logs:r.logs.map((function(e){return{from:Ca(e.from.value),to:Ca(e.to.value),logData:Oo(e.logData),topics:e.topics}}))});case 5:case"end":return e.stop()}}),e,this)}))),function(e){return a.apply(this,arguments)})},{key:"deployContract",value:function(){var t=p(u.mark((function t(r,n,a){var o,s,c,i,p,f,h;return u.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r.vmType!==oe.WASM){t.next=4;break}o=null===(s=n.code)||void 0===s?void 0:s.toString("base64"),t.next=9;break;case 4:if(r.vmType!==oe.EVM){t.next=8;break}o=null===(c=n.code)||void 0===c?void 0:c.toString("utf-8"),t.next=9;break;case 8:throw Error("[deployContract] vmType must be ".concat(oe.WASM," or ").concat(oe.EVM));case 9:if(i={accessId:this.config.accessId,bizid:this.config.bizid,contractCode:o,account:this.config.account,tenantid:this.config.tenantId,mykmsKeyId:this.config.kmsId,orderId:this.generateOrderId(),contractName:r.contractName,gas:n.gas,secretKey:n.tee?this.config.teePassword:void 0},!a){t.next=16;break}return t.next=13,Ro(e(e({},i),{},{method:r.vmType===oe.WASM?ie.updateWasmContractForBiz:ie.updateSolidityContractForBizAsync}),this.request);case 13:p=t.sent,t.next=19;break;case 16:return t.next=18,_o(e(e({},i),{},{method:r.vmType===oe.WASM?ie.deployWasmContractForBiz:ie.deploySolidityContractForBizAsync}),this.request);case 18:p=t.sent;case 19:if(f=r.vmType===oe.WASM?p.txData.txHash:p,!n.tee){t.next=24;break}return f=Buffer.from(f.value,"base64").toString("hex"),h=Ot(this.config.teePassword,f).toString("hex"),t.abrupt("return",{txHash:f,teeSecret:h});case 24:return t.abrupt("return",{txHash:f});case 25:case"end":return t.stop()}}),t,this)})));return function(e,r,n){return t.apply(this,arguments)}}()},{key:"updateContract",value:function(){var e=p(u.mark((function e(t,r){return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.deployContract(t,r,!0));case 1:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"callContract",value:function(){var e=p(u.mark((function e(t,r){var n,a,o,s,c,i,p,f,h,y,l,d,m,v,g,k,b,_,w,x,C;return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=r.methodName,o=void 0===(a=r.args)?[]:a,c=void 0===(s=r.argsType)?[]:s,i=r.returnType,p=r.gas,f=r.tee,h=r.local,y=r.timeout,l=t.contractName,d=t.abi,t.vmType!==oe.EVM){e.next=4;break}throw Error("[callContract] Rest 托管密钥方式暂时不支持调用 Solidity 合约");case 4:return e.next=6,To({methodSignature:"".concat(n,"(").concat(c?c.join(","):"",")"),inputParamListStr:JSON.stringify(o),outTypes:i?'["'.concat(i,'"]'):"[]",method:ie.callWasmContractForBizAsync,accessId:this.config.accessId,bizid:this.config.bizid,account:this.config.account,tenantid:this.config.tenantId,mykmsKeyId:this.config.kmsId,orderId:this.generateOrderId(),contractName:l,isLocalTransaction:h,gas:p,secretKey:f?this.config.teePassword:void 0},this.request);case 6:return v="0x".concat(m=e.sent),g=f?Ot(this.config.teePassword,v).toString("hex"):"",ue("[CloudCryptoRestProvider] callContract txHash:",m),ue("[CloudCryptoRestProvider] callContract teeSecret:",g),e.next=13,this.queryTransactionReceiptWithRetry({hash:v,tee:f},y?Date.now()+y:void 0);case 13:return _=(k=e.sent).code,ue("[CloudCryptoRestProvider] callContract output:",w=b=k.output),x=la(l,d),f&&b&&(w=zt(b,this.config.teePassword,m)),C=xa(n,x,w),e.abrupt("return",{returnValue:C,txHash:v,teeSecret:f?g:void 0,receiptCode:_});case 22:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"queryContract",value:(n=p(u.mark((function e(t){return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,No({method:ie.queryContract,bizid:this.config.bizid,contractName:t.contractName,accessId:this.config.accessId},this.request);case 2:return e.abrupt("return",{code:e.sent.contract.code});case 4:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"sign",value:(r=p(u.mark((function e(t){return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw Error("暂不支持");case 1:case"end":return e.stop()}}),e)}))),function(e){return r.apply(this,arguments)})}]),H}(),Uo=function(t){l(c,Lo);var r,n,a,o,s=d(c);function c(e){var t;return h(this,c),(t=s.call(this,{bizid:e.bizid,restUrl:e.restUrl,accessId:e.accessId,accessSecret:e.accessSecret})).localConfig=void 0,t.localConfig=e,t}return y(c,[{key:"getBaseData",value:(o=p(u.mark((function e(){var t;return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,da(this.localConfig.accountPrivateKey,this.localConfig.accountPrivateKeyPassword);case 2:return e.abrupt("return",{isSign:!0,from:this.localConfig.account,userPublicKey:(t=e.sent).publicKey,userPrivateKey:t.privateKey});case 4:case"end":return e.stop()}}),e,this)}))),function(){return o.apply(this,arguments)})},{key:"sign",value:(a=p(u.mark((function e(t){return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getBaseData();case 2:return e.abrupt("return",{signature:At(t.payload,e.sent.userPrivateKey).toString("hex")});case 4:case"end":return e.stop()}}),e,this)}))),function(e){return a.apply(this,arguments)})},{key:"createAccount",value:function(){var e=p(u.mark((function e(){return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw Error("Rest 非托管密钥方式暂不支持创建账户");case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"deployContract",value:(n=p(u.mark((function t(r,n,a){var o,s,c,i,p,f,h,y;return u.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.getBaseData();case 2:if(o=t.sent,s=r.generateDeployCode(n.code),c=qa(a?ce.updateContract:ce.deployContract,{from:a?r.contractName:o.from,to:r.contractName,gas:n.gas,data:{code:s}},o,(function(e){return e[1]})),i=c.txData,p=c.rlpData,n.tee&&(f=Ot(this.localConfig.teePassword,i.hash).toString("hex")),h={accessId:this.config.accessId,bizid:this.config.bizid,hash:i.hash,method:ie.deployWasmContract,requestStr:{hash:i.hash,timestamp:i.timestamp,vmTypeEnum:r.vmType,secretKey:n.tee?this.localConfig.teePassword:void 0}},!a){t.next=13;break}return t.next=10,Ko(e(e({},h),{},{method:ie.updateWasmContract,requestStr:e(e({},h.requestStr),{},{contractName:Do(r.contractName),contractCode:s,vmType:r.vmType,updateContractRaw:p.toString("base64")})}),this.request);case 10:y=t.sent,t.next=16;break;case 13:return t.next=15,wo(e(e({},h),{},{method:ie.deployWasmContract,requestStr:e(e({},h.requestStr),{},{deployContractRaw:p.toString("base64")})}),this.request);case 15:y=t.sent;case 16:return t.next=18,this.queryTransactionReceiptWithRetry({hash:i.hash,tee:n.tee});case 18:return t.abrupt("return",{txHash:y,teeSecret:f});case 19:case"end":return t.stop()}}),t,this)}))),function(e,t,r){return n.apply(this,arguments)})},{key:"callContract",value:(r=p(u.mark((function e(t,r){var n,a,o,s,c,i,p,f,h,y,l,d,m,v,g,k,b,_,w,x,C,q;return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=r.gas,c=void 0===(s=r.argsType)?[]:s,i=r.local,p=r.tee,f=r.timeout,h=t.contractName,y=t.vmType,l=t.generateCallCode(n=r.methodName,void 0===(a=r.args)?[]:a),e.next=5,this.getBaseData();case 5:if(m=qa(ce.callContract,{from:(d=e.sent).from,to:h,gas:o,data:{parameter:l}},d,(function(e){return e[1]})),v=m.txData,g=m.rlpData,p&&(k=Ot(this.localConfig.teePassword,v.hash).toString("hex")),y!==oe.WASM){e.next=11;break}return e.next=11,Po({accessId:this.config.accessId,bizid:this.config.bizid,hash:v.hash,method:ie.callWasmContract,requestStr:{acctId:{data:ka(v.from)},contractId:{data:ka(v.to)},callWasmContractRaw:g.toString("base64"),methodSignature:"".concat(n,"(").concat(c?c.join(","):"",")"),hash:v.hash,timestamp:v.timestamp,nonceV:Date.now(),vmTypeEnum:oe.WASM,isLocalTransaction:i,teePublicKey:p?this.localConfig.teePublicKey:void 0,secretKey:p?this.localConfig.teePassword:void 0}},this.request);case 11:if(y!==oe.EVM){e.next=14;break}return e.next=14,Po({accessId:this.config.accessId,bizid:this.config.bizid,hash:v.hash,contractName:h,method:ie.callContract,requestStr:{callContractRaw:g.toString("base64"),hash:v.hash,timestamp:v.timestamp,nonceV:Date.now(),vmTypeEnum:oe.EVM}},this.request);case 14:return e.next=16,this.queryTransactionReceiptWithRetry({hash:v.hash,tee:p},f?Date.now()+f:void 0);case 16:return w=(b=e.sent).code,x=_=b.output,p&&_&&(C="0x"+Buffer.from(_,"base64").toString("hex"),x=ka(zt(C,this.localConfig.teePassword,v.hash))),q=t.parseReturnOutput(n,x),e.abrupt("return",{returnValue:q,txHash:v.hash,teeSecret:p?k:void 0,receiptCode:w});case 23:case"end":return e.stop()}}),e,this)}))),function(e,t){return r.apply(this,arguments)})}]),c}();function zo(e){console.warn("[myfish] WalletProvider.".concat(e," 方法暂不支持 TEE 合约"))}var Wo=function(t){l(L,Aa);var r,n,a,o,s,c,i,f,m,v,g,k,b,_,w,x,C,q,E,S,T,P,N,B,I,R,K,A,O,D=d(L);function L(e){var t;return h(this,L),(t=D.call(this)).majorVersion=1,t.config=void 0,t.rpcEngine=void 0,t.rpcConnection=void 0,t.state={chainId:"",accounts:[],isConnected:!1},t.config=e,t.initRpcEngine(),t.initState(),t}return y(L,[{key:"initRpcEngine",value:function(){this.rpcEngine=new Y,this.rpcConnection=J(),this.rpcEngine.push(this.rpcConnection.middleware),G(this.config.connectionStream,this.rpcConnection.stream,this.config.connectionStream,(function(e){console.error("[WalletProvider] stream disconnect",e)}))}},{key:"initState",value:(O=p(u.mark((function t(){var r;return u.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.request({method:le.getProviderState});case 2:r=t.sent,this.state=e(e({},this.state),r),this.state.isConnected=!0,ue("[WalletProvider] initState:",this.state),this.emit("connect",this.state);case 7:case"end":return t.stop()}}),t,this)}))),function(){return O.apply(this,arguments)})},{key:"request",value:(A=p(u.mark((function e(t){var r,n,a,o,s;return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.params,ue("[WalletProvider] request method:",r=t.method),ue("[WalletProvider] request params:",n),e.next=5,this.rpcEngine.handle({jsonrpc:"2.0",id:Q(),method:r,params:n});case 5:if(s=(a=e.sent).result,!(o=a.error)){e.next=11;break}throw ue("[WalletProvider] request error:",o),o;case 11:return ue("[WalletProvider] request result:",s),e.abrupt("return",s);case 13:case"end":return e.stop()}}),e,this)}))),function(e){return A.apply(this,arguments)})},{key:"watchContractEvent",value:function(e,t,r){throw Error("Not support yet.")}},{key:"requestAccounts",value:(K=p(u.mark((function e(){var t;return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.request({method:le.requestAccounts});case 2:return this.state.accounts=t=e.sent,this.emit("accountsChanged",t),e.abrupt("return",t);case 6:case"end":return e.stop()}}),e,this)}))),function(){return K.apply(this,arguments)})},{key:"createAccount",value:function(){var e=p(u.mark((function e(){return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw Error("WalletProvider 暂不支持创建账户");case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"transferBalance",value:function(){var e=p(u.mark((function e(t){return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw Error("Not support yet.");case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"setRecoverkey",value:function(){var e=p(u.mark((function e(t){return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw Error("Not support yet.");case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"preResetPubKey",value:function(){var e=p(u.mark((function e(t){return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw Error("Not support yet.");case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"resetPubKey",value:function(){var e=p(u.mark((function e(t){return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw Error("Not support yet.");case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"freezeAccount",value:(R=p(u.mark((function e(t){return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw Error("Not support yet.");case 1:case"end":return e.stop()}}),e)}))),function(e){return R.apply(this,arguments)})},{key:"freezeContract",value:(I=p(u.mark((function e(t){return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw Error("Not support yet.");case 1:case"end":return e.stop()}}),e)}))),function(e){return I.apply(this,arguments)})},{key:"nativeDepositData",value:(B=p(u.mark((function e(t){return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw Error("Not support yet.");case 1:case"end":return e.stop()}}),e)}))),function(e){return B.apply(this,arguments)})},{key:"queryLastBlockHeader",value:(N=p(u.mark((function e(){return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw Error("Not support yet.");case 1:case"end":return e.stop()}}),e)}))),function(){return N.apply(this,arguments)})},{key:"queryTransactionList",value:(P=p(u.mark((function e(t){return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw Error("Not support yet.");case 1:case"end":return e.stop()}}),e)}))),function(e){return P.apply(this,arguments)})},{key:"queryTransactionAndReceipt",value:(T=p(u.mark((function e(t){return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw Error("Not support yet.");case 1:case"end":return e.stop()}}),e)}))),function(e){return T.apply(this,arguments)})},{key:"queryTimestamp",value:(S=p(u.mark((function e(t){return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw Error("Not support yet.");case 1:case"end":return e.stop()}}),e)}))),function(e){return S.apply(this,arguments)})},{key:"queryP2PStatus",value:(E=p(u.mark((function e(t){return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw Error("Not support yet.");case 1:case"end":return e.stop()}}),e)}))),function(e){return E.apply(this,arguments)})},{key:"queryConsensusStatus",value:(q=p(u.mark((function e(t){return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw Error("Not support yet.");case 1:case"end":return e.stop()}}),e)}))),function(e){return q.apply(this,arguments)})},{key:"queryCommonConsensusStatus",value:(C=p(u.mark((function e(t){return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw Error("Not support yet.");case 1:case"end":return e.stop()}}),e)}))),function(e){return C.apply(this,arguments)})},{key:"querySyncStatus",value:(x=p(u.mark((function e(t){return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw Error("Not support yet.");case 1:case"end":return e.stop()}}),e)}))),function(e){return x.apply(this,arguments)})},{key:"queryTransactionCacheStatus",value:(w=p(u.mark((function e(t){return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw Error("Not support yet.");case 1:case"end":return e.stop()}}),e)}))),function(e){return w.apply(this,arguments)})},{key:"queryBlockCacheStatus",value:(_=p(u.mark((function e(t){return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw Error("Not support yet.");case 1:case"end":return e.stop()}}),e)}))),function(e){return _.apply(this,arguments)})},{key:"queryContractNodesStatus",value:(b=p(u.mark((function e(t){return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw Error("Not support yet.");case 1:case"end":return e.stop()}}),e)}))),function(e){return b.apply(this,arguments)})},{key:"queryContractConfigStatus",value:(k=p(u.mark((function e(t){return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw Error("Not support yet.");case 1:case"end":return e.stop()}}),e)}))),function(e){return k.apply(this,arguments)})},{key:"queryLogLevel",value:(g=p(u.mark((function e(t){return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw Error("Not support yet.");case 1:case"end":return e.stop()}}),e)}))),function(e){return g.apply(this,arguments)})},{key:"updateBlackList",value:(v=p(u.mark((function e(t){return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw Error("Not support yet.");case 1:case"end":return e.stop()}}),e)}))),function(e){return v.apply(this,arguments)})},{key:"queryBlockProof",value:(m=p(u.mark((function e(t){return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw Error("Not support yet.");case 1:case"end":return e.stop()}}),e)}))),function(e){return m.apply(this,arguments)})},{key:"queryBlockHeaderProof",value:(f=p(u.mark((function e(t){return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw Error("Not support yet.");case 1:case"end":return e.stop()}}),e)}))),function(e){return f.apply(this,arguments)})},{key:"queryStateProof",value:(i=p(u.mark((function e(t){return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw Error("Not support yet.");case 1:case"end":return e.stop()}}),e)}))),function(e){return i.apply(this,arguments)})},{key:"queryTransactionProof",value:(c=p(u.mark((function e(t){return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw Error("Not support yet.");case 1:case"end":return e.stop()}}),e)}))),function(e){return c.apply(this,arguments)})},{key:"queryReceiptProof",value:(s=p(u.mark((function e(t){return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw Error("Not support yet.");case 1:case"end":return e.stop()}}),e)}))),function(e){return s.apply(this,arguments)})},{key:"queryBlockHeaderInfos",value:(o=p(u.mark((function e(t){return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw Error("Not support yet.");case 1:case"end":return e.stop()}}),e)}))),function(e){return o.apply(this,arguments)})},{key:"queryBlockReceiptInfos",value:(a=p(u.mark((function e(t){return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw Error("Not support yet.");case 1:case"end":return e.stop()}}),e)}))),function(e){return a.apply(this,arguments)})},{key:"queryBlockBodyInfos",value:(n=p(u.mark((function e(t){return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw Error("Not support yet.");case 1:case"end":return e.stop()}}),e)}))),function(e){return n.apply(this,arguments)})},{key:"updateAuthMap",value:function(){var e=p(u.mark((function e(){return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw Error("WalletProvider 暂不支持 updateAuthMap");case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"queryAccount",value:function(e){return this.request({method:le.queryAccount,params:e})}},{key:"queryBlockHeader",value:function(e){return this.request({method:le.queryBlockHeader,params:e})}},{key:"queryBlock",value:function(e){return this.request({method:le.queryBlock,params:e})}},{key:"queryLastBlock",value:function(){return this.request({method:le.queryLastBlock})}},{key:"queryTransaction",value:function(e){return e.tee&&zo("queryTransaction"),this.request({method:le.queryTransaction,params:e})}},{key:"queryTransactionReceipt",value:function(e){return e.tee&&zo("queryTransactionReceipt"),this.request({method:le.queryTransactionReceipt,params:e})}},{key:"deployContract",value:function(t,r){return r.tee&&zo("deployContract"),this.request({method:le.deployWasmContract,params:e(e({},t),{},{contractName:t.contractName,contractType:t.contractType,abi:t.abi})})}},{key:"updateContract",value:function(){throw Error("wallet provider 暂不支持 updateContract")}},{key:"callContract",value:function(t,r){return(null==r?void 0:r.tee)&&zo("callContract"),this.request({method:t.contractType===ae.solidity?le.callSolidityContract:le.callWasmContract,params:e(e({methodName:t.methodName,args:t.args},r),{},{contractName:t.contractName,contractType:t.contractType,abi:t.abi})})}},{key:"queryContract",value:function(e){return this.request({method:le.queryContract,params:e})}},{key:"sign",value:(r=p(u.mark((function e(t){return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw Error("暂不支持");case 1:case"end":return e.stop()}}),e)}))),function(e){return r.apply(this,arguments)})}]),L}();export{he as AntchainProvider,ve as AntchainSDKError,Aa as BaseProvider,mo as ChainIds,vo as ChainProvider,Lo as CloudCryptoRestProvider,_e as Contract,ae as ContractType,me as EventListenerType,Uo as LocalCryptoRestProvider,ce as MychainMethods,ie as RestMethods,de as RestMethodsUrlMap,Ao as RestServices,Ta as SolContract,se as TxType,oe as VmType,le as WalletMethods,Wo as WalletProvider,Ba as WasmContract,ka as convertHex2Base64,ga as convertHex2Buffer,ne as createDebug,ue as debug,zt as decryptAESWithPassword,pa as decryptTXWithAES,ko as errorCodeMessages,Ot as generateAESKey,la as getAbier,da as getUserInfo,te as isChromeBackground,X as isDebug,Z as isDev,$ as isElectron,ee as isNode,Ra as maxQueryTransactionReceiptRetryInterval,Ze as parsePrivateKeyToAES,Ka as queryTransactionReceiptRetryInterval,ba as remove0x,Xe as signMessage,va as toUTF8,ye as useAntchain};
