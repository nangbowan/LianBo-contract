import e from"@babel/runtime/helpers/esm/objectSpread2";import t from"@babel/runtime/regenerator";import r from"@babel/runtime/helpers/esm/asyncToGenerator";import n from"@babel/runtime/helpers/esm/typeof";import a from"@babel/runtime/helpers/esm/classCallCheck";import o from"@babel/runtime/helpers/esm/createClass";import s from"debug";import c from"@babel/runtime/helpers/esm/inherits";import i from"@babel/runtime/helpers/esm/createSuper";import u from"@babel/runtime/helpers/esm/wrapNativeSuper";import p from"@babel/runtime/helpers/esm/defineProperty";import f from"bignumber.js";import{enc as y,SHA256 as h,AES as l,pad as d,mode as m}from"crypto-js";import v from"crypto-js/sha3";import{Buffer as g}from"safe-buffer";import{AbiCoder as k}from"@ethersproject/abi";import _ from"@babel/runtime/helpers/esm/createForOfIteratorHelper";import b from"fcbuffer";import w from"node-forge";import{decode as x,encode as C}from"rlp";import{sign as q}from"secp256k1";import E from"md5.js";import S from"public-encrypt/browser";import{createCipheriv as T,createDecipheriv as P}from"browserify-aes/browser";import N from"create-hash";import B from"js-encoding-utils";import{ec as R}from"elliptic";import{define as I}from"asn1.js";import K from"bn.js";import A from"@babel/runtime/helpers/esm/toConsumableArray";import O from"events";import D from"tls";import{nanoid as L}from"nanoid";import U from"axios";import{v4 as z}from"uuid";import{JsonRpcEngine as W}from"json-rpc-engine";import{createStreamMiddleware as j}from"json-rpc-middleware-stream";import H from"pump";var M="1"===process.env.MYFISH_DEBUG,Q="development"===process.env.NODE_ENV,F=require("is-electron")(),V="undefined"==typeof window&&"undefined"==typeof chrome&&!F,Y="undefined"!=typeof chrome&&"undefined"==typeof window,J=function(){return s.enable("antchain:*")};function G(e){return(Q||M)&&J(),s(e)}"undefined"!=typeof window&&(window.enableDebug=J),"undefined"!=typeof globalThis&&(globalThis.enableDebug=J);var X,Z,$,ee,te,re=G("antchain:jssdk");!function(e){e.assemblyscript="assemblyscript",e.solidity="solidity"}(X||(X={})),function(e){e.WASM="WASM",e.EVM="EVM"}(Z||(Z={})),function(e){e.TX_DEPLOY_CONTRACT="TX_DEPLOY_CONTRACT",e.CALL_CONTRACT="CALL_CONTRACT"}($||($={})),function(e){e.queryBlock="QueryBlock",e.queryLastBlock="QueryLastBlock",e.queryTransaction="QueryTransaction",e.queryTransactionReceipt="QueryTransactionReceipt",e.queryAccount="QueryAccount",e.queryContract="QueryContract",e.deployContract="DeployContract",e.updateContract="UpdateContract",e.callContract="CallContract",e.encryptedTransaction="EncryptedTransaction",e.LocalTransaction="LocalTransaction"}(ee||(ee={})),function(e){e.queryBlock="QUERYBLOCKBODY",e.queryBlockHeader="QUERYBLOCK",e.queryLastBlock="QUERYLASTBLOCK",e.queryTransactionFromBlockchain="QUERYTRANSACTIONFROMBLOCKCHAIN",e.queryTransactionReceipt="QUERYRECEIPT",e.queryAccount="QUERYACCOUNT",e.queryContract="QUERYCONTRACT",e.deploySolidityContractForBizAsync="DEPLOYCONTRACTFORBIZASYNC",e.updateSolidityContractForBizAsync="UPDATECONTRACTFORBIZASYNC",e.deployWasmContractForBiz="DEPLOYWASMCONTRACT",e.updateWasmContractForBiz="UPDATECONTRACTFORBIZ",e.deployWasmContract="DEPLOYCONTRACT",e.updateWasmContract="UPDATECONTRACT",e.callWasmContractForBiz="CALLWASMCONTRACT",e.callWasmContractForBizAsync="CALLWASMCONTRACTASYNC",e.callWasmContract="CALLWASMCONTRACT",e.callContract="CALLCONTRACT",e.createAccountForBiz="TENANTCREATEACCUNT"}(te||(te={}));var ne,ae=p({default:"/api/contract/chainCall"},te.callWasmContract,"/api/contract/chainCallForBiz");!function(e){e.queryBlockHeader="antchain_queryBlockHeader",e.queryBlock="antchain_queryBlock",e.queryLastBlock="antchain_queryLastBlock",e.queryTransaction="antchain_queryTransaction",e.queryTransactionReceipt="antchain_queryTransactionReceipt",e.queryAccount="antchain_queryAccount",e.queryContract="antchain_queryContract",e.sign="antchain_sign",e.deployContract="antchain_deployContract",e.deployWasmContract="antchain_deployWasmContract",e.deploySolidityContract="antchain_deploySolidityContract",e.callContract="antchain_callContract",e.callWasmContract="antchain_callWasmContract",e.callSolidityContract="antchain_callSolidityContract",e.getProviderState="antchain_getProviderState",e.requestAccounts="antchain_requestAccounts",e.subscription="antchain_subscription"}(ne||(ne={}));var oe,se=function(e){c(r,u(Error));var t=i(r);function r(e,n,o){var s;return a(this,r),(s=t.call(this,e)).code=void 0,s.data=void 0,s.name="AntchainSDKError",s.code=n,s.data=o,s}return o(r)}();!function(e){e[e.ACCOUNT=0]="ACCOUNT",e[e.CONTRACT=1]="CONTRACT",e[e.TOPICS=2]="TOPICS",e[e.BLOCK=3]="BLOCK"}(oe||(oe={}));var ce,ie,ue,pe=function(){function s(e,t){a(this,s),this.options=void 0,this.provider=void 0,this.contractName=void 0,this.contractType=void 0,this.vmType=void 0,this.abi=void 0,re("[Contract] new contarct with options:",e),this.options=e,this.provider=t;var r=e.contractType,o=void 0===r?X.assemblyscript:r,c=e.abi;this.contractName=e.contractName,this.contractType=o,this.vmType=o===X.solidity?Z.EVM:Z.WASM,this.abi="object"===n(c)?JSON.stringify(c):c}var c,i;return o(s,[{key:"on",value:function(e,t){this.provider.watchContractEvent(this,e,t)}},{key:"deploy",value:(i=r(t.mark((function e(r,n){return t.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(n||{}).update){e.next=5;break}return e.abrupt("return",this.provider.updateContract(this,r));case 5:return e.abrupt("return",this.provider.deployContract(this,r));case 6:case"end":return e.stop()}}),e,this)}))),function(e,t){return i.apply(this,arguments)})},{key:"call",value:(c=r(t.mark((function r(n){return t.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(1===this.provider.majorVersion){t.next=4;break}if(this.vmType!==Z.EVM){t.next=3;break}throw Error("当前版本的连接器不支持调用 Solidity 合约，请升级。");case 3:return t.abrupt("return",this.provider.callContract(e({contractName:this.contractName,vmType:this.vmType,abi:this.abi},n)));case 4:return t.abrupt("return",this.provider.callContract(this,n));case 5:case"end":return t.stop()}}),r,this)}))),function(e){return c.apply(this,arguments)})},{key:"generateDeployCode",value:function(e,t){throw Error("不能直接调用 Contract 类的 generateDeployCode")}},{key:"generateCallCode",value:function(e,t){throw Error("不能直接调用 Contract 类的 generateCallCode")}},{key:"parseReturnOutput",value:function(e,t){throw Error("不能直接调用 Contract 类的 generateCallCode")}}]),s}(),fe=String.fromCharCode;function ye(e){for(var t,r,n=[],a=0,o=e.length;o>a;)55296>(t=e.charCodeAt(a++))||t>56319||a>=o?n.push(t):56320==(64512&(r=e.charCodeAt(a++)))?n.push(((1023&t)<<10)+(1023&r)+65536):(n.push(t),a--);return n}function he(e){if(e>=55296&&57343>=e)throw Error("Lone surrogate U+"+e.toString(16).toUpperCase()+" is not a scalar value")}function le(e,t){return fe(e>>t&63|128)}function de(e){if(0==(4294967168&e))return fe(e);var t="";return 0==(4294965248&e)?t=fe(e>>6&31|192):0==(4294901760&e)?(he(e),t=fe(e>>12&15|224),t+=le(e,6)):0==(4292870144&e)&&(t=fe(e>>18&7|240),t+=le(e,12),t+=le(e,6)),t+=fe(63&e|128)}function me(){if(ue>=ie)throw Error("Invalid byte index");var e=255&ce[ue];if(ue++,128==(192&e))return 63&e;throw Error("Invalid continuation byte")}var ve=function(e){for(var t=ye(e),r=t.length,n=-1,a="";++n<r;)a+=de(t[n]);return a},ge=function(e){ce=ye(e),ie=ce.length,ue=0;for(var t,r,n,a=[];!1!==(r=void 0,n=void 0,t=ue!=ie&&(r=255&ce[ue],ue++,0==(128&r)?r:192!=(224&r)||128>(n=(31&r)<<6|me())?224!=(240&r)||2048>(n=(15&r)<<12|me()<<6|me())?240!=(248&r)||65536>(n=(7&r)<<18|me()<<12|me()<<6|me())||n>1114111?void 0:n:(he(n),n):n));)a.push(t);return function(e){for(var t,r=e.length,n=-1,a="";++n<r;)(t=e[n])>65535&&(a+=fe((t-=65536)>>>10&1023|55296),t=56320|1023&t),a+=fe(t);return a}(a)};function ke(e,t){var r=e;return"hex"===t&&(r.length>2&&"0x"===r.substr(0,2)&&(r=r.substr(2)),r=y.Hex.parse(r)),""+v(r,{outputLength:256})}function _e(e,t){var r="0x";t&&(r="");var n=e.toString("hex");if(xe(e)){if("0x"!==e.substr(0,2))return r+""+h(e);n=e.substr(2)}var a=y.Hex.parse(n);return r+h(a).toString(y.Hex)}function be(e){return g.isBuffer(e)}function we(e){return e&&(e instanceof f||e.constructor&&"BigNumber"===e.constructor.name)}function xe(e){return"string"==typeof e||e&&e.constructor&&"String"===e.constructor.name}function Ce(e){return null!==e&&!Array.isArray(e)&&"object"===n(e)}function qe(e){return Array.isArray(e)}function Ee(e,t){var r=e,n=t;if(be(r))return r;"number"==typeof r&&(r=r.toString(16)),xe(r)&&0===r.indexOf("0x")&&(r=r.slice(2)),n||(n=Math.ceil(r.length/2));for(var a=g.alloc(n),o=0;n>o;o++){var s=r.slice(2*o,2*o+2)||"00";a.write(s,o,1,"hex")}return a}function Se(e,t,r){return parseInt(t)>e.length?e+Array(parseInt(t)-e.length+1).join(r||"0"):e}function Te(e,t){var r=e||0;return we(r)?r:xe(r)?0===r.indexOf("0x")||0===r.indexOf("-0x")?new f(r.replace("0x",""),16):new f(r,t||16):new f(r.toString(10),10)}function Pe(e,t){return Te(e,t).toNumber()}function Ne(e,t){var r="0x";t&&(r="");var n=Te(e),a=n.toString(16);return n.lessThan(0)?"-"+r+a.substr(1):r+a}function Be(e,t,r){for(var n=ve(e),a="",o=0;n.length>o;o++){var s=n.charCodeAt(o);if(0===s){if(!t)break;a+="00"}else{var c=s.toString(16);a+=2>c.length?"0"+c:c}}var i="0x";return r&&(i=""),i+a}function Re(e,t){var r="0x";return t&&(r=""),be(e)?r+e.toString("hex"):Ke(e,t)}function Ie(e){return ge(function(e,t){var r="",n=0;for("0x"===e.substring(0,2)&&(n=2);e.length>n;n+=2){var a=parseInt(e.substr(n,2),16);if(t&&0===a)break;r+=String.fromCharCode(a)}return r}(e))}function Ke(e,t){return"boolean"==typeof e?Ne(+e,t):we(e)?Ne(e,t):"object"===n(e)?Be(JSON.stringify(e),!1,t):xe(e)?0===e.indexOf("-0x")?function(e,t){return Ne(e,t)}(e,t):0===e.indexOf("0x")?e:Be(e,1,t):Ne(e,t)}function Ae(e){var t=e;return xe(t)?("0x"===t.substr(0,2)&&(t=t.substr(2)),g.from(t,"hex")):t}var Oe={name:"uint64",Identity:"bytes",checksum160:"fixed_bytes20",checksum256:"fixed_bytes32",checksum512:"fixed_bytes64",signature:"fixed_bytes65",public_key:"fixed_bytes33",message_type:"fixed_string16",symbol:"uint64",symbol_code:"uint64",field_name:"string",account_name:"name",permission_name:"name",type_name:"string",table_name:"name",scope_name:"name",action_name:"string",time_point:"int64",time_point_sec:"time",timestamp:"uint32",block_timestamp_type:"timestamp",block_id:"fixed_bytes32",checksum_type:"fixed_bytes32",checksum256_type:"fixed_bytes32",checksum512_type:"fixed_bytes64",checksum160_type:"fixed_bytes20",sha256:"fixed_bytes32",sha512:"fixed_bytes64",sha160:"fixed_bytes20",weight_type:"uint16",block_num_type:"uint32",share_type:"int64",digest_type:"checksum_type",context_free_type:"bytes",unsigned_int:"varuint32",bool:"uint8",extensions_type:{base:"",fields:{type:"uint16",data:"bytes"}},transaction_header:{base:"",fields:{expiration:"time",ref_block_num:"uint16",ref_block_prefix:"uint32",max_net_usage_words:"unsigned_int",max_cpu_usage_ms:"uint8",delay_sec:"unsigned_int"}},transaction:{base:"transaction_header",fields:{context_free_actions:"action[]",actions:"action[]",transaction_extensions:"extensions_type[]"}},signed_transaction:{base:"transaction",fields:{signatures:"signature[]",context_free_data:"bytes[]"}},fields:"field_def[]",field_def:{fields:{name:"field_name",type:"type_name"}},type_def:{base:"",fields:{new_type_name:"type_name",type:"type_name"}},struct_def:{base:"",fields:{name:"type_name",base:"type_name",fields:"field_def[]"}},clause_pair:{base:"",fields:{id:"string",body:"string"}},error_message:{base:"",fields:{error_code:"uint64",error_msg:"string"}},abi_def:{base:"",fields:{version:"string",types:"type_def[]",structs:"struct_def[]",actions:"action_def[]",tables:"table_def[]",ricardian_clauses:"clause_pair[]",error_messages:"error_message[]",abi_extensions:"extensions_type[]"}},table_def:{base:"",fields:{name:"table_name",index_type:"type_name",key_names:"field_name[]",key_types:"type_name[]",type:"type_name"}},permission_level:{base:"",fields:{actor:"account_name",permission:"permission_name"}},action:{base:"",fields:{name:"action_name"}},action_def:{base:"",fields:{name:"string",type:"type_name"}}},De=function(e){return{"abi_def.fromObject":function(e){if("string"==typeof e){var t=""+g.from(e,"hex");return 0===t.length&&(t=""+g.from(e)),JSON.parse(t)}return g.isBuffer(e)?JSON.parse(""+e):null}}},Le=function(e){return{"setcode.code.fromObject":function(t){var r=t.object,n=t.result;try{var a=""+r.code;if(/^\s*\(module/.test(a)){var o=e.binaryen;e.debug&&console.log("Assembling WASM..");var s=g.from(o.parseText(a).emitBinary());n.code=s}else n.code=r.code}catch(e){throw console.error(e,r.code),e}}}};function Ue(e){null==e&&(e={}),e.abiCache={abi:function(e,n){if(n){g.isBuffer(n)&&(n=JSON.parse(n));var a=function(e,t){var r={};e.types&&e.types.forEach((function(e){r[e.new_type_name]=e.type}));e.structs&&e.structs.forEach((function(e){var t,n={},a=_(e.fields);try{for(a.s();!(t=a.n()).done;){var o=t.value;n[o.name]=o.type}}catch(e){a.e(e)}finally{a.f()}r[e.name]={base:e.base,fields:n,results:e.results},""===e.base&&delete r[e.name].base}));e.interfaces&&e.interfaces.forEach((function(e){var n=r[e.type];n?n.interface={name:e.name}:console.error("Missing abiSchema type",e.type,t)}));return r}(n,e),o=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0,r=Object.assign({},De(),Le(e),e.override),n=Object.assign({},{},e.customTypes);(e=Object.assign({override:r},{customTypes:n},e)).sort=Object.assign({},e.sort);var a=Object.assign({},Oe,t),o=b(a,e),s=o.structs,c=o.types,i=o.errors,u=o.fromBuffer,p=o.toBuffer;if(0!==i.length)throw Error(JSON.stringify(i,null,4));return{structs:s,types:c,fromBuffer:u,toBuffer:p}}(t,a);return r[e]=Object.assign({abi:n,schema:a},o)}var s=r[e];if(null==s)throw Error("Abi '".concat(e,"' is not cached"));return s}};var t=Object.assign({},{defaults:!0},e),r={};return e.abiCache}function ze(e,t){var r=w.md.sha256.create().update(t,"utf8");re("[signMessage] message hash:",r.digest().toHex());var n=""+w.pki.privateKeyFromPem(e).sign(r),a=Buffer.from(w.util.binary.raw.decode(n)).toString("hex");return re("[signMessage] result:",a),a}function We(e,t){if(re("[parsePrivateKeyToAES] privateKey:",e),re("[parsePrivateKeyToAES] passphrase:",t),V){var r=require("crypto").createPrivateKey({format:"pem",key:e,passphrase:t}).export({type:"sec1",format:"pem",cipher:"aes-256-cbc",passphrase:t});return re("[parsePrivateKeyToAES] use node crypto, result:",r),r}return re("[parsePrivateKeyToAES] 浏览器端需要用户手动进行转换"),e}function je(e){return e.readInt32BE(0)}function He(e){return C(e)}function Me(e,t){return Re(He(e),t)}function Qe(e){return x(e)}function Fe(e,t,r){this.tag=t,g.isBuffer(e)?this.encode(e,t,r):e&&this.decode(e.toString("ascii").trim(),r)}Fe.prototype.toString=function(){return this.pem},Fe.prototype.toBuffer=function(){return this.buf},Fe.prototype.decode=function(e,t){e&&(this.pem=e.toString("ascii").trim());var r,n=this.pem.split(/\r?\n/),a=n[0].match(/\-\-\-\-\-\s*BEGIN ?([^-]+)?\-\-\-\-\-/);if(!a)throw Error("parse PEM: BEGIN not found");if(this.tag=a[1],n.shift(),"Proc-Type: 4,ENCRYPTED"===n[0]){if("string"!=typeof t)throw Error("PEM is encrypted but no passphrase given");r=n[1].match(/DEK-Info: ([^,]+),([0-9A-F]+)/i),n.splice(0,3);var o=r[1].toLowerCase(),s=g(r[2],"hex"),c=function(e,t,r){var n=r,a=Ve[e];if(!a){throw new TypeError("Unsupported type. Allowed: "+Object.keys(Ve))}var o=n.length,s=8;n.length!==s&&(n=n.slice(0,s));var c,i=16,u=!1,p=new g(a),f=0;for(;;){var y=new E;u?y.update(c):u=!0,y.update(t),y.update(n),c=y.digest();for(var h=0;a&&i>h;)p[f++]=c[h],a--,h++;var l=Math.min(o,i-h);if(o-=l,h+=l,0==a&&0==o)break}return p}
/**
 * @fileOverview
 * @name base64x-1.1.js
 * @author Kenji Urushima kenji.urushima@gmail.com
 * @version jsrsasign 8.0.12 base64x 1.1.14 (2018-Apr-22)
 * @since jsrsasign 2.1
 * @license <a href="https://kjur.github.io/jsrsasign/license/">MIT License</a>
 */(o.toUpperCase(),t,s);n.pop();var i=n.join("").toString("hex"),u=y.Hex.parse(c.toString("hex")),p=l.decrypt(i,u,{iv:y.Hex.parse(s.toString("hex")),padding:d.NoPadding,mode:m.CBC});r&&(this.buf=g(p.toString(y.Hex),"hex"))}return this.pem="-----BEGIN"+(this.tag?" "+this.tag:"")+"-----\n"+g(this.buf).toString("base64").match(/.{1,64}/g).join("\n")+"\n-----END"+(this.tag?" "+this.tag:"")+"-----",this.pem};var Ve={"DES-EDE3-CBC":24,"DES-CBC":8,"AES-128-CBC":16,"AES-192-CBC":24,"AES-256-CBC":32};function Ye(e,t){return"-----BEGIN "+t+"-----\r\n"+function(e){return function(e){var t,r,n="";for(t=0;e.length>=t+3;t+=3)r=parseInt(e.substring(t,t+3),16),n+=Je.charAt(r>>6)+Je.charAt(63&r);for(t+1==e.length?(r=parseInt(e.substring(t,t+1),16),n+=Je.charAt(r<<2)):t+2==e.length&&(r=parseInt(e.substring(t,t+2),16),n+=Je.charAt(r>>2)+Je.charAt((3&r)<<4));(3&n.length)>0;)n+="=";return n}(e)}
/*! (c) Tom Wu | http://www-cs-students.stanford.edu/~tjw/jsbn/
 */(e).replace(/(.{64})/g,"$1\r\n").replace(/\r\n$/,"")+"\r\n-----END "+t+"-----\r\n"}var Je="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";var Ge=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"];function Xe(e){if(e>65536)throw Error("requested too many random bytes");var t=g.allocUnsafe(e);return e>0&&function(e){for(var t=e.length,r=0;t>r;r++)e[r]="0x"+Ge[parseInt(16*Math.random())]+Ge[parseInt(16*Math.random())]}(t),t}var Ze=new R("secp256k1"),$e=Buffer.from("fffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141","hex"),et=Buffer.alloc(32,0);function tt(e,t){if(!e)throw Error(t||"Assertion failed")}function rt(e){return t=e,!(!Buffer.isBuffer(t)||32!==t.length)&&(e.compare(et)>0&&0>e.compare($e));var t}function nt(e){return Buffer.from(Xe(e))}function at(e,t,r){if(!t||!r)throw Error("aes empty key or iv!");var n=T("aes-128-gcm",t,r);n.setAutoPadding(!1);var a=n.update(e).toString("hex");return n.final(),{data:a,authTag:n.getAuthTag().toString("hex")}}function ot(e){var t=N("sha256").update(e).digest();return new Uint8Array(t)}function st(e){return tt(32===e.length,"Bad private key"),tt(rt(e),"Bad private key"),Buffer.from(Ze.keyFromPrivate(e).getPublic("arr"))}function ct(e,t){tt(Buffer.isBuffer(e),"Bad private key"),tt(Buffer.isBuffer(t),"Bad public key"),tt(32===e.length,"Bad private key"),tt(rt(e),"Bad private key"),tt(65===t.length||33===t.length,"Bad public key"),65===t.length&&tt(4===t[0],"Bad public key"),33===t.length&&tt(2===t[0]||3===t[0],"Bad public key");var r=Ze.keyFromPrivate(e),n=Ze.keyFromPublic(t),a=r.derive(n.getPublic());return Buffer.from(a.toArray())}var it="02",ut={prime256v1:32,secp256k1:32,secp384r1:48,secp521r1:66},pt={prime256v1:"P-256",secp256k1:"P-256K",secp384r1:"P-384",secp521r1:"P-521"},ft={"P-256":"prime256v1","P-256K":"secp256k1","P-384":"secp384r1","P-521":"secp521r1"},yt=I("Rfc5915Key",(function(){this.seq().obj(this.key("version").int(),this.key("privateKey").octstr(),this.key("parameters").optional().explicit(0).objid({"1 2 840 10045 3 1 7":"prime256v1","1 3 132 0 10":"secp256k1","1 3 132 0 34":"secp384r1","1 3 132 0 35":"secp521r1"}),this.key("publicKey").optional().explicit(1).bitstr())})),ht=I("Pkcs8Key",(function(){this.seq().obj(this.key("version").int(),this.key("algorithmIdentifier").seq().obj(this.key("privateKeyType").objid({"1 2 840 10045 2 1":"EC"}),this.key("parameters").objid({"1 2 840 10045 3 1 7":"prime256v1","1 3 132 0 10":"secp256k1","1 3 132 0 34":"secp384r1","1 3 132 0 35":"secp521r1"})),this.key("privateKey").octstr())})),lt=I("SpkiKey",(function(){this.seq().obj(this.key("algorithmIdentifier").seq().obj(this.key("publicKeyType").objid({"1 2 840 10045 2 1":"EC"}),this.key("parameters").objid({"1 2 840 10045 3 1 7":"prime256v1","1 3 132 0 10":"secp256k1","1 3 132 0 34":"secp384r1","1 3 132 0 35":"secp521r1"})),this.key("publicKey").bitstr())}));function dt(e,t){var r=ut[e];if(4==t[0]){if(t.length!=2*r+1)throw new TypeError("Invalid uncompressed key size");return{c:e,x:t.slice(1,r+1),y:t.slice(r+1)}}throw new TypeError("Compressed key unsupported")}function mt(e){var t=ht.decode(e,"der"),r=yt.decode(t.privateKey,"der"),n=t.algorithmIdentifier.parameters,a=ut[n],o=r.privateKey;if(o.length>a)throw new TypeError("Invalid private key size: expected "+a+" gotten "+o.length);var s=dt(n,r.publicKey.data);return s.d=o,s}function vt(e){var t=lt.decode(e,"der");return dt(t.algorithmIdentifier.parameters,t.publicKey.data)}var gt=/-+BEGIN EC PRIVATE KEY-+([\s\S]+)-+END EC PRIVATE KEY-+/m,kt=/-+BEGIN PRIVATE KEY-+([\s\S]*)-+END PRIVATE KEY-+/m,_t=/-+BEGIN PUBLIC KEY-+([\s\S]*)-+END PUBLIC KEY-+/m;function bt(e){if("string"!=typeof e)throw new TypeError("PEM must be a string");var t=null;if(t=e.match(gt))return function(e){var t=yt.decode(e,"der"),r=ut[t.parameters],n=t.privateKey;if(n.length>r)throw new TypeError("Invalid private key size: expected "+r+" gotten "+n.length);var a=dt(t.parameters,t.publicKey.data);return a.d=n,a}(new g(t[1].replace(/[\s-]/gm,""),"base64"));if(t=e.match(kt))return mt(new g(t[1].replace(/[\s-]/gm,""),"base64"));if(t=e.match(_t))return vt(new g(t[1].replace(/[\s-]/gm,""),"base64"));throw new TypeError("Unrecognized PEM key structure")}function wt(e,t){if(!(this instanceof wt))return new wt(e,t);var r,n,a,o,s;if(t||(t="pem"),g.isBuffer(e))if("pem"==t)r=(c=bt(e.toString("ascii"))).c,a=c.x,o=c.y,n=c.d;else if("pkcs8"==t||"rfc5208"==t){r=(c=mt(e)).c,a=c.x,o=c.y,n=c.d}else{if("spki"!=t&&"rfc5280"!=t)throw new TypeError('Unknown format for EC Key "'+t+'"');r=(c=vt(e)).c,a=c.x,o=c.y,n=c.d}else if("string"==typeof e){if("pem"==t)r=(c=bt(e)).c,a=c.x,o=c.y,n=c.d;else if("pkcs8"==t||"rfc5208"==t){r=(c=mt(new g(e,"base64"))).c,a=c.x,o=c.y,n=c.d}else{if("spki"!=t&&"rfc5280"!=t)throw new TypeError('Unknown format for EC Key "'+t+'"');r=(c=vt(new g(e,"base64"))).c,a=c.x,o=c.y,n=c.d}}else{if(!(s=e)||s.constructor!==Object)throw new TypeError("Unrecognized format for EC key");if("string"==typeof e.curve?r=e.curve:"string"==typeof e.crv&&(r=ft[e.crv]||e.crv),g.isBuffer(e.privateKey)?n=e.privateKey:"string"==typeof e.privateKey?n=new g(e.privateKey,"base64"):g.isBuffer(e.d)?n=e.d:"string"==typeof e.d&&(n=new g(e.d,"base64")),g.isBuffer(e.publicKey)){var c=dt(r,e.publicKey);a=c.x,o=c.y}else if("string"==typeof e.publicKey){c=dt(r,new g(e.publicKey,"base64"));a=c.x,o=c.y}else g.isBuffer(e.x)?a=e.x:"string"==typeof e.x&&(a=new g(e.x,"base64")),g.isBuffer(e.y)?o=e.y:"string"==typeof e.y&&(o=new g(e.y,"base64"))}if(!r)throw new TypeError("EC Key curve not specified");if(!a||!o)throw new TypeError("Public EC Key point unavailable");var i=ut[r];if(!i)throw new TypeError('EC Key curve "'+r+'" invalid');if(a.length!=i)throw new TypeError("Public EC Key point X of wrong length");if(o.length!=i)throw new TypeError("Public EC Key point Y of wrong length");if(n&&o.length!=i)throw new TypeError("Private EC Key of wrong length");Object.defineProperties(this,{curve:{enumerable:!0,configurable:!1,value:r},isPrivateECKey:{enumerable:!0,configurable:!1,value:null!=n},x:{enumerable:!0,configurable:!1,get:function(){return new g(a)}},y:{enumerable:!0,configurable:!1,get:function(){return new g(o)}},jsonCurve:{enumerable:!1,configurable:!1,value:pt[r]},publicCodePoint:{enumerable:!1,configurable:!1,get:function(){return g.concat([new g([4]),a,o])}}}),n&&Object.defineProperty(this,"d",{enumerable:!0,configurable:!1,get:function(){return new g(n)}})}function xt(e,t){return function(e,t){var r=new wt(function(e,t,r){return new Fe(e,t,r)}(e,"EC PRIVATE KEY",t).pem,"pem"),n=r.d,a=r.publicCodePoint;a.length>64&&(a=a.slice(1));return{privateKey:n,publicKey:a}}(e,t)}function Ct(e,t){var r=e;be(r)?32!==r.length&&(r=Ee(_e(r))):r=xe(r)&&0===r.indexOf("0x")?Ee(r):Ee(_e(r));var n=q(r,t);return g.concat([n.signature,g.from([n.recovery])],65)}function qt(e,t){var r=e,n=t;if(!r||!n)throw Error("aes password or tx hash is invalid"+r+"..."+n);if(xe(r)&&(r="0x"===r.substr(0,2)?g.from(r.substr(2),"hex"):g.from(r,"ascii")),!be(r))throw Error("aes password is invalid");return n=Ae(n),N("sha256").update(g.concat([r,n])).digest().slice(0,16)}function Et(){return Xe(4).readUInt32BE(0)}function St(e,t,r,n,a){return a===it?function(e,t,r){var n=r,a=e;if(!a)throw Error("ecc_pub_key is invalid");n||(n=Xe(16));n=Ae(n);var o=Xe(12),s=Tt(t,n,o),c=g.from(s.authTag,"hex"),i=g.from(s.data,"hex"),u={iv:o},p=B.formatter.pemToBin(""+a),f=g.from(p),y=function(e,t){for(var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=r.ephemPrivateKey||nt(32);!rt(n);)n=r.ephemPrivateKey||nt(32);var a=st(n),o=ct(n,e),s=Buffer.alloc(36);o.copy(s,0,0,32),s[35]=1;var c=ot(s),i=r.iv||nt(12),u=Buffer.from(c.slice(0,16)),p=at(t,u,i),f=Ae(p.data),y=Ae(p.authTag);return Buffer.concat([a,i,y,f])}(a=Ae(a=f.slice(f.byteLength-65,f.byteLength)),n,u);if(109>y.length){var h=g.alloc(109);y.copy(h,109-y.length),y=h}var l=new g(2);return l.writeUInt16BE(320,0),y=Ae(y),"0x"+g.concat([l,y,o,c,i]).toString("hex")}(e,t,qt(r,n)):function(e,t,r){var n=r,a=e;n||(n=Xe(16));if(n=Ae(n),!a)throw Error("rsa_pub_key is invalid");xe(a)&&-1===a.indexOf("PUBLIC KEY")&&("0x"===a.substr(0,2)&&(a=a.substr(2)),a=Ye(a,"PUBLIC KEY"));var o=Xe(12),s=Tt(t,n,o),c=S.publicEncrypt(a,n);if(256>c.length){var i=g.alloc(256);c.copy(i,256-c.length),c=i}var u=new g(2);return u.writeUInt16BE(1,0),"0x"+g.concat([u,c,o,g.from(s.authTag,"hex"),g.from(s.data,"hex")]).toString("hex")}(e,t,qt(r,n))}function Tt(e,t,r){if(!t||!r)throw Error("aes empty key or iv!");var n=e,a=t;n=Ae(n),a=Ae(a);var o=T("aes-128-gcm",a,r);o.setAutoPadding(!1);var s=o.update(n).toString("hex");return o.final(),{data:s,authTag:o.getAuthTag().toString("hex")}}function Pt(e,t,r){return function(e,t){if(!t||!e)throw Error("aes empty key or data!");var r=e,n=t;r=Ae(r),n=Ae(n);var a=r.length-16,o=r.length,s=r.slice(a,o),c=r.slice(a-=12,o-=16),i=r.slice(0,a),u=P("aes-128-gcm",n,c);return u.setAuthTag(s),"0x"+u.update(i).toString("hex")}(e,qt(t,r))}function Nt(e,t){if(-1!==e.name.indexOf("("))return e.name;var r="";return r=t?t.join(","):e.inputs.map((function(e){return e.type})).join(","),e.name+"("+r+")"}wt.prototype.asPublicECKey=function(){return this.isPrivateECKey?new wt({curve:this.curve,x:this.x,y:this.y}):this},wt.prototype.toBuffer=function(e){if(e||(e="pem"),"pem"==e)return new g(this.toString("pem"),"ascii");if(this.isPrivateECKey){for(var t=this.d;0==t[0];)t=t.slice(1);if("pkcs8"==e||"rfc5208"==e)return ht.encode({version:0,algorithmIdentifier:{privateKeyType:"EC",parameters:this.curve},privateKey:yt.encode({version:1,privateKey:t,publicKey:{data:this.publicCodePoint}},"der")},"der");if("rfc5915"==e)return yt.encode({version:1,privateKey:t,parameters:this.curve,publicKey:{data:this.publicCodePoint}},"der");throw new TypeError('Unknown format for private key "'+e+'"')}if("spki"==e||"rfc5280"==e)return lt.encode({algorithmIdentifier:{publicKeyType:"EC",parameters:this.curve},publicKey:{data:this.publicCodePoint}},"der");throw new TypeError('Unknown format for public key "'+e+'"')},wt.prototype.toString=function(e){if(e||(e="pem"),this.isPrivateECKey){if("pem"==e)return"-----BEGIN PRIVATE KEY-----\n"+this.toBuffer("pkcs8").toString("base64").match(/.{1,64}/g).join("\n")+"\n-----END PRIVATE KEY-----\n";if("rfc5915"==e)return"-----BEGIN EC PRIVATE KEY-----\n"+this.toBuffer("rfc5915").toString("base64").match(/.{1,64}/g).join("\n")+"\n-----END EC PRIVATE KEY-----\n";if("pkcs8"==e||"rfc5208"==e)return this.toBuffer("pkcs8").toString("base64");if("spki"==e||"rfc5280"==e)return this.toBuffer("spki").toString("base64");throw new TypeError('Unknown format for private key "'+e+'"')}if("pem"==e)return"-----BEGIN PUBLIC KEY-----\n"+this.toBuffer("spki").toString("base64").match(/.{1,64}/g).join("\n")+"\n-----END PUBLIC KEY-----\n";if("spki"==e||"rfc5280"==e)return this.toBuffer("spki").toString("base64");throw new TypeError('Unknown format for public key "'+e+'"')},wt.prototype.toJSON=function(){function e(e){return e.toString("base64").replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")}var t={kty:"EC",crv:pt[this.curve],x:e(this.x),y:e(this.y)},r=this.d;if(r){var n=ut[this.curve];if(n>r.length)r=g.concat([new g(n-r.length).fill(0),r]);t.d=e(r)}return t};var Bt;!function(e){e.CONNECTION="connection",e.RESPONSE_NOT_JSON="responseNotJSON",e.RETURNCODE_ERROR="returnCode",e.RECEIPT_ERROR="receiptResult"}(Bt||(Bt={}));var Rt=function(e){c(r,u(Error));var t=i(r);function r(e,n){var o;return a(this,r),(o=t.call(this,e)).type=void 0,o.code=void 0,o.returnCode=void 0,o.receiptCode=void 0,o.hash=void 0,o.output=void 0,n&&(o.type=n.type,o.code=n.code,o.returnCode=n.returnCode,o.receiptCode=n.receiptCode,o.hash=n.hash,o.output=n.output),o}return o(r)}(),It=function(){return new Rt("Invalid number of arguments to Solidity function")},Kt=function(){return new Rt("CONNECTION UNAUTHORIZED")},At=function(e){return new Rt("PARAMETER ERROR: The value of "+e+" is error")};function Ot(e){var t=e;return be(t)&&(t=t.toString("hex")),t?"0x"+t:""}var Dt=Object.freeze({__proto__:null,inputdecimal:function(e){return Pe(e)},inputhash:function e(t){if(xe(t)){if(0===t.indexOf("0x")){if(66===t.length)return t;if(66>t.length)return"0x"+Se(Ke(t).slice(2),64)}return _e(t)}if(be(t))return Re(t);if(qe(t)){for(var r=[],n=0;t.length>n;n++)r[n]=e(t[n]);return r}return"0x"+Se(Ke(t).slice(2),64)},inputbytes:function(e){return be(e)?Re(e):xe(e)&&0===e.indexOf("0x")?e:Ke(e)},inputcode:function(e,t,r){var n=t,a=r;n||(n="01"),a||(a="");var o="",s="",c=0;if(be(e)?(c=e.length,o=e.toString("hex")):xe(e)&&(0===(o=e).indexOf("0x")&&(o=o.slice(2)),c=o.length/2),"wasm"===n){n="02";var i=new Buffer(4);i.writeUInt32BE(c),s=i.toString("hex")}if(""===o)throw At("code");return"0x"+n+s+o+a},inputbignumber:function(e){return K.isBN(e)?e:xe(e)&&0===e.indexOf("0x")?new K(e.slice(2),16):new K(e,10)},outputdecimal:function(e,t){var r=e;return be(r)&&(r=r.toString("hex")),Pe(r,t)},outputbytes:Ot,outputhash:function(e){return Ot(e)},outputstring:function(e){var t=e;return be(t)&&(t=t.toString("hex")),Ie(t)},outputbignumber:function(e){var t=e;return"number"==typeof t?t:be(t)?new K(t=t.toString("hex"),16).toNumber():xe(t)&&0===t.indexOf("0x")?new K(t.slice(2),16).toNumber():new K(t).toNumber()}}),Lt=[[{name:"session_id"}]],Ut={name:"hash",type:"hash"},zt=Array(Ut);zt.value=[],zt.name="hashes",zt.type="array";var Wt=[{name:"key",type:"bytes"},{name:"value",type:"bytes"}];Wt.name="configs",Wt.type="array";var jt={name:"timestamp",type:"decimal"},Ht={name:"from",type:"hash"},Mt={name:"to",type:"hash"},Qt={name:"gas_used",type:"decimal"},Ft={name:"identity",type:"hash"},Vt={name:"transaction_index",type:"decimal"},Yt={name:"topic",type:"string"},Jt={name:"msg_type",type:"decimal"},Gt={name:"sequence",type:"decimal"},Xt={name:"group_id",type:"bytes"},Zt={name:"return_code",type:"decimal"},$t=[Jt],er=[$t,Gt,Xt],tr=[$t,Gt,Zt,Xt],rr={name:"block_number",type:"bignumber"},nr=[Yt];nr.name="topics",nr.type="array",nr.array_type="one";var ar=[Ht,Mt,nr,{name:"log_data",type:"bytes"}];ar.name="log_entry",ar.value=[],ar.type="array";var or=[{name:"result",type:"decimal"},Qt,ar,{name:"output",type:"bytes"}];or.name="receipt";var sr=[or];sr.name="receipts",sr.type="array";var cr={name:"transaction_type",type:"decimal"},ir={name:"nonce"},ur={name:"period",type:"decimal"},pr={name:"value",type:"decimal"},fr={name:"gas",type:"decimal"},yr={name:"version",type:"decimal",value:2},hr=[];hr.name="extensions",hr.type="array";var lr={name:"data",type:"bytes"},dr=[{name:"signature",type:"bytes"}];dr.name="signature",dr.type="array",dr.array_type="one";var mr=[Ut,cr,jt,ir,ur,Ht,Mt,pr,fr,Xt,yr,lr,dr,hr];mr.name="transaction";var vr=[Ut,cr,jt,ir,ur,Ht,Mt,pr,fr,Xt,yr,lr,dr,hr];vr.name="transactions",vr.type="array";var gr=[mr,or,rr,Vt];gr.name="transaction_infos",gr.type="array";var kr=A(mr);kr.type="array",kr.value=[],kr.name="transaction_list";var _r=A(or);_r.type="array",_r.value=[],_r.name="receipt_list";var br=[Ut,{name:"version",type:"decimal"},rr,{name:"parent_hash",type:"hash"},{name:"transaction_root",type:"bytes"},{name:"receipt_root",type:"bytes"},{name:"state_root",type:"bytes"},Qt,jt,{name:"log_bloom",type:"bytes"}];br.name="block_header";var wr=[kr,_r,{name:"consensus_proof",type:"bytes"}];wr.name="block_body";var xr=[br,wr];xr.name="block";var Cr={name:"balance",value:"",type:"decimal"},qr={name:"recover_key",type:"bytes"},Er={name:"recover_time",type:"decimal"},Sr={name:"status",type:"decimal"},Tr={name:"code",type:"bytes"},Pr={name:"storage_root",type:"bytes"},Nr={name:"code_hash",type:"hash"},Br={name:"encryption_key",type:"bytes"},Rr={name:"auth_key",type:"bytes"},Ir={name:"auth_weight",type:"decimal"},Kr=[Rr,Ir];Kr.name="auth_map",Kr.type="array",Kr.array_type=2,Kr.rlp=!0,Kr.mapInfo={key:Rr,value:Ir};var Ar=[Ft,Cr,qr,Er,Sr,Tr,Pr,Nr,Br,[{name:"acc_version",type:"decimal",value:2}],Kr],Or=[Ft,Cr,qr,Er,Sr,Tr,Pr,Nr,Br,Rr,Ir];Ar.name="data";var Dr=Ar,Lr={name:"node_id",type:"bytes",value:"0x00"},Ur={name:"public_key",type:"bytes"},zr={name:"node_role",type:"decimal"},Wr={name:"node_state",type:"decimal"},jr=[{name:"ip",type:"string"},{name:"port",type:"decimal"}];jr.name="endpoints",jr.type="array";var Hr=[[Lr,Ur,zr,Wr,jr],{name:"isConnected",type:"decimal"}];Hr.name="node_status",Hr.type="array";var Mr=[{name:"total_node_count",type:"decimal"},{name:"total_consensus_node_count",type:"decimal"},{name:"total_non_consensus_node_count",type:"decimal"},{name:"total_connected_consensus_node_count",type:"decimal"},{name:"total_connected_non_consensus_node_count",type:"decimal"},Hr];Mr.name="p2p_status";var Qr=[Lr,Ur,zr,Wr,jr];Qr.name="node_info",Qr.type="array";var Fr=[{name:"syncing",type:"decimal"},{name:"my_best",type:"decimal"},{name:"target",type:"decimal"}];Fr.name="sync_status";var Vr={name:"unverified_queue_limit",type:"decimal"},Yr={name:"verified_queue_limit",type:"decimal"},Jr={name:"unverified_queue_usage",type:"decimal"},Gr={name:"verified_queue_usage",type:"decimal"},Xr=[Vr,Yr,Jr,Gr];Xr.name="transaction_cache_info";var Zr=[Vr,Yr,{name:"verified_parent_not_found_queue_limit",type:"decimal"},Jr,Gr,{name:"verified_parent_not_found_queue_usage",type:"decimal"},{name:"unverified_max_block_number",type:"decimal"},{name:"verified_max_block_number",type:"decimal"},{name:"verified_parent_not_found_max_block_number",type:"decimal"}];Zr.name="block_cache_info";var $r={name:"code",type:"bytes"},en={name:"type",type:"decimal",value:0},tn={name:"filter_id",type:"decimal"},rn=[{name:"type",type:"bytes"},{name:"phase",type:"string"},{name:"n",type:"decimal"},{name:"f",type:"decimal"},{name:"current_leader",type:"bytes"},{name:"my_id",type:"bytes"},{name:"current_view",type:"decimal"},{name:"last_exec_seq",type:"decimal"},{name:"propose_size",type:"decimal"},{name:"propose_timeout_interval",type:"decimal"},{name:"normal_timeout_interval",type:"decimal"},{name:"viewchange_timeout_interval",type:"decimal"}];rn.name="info";var nn=[{name:"black_list",type:"hash"}];nn.name="black_list",nn.type="array";var an=[{name:"type",type:"decimal"},{name:"proof",type:"bytes"}];an.name="block_proof_info";var on={name:"block_number",type:"decimal"},sn=[{name:"data",type:"bytes"},{name:"next_key_begin_index",type:"decimal"},{name:"next_key_end_index",type:"decimal"}];sn.name="nodes",sn.type="array";var cn=[on,{name:"state_root",type:"bytes"},sn];cn.name="proof";var un={name:"root",type:"bytes"},pn={name:"index",type:"decimal"},fn={name:"size",type:"decimal"},yn={name:"branch",type:"decimal"},hn=[on,un,pn,fn,yn];hn.name="proof";var ln=[on,un,pn,fn,yn];ln.name="receipt_proof";var dn=[an,br];dn.name="header_infos",dn.type="array";var mn={name:"block_hash",type:"hash"},vn=[mn,sr];vn.name="block_receipts",vn.type="array";var gn=[vr,sr,{name:"consensus_proof",type:"bytes"}];gn.name="body";var kn=[mn,gn];kn.name="block_body",kn.type="array";var _n=25,bn=124,wn="CreateAccount",xn="QueryTransactionReceipt",Cn="TransferBalance",qn="SetRecoverkey",En="PreResetPubKey",Sn="ResetPubKey",Tn="UpdateAuthMap",Pn="QueryLastBlock",Nn="QueryBlockHeader",Bn="QueryLastBlockHeader",Rn="QueryBlock",In="QueryTransaction",Kn="QueryAccount",An="QueryContract",On="DeployContract",Dn="UpdateContract",Ln="CallContract",Un="EncryptedTransaction",zn="EventContract",Wn="EventFetch",jn={},Hn={};function Mn(e,t){return xe(e)&&"0x"===e.substr(0,2)&&66===e.length?t?e.substr(2):e:_e(e,t)}function Qn(e,t){for(var r=[],n=0;e.length>n;n++){var a=e[n];if(!Array.isArray(a)||a.rlp){var o=t[a.name]||a.value||"",s=a.type;a.rlp&&(s="bytes");var c=Dt["input"+s];c&&(o="code"===s&&t.type?c(o,t.type,t.parameters):c(o)),r[n]=o}else r[n]=Qn(a,t)}return r}function Fn(e,t){var r=Hn[e];if(!r)throw Error(e+" is not api");return Qn(r.data,t)}function Vn(e,t,r){for(var n=[],a=0;r.length>a;a++){var o=r[a];if(!Array.isArray(o)||o.rlp){var s=o.name,c=t[s]||o.value||"";if("msg_type"===s)c=Hn[e].request_msg_type;else if("transaction_type"===s)c=Hn[e].transaction_type,e===ee.LocalTransaction&&(c=t.type);else{var i=o.type;o.rlp&&(i="bytes");var u=Dt["input"+i];u&&(c=u(c))}n[a]=c}else n[a]=Vn(e,t,o)}return n}function Yn(e,t){re("RequestProcess ".concat(e),t);var r=Hn[e];if(!r)throw Error(e+" is not api");return Vn(e,t,r.request)}function Jn(e,t){if(be(t)){var r=Dt["output"+e.type];return r?r(t):t.toString("hex")}return t||e.value||""}function Gn(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=t.name,a=t.type,o=r;if(Array.isArray(t)&&e)if("array"===a&&Array.isArray(e)){var s=[];if("one"===t.array_type)e.forEach((function(e){s.push(Jn(t[0],e))}));else if("number"==typeof t.array_type)for(var c=t.slice(0),i=0;e.length>i;i+=2)s.push(Xn([e[i],e[i+1]],c));else e.forEach((function(e){s.push(Xn(e,t))}));var u=n||"arr";o[u]=s}else if(t.rlp){var p=Qe(e);o=Gn(p,t,o)}else n?o[n]=Xn(e,t):o=Xn(e,t,o);else o[n]=Jn(t,e);return o}function Xn(e,t){for(var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=r,a=0;t.length>a;a++){var o=(Array.isArray(e)?e[a]:e)||"",s=t[a];n=Gn(o,s,n)}return n}function Zn(e,t){switch(e){case oe.ACCOUNT:return function(e){return Xn(e,[[Or]])}(t);case oe.CONTRACT:return function(e){return Xn(e,[[Ar]])}(t);case oe.TOPICS:return function(e){return Xn(e,[[[Yt,{name:"data",type:"bytes"}]]])}(t);case oe.BLOCK:return function(e){return Xn(e,[[br]])}(t)}}function $n(e,t,r){var n=e;if(!n)throw Error("aes empty key or iv or tag!");var a=function(e,t){if(!t||!e)throw Error("aes empty key or data!");var r=e,n=t;r=Ae(r),n=Ae(n);var a=0,o=12,s=r.slice(a,o),c=r.slice(a+=12,o+=16),i=r.slice(a+=16,o=r.length),u=P("aes-128-gcm",n,s);return u.setAuthTag(c),"0x"+u.update(i).toString("hex")}((n=Ae(n)).slice(258,n.length),qt(t,r));return Xn(Qe(a),mr)}function ea(e,t,r,n){var a=function(e){return Hn[e].transaction_type}(e);re("[NEW JS SDK] getTxData:",t);var o={type:a,group_id:t.group_id||"0x0000000000000000000000000000000000000000",timestamp:Date.now(),nonce:t.nonce||Et(),period:t.period||100,from:t.from||r.from,to:t.to,value:t.value||0,gas:t.gas||1e10,version:t.tx_version||2,extensions:[],data:t.data};r.sequence&&(o.sequence=r.sequence);var s=t.hash||_e(Me([o.type,o.timestamp,o.nonce,o.period,o.from,o.to,o.value,o.gas,o.group_id,o.version,o.data,o.extensions])),c=Ct(s,n||r.userPrivateKey);return o.hash=s,o.signature=r.isSign?Re(c):"",re("[NEW JS SDK] getTxData return param:",o),o}function ta(e,t,r,n){return{type:t.transaction_type,group_id:e.group_id||"0x0000000000000000000000000000000000000000",timestamp:r,nonce:e.nonce||Et(),period:e.period||100,from:"0x0",to:"0x0",value:e.value||0,gas:e.gas||1e7,version:e.tx_version||2,extensions:[],data:e.data||"0x0",sequence:t.sequence,hash:n,signature:"0x0"}}function ra(e,t){return Yn(e,t)}function na(e,t){return Ue().abi(e,Buffer.from(t))}function aa(e,t){return oa.apply(this,arguments)}function oa(){return(oa=r(t.mark((function e(r,n){var a;return t.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(re("[utils/mychain] getUserInfo"),a=xt(We(r,n),n)){e.next=4;break}throw Error("[utils/mychain] 获取用户信息失败，请检查 account 相关配置");case 4:return e.abrupt("return",a);case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function sa(e){return Ie(e)}function ca(e){var t=e.startsWith("0x")?e.substring(2):e;return Buffer.from(t,"hex")}function ia(e){return ca(e).toString("base64")}function ua(e){return e.startsWith("0x")?e.substring(2):e}[{name:wn,topics:"create_account",request_msg_type:2,response_msg_type:14,transaction_type:0,request:[Jt,[er,mr]],response:[Jt,[tr,Ut]],data:Ar},{name:Cn,topics:"transfer_balance",request_msg_type:3,response_msg_type:15,transaction_type:1,request:[Jt,[er,mr]],response:[Jt,[tr,Ut]],data:[]},{name:qn,topics:"set_recover_key",request_msg_type:4,response_msg_type:16,transaction_type:20,request:[Jt,[er,mr]],response:[Jt,[tr,Ut]],data:[qr]},{name:En,topics:"",request_msg_type:5,response_msg_type:17,transaction_type:21,request:[Jt,[er,mr]],response:[Jt,[tr,Ut]],data:[]},{name:Sn,topics:"",request_msg_type:6,response_msg_type:18,transaction_type:22,request:[Jt,[er,mr]],response:[Jt,[tr,Ut]],data:[Rr,Ir]},{name:Tn,topics:"",request_msg_type:7,response_msg_type:19,transaction_type:23,request:[Jt,[er,mr]],response:[Jt,[tr,Ut]],data:[Rr,Ir]},{name:"FreezeAccount",topics:"",request_msg_type:24,response_msg_type:25,transaction_type:_n,request:[Jt,[er,mr]],response:[Jt,[tr,Ut]],data:[]},{name:"FreezeContract",topics:"",request_msg_type:28,response_msg_type:29,transaction_type:_n,request:[Jt,[er,mr]],response:[Jt,[tr,Ut]],data:[]},{name:"NativeDepositData",request_msg_type:36,response_msg_type:37,transaction_type:40,request:[Jt,[er,mr]],response:[Jt,[tr,Ut]],data:[{name:"payload",type:"bytes"}]},{name:Pn,request_msg_type:51,response_msg_type:58,transaction_type:"",request:[Jt,er],response:[Jt,[tr,xr]],data:[]},{name:Nn,request_msg_type:52,response_msg_type:59,transaction_type:"",request:[Jt,[er,rr,Ut]],response:[Jt,[tr,br]],data:[]},{name:Bn,request_msg_type:66,response_msg_type:67,transaction_type:"",request:[Jt,er],response:[Jt,[tr,br]],data:[]},{name:Rn,request_msg_type:53,response_msg_type:60,transaction_type:"",request:[Jt,[er,rr,Ut]],response:[Jt,[tr,xr]],data:[]},{name:In,request_msg_type:55,response_msg_type:62,transaction_type:"",request:[Jt,[er,Ut]],response:[Jt,[tr,mr,rr,Vt]],data:[]},{name:xn,request_msg_type:56,response_msg_type:63,transaction_type:"",request:[Jt,[er,Ut]],response:[Jt,[tr,or,rr,Vt]],data:[]},{name:"QueryTransactionList",request_msg_type:94,response_msg_type:95,transaction_type:"",request:[Jt,[er,Ut]],response:[Jt,[tr,vr]],data:[]},{name:"QueryTransactionAndReceipt",request_msg_type:96,response_msg_type:97,transaction_type:"",request:[Jt,[er,Ut]],response:[Jt,[tr,gr]],data:[]},{name:Kn,request_msg_type:54,response_msg_type:61,transaction_type:"",request:[Jt,[er,Ut]],response:[Jt,[tr,Ar]],data:[]},{name:An,request_msg_type:64,response_msg_type:65,transaction_type:"",request:[Jt,[er,Ut]],response:[Jt,[tr,Dr]],data:[]},{name:"QueryTimestamp",request_msg_type:50,response_msg_type:57,transaction_type:"",request:[Jt,er],response:[Jt,[tr,jt]],data:[]},{name:"QueryP2PStatus",request_msg_type:100,response_msg_type:101,transaction_type:"",request:[Jt,er,Lr],response:[Jt,[tr,Mr]],data:[]},{name:"QueryConsensusStatus",request_msg_type:102,response_msg_type:103,transaction_type:"",request:[Jt,[er,Lr]],response:[Jt,[tr,rn]],data:[]},{name:"QueryCommonConsensusStatus",request_msg_type:200,response_msg_type:201,transaction_type:"",request:[Jt,[er,Lr]],response:[Jt,[tr,{name:"type",type:"decimal"},{name:"info",type:"bytes"}]],data:[]},{name:"QuerySyncStatus",request_msg_type:104,response_msg_type:105,transaction_type:"",request:[Jt,[er,Lr]],response:[Jt,[tr,Fr]],data:[]},{name:"QueryTransactionCacheStatus",request_msg_type:106,response_msg_type:107,transaction_type:"",request:[Jt,[er,Lr]],response:[Jt,[tr,Xr]],data:[]},{name:"QueryBlockCacheStatus",request_msg_type:108,response_msg_type:109,transaction_type:"",request:[Jt,[er,Lr]],response:[Jt,[tr,Zr]],data:[]},{name:"QueryContractNodesStatus",request_msg_type:110,response_msg_type:111,transaction_type:"",request:[Jt,er],response:[Jt,[tr,Qr]],data:[]},{name:"QueryContractConfigStatus",request_msg_type:112,response_msg_type:113,transaction_type:"",request:[Jt,er],response:[Jt,[tr,Wt]],data:[]},{name:"QueryLogLevel",request_msg_type:152,response_msg_type:153,transaction_type:"",request:[Jt,er],response:[Jt,[tr,{name:"level",type:"decimal"}]],data:[]},{name:"UpdateBlackList",request_msg_type:158,response_msg_type:159,transaction_type:"",request:[Jt,[er,nn,dr]],response:[Jt,tr],data:[]},{name:"QueryBlockProof",request_msg_type:68,response_msg_type:69,transaction_type:"",request:[Jt,[er,rr,Ut]],response:[Jt,[tr,an]],data:[]},{name:"QueryLatestStateProof",request_msg_type:70,response_msg_type:71,transaction_type:"",request:[Jt,[er,Ft]],response:[Jt,[tr,cn]],data:[]},{name:"QueryStateProof",request_msg_type:80,response_msg_type:81,transaction_type:"",request:[Jt,[er,Ft]],response:[Jt,[tr,cn]],data:[]},{name:"QueryTransactionProof",request_msg_type:72,response_msg_type:73,transaction_type:"",request:[Jt,[er,Ut]],response:[Jt,[tr,hn]],data:[]},{name:"QueryReceiptProof",request_msg_type:82,response_msg_type:83,transaction_type:"",request:[Jt,[er,Ut]],response:[Jt,[tr,ln]],data:[]},{name:"QueryBlockHeaderInfos",request_msg_type:74,response_msg_type:75,transaction_type:"",request:[Jt,[er,Ut,rr,{name:"max_amount",type:"decimal"},{name:"reverse",type:"decimal"}]],response:[Jt,[tr,dn]],data:[]},{name:"QueryBlockReceiptInfos",request_msg_type:76,response_msg_type:77,transaction_type:"",request:[Jt,[er,Ut]],response:[Jt,[tr,vn]],data:[]},{name:"QueryBlockBodyInfos",request_msg_type:78,response_msg_type:79,transaction_type:"",request:[Jt,[er,Ut]],response:[Jt,[tr,kn]],data:[]},{name:On,request_msg_type:8,response_msg_type:20,transaction_type:10,request:[Jt,[er,mr]],response:[Jt,[tr,Ut]],data:[$r]},{name:Dn,request_msg_type:10,response_msg_type:22,transaction_type:12,request:[Jt,[er,mr]],response:[Jt,[tr,Ut]],data:[$r]},{name:Ln,request_msg_type:9,response_msg_type:21,transaction_type:11,request:[Jt,[er,mr]],response:[Jt,[tr,Ut]],data:[{name:"parameter",type:"bytes"}]},{name:"EventAccount",request_msg_type:120,response_msg_type:bn,transaction_type:"",request:[Jt,[er,en,Ft]],response:[Jt,[tr,tn]],data:[]},{name:zn,request_msg_type:121,response_msg_type:bn,transaction_type:"",request:[Jt,[er,en,Ft]],response:[Jt,[tr,tn]],data:[]},{name:"EventTopics",request_msg_type:122,response_msg_type:bn,transaction_type:"",request:[Jt,[er,en,[Yt]]],response:[Jt,[tr,tn]],data:[]},{name:"EventBlock",request_msg_type:123,response_msg_type:bn,transaction_type:"",request:[Jt,[er,en,Gt]],response:[Jt,[tr,tn]],data:[]},{name:Wn,request_msg_type:125,response_msg_type:136,transaction_type:"",request:[Jt,[er,tn]],response:[Jt,[tr,{name:"event_type",type:"decimal"},{name:"event_data",type:"bytes"}]],data:[]},{name:"EventCancel",request_msg_type:134,response_msg_type:135,transaction_type:"",request:[Jt,[er,[tn]]],response:[Jt,[$t,Gt,Zt,Xt]],data:[]},{name:"LocalTransaction",request_msg_type:1,response_msg_type:13,request:[Jt,[er,rr,mr]],response:[Jt,[tr,Ut,or]],data:[]},{name:Un,request_msg_type:800,response_msg_type:801,transaction_type:500,request:[Jt,[er,mr]],response:[Jt,[tr,Ut]],data:[{name:"encrypted_tx",type:"bytes"}]}].forEach((function(e){Hn[e.name]=e,jn[e.response_msg_type]=e}));var pa=new k;function fa(e,t){return pa.encode(e,t).slice(2)}function ya(e,t,r){var n,a,o;if(r){re("[RestProvider] parseReceiptReturnOutput methodName:",e),re("[RestProvider] parseReceiptReturnOutput output:",r);var s=null===(n=t.schema)||void 0===n||null===(a=n[e])||void 0===a||null===(o=a.results)||void 0===o?void 0:o[0];if(re("[RestProvider] parseReceiptReturnOutput type:",s),!t||!s)throw Error("[RestProvider] parseReceiptReturnOutput not find abi schema for parse output: ".concat(r));return"function"!=typeof t.fromBuffer?null:t.fromBuffer(s,Buffer.from(r,"hex"))}}function ha(e){return"0x".concat(Buffer.from(e,"base64").toString("hex"))}function la(t,r,n){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:function(e){return e};re("[RestProvider] getTransactionRequest args:",t,r,n);var o=ea(t,e(e({},r),{},{to:Mn(r.to),from:Mn(r.from),data:Fn(t,r.data)[0]||""}),n);re("[RestProvider] getTransactionRequest txData:",o);var s=ra(t,o);re("[RestProvider] getTransactionRequest rlpRawData:",s);var c=C(a(s));return re("[RestProvider] getTransactionRequest rlpData:",c),{txData:o,rlpData:c}}function da(e,t,r){if(!r)return"";var n=t.find((function(t){return t.name===e})),a=function(e,t){return pa.decode(e,ca(t))}((qe(n.outputs)?n.outputs:[]).map((function(e){return e.type})),r);return 1===a.length?a[0]:a}function ma(e,t){if(e.filter((function(e){return!(!0===Ce(e)&&!1===qe(e)&&!1===we(e))})).length!==t.length)throw It()}var va=function(t){c(n,pe);var r=i(n);function n(t,o){return a(this,n),r.call(this,e({contractType:X.solidity},t),o)}return o(n,[{key:"generateDeployCode",value:function(e,t){if(t)throw Error("还未支持参数");return"0x01"+e.toString("utf-8")}},{key:"generateCallCode",value:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],r="",n=JSON.parse(this.abi),a=0;n.length>a;a++){var o=n[a],s=[];qe(o.inputs)&&(s=o.inputs);for(var c=[],i=[],u=0;s.length>u;u++){var p=s[u];c.push(p.type),i.push(p.name)}if("function"===o.type&&o.name===e&&t.length===c.length){var f=Nt(o,c),y="0x"+ke(f).slice(0,8);ma(t,c),r=y+fa(c,t);break}}if(!r)throw Error("未找到对应的方法，请检查方法名和参数是否正确。");return r}},{key:"parseReturnOutput",value:function(e,t){return da(e,JSON.parse(this.abi),t)}}]),n}(),ga=function(){};ga.prototype.encodeParams=function(e,t,r,n){var a="";if(!1===xe(e)||!1===Ce(t)||!1===qe(r))return a;if(!1===Ce(t.schema)||!t.schema[e]||!r)return a;if(!1===Ce(t.schema[e])||!1===Ce(t.schema[e].fields))return a;var o=Object.keys(t.schema[e].fields);if(qe(r)&&o.length!==r.length)return a;var s={},c=0;r&&qe(r)&&o.forEach((function(e){s[e]=r[c],c++}));var i=t.toBuffer(e,s),u=t.toBuffer("string",e),p=t.toBuffer("bytes",i),f=g.concat([u,p]);if(n){var y=new g(4);y.writeUInt32BE(f.length),a=y.toString("hex")+f.toString("hex")}else a=f.toString("hex");return a},ga.prototype.decodeParam=function(e,t,r){return e&&t&&r?!1==("function"==typeof e.fromBuffer)?null:e.fromBuffer(t,r):null};var ka=new ga,_a=function(t){c(n,pe);var r=i(n);function n(t,o){var s;return a(this,n),(s=r.call(this,e({contractType:X.assemblyscript},t),o)).abier=void 0,s.abier=na(t.contractName,s.abi),s}return o(n,[{key:"generateDeployCode",value:function(e,t){if(t)throw Error("还未支持参数");var r=e.toString("hex"),n=function(e){var t=new g(4);return t.writeUInt32BE(e),t.toString("hex")}(r.length/2);return"0x02"+n+r}},{key:"generateCallCode",value:function(e,t){var r="",n=this.abier.schema[e].fields||{},a=[];for(var o in n)a.push({key:o,type:n[o]});return(r=ka.encodeParams(e,this.abier,t||[]))&&(r="0x"+r),r}},{key:"parseReturnOutput",value:function(e,t){var r;if(t){var n=t;0===n.indexOf("0x")&&(n=n.slice(2));var a=null===(r=this.abier.schema[e])||void 0===r?void 0:r.results,o=ka.decodeParam(this.abier,a&&a.length>0&&a[0],Buffer.from(n,"hex"));return 1===o.length?o[0]:o}}}]),n}();function ba(e){return new Promise((function(t){setTimeout((function(){t()}),e)}))}var wa=3e4,xa=[3e4,1e4,5e3,2e3,1e3],Ca=function(e){c(u,O);var n,s=i(u);function u(){return a(this,u),s.apply(this,arguments)}return o(u,[{key:"queryTransactionReceiptWithRetry",value:(n=r(t.mark((function e(r,n){var a,o=arguments;return t.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((a=o.length>2&&void 0!==o[2]?o[2]:xa.length-1)>=0){e.next=6;break}return e.next=4,ba(3e4);case 4:e.next=8;break;case 6:return e.next=8,ba(xa[a]);case 8:return e.prev=8,e.next=11,this.queryTransactionReceipt(r);case 11:case 28:return e.abrupt("return",e.sent);case 14:if(e.prev=14,e.t0=e.catch(8),"404"===e.t0.code||"414"===e.t0.code){e.next=19;break}throw re("code is ".concat(e.t0.code,", stop retry")),e.t0;case 19:if(!n){e.next=24;break}if(Date.now()<=n){e.next=22;break}throw Error("queryTransactionReceipt timeout");case 22:e.next=26;break;case 24:if(0!==a){e.next=26;break}throw Error("queryTransactionReceipt retry times out");case 26:return e.next=28,this.queryTransactionReceiptWithRetry(r,n,a-1);case 29:case"end":return e.stop()}}),e,this,[[8,14]])}))),function(e,t){return n.apply(this,arguments)})}]),u}(),qa={ecdhCurve:"secp256k1:prime256v1"},Ea=function(){function t(e,r){var n=e.host,o=e.port,s=e.clients,c=e.timeout,i=e.cert,u=e.ca,p=e.key,f=e.passphrase,y=e.checkServerIdentity,h=e.sendCallback;a(this,t),this.callback=void 0,this.sendCallback=void 0,this.retryNum=void 0,this.clients=void 0,this.currentClient=void 0,this.host=void 0,this.port=void 0,this.timeout=void 0,this.cert=void 0,this.ca=void 0,this.key=void 0,this.passphrase=void 0,this.checkServerIdentity=void 0,this.socket=void 0,this.callback=r,this.sendCallback=h||"",this.retryNum=0;var l=n,d=o,m=s;l&&d?(Array.isArray(s)||(m=[]),m=[{host:l,port:d}].concat(m)):Array.isArray(s)&&s.length&&(l=s[0].host,d=s[0].port),this.clients=m||[],this.currentClient=0,this.resetConnect({host:n,port:o,timeout:c,cert:i,ca:u,key:p,passphrase:f,checkServerIdentity:y})}return o(t,[{key:"doCallback",value:function(e,t){"function"==typeof this.callback&&this.callback(e,t)}},{key:"setConfig",value:function(e){var t=e.port,r=e.timeout,n=e.cert,a=e.ca,o=e.key,s=e.passphrase,c=e.checkServerIdentity;this.host=e.host||"localhost",this.port=t||"18130",this.timeout=r||3e4,this.cert=n||"",this.ca=a||"",this.key=o||"",this.passphrase=s||"",this.checkServerIdentity=c}},{key:"connect",value:function(){var e=this,t=D.createSecureContext({cert:this.cert,ca:[this.ca],key:this.key,passphrase:this.passphrase,ciphers:"ALL",ecdhCurve:qa.ecdhCurve}),r={host:this.host,port:this.port,secureContext:t,checkServerIdentity:void 0};this.checkServerIdentity||(r.checkServerIdentity=function(){});var n=D.connect(r,(function(){n.authorized?(e.retryNum=0,e.doCallback()):e.doCallback(Kt)}));return n}},{key:"resetConnect",value:function(t){var r=this;this.setConfig(t),this.socket=this.connect();var n=null;this.socket.on("readable",(function(e){if(n||(n=r.socket.read(16)),n){var t=je(n),a=r.socket.read(t-16);if(a){var o=function(e,t){return{total_len:je(e),version:e.readInt16BE(4),magic1:e.readInt8(6),magic2:e.readInt8(7),reserved1:e.readInt32BE(8),reserved2:e.readInt32BE(12),data:Qe(t)}}(n,a);n=null,"function"==typeof r.sendCallback&&r.sendCallback(e,o.data)}}})),this.socket.on("close",(function(){if(4>r.retryNum)r.retryNum++,setTimeout((function(){r.resetConnect(t)}),1e3);else{r.currentClient++;var n=r.clients[r.currentClient];n&&setTimeout((function(){r.retryNum=0,r.resetConnect(e(e({},t),{},{host:n.host,port:n.port}))}),1e3)}})),this.socket.on("error",(function(e){console.error(e)}))}},{key:"send",value:function(e){var t=function(e){var t=Array.isArray(e)?He(e):e,r=16+t.length,n=g.alloc(16);return n.writeInt32BE(r,0),n.writeInt16BE(2,4),n.writeInt8(51,6),n.writeInt8(119,7),n.writeInt32BE(0,8),n.writeInt32BE(0,12),g.concat([n,t],r)}(e);this.socket.write(t,"buffer",(function(){}))}}]),t}(),Sa=function(e,t){return new Ea(e,t)};Sa.setEcdhCurve=function(e){qa.ecdhCurve=e},Sa.setPrime256v1EcdhCurve=function(){this.setEcdhCurve("prime256v1")};var Ta=function(){function n(o,s){var c=this;a(this,n),this.sender=null,this.callbacks={},this.sendCache=[],this.sessionId="",this.callback=null,this.currentSequence=1,this.userPublicKey=void 0,this.userSignature=void 0,this.userPrivateKey=void 0,this.userRecoverPrivateKey=void 0,this.userRecoverPublicKey=void 0,this.options=void 0,this.userKeySeted=!1,this.setUserKey=r(t.mark((function e(){var r,n,a,o,s,i,u;return t.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!c.userKeySeted){e.next=2;break}return e.abrupt("return");case 2:return n=(r=c.options).accountPrivateKey,a=r.accountPrivateKeyPassword,o=r.accountRecoverPrivateKey,s=r.accountRecoverPrivateKeyPassword,e.next=5,aa(n,a);case 5:if(i=e.sent,!o){e.next=12;break}return e.next=9,aa(o,s);case 9:c.userRecoverPrivateKey=Ee((u=e.sent).privateKey),c.userRecoverPublicKey=Ee(u.publicKey);case 12:c.userPublicKey=Ee(i.publicKey||"0x97466f2b32bc3bb76d4741ae51cd1d8578b48d3f1e68da206d47321aec267ce78549b514e4453d74ef11b0cd5e4e4c364effddac8b51bcfc8de80682f952896f"),c.userPrivateKey=Ee(i.privateKey||"0x3ecb44df2159c26e0f995712d4f39b6f6e499b40749b1cf1246c37f9516cb6a4"),c.userKeySeted=!0;case 15:case"end":return e.stop()}}),e)}))),this.sendCallback=function(e,t){var r=function(e){var t=parseInt(e[0],16);e[0]&&be(e[0])&&(t=parseInt(e[0].toString("hex"),16));var r=jn[t];if(!r){if(e[0]&&e[0][0]){var n=Xn(e,Lt);return n.api="Handshake",n}throw Error('msg_type "'+t+'" is not error')}var a=r.name,o=Xn(e,r.response);return o.api=a,o}(t);if(re("[TSL connector] sendCallback get data",r),"Handshake"===r.api){if(c.sessionId=r.session_id||"","function"==typeof c.callback&&(c.callback(e,r),c.callback=null),c.sendCache.length)for(var n=c.sendCache.shift();n;)c._send(n.rlpData),n=c.sendCache.shift()}else{var a=c.callbacks[r.sequence];"function"==typeof a&&a(0!==r.return_code?new se("[TLSConnector] request failed, code: ".concat(r.return_code),r.return_code+"",r):e,r)}},this.getSequence=function(){return c.currentSequence++},this.getBaseData=r(t.mark((function e(){return t.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,c.setUserKey();case 2:return e.abrupt("return",{isSign:void 0===c.options.isSign||c.options.isSign,from:c.options.account,userPrivateKey:c.userPrivateKey,userPublicKey:c.userPublicKey,userRecoverPrivateKey:c.userRecoverPrivateKey,userRecoverPublicKey:c.userRecoverPublicKey});case 3:case"end":return e.stop()}}),e)}))),this._send=function(e){re("[TSL connector] send data",e),c.sender.send(e)},this.handshake=r(t.mark((function e(){var r,n;return t.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return re("[TSL connector] handshake..."),n=void 0===(r=c.options.nonce)?"hello world":r,e.next=4,c.setUserKey();case 4:c.userSignature=Ct(n,c.userPrivateKey),c.sender.send([n,c.userPrivateKey,c.userSignature,0]);case 6:case"end":return e.stop()}}),e)}))),this.callback=s,this.options=o,this.sender=Sa(e(e({},o),{},{sendCallback:this.sendCallback}),(function(e){e&&(console.error(e),s&&s(e)),c.handshake()}))}var s;return o(n,[{key:"send",value:(s=r(t.mark((function e(r,n){var a=this;return t.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,t){a.callbacks[n]=function(r,n){r?t(r):e(n)},a.sessionId?a._send(r):a.sendCache.push({sequence:n+"",rlpData:r})})));case 1:case"end":return e.stop()}}),e)}))),function(e,t){return s.apply(this,arguments)})}]),n}();function Pa(e,t){var r=t.getSequence(),n=Yn(Pn,{sequence:r});return t.send(n,r)}function Na(e,t){var r=t.getSequence(),n=Yn(Nn,{sequence:r,block_number:e.blockNumber||0,hash:e.hash||"0x0"});return t.send(n,r)}function Ba(e,t){var r=t.getSequence(),n=Yn(Bn,{sequence:r});return t.send(n,r)}function Ra(e,t){var r=t.getSequence(),n=Yn(Rn,{sequence:r,block_number:e.blockNumber||0,hash:e.hash||"0x0"});return t.send(n,r)}function Ia(e,t){var r=t.getSequence(),n={sequence:r,group_id:e.groupId||"0x0000000000000000000000000000000000000000",hash:Mn(e.account)},a=Yn(Kn,n);return t.send(a,r)}function Ka(e,t){var r=t.getSequence(),n={sequence:r,group_id:e.groupId||"0x0000000000000000000000000000000000000000",hash:Mn(e.hash)},a=Yn(In,n);return t.send(a,r)}function Aa(e,t){return Oa.apply(this,arguments)}function Oa(){return Oa=r(t.mark((function e(r,n){var a,o,s;return t.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=n.getSequence(),o={sequence:a,group_id:r.groupId||"0x0000000000000000000000000000000000000000",hash:Mn(r.hash)},s=Yn(xn,o),e.next=5,n.send(s,a);case 5:return e.abrupt("return",e.sent);case 7:case"end":return e.stop()}}),e)}))),Oa.apply(this,arguments)}function Da(e,t){var r=t.getSequence(),n={sequence:r,hash:Mn(e.contractName)},a=Yn(An,n);return t.send(a,r)}function La(e,t){return Ua.apply(this,arguments)}function Ua(){return Ua=r(t.mark((function e(r,n){var a,o,s,c,i,u,p,f;return t.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=n.getSequence(),o=Mn(r.from),s=Mn(r.to),e.next=5,n.getBaseData();case 5:return(c=e.sent).sequence=a,i=[],r.authMap.forEach((function(e){i.push(e.authKey),i.push(e.authWeight)})),u={identity:s,recover_key:r.recoveryKey,auth_map:Me(i)},p=ea(wn,{from:o,to:s,data:Me(Fn(wn,u))},c),f=Yn(wn,p),e.next=14,n.send(f,a);case 14:return e.abrupt("return",e.sent);case 16:case"end":return e.stop()}}),e)}))),Ua.apply(this,arguments)}function za(e,t){return Wa.apply(this,arguments)}function Wa(){return Wa=r(t.mark((function e(r,n){var a,o,s,c,i;return t.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=n.getSequence(),o=Mn(r.account),e.next=4,n.getBaseData();case 4:return(s=e.sent).sequence=a,c=ea(Tn,{from:o,to:o,data:Me(Fn(Tn,{auth_key:r.authMap[0].key,auth_weight:100}))},s),i=Yn(Tn,c),e.next=12,n.send(i,a);case 12:return e.abrupt("return",e.sent);case 14:case"end":return e.stop()}}),e)}))),Wa.apply(this,arguments)}function ja(e,t){return Ha.apply(this,arguments)}function Ha(){return Ha=r(t.mark((function e(r,n){var a,o,s,c,i,u,p;return t.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=n.getSequence(),o=r.contract,e.next=4,n.getBaseData();case 4:if((s=e.sent).sequence=a,c=o.generateDeployCode(r.code),i=ea(On,{from:Mn(r.from),to:Mn(o.contractName),data:Fn(On,{code:c})[0]||""},s),u=Yn(On,i),!r.encrypt){e.next=17;break}return p=ta({from:Mn(r.from),to:Mn(o.contractName),data:Fn(Un,{encrypted_tx:St(r.publicKey,u,r.aesKey,i.hash,r.encryptType)})[0]||""},s,i.timestamp,i.hash),e.next=13,n.send(Yn(Un,p),a);case 13:return e.abrupt("return",e.sent);case 17:return e.next=19,n.send(u,a);case 19:return e.abrupt("return",e.sent);case 21:case"end":return e.stop()}}),e)}))),Ha.apply(this,arguments)}function Ma(e,t){return Qa.apply(this,arguments)}function Qa(){return Qa=r(t.mark((function e(r,n){var a,o,s,c,i;return t.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=n.getSequence(),e.next=3,n.getBaseData();case 3:return(o=e.sent).sequence=a,0===(s=r.code).indexOf("0x")&&(s=s.slice(2)),s="0x"+(r.vm===Z.EVM?"01":"02")+s,c=ea(Dn,{from:Mn(r.contractName),to:Mn(r.contractName),data:Fn(Dn,{code:s})[0]||""},o),i=Yn(Dn,c),e.next=13,n.send(i,a);case 13:return e.abrupt("return",e.sent);case 15:case"end":return e.stop()}}),e)}))),Qa.apply(this,arguments)}function Fa(e,t){return Va.apply(this,arguments)}function Va(){return Va=r(t.mark((function e(r,n){var a,o,s,c,i,u,p;return t.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=n.getSequence(),o=r.contract,e.next=4,n.getBaseData();case 4:if((s=e.sent).sequence=a,c=o.generateCallCode(r.methodName,r.args),i=ea(Ln,{from:Mn(r.from),to:Mn(o.contractName),data:Fn(Ln,{parameter:c})[0]||""},s),u=Yn(Ln,i),!r.encrypt){e.next=18;break}return p=ta({to:Mn(o.contractName),data:Fn(Un,{encrypted_tx:St(r.publicKey,u,r.aesKey,i.hash,r.encryptType)})[0]||""},s,i.timestamp,i.hash),e.next=14,n.send(Yn(Un,p),a);case 14:return e.abrupt("return",e.sent);case 18:return e.next=20,n.send(u,a);case 20:return e.abrupt("return",e.sent);case 22:case"end":return e.stop()}}),e)}))),Va.apply(this,arguments)}function Ya(e,t){return Ja.apply(this,arguments)}function Ja(){return Ja=r(t.mark((function e(r,n){var a,o,s,c;return t.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=n.getSequence(),e.next=3,n.getBaseData();case 3:return(o=e.sent).sequence=a,s=ea(Cn,{from:Mn(r.from),to:Mn(r.to),data:"0x0",value:r.value},o),c=Yn(Cn,s),e.next=9,n.send(c,a);case 9:return e.abrupt("return",e.sent);case 10:case"end":return e.stop()}}),e)}))),Ja.apply(this,arguments)}function Ga(e,t){return Xa.apply(this,arguments)}function Xa(){return Xa=r(t.mark((function e(r,n){var a,o,s,c,i;return t.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=Mn(r.account),o=n.getSequence(),e.next=4,n.getBaseData();case 4:return(s=e.sent).sequence=o,c=ea(qn,{from:a,to:a,data:Fn(qn,{recover_key:r.recoverKey})[0]||""},s),i=Yn(qn,c),e.next=10,n.send(i,o);case 10:return e.abrupt("return",e.sent);case 12:case"end":return e.stop()}}),e)}))),Xa.apply(this,arguments)}function Za(e,t){return $a.apply(this,arguments)}function $a(){return $a=r(t.mark((function e(r,n){var a,o,s,c,i;return t.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=Mn(r.account),o=n.getSequence(),e.next=4,n.getBaseData();case 4:if((s=e.sent).userRecoverPrivateKey){e.next=7;break}throw Error("userRecoverPrivateKey is not set");case 7:return s.sequence=o,c=ea(En,{from:a,to:a},s,s.userRecoverPrivateKey),i=Yn(En,c),e.next=12,n.send(i,o);case 12:return e.abrupt("return",e.sent);case 14:case"end":return e.stop()}}),e)}))),$a.apply(this,arguments)}function eo(e,t){return to.apply(this,arguments)}function to(){return to=r(t.mark((function e(r,n){var a,o,s,c,i;return t.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=Mn(r.account),o=n.getSequence(),e.next=4,n.getBaseData();case 4:if((s=e.sent).userRecoverPrivateKey){e.next=7;break}throw Error("userRecoverPrivateKey is not set");case 7:return s.sequence=o,c=ea(Sn,{from:a,to:a,data:Me(Fn(Sn,{auth_key:r.authKey,auth_weight:100}))},s,s.userRecoverPrivateKey),i=Yn(Sn,c),e.next=13,n.send(i,o);case 13:return e.abrupt("return",e.sent);case 15:case"end":return e.stop()}}),e)}))),to.apply(this,arguments)}function ro(e,t){return no.apply(this,arguments)}function no(){return no=r(t.mark((function r(n,a){var o,s,c,i,u;return t.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return o=a.getSequence(),s=Yn(Wn,{sequence:o,filter_id:n.filterId}),t.next=5,a.send(s,o);case 5:if(!(c=t.sent).event_data){t.next=10;break}return i=Ae(c.event_data),u=Qe(i),t.abrupt("return",e(e({},c),{},{event_data:Zn(c.event_type,u)}));case 10:return t.abrupt("return",c);case 11:case"end":return t.stop()}}),r)}))),no.apply(this,arguments)}var ao,oo=function(n){c(X,Ca);var s,u,p,f,y,h,l,d,m,v,g,k,_,b,w,x,C,q,E,S,T,P,N,B,R,I,K,A,O,D,L,U,z,W,j,H,M,Q,F,V,Y,J,G=i(X);function X(){var e,t,r,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return a(this,X),(r=G.call(this)).majorVersion=1,r.config=void 0,r.teeExtraParams=void 0,r.connector=void 0,r.eventsId=[],r.EVENTLOOPTIME=6e3,r.eventTimeout=void 0,r.config=n,r.teeExtraParams={aesKey:null===(e=r.config)||void 0===e?void 0:e.teePassword,encrypt:!0,encryptType:"02",publicKey:null===(t=r.config)||void 0===t?void 0:t.teePublicKey},r.connector=new Ta({host:r.config.host,port:r.config.port,cert:r.config.cert,ca:r.config.ca,passphrase:r.config.privateKeyPassword,key:r.config.privateKey,account:r.config.account,accountPrivateKey:r.config.accountPrivateKey,accountPrivateKeyPassword:r.config.accountPrivateKeyPassword,accountRecoverPrivateKey:r.config.accountRecoverPrivateKey,accountRecoverPrivateKeyPassword:r.config.accountRecoverPrivateKeyPassword}),r}return o(X,[{key:"startEventLoop",value:function(){this.eventTimeout||0===this.eventsId.length||this.fetchEvents()}},{key:"fetchEvents",value:function(){var e=this;this.eventsId.forEach(function(){var n=r(t.mark((function r(n){var a;return t.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,ro({filterId:n},e.connector);case 2:re("get res with event id and res",n,a=t.sent),e.emit(n,a);case 5:case"end":return t.stop()}}),r)})));return function(e){return n.apply(this,arguments)}}()),this.eventTimeout=setTimeout((function(){e.fetchEvents()}),this.EVENTLOOPTIME)}},{key:"watchContractEvent",value:function(e,t,r){var n=this;(function(e,t){var r=t.getSequence(),n={sequence:r,event_type:e.type,identity:Mn(e.contractName)},a=Yn(zn,n);return t.send(a,r)})({contractName:e.contractName,type:oe.CONTRACT},this.connector).then((function(e){var t=e.filter_id;n.on(t,r),n.eventsId.push(t),n.startEventLoop()}))}},{key:"createAccount",value:(J=r(t.mark((function e(r){var n;return t.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,La({from:this.config.account,to:r.newAccountName,recoveryKey:r.recoveryKey,authMap:[{authKey:r.authKey,authWeight:100}]},this.connector);case 2:return n=e.sent,e.next=5,this.queryTransactionReceiptWithRetry({hash:n.hash});case 5:return e.abrupt("return",{txHash:n.hash});case 6:case"end":return e.stop()}}),e,this)}))),function(e){return J.apply(this,arguments)})},{key:"transferBalance",value:(Y=r(t.mark((function e(r){return t.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Ya({from:r.from||this.config.account,to:r.to,value:r.value},this.connector);case 2:return e.abrupt("return",{txHash:e.sent.hash});case 4:case"end":return e.stop()}}),e,this)}))),function(e){return Y.apply(this,arguments)})},{key:"setRecoverkey",value:(V=r(t.mark((function e(r){return t.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Ga({account:r.account||this.config.account,recoverKey:r.recoverKey},this.connector);case 2:return e.abrupt("return",{txHash:e.sent.hash});case 4:case"end":return e.stop()}}),e,this)}))),function(e){return V.apply(this,arguments)})},{key:"preResetPubKey",value:(F=r(t.mark((function e(r){return t.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Za({account:r.account||this.config.account},this.connector);case 2:return e.abrupt("return",{txHash:e.sent.hash});case 4:case"end":return e.stop()}}),e,this)}))),function(e){return F.apply(this,arguments)})},{key:"resetPubKey",value:(Q=r(t.mark((function e(r){return t.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,eo({account:r.account||this.config.account,authKey:r.authKey},this.connector);case 2:return e.abrupt("return",{txHash:e.sent.hash});case 4:case"end":return e.stop()}}),e,this)}))),function(e){return Q.apply(this,arguments)})},{key:"freezeAccount",value:(M=r(t.mark((function e(r){return t.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw Error("Not support yet.");case 1:case"end":return e.stop()}}),e)}))),function(e){return M.apply(this,arguments)})},{key:"freezeContract",value:(H=r(t.mark((function e(r){return t.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw Error("Not support yet.");case 1:case"end":return e.stop()}}),e)}))),function(e){return H.apply(this,arguments)})},{key:"nativeDepositData",value:(j=r(t.mark((function e(r){return t.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw Error("Not support yet.");case 1:case"end":return e.stop()}}),e)}))),function(e){return j.apply(this,arguments)})},{key:"queryLastBlockHeader",value:(W=r(t.mark((function e(){var r;return t.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Ba(0,this.connector);case 2:return e.abrupt("return",{gasUsed:(r=e.sent.block_header).gas_used,hash:r.hash,logBloom:r.log_bloom,number:r.block_number,parentHash:r.parent_hash,receiptRoot:r.receipt_root,stateRoot:r.state_root,timestamp:r.timestamp,transactionRoot:r.transaction_root,version:r.version});case 5:case"end":return e.stop()}}),e,this)}))),function(){return W.apply(this,arguments)})},{key:"queryTransactionList",value:(z=r(t.mark((function e(r){return t.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw Error("Not support yet.");case 1:case"end":return e.stop()}}),e)}))),function(e){return z.apply(this,arguments)})},{key:"queryTransactionAndReceipt",value:(U=r(t.mark((function e(r){return t.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw Error("Not support yet.");case 1:case"end":return e.stop()}}),e)}))),function(e){return U.apply(this,arguments)})},{key:"queryTimestamp",value:(L=r(t.mark((function e(r){return t.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw Error("Not support yet.");case 1:case"end":return e.stop()}}),e)}))),function(e){return L.apply(this,arguments)})},{key:"queryP2PStatus",value:(D=r(t.mark((function e(r){return t.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw Error("Not support yet.");case 1:case"end":return e.stop()}}),e)}))),function(e){return D.apply(this,arguments)})},{key:"queryConsensusStatus",value:(O=r(t.mark((function e(r){return t.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw Error("Not support yet.");case 1:case"end":return e.stop()}}),e)}))),function(e){return O.apply(this,arguments)})},{key:"queryCommonConsensusStatus",value:(A=r(t.mark((function e(r){return t.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw Error("Not support yet.");case 1:case"end":return e.stop()}}),e)}))),function(e){return A.apply(this,arguments)})},{key:"querySyncStatus",value:(K=r(t.mark((function e(r){return t.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw Error("Not support yet.");case 1:case"end":return e.stop()}}),e)}))),function(e){return K.apply(this,arguments)})},{key:"queryTransactionCacheStatus",value:(I=r(t.mark((function e(r){return t.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw Error("Not support yet.");case 1:case"end":return e.stop()}}),e)}))),function(e){return I.apply(this,arguments)})},{key:"queryBlockCacheStatus",value:(R=r(t.mark((function e(r){return t.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw Error("Not support yet.");case 1:case"end":return e.stop()}}),e)}))),function(e){return R.apply(this,arguments)})},{key:"queryContractNodesStatus",value:(B=r(t.mark((function e(r){return t.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw Error("Not support yet.");case 1:case"end":return e.stop()}}),e)}))),function(e){return B.apply(this,arguments)})},{key:"queryContractConfigStatus",value:(N=r(t.mark((function e(r){return t.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw Error("Not support yet.");case 1:case"end":return e.stop()}}),e)}))),function(e){return N.apply(this,arguments)})},{key:"queryLogLevel",value:(P=r(t.mark((function e(r){return t.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw Error("Not support yet.");case 1:case"end":return e.stop()}}),e)}))),function(e){return P.apply(this,arguments)})},{key:"updateBlackList",value:(T=r(t.mark((function e(r){return t.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw Error("Not support yet.");case 1:case"end":return e.stop()}}),e)}))),function(e){return T.apply(this,arguments)})},{key:"queryBlockProof",value:(S=r(t.mark((function e(r){return t.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw Error("Not support yet.");case 1:case"end":return e.stop()}}),e)}))),function(e){return S.apply(this,arguments)})},{key:"queryBlockHeaderProof",value:(E=r(t.mark((function e(r){return t.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw Error("Not support yet.");case 1:case"end":return e.stop()}}),e)}))),function(e){return E.apply(this,arguments)})},{key:"queryStateProof",value:(q=r(t.mark((function e(r){return t.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw Error("Not support yet.");case 1:case"end":return e.stop()}}),e)}))),function(e){return q.apply(this,arguments)})},{key:"queryTransactionProof",value:(C=r(t.mark((function e(r){return t.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw Error("Not support yet.");case 1:case"end":return e.stop()}}),e)}))),function(e){return C.apply(this,arguments)})},{key:"queryReceiptProof",value:(x=r(t.mark((function e(r){return t.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw Error("Not support yet.");case 1:case"end":return e.stop()}}),e)}))),function(e){return x.apply(this,arguments)})},{key:"queryBlockHeaderInfos",value:(w=r(t.mark((function e(r){return t.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw Error("Not support yet.");case 1:case"end":return e.stop()}}),e)}))),function(e){return w.apply(this,arguments)})},{key:"queryBlockReceiptInfos",value:(b=r(t.mark((function e(r){return t.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw Error("Not support yet.");case 1:case"end":return e.stop()}}),e)}))),function(e){return b.apply(this,arguments)})},{key:"queryBlockBodyInfos",value:(_=r(t.mark((function e(r){return t.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw Error("Not support yet.");case 1:case"end":return e.stop()}}),e)}))),function(e){return _.apply(this,arguments)})},{key:"queryAccount",value:(k=r(t.mark((function e(r){return t.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Ia({account:r.account},this.connector).then((function(e){var t,r=e.data;return{address:r.identity,balance:r.balance,encryptionKey:r.encryption_key,recoveryKey:r.recover_key,recoveryTime:r.recover_time,authMap:null===(t=r.auth_map)||void 0===t?void 0:t.map((function(e){return{key:e.auth_key,weight:e.auth_weight}})),status:r.status,version:r.acc_version}})));case 2:case"end":return e.stop()}}),e,this)}))),function(e){return k.apply(this,arguments)})},{key:"updateAuthMap",value:(g=r(t.mark((function e(r){var n;return t.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,za(r,this.connector);case 2:return n=e.sent.hash,e.next=6,this.queryTransactionReceiptWithRetry({hash:n});case 6:return e.abrupt("return",{txHash:n});case 7:case"end":return e.stop()}}),e,this)}))),function(e){return g.apply(this,arguments)})},{key:"queryBlockHeader",value:(v=r(t.mark((function e(r){return t.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Na({blockNumber:r.blockNumber,hash:r.hash},this.connector).then((function(e){var t=e.block_header;return{gasUsed:t.gas_used,hash:t.hash,logBloom:t.log_bloom,number:t.block_number,parentHash:t.parent_hash,receiptRoot:t.receipt_root,stateRoot:t.state_root,timestamp:t.timestamp,transactionRoot:t.transaction_root,version:t.version}})));case 2:case"end":return e.stop()}}),e,this)}))),function(e){return v.apply(this,arguments)})},{key:"queryBlock",value:(m=r(t.mark((function e(r){return t.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Ra({blockNumber:r.blockNumber,hash:r.hash},this.connector).then((function(e){var t=e.block,r=t.block_header,n=t.block_body;return{gasUsed:r.gas_used,hash:r.hash,logBloom:r.log_bloom,number:r.block_number,parentHash:r.parent_hash,receiptRoot:r.receipt_root,stateRoot:r.state_root,timestamp:r.timestamp,transactionRoot:r.transaction_root,version:r.version,transactionList:n.transaction_list,receiptList:n.receipt_list,consensusProof:n.consensus_proof}})));case 2:case"end":return e.stop()}}),e,this)}))),function(e){return m.apply(this,arguments)})},{key:"queryLastBlock",value:(d=r(t.mark((function e(){return t.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Pa(0,this.connector).then((function(e){var t=e.block.block_header;return{gasUsed:t.gas_used,hash:t.hash,logBloom:t.log_bloom,number:t.block_number,parentHash:t.parent_hash,receiptRoot:t.receipt_root,stateRoot:t.state_root,timestamp:t.timestamp,transactionRoot:t.transaction_root,version:t.version}})));case 1:case"end":return e.stop()}}),e,this)}))),function(){return d.apply(this,arguments)})},{key:"queryTransaction",value:(l=r(t.mark((function e(r){var n,a=this;return t.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.tee,e.abrupt("return",Ka({hash:r.hash},this.connector).then((function(e){var t=n?$n(e.transaction.data,a.config.teePassword,e.transaction.hash):e.transaction.data;return{blockNumber:e.block_number,hash:e.transaction.hash,data:t,to:e.transaction.to,from:e.transaction.from}})));case 2:case"end":return e.stop()}}),e,this)}))),function(e){return l.apply(this,arguments)})},{key:"queryTransactionReceipt",value:(h=r(t.mark((function e(r){return t.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Aa({hash:r.hash},this.connector).then((function(e){return{blockNumber:e.block_number,gasUsed:e.receipt.gas_used,output:e.receipt.output,code:e.receipt.result,logs:e.receipt.log_entry.map((function(e){return{from:e.from,to:e.to,logData:e.log_data,topics:e.topics}}))}})));case 1:case"end":return e.stop()}}),e,this)}))),function(e){return h.apply(this,arguments)})},{key:"deployContract",value:(y=r(t.mark((function r(n,a){var o,s;return t.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return o={},a.tee&&Object.assign(o,this.teeExtraParams),t.next=4,ja(e({contract:n,code:a.code,from:this.config.account},o),this.connector);case 4:return s=t.sent.hash,t.next=8,this.queryTransactionReceiptWithRetry({hash:s});case 8:return t.abrupt("return",{txHash:s,teeSecret:a.tee?qt(this.config.teePassword,s).toString("hex"):void 0});case 9:case"end":return t.stop()}}),r,this)}))),function(e,t){return y.apply(this,arguments)})},{key:"updateContract",value:(f=r(t.mark((function e(r,n){var a;return t.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Ma({contractName:r.contractName,code:r.vmType===Z.WASM?"0x".concat(n.code.toString("hex")):n.code.toString("utf-8"),vm:r.vmType},this.connector);case 2:return a=e.sent.hash,e.next=6,this.queryTransactionReceiptWithRetry({hash:a});case 6:return e.abrupt("return",{txHash:a});case 7:case"end":return e.stop()}}),e,this)}))),function(e,t){return f.apply(this,arguments)})},{key:"callContract",value:(p=r(t.mark((function r(n,a){var o,s,c,i,u;return t.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return o={},a.tee&&Object.assign(o,this.teeExtraParams),t.next=4,Fa(e({contract:n,from:this.config.account,args:a.args,methodName:a.methodName},o),this.connector);case 4:return s=t.sent.hash,t.next=8,this.queryTransactionReceiptWithRetry({hash:s},a.timeout?Date.now()+a.timeout:void 0);case 8:return c=t.sent,i=a.tee?Pt(c.output,this.config.teePassword,s):c.output,u=n.parseReturnOutput(a.methodName,ua(i)),t.abrupt("return",{txHash:s,receiptCode:c.code,returnValue:u,teeSecret:a.tee?qt(this.config.teePassword,s).toString("hex"):void 0});case 12:case"end":return t.stop()}}),r,this)}))),function(e,t){return p.apply(this,arguments)})},{key:"queryContract",value:(u=r(t.mark((function e(r){var n;return t.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Da(r,this.connector);case 2:return e.abrupt("return",{code:(n=e.sent).data.code,authMap:n.data.auth_map.map((function(e){return{key:e.auth_key,weight:e.auth_weight}}))});case 4:case"end":return e.stop()}}),e,this)}))),function(e){return u.apply(this,arguments)})},{key:"sign",value:(s=r(t.mark((function e(r){return t.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw Error("暂不支持");case 1:case"end":return e.stop()}}),e)}))),function(e){return s.apply(this,arguments)})}]),X}(),so=function(){var n=r(t.mark((function r(n,a){var o,s,c,i,u,p,f;return t.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(s=void 0===(o=a.method)?"GET":o,i=void 0===(c=a.body)?{}:c,p=void 0===(u=a.headers)?{}:u,"undefined"==typeof fetch){t.next=8;break}return t.next=4,fetch(n,{method:s,body:JSON.stringify(i),headers:e({"Content-Type":"application/json"},p)});case 4:if((f=t.sent).ok){t.next=7;break}throw Error("[utils/fetch] res.ok is false");case 7:return t.abrupt("return",f.json());case 8:return t.next=10,U(n,{method:s,data:i,headers:p});case 10:return t.abrupt("return",t.sent.data);case 12:case"end":return t.stop()}}),r)})));return function(e,t){return n.apply(this,arguments)}}(),co={100:"哈希计算错误",101:"交易指针为空指针",102:"交易的 data 字段不满足类型约束",103:"签名不可用",104:"交易的发送账户余额不足",105:"交易的时间戳所在时间段无效，合约平台会对时间戳做检查，不在特定的时间范围内将被认为不可用",106:"交易的目标账户不包含可用的合约哈希",107:"交易的目标账户为空",108:"创建账户的交易不满足需求",109:"部署合约的交易不满足需求",110:"基本的交易类型需求校验失败",111:"交易类型未知",112:"恢复时间未知",113:"交易被重放",114:"交易的 data 字段太大，超过系统限制",115:"交易消耗的 gas 太大，超过系统限制",116:"交易的提交账户在区块链上不存在，提交账户是交易数据结构中的 from 字段",117:"交易的提交账户为空",118:"交易的提交账户被冻结",119:"交易的提交账户正在恢复中",120:"交易的目标账户在区块链上不存在，目标账户是交易数据结构中的 to 字段",121:"交易的目标账户被冻结",122:"交易的签名权重不足",123:"交易的目标账户已经存在",124:"块指针为空",125:"块的父级不存在",126:"块的父级无效，因为哈希和块号不匹配",127:"块的时间戳不满足单调递增的要求",128:"块的交易根哈希未正确计算",129:"块的交易接收根哈希未正确计算",130:"块的共识证明无效",131:"其他错误",132:"不满足交易的 group id 约束要求",133:"不满足交易的版本约束要求",134:"账户为空",135:"合约为空",136:"验证权限失败",137:"锚数据验证失败",140:"验证预留ID失败",141:"已打开受管理的应用程序合同",142:"更新合同无效",143:"更新合同状态无效",144:"不允许更新数据合同",145:"当前交易的合同代码无效",146:"已打开受管理的系统合约",400:"插件不存在",401:"消息转换失败",402:"本地交易执行失败",403:"无法将交易推送至缓存队列",404:"查询无结果",405:"业务不支持",406:"事件不存在",407:"日志实例不存在",408:"交易验证失败",409:"无节点可转发请求",410:"请求转发超时",411:"响应转发超时",412:"添加群链失败",413:"交易尚未验证",414:"交易已验证，等待执行",415:"节点无法提供服务，可能有两种原因：<br>1. 当前链在指定时间内无法成块；<br>2. 当前链内请求积压超过设定限制",416:"用于根据时间戳查询区块，请求中的时间戳小于创世块的时间戳",417:"转发请求查询无结果，可能是被转发节点处于无法服务状态",418:"注册事件失败，可能是触发事件注册单个 session 事件注册数限制或者节点支持最大事件注册数限制",419:"参数无效",420:"请求权限校验不通过，可能原因有：<br>1. 管理类请求需要校验签名，校验签名不通过；<br>2. 交易内账户涉及黑名单，被节点拒绝",421:"内部错误",422:"故障点不可用",423:"更新故障点案例失败",424:"超出了请求限制",425:"子网不存在",426:"子网不可用",1e3:"世界状态（WS）数据库未初始化",1001:"世界状态中找不到合约的代码哈希",1002:"世界状态中未找到该状态对象",1003:"状态对象（ID）被占用",1004:"指定的状态对象（ID）已删除",1005:"指定的状态对象余额不足",1006:"转账失败",1007:"指定的公钥不存在",1008:"余额溢出",1009:"未知故障",1010:"指定的权重值无效",1012:"发布资产失败",1013:"回收资产失败",2e3:"交易执行无法从交易获取足够的燃料",2001:"交易执行无法在区块链中定位到标识",2002:"负载中的权重值无效",2003:"交易负载无效",2004:"恢复时间无效",2005:"交易执行出现未知错误",3e3:"块不存在",3001:"数据库没有数据",3002:"写入数据库失败",3003:"从数据库读取数据失败",3004:"RLP存储解析失败",3005:"无效的ID",3006:"当前数据库的根目录状态无效",3007:"设置根目录失败",3008:"当前数据库数据丢失",3009:"数据覆盖失败",3010:"当前事件状态为空",3011:"最近块为空",3012:"区块编码无效",3013:"存储快照版本失败",3014:"对象状态初始化失败",3015:"对象状态接收无效",3016:"交易上下文为空",3017:"处理内容为空",3018:"merkle 树初始化失败",3019:"清理所有 merkle 树的缓存失败",3020:"清空所有merkle 树的状态失败",4e3:"超过要求的限制",4001:"创建group ID失败",4002:"获取公私钥失败",4003:"存储有关信息失败",4004:"发送已创建分组账号的交易失败",4005:"发送合约分组交易失败",4006:"获取公钥失败",4007:"公钥匹配出错",4008:"节点信息解码错误",4009:"获取密钥对失败",1e4:"虚拟机一般故障",10001:"错误的指令，包含create/create2/suicide/…",10002:"请调整堆栈",10003:"请调整堆栈",10004:"内存错误",10005:"代码为空",10006:"强制重启",10010:"虚拟机版本无效",10025:"由虚拟机参数不匹配引起的错误",10026:"虚拟机更新合约失败",10100:"虚拟机消耗超出限制",10101:"虚拟机创建失败",10102:"虚拟机参数代码为空",10103:"虚拟机参数代码为空",10200:"燃料不足",10201:"由 revert 指令触发的错误",10202:"由 toUint64 方法触发的错误",10203:"由虚拟机上下文static_call为true引起的错误",10204:"虚拟机方法引起的错误",10300:"获取余额失败",10301:"设置存储失败= 108，一般由存储引起",10302:"获取存储失败，一般由加载引起",10303:"转账失败，一般由evm_call调用方法引起",10304:"获取代码失败，一般由extcodecopy/extcodesize instruction or evm_call调用方法引起",10305:"获取块哈希失败，一般由哈希指令引起",10306:"获取代码哈希失败，由用户不存在引起",10307:"受获取燃料受限，由genesis.json设置",10308:"删除存储失败，原因是客户端收到删除存储结果失败",10309:"帐户被冻结，无法调用",10310:"虚拟机获取交易数据失败",10311:"虚拟机获取交易发送方失败",10312:"虚拟机获取交易交易接收器失败",10313:"虚拟机获取交易时间戳失败",10314:"虚拟机获取交易块索引失败",10315:"虚拟机从min_query_block中获取交易",10316:"交易类型不是TX_NATIVE_DEPOSIT_DATA和TX_RELATED_DEPOSIT_DATA",10317:"虚拟机获取交易存款标志失败",10318:"虚拟机获取恢复密钥失败",10319:"虚拟机获取身份验证映射失败",10350:"获得相关交易失败",10500:"虚拟内部错误",10600:"虚拟机创建动态库失败，可能是由本机合约创建动态库引起的",10601:"虚拟机创建socket失败，可能是由本机合约创建的socket方法引起的",10602:"虚拟机绑定socket失败，可能是由于客户端绑定到mychain时的本机协定引起的",10603:"虚拟机侦听socket失败，可能是由于mychain侦听客户端时的本机协定引起的",10604:"虚拟机响应失败，可能是由本机合同响应将数据发送给客户端造成的",10605:"虚拟机读取数据失败，可能是由于mychian读取客户端数据时的本机协定引起的",10606:"虚拟机执行子进程运行客户端失败",10607:"虚拟机fork进程失败，可能是由fork子进程时的本机合约引起的",10608:"虚拟机写入数据失败，可能是由于mychain将数据写入客户端时的幼稚合同引起的",10620:"虚拟机不支持本机合约，可能是由genesis.json中的native_enable引起的",10622:"虚拟机初始化失败，可能是由本地合约初始化方法引起",10623:"虚拟机不部署失败，可能是由于本地合约code引起部署失败",10700:"vm不支持本机预编译协定，没有使用ENABLE_NATIVE_PRECOMPILE_CONTRACT构建",10701:"虚拟机初始化失败，可能是由本机预编译协定init方法引起的",10702:"虚拟机部署失败，可能是由本机预编译合同部署代码引起的",10703:"虚拟机响应失败，可能是由本机预编译合同响应将数据发送给客户端引起的",10750:"合约 ID 不存在",10751:"数据库 ID 不存在",10752:"没有阅读数据合同的许可",10753:"没有写入数据合同的许可",10754:"没有删除数据合同的许可",10755:"数据协定API的输出是固定的，数据流反序列化输出失败",10756:"之前的schema不存在",10757:"当前的schema不存在",10758:"ACL ID不存在",10760:"数据不存在",10900:"参数格式错误",10901:"JSON/XML 的目标路径不存在",10902:"传入的 handler 参数不存在，检查 property_parse 是否执行成功",10903:"数据类型不匹配，当前使用的方法不能获取目标类型的数据",2e4:"SDK 内部错误",20001:"IPC/网络参数错误：协议族不支持的地址族",20002:"IPC/网络参数错误：该地址已被使用",20003:"IPC/网络参数错误：无法分配请求的地址",20004:"IPC/网络运行出错：套接口已连接",20005:"参数列表太长",20006:"数值参数不在域内",20007:"地址不详",20008:"文件描述符不详",20009:"程序加载错误：消息不详",20010:"管道破损",20011:"IPC/网络运行出错：软件问题导致连接中断",20012:"非阻塞和中断 I/O：操作进行中",20013:"IPC/网络运行出错：连接被拒绝",20014:"连接被对方重设",20015:"跨设备链接",20016:"IPC/网络参数错误：目标地址不得为空",20017:"设备或资源忙",20018:"目录不为空，需重新安排",20019:"执行格式错误",20020:"文件已存在",20021:"文件太大",20022:"IPC/网络运行出错：文件名太长",20023:"网络文件系统：功能未实现",20024:"无主机路由，需重新安排",20025:"程序加载错误：标识已被删除",20026:"程序加载错误：非法字节序列",20027:"ioctl 不适合设备",20028:"系统调用中断",20029:"参数无效",20030:"非法寻求",20031:"输入/输出错误",20032:"此为目录",20033:"IPC/网络参数错误：消息太长",20034:"IPC/网络运行出错：网络故障",20035:"IPC/网络运行出错：重置时网络断开连接",20036:"IPC/网络运行出错：网络无法访问",20037:"IPC/网络运行出错：无缓冲空间",20038:"无子程序",20039:"程序加载错误：已保留",20040:"网络文件系统，无锁可用",20041:"程序加载错误：消息流上无消息",20042:"程序加载错误：无预期类型的消息",20043:"IPC/网络参数错误：协议不可用",20044:"设备空间不足",20045:"程序加载错误：无流资源",20046:"设备未配置",20047:"设备不支持该操作",20048:"该文件或目录不存在",20049:"该程序不存在",20050:"非目录",20051:"IPC/网络参数错误：未在套接口上执行套接口操作",20052:"程序加载错误：非流",20053:"IPC/网络运行出错：套接口未连接",20054:"无法分配内存",20055:"IPC/网络参数错误：不支持该操作",20056:"程序加载错误：操作已取消",20057:"非阻塞和中断 I/O：操作进行中",20058:"操作不允许",20059:"仅当编译 __DARWIN_UNIX03 时该值为离散值，或 KERNE：套接口不支持该操作",20060:"非阻塞和中断 I/O：操作将阻塞",20061:"程序加载错误：之前的 Owner 已去世",20062:"权限不足",20063:"程序加载错误：协议错误",20064:"IPC/网络参数错误：不支持该协议",20065:"只读文件系统",20066:"避免资源死锁",20067:"非阻塞和中断 I/O：资源暂时不可用",20068:"结果太大",20069:"程序加载错误：状态不可恢复",20070:"程序加载错误：流 ioctl 超时",20071:"文本文件忙",20072:"IPC/网络运行出错：运行超时",20073:"系统打开的文件太多",20074:"打开的文件太多",20075:"太多链接",20076:"IPC/网络运行出错：符号链接级别太多",20077:"智能设备错误：值太大导致无法存储在数据类型中",20078:"IPC/网络参数错误：套接口协议类型错误",3e4:"SDK 参数无效",30001:"SDK 私钥无效",30002:"SDK 签名工具验证出错",30003:"SDK 不支持编码",30004:"SDK 获取文件输入流失败",30005:"SDK 查找线程失败",30006:"SDK 字节操作失败",30007:"SDK 转换公钥失败",30008:"SDK 消息编码失败",30009:"SDK 读取客户端配置失败",30010:"SDK 初始化失败",30011:"SDK 连接网络失败",30012:"SDK 解码出错",30013:"SDK 不支持该消息类型",30014:"未做握手",30015:"初始化 SSL 上下文失败",30016:"SDK 正在握手",30017:"SDK 无效的公钥",30018:"邮件已达到最大队列大小",60001:"加密交易解密失败",60002:"加密交易中内嵌的不是明文交易",60003:"待处理的交易非加密交易",60004:"TEE 中不支持 native 类型的合约",60005:"加密交易反序列化失败",60006:"合约账户的状态反序列化失败",60007:"非法访问加密的账户数据",60008:"TEE 内不支持的交易类型",60009:"加密回执中的 log 信息失败",60010:"非法访问加密的合约代码",60011:"加密交易的 hash 和时间戳不合法",60012:"交易回执过大",60013:"TEE 内部错误",60014:"合约代码加密失败",60015:"合约代码解密失败",60016:"合约状态加密失败",60017:"合约状态解密失败",60018:"合约状态反序列化失败",60019:"合约状态序列化失败",60020:"合约账户基本信息解密失败",60021:"合约账户基本信息加密失败",60022:"TEE 中不允许执行明文合约",60023:"TEE 中不允许更新明文合约",60024:"按不存在的方法类型进行查询",60025:"查询时使用的 hash 不存在",60026:"不允许查询",60027:"解密隐私交易回执失败",60028:"对象状态初始化失败",60029:"获取代码状态失败",60030:"删除存储状态失败",60031:"错误的虚拟机类型",60032:"设置代码状态失败",60033:"查询时交易不匹配",60034:"从块获取交易列表失败",60035:"查询时调用虚拟机失败",60036:"查询时不被允许",60037:"查询RLP失败",60038:"更新合约无效",60039:"查询时该方法不支持",60040:"加密交易的期望合约代码哈希值不匹配",60041:"更新存款合同时，获取公钥失败",7e4:"通用错误",70001:"无效的提供者",70002:"无效的密钥类型",70003:"无效的类",70004:"无效的公钥",70005:"无效的私钥",70006:"无效的消息",70007:"无效的纯文本",70008:"无效的密文",70009:"无效的签名",70010:"无效的对称密钥",70011:"无效的文件路径",70012:"无效的密钥文件",70013:"无效的x509",70101:"算法未初始化",70102:"提供者错误",8e4:"注册失败"};!function(e){e.OpenLab="0b06e2744ad341538b7a3b3cc5ad9e57"}(ao||(ao={}));var io=function(){function n(e){a(this,n),this.requestConfig=void 0,this.tokenPromise=void 0,this.requestConfig=e,this.tokenPromise=this.getToken()}var s,c;return o(n,[{key:"getToken",value:(c=r(t.mark((function e(){var r,n,a,o,s,c,i,u,p,f;return t.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=(r=this.requestConfig).accessSecret,o=r.baseUrl,re("[RestRequest] getToken accessId:",n=r.accessId),re("[RestRequest] getToken accessSecret:",a),s=""+Date.now(),c=ze(a,"".concat(n).concat(s)),e.next=7,so("".concat(o,"/api/contract/shakeHand"),{method:"POST",body:{time:s,accessId:n,secret:c}});case 7:if(u=(i=e.sent).code,p=i.data,f=i.message,!i.success||"200"!==u){e.next=15;break}return re("[RestRequest] getToken token:",p),e.abrupt("return",p);case 15:throw Error(f);case 16:case"end":return e.stop()}}),e,this)}))),function(){return c.apply(this,arguments)})},{key:"request",value:(s=r(t.mark((function r(n){var a,o,s,c,i,u,p,f,y,h,l=arguments;return t.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=l.length>1&&void 0!==l[1]?l[1]:{},o=l.length>2&&void 0!==l[2]?l[2]:1,s=this.requestConfig.baseUrl+n,t.next=5,this.tokenPromise;case 5:return c=t.sent,i=a.requestStr?{requestStr:JSON.stringify(a.requestStr)}:{},u=e(e(e({},a),i),{},{token:c}),re("[RestRequest] request url & tokenTimeoutRetryTimes:",s,o),re("[RestRequest] request body:",u),t.next=12,so(s,{method:"POST",body:u});case 12:if(re("[RestRequest] response body:",p=t.sent),!p.success||!("200"===p.code||"0"===p.code&&a.secretKey)){t.next=28;break}if(!/\{.+\}/.test(p.data)){t.next=25;break}return t.prev=16,t.abrupt("return",JSON.parse(p.data));case 20:throw t.prev=20,t.t0=t.catch(16),new se("response parse error, code: ".concat(p.code),p.code);case 23:t.next=26;break;case 25:return t.abrupt("return",p.data);case 26:t.next=39;break;case 28:if("202"!==p.code||0>=o){t.next=34;break}return re("[RestRequest] token timeout, retry get token, tokenTimeoutRetryTimes: ".concat(o)),this.tokenPromise=this.getToken(),t.abrupt("return",this.request(n,a,o-1));case 34:if(f=co[p.code]||p.code,h=p.data,/\{.+\}/.test(p.data))try{(h=JSON.parse(p.data)).output&&(y=""+Buffer.from(h.output,"base64"))}catch(e){}throw y?f="".concat(f," ").concat(y):p.data?f="".concat(f," ").concat(p.data):p.message&&(f="".concat(f," ").concat(p.message)),new se("[RestRequest] request failed, code: ".concat(p.code,", detail: ").concat(f),p.code,h);case 39:case"end":return t.stop()}}),r,this,[[16,20]])}))),function(e){return s.apply(this,arguments)})}]),n}();function uo(e,t){return t.request("/api/contract/chainCallForBiz",e)}function po(e,t){return t.request("/api/contract/chainCall",e)}function fo(e,t){return t.request("/api/contract/chainCall",e)}function yo(e,t){return t.request("/api/contract/chainCall",e)}function ho(e,t){return t.request("/api/contract/chainCall",e)}function lo(e,t){return t.request("/api/contract/chainCall",e)}function mo(e,t){return t.request("/api/contract/chainCall",e)}function vo(e,t){return t.request("/api/contract/chainCallForBiz",e)}function go(e,t){return t.request("/api/contract/chainCall",e)}function ko(e,t){return t.request("/api/contract/chainCall",e)}function _o(e,t){return t.request("/api/contract/chainCall",e)}function bo(e,t){return t.request("/api/contract/chainCallForBiz",e)}function wo(e,t){return t.request("/api/contract/chainCallForBiz",e)}function xo(e,t){return t.request("/api/contract/chainCall",e)}var Co=Object.freeze({__proto__:null,deployContractForBiz:uo,deployContract:po,queryAccount:fo,queryBlockHeader:yo,queryBlock:ho,queryLastBlock:lo,queryTransaction:mo,callContractForBiz:vo,callContract:go,queryContract:ko,queryTransactionReceipt:_o,createAccountForBiz:bo,updateContractForBiz:wo,updateContract:xo});function qo(e){return Buffer.from(e,"base64").toString("hex")}function Eo(e){return"0x".concat(function(e){var t=w.md.sha256.create();return t.update(e),t.digest().toHex()}(e))}var So=function(n){c(Q,Ca);var s,u,p,f,y,h,l,d,m,v,g,k,_,b,w,x,C,q,E,S,T,P,N,B,R,I,K,A,O,D,U,W,j,H,M=i(Q);function Q(e){var t;return a(this,Q),(t=M.call(this)).majorVersion=1,t.config=void 0,t.request=void 0,t.config=e,t.request=new io({baseUrl:t.config.restUrl,accessId:t.config.accessId,accessSecret:t.config.accessSecret}),t}return o(Q,[{key:"getToken",value:function(){return this.request.getToken()}},{key:"generateOrderId",value:function(){return"order_myfish_".concat(this.config.accessId,"_").concat(L())}},{key:"watchContractEvent",value:function(e,t,r){throw Error("Not support yet.")}},{key:"createAccount",value:function(){var e=r(t.mark((function e(){return t.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw Error("托管密钥方式请使用 createAccountWithKms");case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"createAccountWithKms",value:(H=r(t.mark((function e(r){var n;return t.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n="".concat(this.config.tenantId).concat(z()),e.next=3,bo({newAccountId:r.newAccountName,newAccountKmsId:n,method:te.createAccountForBiz,accessId:this.config.accessId,bizid:this.config.bizid,account:this.config.account,tenantid:this.config.tenantId,mykmsKeyId:this.config.kmsId,orderId:this.generateOrderId()},this.request);case 3:return e.abrupt("return",{kmsId:n,authKey:e.sent});case 5:case"end":return e.stop()}}),e,this)}))),function(e){return H.apply(this,arguments)})},{key:"transferBalance",value:function(){var e=r(t.mark((function e(r){return t.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw Error("Not support yet.");case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"setRecoverkey",value:function(){var e=r(t.mark((function e(r){return t.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw Error("Not support yet.");case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"preResetPubKey",value:function(){var e=r(t.mark((function e(r){return t.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw Error("Not support yet.");case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"resetPubKey",value:function(){var e=r(t.mark((function e(r){return t.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw Error("Not support yet.");case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"freezeAccount",value:(j=r(t.mark((function e(r){return t.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw Error("Not support yet.");case 1:case"end":return e.stop()}}),e)}))),function(e){return j.apply(this,arguments)})},{key:"freezeContract",value:(W=r(t.mark((function e(r){return t.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw Error("Not support yet.");case 1:case"end":return e.stop()}}),e)}))),function(e){return W.apply(this,arguments)})},{key:"nativeDepositData",value:(U=r(t.mark((function e(r){return t.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw Error("Not support yet.");case 1:case"end":return e.stop()}}),e)}))),function(e){return U.apply(this,arguments)})},{key:"queryLastBlockHeader",value:(D=r(t.mark((function e(){return t.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw Error("Not support yet.");case 1:case"end":return e.stop()}}),e)}))),function(){return D.apply(this,arguments)})},{key:"queryTransactionList",value:(O=r(t.mark((function e(r){return t.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw Error("Not support yet.");case 1:case"end":return e.stop()}}),e)}))),function(e){return O.apply(this,arguments)})},{key:"queryTransactionAndReceipt",value:(A=r(t.mark((function e(r){return t.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw Error("Not support yet.");case 1:case"end":return e.stop()}}),e)}))),function(e){return A.apply(this,arguments)})},{key:"queryTimestamp",value:(K=r(t.mark((function e(r){return t.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw Error("Not support yet.");case 1:case"end":return e.stop()}}),e)}))),function(e){return K.apply(this,arguments)})},{key:"queryP2PStatus",value:(I=r(t.mark((function e(r){return t.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw Error("Not support yet.");case 1:case"end":return e.stop()}}),e)}))),function(e){return I.apply(this,arguments)})},{key:"queryConsensusStatus",value:(R=r(t.mark((function e(r){return t.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw Error("Not support yet.");case 1:case"end":return e.stop()}}),e)}))),function(e){return R.apply(this,arguments)})},{key:"queryCommonConsensusStatus",value:(B=r(t.mark((function e(r){return t.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw Error("Not support yet.");case 1:case"end":return e.stop()}}),e)}))),function(e){return B.apply(this,arguments)})},{key:"querySyncStatus",value:(N=r(t.mark((function e(r){return t.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw Error("Not support yet.");case 1:case"end":return e.stop()}}),e)}))),function(e){return N.apply(this,arguments)})},{key:"queryTransactionCacheStatus",value:(P=r(t.mark((function e(r){return t.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw Error("Not support yet.");case 1:case"end":return e.stop()}}),e)}))),function(e){return P.apply(this,arguments)})},{key:"queryBlockCacheStatus",value:(T=r(t.mark((function e(r){return t.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw Error("Not support yet.");case 1:case"end":return e.stop()}}),e)}))),function(e){return T.apply(this,arguments)})},{key:"queryContractNodesStatus",value:(S=r(t.mark((function e(r){return t.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw Error("Not support yet.");case 1:case"end":return e.stop()}}),e)}))),function(e){return S.apply(this,arguments)})},{key:"queryContractConfigStatus",value:(E=r(t.mark((function e(r){return t.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw Error("Not support yet.");case 1:case"end":return e.stop()}}),e)}))),function(e){return E.apply(this,arguments)})},{key:"queryLogLevel",value:(q=r(t.mark((function e(r){return t.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw Error("Not support yet.");case 1:case"end":return e.stop()}}),e)}))),function(e){return q.apply(this,arguments)})},{key:"updateBlackList",value:(C=r(t.mark((function e(r){return t.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw Error("Not support yet.");case 1:case"end":return e.stop()}}),e)}))),function(e){return C.apply(this,arguments)})},{key:"queryBlockProof",value:(x=r(t.mark((function e(r){return t.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw Error("Not support yet.");case 1:case"end":return e.stop()}}),e)}))),function(e){return x.apply(this,arguments)})},{key:"queryBlockHeaderProof",value:(w=r(t.mark((function e(r){return t.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw Error("Not support yet.");case 1:case"end":return e.stop()}}),e)}))),function(e){return w.apply(this,arguments)})},{key:"queryStateProof",value:(b=r(t.mark((function e(r){return t.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw Error("Not support yet.");case 1:case"end":return e.stop()}}),e)}))),function(e){return b.apply(this,arguments)})},{key:"queryTransactionProof",value:(_=r(t.mark((function e(r){return t.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw Error("Not support yet.");case 1:case"end":return e.stop()}}),e)}))),function(e){return _.apply(this,arguments)})},{key:"queryReceiptProof",value:(k=r(t.mark((function e(r){return t.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw Error("Not support yet.");case 1:case"end":return e.stop()}}),e)}))),function(e){return k.apply(this,arguments)})},{key:"queryBlockHeaderInfos",value:(g=r(t.mark((function e(r){return t.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw Error("Not support yet.");case 1:case"end":return e.stop()}}),e)}))),function(e){return g.apply(this,arguments)})},{key:"queryBlockReceiptInfos",value:(v=r(t.mark((function e(r){return t.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw Error("Not support yet.");case 1:case"end":return e.stop()}}),e)}))),function(e){return v.apply(this,arguments)})},{key:"queryBlockBodyInfos",value:(m=r(t.mark((function e(r){return t.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw Error("Not support yet.");case 1:case"end":return e.stop()}}),e)}))),function(e){return m.apply(this,arguments)})},{key:"queryAccount",value:(d=r(t.mark((function e(r){var n,a;return t.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.account,e.next=3,fo({method:te.queryAccount,requestStr:{queryAccount:n},bizid:this.config.bizid,accessId:this.config.accessId},this.request);case 3:return e.abrupt("return",{address:(a=e.sent).id,balance:a.balance,encryptionKey:a.encryption_key,recoveryKey:a.recovery_key,recoveryTime:a.recovery_time,authMap:a.auth_map.map((function(e){return{key:e.key,weight:e.value}})),status:a.status,version:a.version});case 5:case"end":return e.stop()}}),e,this)}))),function(e){return d.apply(this,arguments)})},{key:"updateAuthMap",value:function(){var e=r(t.mark((function e(){return t.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw Error("Rest 暂不支持 updateAuthMap");case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"queryBlockHeader",value:(l=r(t.mark((function e(r){var n;return t.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.blockNumber,e.next=3,yo({method:te.queryBlockHeader,requestStr:n,bizid:this.config.bizid,accessId:this.config.accessId},this.request);case 3:return e.abrupt("return",e.sent.block.blockHeader);case 5:case"end":return e.stop()}}),e,this)}))),function(e){return l.apply(this,arguments)})},{key:"queryBlock",value:(h=r(t.mark((function e(r){var n,a;return t.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.blockNumber,e.next=3,ho({method:te.queryBlock,requestStr:n,bizid:this.config.bizid,accessId:this.config.accessId},this.request);case 3:return e.abrupt("return",{gasUsed:(a=e.sent).header.gas_used,hash:a.header.hash,logBloom:a.header.log_bloom,number:a.header.number,parentHash:a.header.parent_hash,receiptRoot:a.header.receipt_root,stateRoot:a.header.state_root,timestamp:a.header.timestamp,transactionRoot:a.header.transaction_root,version:a.header.version,receiptList:a.body.receipt_list,consensusProof:a.body.consensus_proof,transactionList:a.body.transaction_list});case 5:case"end":return e.stop()}}),e,this)}))),function(e){return h.apply(this,arguments)})},{key:"queryLastBlock",value:(y=r(t.mark((function e(){return t.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,lo({method:te.queryLastBlock,bizid:this.config.bizid,accessId:this.config.accessId},this.request);case 2:return e.abrupt("return",e.sent.block.blockHeader);case 4:case"end":return e.stop()}}),e,this)}))),function(){return y.apply(this,arguments)})},{key:"queryTransaction",value:(f=r(t.mark((function e(r){var n,a,o;return t.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.hash,a=r.tee,e.next=3,mo({method:te.queryTransactionFromBlockchain,hash:n,bizid:this.config.bizid,accessId:this.config.accessId,secretKey:a?this.config.teePassword:void 0},this.request);case 3:return e.abrupt("return",{blockNumber:(o=e.sent).blockHeight,hash:"0x".concat(o.hash),data:o.transactionV10.data,from:"0x".concat(o.transactionV10.from),to:"0x".concat(o.transactionV10.to)});case 5:case"end":return e.stop()}}),e,this)}))),function(e){return f.apply(this,arguments)})},{key:"queryTransactionReceipt",value:(p=r(t.mark((function e(r){var n;return t.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,_o({method:te.queryTransactionReceipt,hash:r.hash,bizid:this.config.bizid,accessId:this.config.accessId,secretKey:r.tee?this.config.teePassword:void 0},this.request);case 2:return re("[CloudCryptoRestProvider] queryTransactionReceipt gas used:",(n=e.sent).gasUsed),e.abrupt("return",{blockNumber:n.blockNumber,gasUsed:n.gasUsed,output:qo(n.output),code:n.result,logs:n.logs.map((function(e){return{from:ha(e.from.value),to:ha(e.to.value),logData:qo(e.logData),topics:e.topics}}))});case 5:case"end":return e.stop()}}),e,this)}))),function(e){return p.apply(this,arguments)})},{key:"deployContract",value:function(){var n=r(t.mark((function r(n,a,o){var s,c,i,u,p,f,y;return t.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n.vmType!==Z.WASM){t.next=4;break}s=null===(c=a.code)||void 0===c?void 0:c.toString("base64"),t.next=9;break;case 4:if(n.vmType!==Z.EVM){t.next=8;break}s=null===(i=a.code)||void 0===i?void 0:i.toString("utf-8"),t.next=9;break;case 8:throw Error("[deployContract] vmType must be ".concat(Z.WASM," or ").concat(Z.EVM));case 9:if(u={accessId:this.config.accessId,bizid:this.config.bizid,contractCode:s,account:this.config.account,tenantid:this.config.tenantId,mykmsKeyId:this.config.kmsId,orderId:this.generateOrderId(),contractName:n.contractName,gas:a.gas,secretKey:a.tee?this.config.teePassword:void 0},!o){t.next=16;break}return t.next=13,wo(e(e({},u),{},{method:n.vmType===Z.WASM?te.updateWasmContractForBiz:te.updateSolidityContractForBizAsync}),this.request);case 13:p=t.sent,t.next=19;break;case 16:return t.next=18,uo(e(e({},u),{},{method:n.vmType===Z.WASM?te.deployWasmContractForBiz:te.deploySolidityContractForBizAsync}),this.request);case 18:p=t.sent;case 19:if(f=n.vmType===Z.WASM?p.txData.txHash:p,!a.tee){t.next=24;break}return f=Buffer.from(f.value,"base64").toString("hex"),y=qt(this.config.teePassword,f).toString("hex"),t.abrupt("return",{txHash:f,teeSecret:y});case 24:return t.abrupt("return",{txHash:f});case 25:case"end":return t.stop()}}),r,this)})));return function(e,t,r){return n.apply(this,arguments)}}()},{key:"updateContract",value:function(){var e=r(t.mark((function e(r,n){return t.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.deployContract(r,n,!0));case 1:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"callContract",value:function(){var e=r(t.mark((function e(r,n){var a,o,s,c,i,u,p,f,y,h,l,d,m,v,g,k,_,b,w,x,C;return t.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=n.methodName,s=void 0===(o=n.args)?[]:o,i=void 0===(c=n.argsType)?[]:c,u=n.returnType,p=n.gas,f=n.tee,y=n.local,h=n.timeout,l=r.contractName,d=r.abi,r.vmType!==Z.EVM){e.next=4;break}throw Error("[callContract] Rest 托管密钥方式暂时不支持调用 Solidity 合约");case 4:return e.next=6,vo({methodSignature:"".concat(a,"(").concat(i?i.join(","):"",")"),inputParamListStr:JSON.stringify(s),outTypes:u?'["'.concat(u,'"]'):"[]",method:te.callWasmContractForBizAsync,accessId:this.config.accessId,bizid:this.config.bizid,account:this.config.account,tenantid:this.config.tenantId,mykmsKeyId:this.config.kmsId,orderId:this.generateOrderId(),contractName:l,isLocalTransaction:y,gas:p,secretKey:f?this.config.teePassword:void 0},this.request);case 6:return v="0x".concat(m=e.sent),g=f?qt(this.config.teePassword,v).toString("hex"):"",re("[CloudCryptoRestProvider] callContract txHash:",m),re("[CloudCryptoRestProvider] callContract teeSecret:",g),e.next=13,this.queryTransactionReceiptWithRetry({hash:v,tee:f},h?Date.now()+h:void 0);case 13:return b=(k=e.sent).code,re("[CloudCryptoRestProvider] callContract output:",w=_=k.output),x=na(l,d),f&&_&&(w=Pt(_,this.config.teePassword,m)),C=ya(a,x,w),e.abrupt("return",{returnValue:C,txHash:v,teeSecret:f?g:void 0,receiptCode:b});case 22:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"queryContract",value:(u=r(t.mark((function e(r){return t.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,ko({method:te.queryContract,bizid:this.config.bizid,contractName:r.contractName,accessId:this.config.accessId},this.request);case 2:return e.abrupt("return",{code:e.sent.contract.code});case 4:case"end":return e.stop()}}),e,this)}))),function(e){return u.apply(this,arguments)})},{key:"sign",value:(s=r(t.mark((function e(r){return t.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw Error("暂不支持");case 1:case"end":return e.stop()}}),e)}))),function(e){return s.apply(this,arguments)})}]),Q}(),To=function(n){c(h,So);var s,u,p,f,y=i(h);function h(e){var t;return a(this,h),(t=y.call(this,{bizid:e.bizid,restUrl:e.restUrl,accessId:e.accessId,accessSecret:e.accessSecret})).localConfig=void 0,t.localConfig=e,t}return o(h,[{key:"getBaseData",value:(f=r(t.mark((function e(){var r;return t.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,aa(this.localConfig.accountPrivateKey,this.localConfig.accountPrivateKeyPassword);case 2:return e.abrupt("return",{isSign:!0,from:this.localConfig.account,userPublicKey:(r=e.sent).publicKey,userPrivateKey:r.privateKey});case 4:case"end":return e.stop()}}),e,this)}))),function(){return f.apply(this,arguments)})},{key:"sign",value:(p=r(t.mark((function e(r){return t.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getBaseData();case 2:return e.abrupt("return",{signature:Ct(r.payload,e.sent.userPrivateKey).toString("hex")});case 4:case"end":return e.stop()}}),e,this)}))),function(e){return p.apply(this,arguments)})},{key:"createAccount",value:function(){var e=r(t.mark((function e(){return t.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw Error("Rest 非托管密钥方式暂不支持创建账户");case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"deployContract",value:(u=r(t.mark((function r(n,a,o){var s,c,i,u,p,f,y,h;return t.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.getBaseData();case 2:if(s=t.sent,c=n.generateDeployCode(a.code),i=la(o?ee.updateContract:ee.deployContract,{from:o?n.contractName:s.from,to:n.contractName,gas:a.gas,data:{code:c}},s,(function(e){return e[1]})),u=i.txData,p=i.rlpData,a.tee&&(f=qt(this.localConfig.teePassword,u.hash).toString("hex")),y={accessId:this.config.accessId,bizid:this.config.bizid,hash:u.hash,method:te.deployWasmContract,requestStr:{hash:u.hash,timestamp:u.timestamp,vmTypeEnum:n.vmType,secretKey:a.tee?this.localConfig.teePassword:void 0}},!o){t.next=13;break}return t.next=10,xo(e(e({},y),{},{method:te.updateWasmContract,requestStr:e(e({},y.requestStr),{},{contractName:Eo(n.contractName),contractCode:c,vmType:n.vmType,updateContractRaw:p.toString("base64")})}),this.request);case 10:h=t.sent,t.next=16;break;case 13:return t.next=15,po(e(e({},y),{},{method:te.deployWasmContract,requestStr:e(e({},y.requestStr),{},{deployContractRaw:p.toString("base64")})}),this.request);case 15:h=t.sent;case 16:return t.next=18,this.queryTransactionReceiptWithRetry({hash:u.hash,tee:a.tee});case 18:return t.abrupt("return",{txHash:h,teeSecret:f});case 19:case"end":return t.stop()}}),r,this)}))),function(e,t,r){return u.apply(this,arguments)})},{key:"callContract",value:(s=r(t.mark((function e(r,n){var a,o,s,c,i,u,p,f,y,h,l,d,m,v,g,k,_,b,w,x,C,q;return t.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=n.gas,i=void 0===(c=n.argsType)?[]:c,u=n.local,p=n.tee,f=n.timeout,y=r.contractName,h=r.vmType,l=r.generateCallCode(a=n.methodName,void 0===(o=n.args)?[]:o),e.next=5,this.getBaseData();case 5:if(m=la(ee.callContract,{from:(d=e.sent).from,to:y,gas:s,data:{parameter:l}},d,(function(e){return e[1]})),v=m.txData,g=m.rlpData,p&&(k=qt(this.localConfig.teePassword,v.hash).toString("hex")),h!==Z.WASM){e.next=11;break}return e.next=11,go({accessId:this.config.accessId,bizid:this.config.bizid,hash:v.hash,method:te.callWasmContract,requestStr:{acctId:{data:ia(v.from)},contractId:{data:ia(v.to)},callWasmContractRaw:g.toString("base64"),methodSignature:"".concat(a,"(").concat(i?i.join(","):"",")"),hash:v.hash,timestamp:v.timestamp,nonceV:Date.now(),vmTypeEnum:Z.WASM,isLocalTransaction:u,teePublicKey:p?this.localConfig.teePublicKey:void 0,secretKey:p?this.localConfig.teePassword:void 0}},this.request);case 11:if(h!==Z.EVM){e.next=14;break}return e.next=14,go({accessId:this.config.accessId,bizid:this.config.bizid,hash:v.hash,contractName:y,method:te.callContract,requestStr:{callContractRaw:g.toString("base64"),hash:v.hash,timestamp:v.timestamp,nonceV:Date.now(),vmTypeEnum:Z.EVM}},this.request);case 14:return e.next=16,this.queryTransactionReceiptWithRetry({hash:v.hash,tee:p},f?Date.now()+f:void 0);case 16:return w=(_=e.sent).code,x=b=_.output,p&&b&&(C="0x"+Buffer.from(b,"base64").toString("hex"),x=ia(Pt(C,this.localConfig.teePassword,v.hash))),q=r.parseReturnOutput(a,x),e.abrupt("return",{returnValue:q,txHash:v.hash,teeSecret:p?k:void 0,receiptCode:w});case 23:case"end":return e.stop()}}),e,this)}))),function(e,t){return s.apply(this,arguments)})}]),h}();function Po(e){console.warn("[myfish] WalletProvider.".concat(e," 方法暂不支持 TEE 合约"))}var No=function(n){c(U,Ca);var s,u,p,f,y,h,l,d,m,v,g,k,_,b,w,x,C,q,E,S,T,P,N,B,R,I,K,A,O,D=i(U);function U(e){var t;return a(this,U),(t=D.call(this)).majorVersion=1,t.config=void 0,t.rpcEngine=void 0,t.rpcConnection=void 0,t.state={chainId:"",accounts:[],isConnected:!1},t.config=e,t.initRpcEngine(),t.initState(),t}return o(U,[{key:"initRpcEngine",value:function(){this.rpcEngine=new W,this.rpcConnection=j(),this.rpcEngine.push(this.rpcConnection.middleware),H(this.config.connectionStream,this.rpcConnection.stream,this.config.connectionStream,(function(e){console.error("[WalletProvider] stream disconnect",e)}))}},{key:"initState",value:(O=r(t.mark((function r(){var n;return t.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.request({method:ne.getProviderState});case 2:n=t.sent,this.state=e(e({},this.state),n),this.state.isConnected=!0,re("[WalletProvider] initState:",this.state),this.emit("connect",this.state);case 7:case"end":return t.stop()}}),r,this)}))),function(){return O.apply(this,arguments)})},{key:"request",value:(A=r(t.mark((function e(r){var n,a,o,s,c;return t.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=r.params,re("[WalletProvider] request method:",n=r.method),re("[WalletProvider] request params:",a),e.next=5,this.rpcEngine.handle({jsonrpc:"2.0",id:L(),method:n,params:a});case 5:if(c=(o=e.sent).result,!(s=o.error)){e.next=11;break}throw re("[WalletProvider] request error:",s),s;case 11:return re("[WalletProvider] request result:",c),e.abrupt("return",c);case 13:case"end":return e.stop()}}),e,this)}))),function(e){return A.apply(this,arguments)})},{key:"watchContractEvent",value:function(e,t,r){throw Error("Not support yet.")}},{key:"requestAccounts",value:(K=r(t.mark((function e(){var r;return t.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.request({method:ne.requestAccounts});case 2:return this.state.accounts=r=e.sent,this.emit("accountsChanged",r),e.abrupt("return",r);case 6:case"end":return e.stop()}}),e,this)}))),function(){return K.apply(this,arguments)})},{key:"createAccount",value:function(){var e=r(t.mark((function e(){return t.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw Error("WalletProvider 暂不支持创建账户");case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"transferBalance",value:function(){var e=r(t.mark((function e(r){return t.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw Error("Not support yet.");case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"setRecoverkey",value:function(){var e=r(t.mark((function e(r){return t.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw Error("Not support yet.");case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"preResetPubKey",value:function(){var e=r(t.mark((function e(r){return t.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw Error("Not support yet.");case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"resetPubKey",value:function(){var e=r(t.mark((function e(r){return t.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw Error("Not support yet.");case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"freezeAccount",value:(I=r(t.mark((function e(r){return t.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw Error("Not support yet.");case 1:case"end":return e.stop()}}),e)}))),function(e){return I.apply(this,arguments)})},{key:"freezeContract",value:(R=r(t.mark((function e(r){return t.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw Error("Not support yet.");case 1:case"end":return e.stop()}}),e)}))),function(e){return R.apply(this,arguments)})},{key:"nativeDepositData",value:(B=r(t.mark((function e(r){return t.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw Error("Not support yet.");case 1:case"end":return e.stop()}}),e)}))),function(e){return B.apply(this,arguments)})},{key:"queryLastBlockHeader",value:(N=r(t.mark((function e(){return t.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw Error("Not support yet.");case 1:case"end":return e.stop()}}),e)}))),function(){return N.apply(this,arguments)})},{key:"queryTransactionList",value:(P=r(t.mark((function e(r){return t.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw Error("Not support yet.");case 1:case"end":return e.stop()}}),e)}))),function(e){return P.apply(this,arguments)})},{key:"queryTransactionAndReceipt",value:(T=r(t.mark((function e(r){return t.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw Error("Not support yet.");case 1:case"end":return e.stop()}}),e)}))),function(e){return T.apply(this,arguments)})},{key:"queryTimestamp",value:(S=r(t.mark((function e(r){return t.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw Error("Not support yet.");case 1:case"end":return e.stop()}}),e)}))),function(e){return S.apply(this,arguments)})},{key:"queryP2PStatus",value:(E=r(t.mark((function e(r){return t.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw Error("Not support yet.");case 1:case"end":return e.stop()}}),e)}))),function(e){return E.apply(this,arguments)})},{key:"queryConsensusStatus",value:(q=r(t.mark((function e(r){return t.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw Error("Not support yet.");case 1:case"end":return e.stop()}}),e)}))),function(e){return q.apply(this,arguments)})},{key:"queryCommonConsensusStatus",value:(C=r(t.mark((function e(r){return t.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw Error("Not support yet.");case 1:case"end":return e.stop()}}),e)}))),function(e){return C.apply(this,arguments)})},{key:"querySyncStatus",value:(x=r(t.mark((function e(r){return t.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw Error("Not support yet.");case 1:case"end":return e.stop()}}),e)}))),function(e){return x.apply(this,arguments)})},{key:"queryTransactionCacheStatus",value:(w=r(t.mark((function e(r){return t.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw Error("Not support yet.");case 1:case"end":return e.stop()}}),e)}))),function(e){return w.apply(this,arguments)})},{key:"queryBlockCacheStatus",value:(b=r(t.mark((function e(r){return t.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw Error("Not support yet.");case 1:case"end":return e.stop()}}),e)}))),function(e){return b.apply(this,arguments)})},{key:"queryContractNodesStatus",value:(_=r(t.mark((function e(r){return t.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw Error("Not support yet.");case 1:case"end":return e.stop()}}),e)}))),function(e){return _.apply(this,arguments)})},{key:"queryContractConfigStatus",value:(k=r(t.mark((function e(r){return t.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw Error("Not support yet.");case 1:case"end":return e.stop()}}),e)}))),function(e){return k.apply(this,arguments)})},{key:"queryLogLevel",value:(g=r(t.mark((function e(r){return t.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw Error("Not support yet.");case 1:case"end":return e.stop()}}),e)}))),function(e){return g.apply(this,arguments)})},{key:"updateBlackList",value:(v=r(t.mark((function e(r){return t.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw Error("Not support yet.");case 1:case"end":return e.stop()}}),e)}))),function(e){return v.apply(this,arguments)})},{key:"queryBlockProof",value:(m=r(t.mark((function e(r){return t.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw Error("Not support yet.");case 1:case"end":return e.stop()}}),e)}))),function(e){return m.apply(this,arguments)})},{key:"queryBlockHeaderProof",value:(d=r(t.mark((function e(r){return t.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw Error("Not support yet.");case 1:case"end":return e.stop()}}),e)}))),function(e){return d.apply(this,arguments)})},{key:"queryStateProof",value:(l=r(t.mark((function e(r){return t.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw Error("Not support yet.");case 1:case"end":return e.stop()}}),e)}))),function(e){return l.apply(this,arguments)})},{key:"queryTransactionProof",value:(h=r(t.mark((function e(r){return t.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw Error("Not support yet.");case 1:case"end":return e.stop()}}),e)}))),function(e){return h.apply(this,arguments)})},{key:"queryReceiptProof",value:(y=r(t.mark((function e(r){return t.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw Error("Not support yet.");case 1:case"end":return e.stop()}}),e)}))),function(e){return y.apply(this,arguments)})},{key:"queryBlockHeaderInfos",value:(f=r(t.mark((function e(r){return t.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw Error("Not support yet.");case 1:case"end":return e.stop()}}),e)}))),function(e){return f.apply(this,arguments)})},{key:"queryBlockReceiptInfos",value:(p=r(t.mark((function e(r){return t.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw Error("Not support yet.");case 1:case"end":return e.stop()}}),e)}))),function(e){return p.apply(this,arguments)})},{key:"queryBlockBodyInfos",value:(u=r(t.mark((function e(r){return t.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw Error("Not support yet.");case 1:case"end":return e.stop()}}),e)}))),function(e){return u.apply(this,arguments)})},{key:"updateAuthMap",value:function(){var e=r(t.mark((function e(){return t.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw Error("WalletProvider 暂不支持 updateAuthMap");case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"queryAccount",value:function(e){return this.request({method:ne.queryAccount,params:e})}},{key:"queryBlockHeader",value:function(e){return this.request({method:ne.queryBlockHeader,params:e})}},{key:"queryBlock",value:function(e){return this.request({method:ne.queryBlock,params:e})}},{key:"queryLastBlock",value:function(){return this.request({method:ne.queryLastBlock})}},{key:"queryTransaction",value:function(e){return e.tee&&Po("queryTransaction"),this.request({method:ne.queryTransaction,params:e})}},{key:"queryTransactionReceipt",value:function(e){return e.tee&&Po("queryTransactionReceipt"),this.request({method:ne.queryTransactionReceipt,params:e})}},{key:"deployContract",value:function(t,r){return r.tee&&Po("deployContract"),this.request({method:ne.deployWasmContract,params:e(e({},t),{},{contractName:t.contractName,contractType:t.contractType,abi:t.abi})})}},{key:"updateContract",value:function(){throw Error("wallet provider 暂不支持 updateContract")}},{key:"callContract",value:function(t,r){return(null==r?void 0:r.tee)&&Po("callContract"),this.request({method:t.contractType===X.solidity?ne.callSolidityContract:ne.callWasmContract,params:e(e({methodName:t.methodName,args:t.args},r),{},{contractName:t.contractName,contractType:t.contractType,abi:t.abi})})}},{key:"queryContract",value:function(e){return this.request({method:ne.queryContract,params:e})}},{key:"sign",value:(s=r(t.mark((function e(r){return t.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw Error("暂不支持");case 1:case"end":return e.stop()}}),e)}))),function(e){return s.apply(this,arguments)})}]),U}();export{se as AntchainSDKError,Ca as BaseProvider,ao as ChainIds,oo as ChainProvider,So as CloudCryptoRestProvider,pe as Contract,X as ContractType,oe as EventListenerType,To as LocalCryptoRestProvider,ee as MychainMethods,te as RestMethods,ae as RestMethodsUrlMap,Co as RestServices,va as SolContract,$ as TxType,Z as VmType,ne as WalletMethods,No as WalletProvider,_a as WasmContract,ia as convertHex2Base64,ca as convertHex2Buffer,G as createDebug,re as debug,Pt as decryptAESWithPassword,$n as decryptTXWithAES,co as errorCodeMessages,qt as generateAESKey,na as getAbier,aa as getUserInfo,Y as isChromeBackground,M as isDebug,Q as isDev,F as isElectron,V as isNode,wa as maxQueryTransactionReceiptRetryInterval,We as parsePrivateKeyToAES,xa as queryTransactionReceiptRetryInterval,ua as remove0x,ze as signMessage,sa as toUTF8};
