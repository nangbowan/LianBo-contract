"use strict";var bn=require("bn.js"),randomBytes=require("./randombytes"),Buffer=require("safe-buffer").Buffer;function blind(e){var r=getr(e);return{blinder:r.toRed(bn.mont(e.modulus)).redPow(new bn(e.publicExponent)).fromRed(),unblinder:r.invm(e.modulus)}}function crt(e,r){var n=blind(r),u=r.modulus.byteLength(),o=(bn.mont(r.modulus),new bn(e).mul(n.blinder).umod(r.modulus)),m=o.toRed(bn.mont(r.prime1)),d=o.toRed(bn.mont(r.prime2)),t=r.coefficient,e=r.prime1,o=r.prime2,m=m.redPow(r.exponent1),d=d.redPow(r.exponent2),m=m.fromRed(),d=d.fromRed(),e=m.isub(d).imul(t).umod(e);return e.imul(o),d.iadd(e),new Buffer(d.imul(n.unblinder).umod(r.modulus).toArray(!1,u))}function getr(e){for(var r=e.modulus.byteLength(),n=new bn(randomBytes(r));0<=n.cmp(e.modulus)||!n.umod(e.prime1)||!n.umod(e.prime2);)n=new bn(randomBytes(r));return n}(module.exports=crt).getr=getr;