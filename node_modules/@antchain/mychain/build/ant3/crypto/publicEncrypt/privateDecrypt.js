"use strict";var parseKeys=require("./parse-asn1"),mgf=require("./mgf"),xor=require("./xor"),BN=require("bn.js"),crt=require("./browserify-rsa"),createHash=require("create-hash"),withPublic=require("./withPublic"),Buffer=require("safe-buffer").Buffer;function oaep(r,e){var t=r.modulus.byteLength(),o=createHash("sha256").update(Buffer.alloc(0)).digest(),n=o.length;if(0!==e[0])throw new Error("decryption error");var r=e.slice(1,n+1),e=e.slice(n+1),r=xor(r,mgf(e,n)),i=xor(e,mgf(r,t-n-1));if(compare(o,i.slice(0,n)))throw new Error("decryption error");for(var f=n;0===i[f];)f++;if(1!==i[f++])throw new Error("decryption error");return i.slice(f)}function pkcs1(r,e,t){for(var o=e.slice(0,2),n=2,i=0;0!==e[n++];)if(n>=e.length){i++;break}var f=e.slice(2,n-1);if(("0002"!==o.toString("hex")&&!t||"0001"!==o.toString("hex")&&t)&&i++,f.length<8&&i++,i)throw new Error("decryption error");return e.slice(n)}function compare(r,e){r=Buffer.from(r),e=Buffer.from(e);var t=0,o=r.length;r.length!==e.length&&(t++,o=Math.min(r.length,e.length));for(var n=-1;++n<o;)t+=r[n]^e[n];return t}module.exports=function(r,e,t){var o=r.padding||(t?1:4),n=parseKeys(r),i=n.modulus.byteLength();if(e.length>i||0<=new BN(e).cmp(n.modulus))throw new Error("decryption error");r=t?withPublic(new BN(e),n):crt(e,n),e=Buffer.alloc(i-r.length);if(r=Buffer.concat([e,r],i),4===o)return oaep(n,r);if(1===o)return pkcs1(n,r,t);if(3===o)return r;throw new Error("unknown padding")};