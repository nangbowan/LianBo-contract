"use strict";var parseKeys=require("./parse-asn1"),randomBytes=require("./randombytes"),createHash=require("create-hash"),mgf=require("./mgf"),xor=require("./xor"),BN=require("bn.js"),withPublic=require("./withPublic"),crt=require("./browserify-rsa"),Buffer=require("safe-buffer").Buffer;function oaep(r,e){var o=r.modulus.byteLength(),f=e.length,n=createHash("sha256").update(Buffer.alloc(0)).digest(),u=n.length,t=2*u;if(o-t-2<f)throw new Error("message too long");r=Buffer.alloc(o-f-t-2),f=o-u-1,t=randomBytes(u),f=xor(Buffer.concat([n,r,Buffer.alloc(1,1),e],f),mgf(t,f)),u=xor(t,mgf(f,u));return new BN(Buffer.concat([Buffer.alloc(1),u,f],o))}function pkcs1(r,e,o){var f=e.length,r=r.modulus.byteLength();if(r-11<f)throw new Error("message too long");return f=o?Buffer.alloc(r-f-3,255):nonZero(r-f-3),new BN(Buffer.concat([Buffer.from([0,o?1:2]),f,Buffer.alloc(1),e],r))}function nonZero(r){for(var e,o=Buffer.allocUnsafe(r),f=0,n=randomBytes(2*r),u=0;f<r;)u===n.length&&(n=randomBytes(2*r),u=0),(e=n[u++])&&(o[f++]=e);return o}module.exports=function(r,e,o){var f,n=r.padding||(o?1:4),r=parseKeys(r);if(4===n)f=oaep(r,e);else if(1===n)f=pkcs1(r,e,o);else{if(3!==n)throw new Error("unknown padding");if(0<=(f=new BN(e)).cmp(r.modulus))throw new Error("data too long for modulus")}return(o?crt:withPublic)(f,r)};