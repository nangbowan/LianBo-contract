"use strict";var BN=require("./bn");function ECJPoint(r,e,d){null===r&&null===e&&null===d?(this.x=ECJPoint.one,this.y=ECJPoint.one,this.z=ECJPoint.zero):(this.x=r,this.y=e,this.z=d),this.zOne=this.z===ECJPoint.one}ECJPoint.zero=BN.fromNumber(0),ECJPoint.one=BN.fromNumber(1),ECJPoint.prototype.neg=function(){return this.inf?this:new ECJPoint(this.x,this.y.redNeg(),this.z)},ECJPoint.prototype.add=function(r){if(this.inf)return r;if(r.inf)return this;var e=r.z.redSqr(),d=this.z.redSqr(),t=this.x.redMul(e),i=r.x.redMul(d),u=this.y.redMul(e).redMul(r.z),n=r.y.redMul(d).redMul(this.z),e=t.redSub(i),d=u.redSub(n);if(e.isZero())return d.isZero()?this.dbl():new ECJPoint(null,null,null);i=e.redSqr(),n=t.redMul(i),t=i.redMul(e),i=d.redSqr().redIAdd(t).redISub(n).redISub(n);return new ECJPoint(i,d.redMul(n.redISub(i)).redISub(u.redMul(t)),this.z.redMul(r.z).redMul(e))},ECJPoint.prototype.mixedAdd=function(r){if(this.inf)return r.toECJPoint();if(r.inf)return this;var e=this.z.redSqr(),d=this.x,t=r.x.redMul(e),i=this.y,u=r.y.redMul(e).redMul(this.z),r=d.redSub(t),e=i.redSub(u);if(r.isZero())return e.isZero()?this.dbl():new ECJPoint(null,null,null);t=r.redSqr(),u=d.redMul(t),d=t.redMul(r),t=e.redSqr().redIAdd(d).redISub(u).redISub(u);return new ECJPoint(t,e.redMul(u.redISub(t)).redISub(i.redMul(d)),this.z.redMul(r))},ECJPoint.prototype.dbl=function(){return this.inf?this:(u=this.zOne?(d=this.x.redSqr(),r=(t=this.y.redSqr()).redSqr(),i=(i=this.x.redAdd(t).redSqr().redISub(d).redISub(r)).redIAdd(i),t=(e=d.redAdd(d).redIAdd(d)).redSqr().redISub(i).redISub(i),d=r.redIAdd(r).redIAdd(r).redIAdd(r),e=e.redMul(i.redISub(r=t)).redISub(d),this.y.redAdd(this.y)):(i=this.x.redSqr(),u=(t=this.y.redSqr()).redSqr(),d=(d=this.x.redAdd(t).redSqr().redISub(i).redISub(u)).redIAdd(d),i=(t=i.redAdd(i).redIAdd(i)).redSqr(),u=u.redIAdd(u).redIAdd(u).redIAdd(u),r=i.redISub(d).redISub(d),e=t.redMul(d.redISub(r)).redISub(u),(u=this.y.redMul(this.z)).redIAdd(u)),new ECJPoint(r,e,u));var r,e,d,t,i,u},ECJPoint.prototype.dblp=function(r){if(0===r||this.inf)return this;for(var e=this,d=0;d<r;d++)e=e.dbl();return e},Object.defineProperty(ECJPoint.prototype,"inf",{enumerable:!0,get:function(){return this.z.isZero()}}),module.exports=ECJPoint;