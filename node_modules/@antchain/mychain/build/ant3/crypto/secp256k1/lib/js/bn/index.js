"use strict";var Buffer=require("safe-buffer").Buffer,optimized=require("./optimized");function BN(){this.negative=0,this.words=null,this.length=0}BN.fromNumber=function(t){var r=new BN;return r.words=[67108863&t],r.length=1,r},BN.fromBuffer=function(t){var r=new BN;return r.words=new Array(10),r.words[0]=(3&t[28])<<24|t[29]<<16|t[30]<<8|t[31],r.words[1]=(15&t[25])<<22|t[26]<<14|t[27]<<6|t[28]>>>2,r.words[2]=(63&t[22])<<20|t[23]<<12|t[24]<<4|t[25]>>>4,r.words[3]=(255&t[19])<<18|t[20]<<10|t[21]<<2|t[22]>>>6,r.words[4]=(3&t[15])<<24|t[16]<<16|t[17]<<8|t[18],r.words[5]=(15&t[12])<<22|t[13]<<14|t[14]<<6|t[15]>>>2,r.words[6]=(63&t[9])<<20|t[10]<<12|t[11]<<4|t[12]>>>4,r.words[7]=(255&t[6])<<18|t[7]<<10|t[8]<<2|t[9]>>>6,r.words[8]=(3&t[2])<<24|t[3]<<16|t[4]<<8|t[5],r.words[9]=t[0]<<14|t[1]<<6|t[2]>>>2,r.length=10,r.strip()},BN.prototype.toBuffer=function(){for(var t=this.words,r=this.length;r<10;++r)t[r]=0;return Buffer.from([t[9]>>>14&255,t[9]>>>6&255,(63&t[9])<<2|t[8]>>>24&3,t[8]>>>16&255,t[8]>>>8&255,255&t[8],t[7]>>>18&255,t[7]>>>10&255,t[7]>>>2&255,(3&t[7])<<6|t[6]>>>20&63,t[6]>>>12&255,t[6]>>>4&255,(15&t[6])<<4|t[5]>>>22&15,t[5]>>>14&255,t[5]>>>6&255,(63&t[5])<<2|t[4]>>>24&3,t[4]>>>16&255,t[4]>>>8&255,255&t[4],t[3]>>>18&255,t[3]>>>10&255,t[3]>>>2&255,(3&t[3])<<6|t[2]>>>20&63,t[2]>>>12&255,t[2]>>>4&255,(15&t[2])<<4|t[1]>>>22&15,t[1]>>>14&255,t[1]>>>6&255,(63&t[1])<<2|t[0]>>>24&3,t[0]>>>16&255,t[0]>>>8&255,255&t[0]])},BN.prototype.clone=function(){var t=new BN;t.words=new Array(this.length);for(var r=0;r<this.length;r++)t.words[r]=this.words[r];return t.length=this.length,t.negative=this.negative,t},BN.prototype.strip=function(){for(;1<this.length&&0==(0|this.words[this.length-1]);)this.length--;return this},BN.prototype.normSign=function(){return 1===this.length&&0===this.words[0]&&(this.negative=0),this},BN.prototype.isEven=function(){return 0==(1&this.words[0])},BN.prototype.isOdd=function(){return 1==(1&this.words[0])},BN.prototype.isZero=function(){return 1===this.length&&0===this.words[0]},BN.prototype.ucmp=function(t){if(this.length!==t.length)return this.length>t.length?1:-1;for(var r=this.length-1;0<=r;--r)if(this.words[r]!==t.words[r])return this.words[r]>t.words[r]?1:-1;return 0},BN.prototype.gtOne=function(){return 1<this.length||1<this.words[0]},BN.prototype.isOverflow=function(){return 0<=this.ucmp(BN.n)},BN.prototype.isHigh=function(){return 1===this.ucmp(BN.nh)},BN.prototype.bitLengthGT256=function(){return 10<this.length||10===this.length&&4194303<this.words[9]},BN.prototype.iuaddn=function(t){this.words[0]+=t;for(var r=0;67108863<this.words[r]&&r<this.length;++r)this.words[r]-=67108864,this.words[r+1]+=1;return r===this.length&&(this.words[r]=1,this.length+=1),this},BN.prototype.iadd=function(t){if(this.negative!==t.negative)return 0!==this.negative?(this.negative=0,this.isub(t),this.negative^=1):(t.negative=0,this.isub(t),t.negative=1),this.normSign();for(var r,i=this.length>t.length?(r=this,t):(r=t,this),e=0,s=0;e<i.length;++e){var n=r.words[e]+i.words[e]+s;this.words[e]=67108863&n,s=n>>>26}for(;0!==s&&e<r.length;++e)n=r.words[e]+s,this.words[e]=67108863&n,s=n>>>26;if(this.length=r.length,0!==s)this.words[this.length++]=s;else if(r!==this)for(;e<r.length;++e)this.words[e]=r.words[e];return this},BN.prototype.add=function(t){return this.clone().iadd(t)},BN.prototype.isub=function(t){if(this.negative!==t.negative)return 0!==this.negative?(this.negative=0,this.iadd(t),this.negative=1):(t.negative=0,this.iadd(t),t.negative=1),this.normSign();var r,i=this.ucmp(t);if(0===i)return this.negative=0,this.words[0]=0,this.length=1,this;for(var e=0<i?(r=this,t):(r=t,this),s=0,n=0;s<e.length;++s){var o=r.words[s]-e.words[s]+n,n=o>>26;this.words[s]=67108863&o}for(;0!==n&&s<r.length;++s)n=(o=r.words[s]+n)>>26,this.words[s]=67108863&o;if(0===n&&s<r.length&&r!==this)for(;s<r.length;++s)this.words[s]=r.words[s];return this.length=Math.max(this.length,s),r!==this&&(this.negative^=1),this.strip().normSign()},BN.prototype.sub=function(t){return this.clone().isub(t)},BN.umulTo=function(t,r,i){i.length=t.length+r.length-1;var e=t.words[0]*r.words[0],s=e/67108864|0;i.words[0]=67108863&e;for(var n=1,o=i.length;n<o;n++){for(var h=s>>>26,d=67108863&s,u=Math.max(0,n-t.length+1),f=Math.min(n,r.length-1);u<=f;u++){var l=t.words[n-u]*r.words[u]+d;h+=l/67108864|0,d=67108863&l}i.words[n]=d,s=h}return 0!==s&&(i.words[i.length++]=s),i.strip()},BN.umulTo10x10=Math.imul?optimized.umulTo10x10:BN.umulTo,BN.umulnTo=function(t,r,i){if(0===r)return i.words=[0],i.length=1,i;for(var e=0,s=0;e<t.length;++e){var n=t.words[e]*r+s;i.words[e]=67108863&n,s=n/67108864|0}return 0<s?(i.words[e]=s,i.length=t.length+1):i.length=t.length,i},BN.prototype.umul=function(t){var r=new BN;return r.words=new Array(this.length+t.length),10===this.length&&10===t.length?BN.umulTo10x10(this,t,r):1===this.length?BN.umulnTo(t,this.words[0],r):1===t.length?BN.umulnTo(this,t.words[0],r):BN.umulTo(this,t,r)},BN.prototype.isplit=function(t){t.length=Math.min(this.length,9);for(var r=0;r<t.length;++r)t.words[r]=this.words[r];if(this.length<=9)return this.words[0]=0,this.length=1,this;var i=this.words[9];for(t.words[t.length++]=4194303&i,r=10;r<this.length;++r){var e=this.words[r];this.words[r-10]=(4194303&e)<<4|i>>>22,i=e}return 0===(this.words[r-10]=i>>>=22)&&10<this.length?this.length-=10:this.length-=9,this},BN.prototype.fireduce=function(){return this.isOverflow()&&this.isub(BN.n),this},BN.prototype.ureduce=function(){var t=this.clone().isplit(BN.tmp).umul(BN.nc).iadd(BN.tmp);return(t=t.bitLengthGT256()&&(t=t.isplit(BN.tmp).umul(BN.nc).iadd(BN.tmp)).bitLengthGT256()?t.isplit(BN.tmp).umul(BN.nc).iadd(BN.tmp):t).fireduce()},BN.prototype.ishrn=function(t){for(var r=(1<<t)-1,i=26-t,e=this.length-1,s=0;0<=e;--e){var n=this.words[e];this.words[e]=s<<i|n>>>t,s=n&r}return 1<this.length&&0===this.words[this.length-1]&&--this.length,this},BN.prototype.uinvm=function(){for(var t=this.clone(),r=BN.n.clone(),i=BN.fromNumber(1),e=BN.fromNumber(0),s=BN.fromNumber(0),n=BN.fromNumber(1);t.isEven()&&r.isEven();){for(var o=1,h=1;0==(t.words[0]&h)&&0==(r.words[0]&h)&&o<26;++o,h<<=1);t.ishrn(o),r.ishrn(o)}for(var d=r.clone(),u=t.clone();!t.isZero();){for(var f=0,l=1;0==(t.words[0]&l)&&f<26;++f,l<<=1);if(0<f)for(t.ishrn(f);0<f--;)(i.isOdd()||e.isOdd())&&(i.iadd(d),e.isub(u)),i.ishrn(1),e.ishrn(1);for(var p=0,g=1;0==(r.words[0]&g)&&p<26;++p,g<<=1);if(0<p)for(r.ishrn(p);0<p--;)(s.isOdd()||n.isOdd())&&(s.iadd(d),n.isub(u)),s.ishrn(1),n.ishrn(1);0<=t.ucmp(r)?(t.isub(r),i.isub(s),e.isub(n)):(r.isub(t),s.isub(i),n.isub(e))}if(1!==s.negative)return s.ureduce();s.negative=0;var B=s.ureduce();return B.negative^=1,B.normSign().iadd(BN.n)},BN.prototype.imulK=function(){this.words[this.length]=0,this.words[this.length+1]=0,this.length+=2;for(var t=0,r=0;t<this.length;++t){var i=0|this.words[t];r+=977*i,this.words[t]=67108863&r,r=64*i+(r/67108864|0)}return 0===this.words[this.length-1]&&(--this.length,0===this.words[this.length-1]&&--this.length),this},BN.prototype.redIReduce=function(){this.isplit(BN.tmp).imulK().iadd(BN.tmp),this.bitLengthGT256()&&this.isplit(BN.tmp).imulK().iadd(BN.tmp);var t=this.ucmp(BN.p);return 0===t?(this.words[0]=0,this.length=1):0<t?this.isub(BN.p):this.strip(),this},BN.prototype.redNeg=function(){return this.isZero()?BN.fromNumber(0):BN.p.sub(this)},BN.prototype.redAdd=function(t){return this.clone().redIAdd(t)},BN.prototype.redIAdd=function(t){return this.iadd(t),0<=this.ucmp(BN.p)&&this.isub(BN.p),this},BN.prototype.redIAdd7=function(){return this.iuaddn(7),0<=this.ucmp(BN.p)&&this.isub(BN.p),this},BN.prototype.redSub=function(t){return this.clone().redISub(t)},BN.prototype.redISub=function(t){return this.isub(t),0!==this.negative&&this.iadd(BN.p),this},BN.prototype.redMul=function(t){return this.umul(t).redIReduce()},BN.prototype.redSqr=function(){return this.umul(this).redIReduce()},BN.prototype.redSqrt=function(){if(this.isZero())return this.clone();for(var t=this.redSqr(),r=t.redSqr(),r=r.redSqr().redMul(r),t=r.redMul(t),i=t.redMul(this),e=i,s=0;s<54;++s)e=e.redSqr().redSqr().redSqr().redSqr().redMul(i);for(e=e.redSqr().redSqr().redSqr().redSqr().redMul(t),s=0;s<5;++s)e=e.redSqr().redSqr().redSqr().redSqr().redMul(i);return 0===(e=(e=e.redSqr().redSqr().redSqr().redSqr().redMul(r)).redSqr().redSqr().redSqr().redSqr().redSqr().redSqr().redMul(r)).redSqr().ucmp(this)?e:null},BN.prototype.redInvm=function(){for(var t,r=this.clone(),i=BN.p.clone(),e=BN.fromNumber(1),s=BN.fromNumber(0);r.gtOne()&&i.gtOne();){for(var n=0,o=1;0==(r.words[0]&o)&&n<26;++n,o<<=1);if(0<n)for(r.ishrn(n);0<n--;)e.isOdd()&&e.iadd(BN.p),e.ishrn(1);for(var h=0,d=1;0==(i.words[0]&d)&&h<26;++h,d<<=1);if(0<h)for(i.ishrn(h);0<h--;)s.isOdd()&&s.iadd(BN.p),s.ishrn(1);0<=r.ucmp(i)?(r.isub(i),e.isub(s)):(i.isub(r),s.isub(e))}return 0!==(t=1===r.length&&1===r.words[0]?e:s).negative&&t.iadd(BN.p),0!==t.negative?(t.negative=0,t.redIReduce().redNeg()):t.redIReduce()},BN.prototype.getNAF=function(t){for(var r=[],i=1<<t+1,e=i-1,s=i>>1,n=this.clone();!n.isZero();){for(var o=0,h=1;0==(n.words[0]&h)&&o<26;++o,h<<=1)r.push(0);if(0!==o)n.ishrn(o);else{var d=n.words[0]&e;if(s<=d)r.push(s-d),n.iuaddn(d-s).ishrn(1);else if(r.push(d),n.words[0]-=d,!n.isZero()){for(o=t-1;0<o;--o)r.push(0);n.ishrn(t)}}}return r},BN.prototype.inspect=function(){if(this.isZero())return"0";for(var t=this.toBuffer().toString("hex"),r=0;"0"===t[r];++r);return t.slice(r)},BN.n=BN.fromBuffer(Buffer.from("FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEBAAEDCE6AF48A03BBFD25E8CD0364141","hex")),BN.nh=BN.n.clone().ishrn(1),BN.nc=BN.fromBuffer(Buffer.from("000000000000000000000000000000014551231950B75FC4402DA1732FC9BEBF","hex")),BN.p=BN.fromBuffer(Buffer.from("FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFFC2F","hex")),BN.psn=BN.p.sub(BN.n),BN.tmp=new BN,BN.tmp.words=new Array(10),BN.fromNumber(1).words[3]=0,module.exports=BN;