"use strict";var ZERO_BUF,checkParameters=require("./precondition"),defaultEncoding=require("./default-encoding"),sync=require("./sync"),Buffer=require("safe-buffer").Buffer,subtle=global.crypto&&global.crypto.subtle,toBrowser={sha:"SHA-1","sha-1":"SHA-1",sha1:"SHA-1",sha256:"SHA-256","sha-256":"SHA-256",sha384:"SHA-384","sha-384":"SHA-384","sha-512":"SHA-512",sha512:"SHA-512"},checks=[];function checkNative(e){if(global.process&&!global.process.browser)return Promise.resolve(!1);if(!subtle||!subtle.importKey||!subtle.deriveBits)return Promise.resolve(!1);if(void 0!==checks[e])return checks[e];var r=browserPbkdf2(ZERO_BUF=ZERO_BUF||Buffer.alloc(8),ZERO_BUF,10,128,e).then(function(){return!0}).catch(function(){return!1});return checks[e]=r}function browserPbkdf2(e,r,t,n,o){return subtle.importKey("raw",e,{name:"PBKDF2"},!1,["deriveBits"]).then(function(e){return subtle.deriveBits({name:"PBKDF2",salt:r,iterations:t,hash:{name:o}},e,n<<3)}).then(function(e){return Buffer.from(e)})}function resolvePromise(e,r){e.then(function(e){process.nextTick(function(){r(null,e)})},function(e){process.nextTick(function(){r(e)})})}module.exports=function(r,t,n,o,s,c){"function"==typeof s&&(c=s,s=void 0);var f=toBrowser[(s=s||"sha1").toLowerCase()];if(!f||"function"!=typeof global.Promise)return process.nextTick(function(){var e;try{e=sync(r,t,n,o,s)}catch(e){return c(e)}c(null,e)});if(checkParameters(r,t,n,o),"function"!=typeof c)throw new Error("No callback provided to pbkdf2");Buffer.isBuffer(r)||(r=Buffer.from(r,defaultEncoding)),Buffer.isBuffer(t)||(t=Buffer.from(t,defaultEncoding)),resolvePromise(checkNative(f).then(function(e){return e?browserPbkdf2(r,t,n,o,f):sync(r,t,n,o,s)}),c)};