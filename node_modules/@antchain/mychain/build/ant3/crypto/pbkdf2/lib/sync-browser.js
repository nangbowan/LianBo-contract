"use strict";var md5=require("create-hash/md5"),RIPEMD160=require("ripemd160"),sha=require("sha.js"),checkParameters=require("./precondition"),defaultEncoding=require("./default-encoding"),Buffer=require("safe-buffer").Buffer,ZEROS=Buffer.alloc(128),sizes={md5:16,sha1:20,sha224:28,sha256:32,sha384:48,sha512:64,rmd160:20,ripemd160:20};function Hmac(e,r,s){var a=getDigest(e),f="sha512"===e||"sha384"===e?128:64;r.length>f?r=a(r):r.length<f&&(r=Buffer.concat([r,ZEROS],f));for(var i=Buffer.allocUnsafe(f+sizes[e]),t=Buffer.allocUnsafe(f+sizes[e]),n=0;n<f;n++)i[n]=54^r[n],t[n]=92^r[n];s=Buffer.allocUnsafe(f+s+4);i.copy(s,0,0,f),this.ipad1=s,this.ipad2=i,this.opad=t,this.alg=e,this.blocksize=f,this.hash=a,this.size=sizes[e]}function getDigest(r){return"rmd160"===r||"ripemd160"===r?function(e){return(new RIPEMD160).update(e).digest()}:"md5"===r?md5:function(e){return sha(r).update(e).digest()}}function pbkdf2(e,r,s,a,f){checkParameters(e,r,s,a);var i=new Hmac(f=f||"sha1",e=!Buffer.isBuffer(e)?Buffer.from(e,defaultEncoding):e,(r=!Buffer.isBuffer(r)?Buffer.from(r,defaultEncoding):r).length),t=Buffer.allocUnsafe(a),n=Buffer.allocUnsafe(r.length+4);r.copy(n,0,0,r.length);for(var u=0,h=sizes[f],o=Math.ceil(a/h),c=1;c<=o;c++){n.writeUInt32BE(c,r.length);for(var d=i.run(n,i.ipad1),l=d,p=1;p<s;p++)for(var l=i.run(l,i.ipad2),m=0;m<h;m++)d[m]^=l[m];d.copy(t,u),u+=h}return t}Hmac.prototype.run=function(e,r){return e.copy(r,this.blocksize),this.hash(r).copy(this.opad,this.blocksize),this.hash(this.opad)},module.exports=pbkdf2;