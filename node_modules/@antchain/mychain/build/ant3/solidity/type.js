"use strict";var f=require("./formatters"),SolidityParam=require("./param"),SolidityType=function(t){this._inputFormatter=t.inputFormatter,this._outputFormatter=t.outputFormatter};SolidityType.prototype.isType=function(t){throw"this method should be overrwritten for type "+t},SolidityType.prototype.staticPartLength=function(t){return(this.nestedTypes(t)||["[1]"]).map(function(t){return parseInt(t.slice(1,-1),10)||1}).reduce(function(t,e){return t*e},32)},SolidityType.prototype.isDynamicArray=function(t){t=this.nestedTypes(t);return!!t&&!t[t.length-1].match(/[0-9]{1,}/g)},SolidityType.prototype.isStaticArray=function(t){t=this.nestedTypes(t);return!!t&&!!t[t.length-1].match(/[0-9]{1,}/g)},SolidityType.prototype.staticArrayLength=function(t){t=this.nestedTypes(t);return t?parseInt(t[t.length-1].match(/[0-9]{1,}/g)||1):1},SolidityType.prototype.nestedName=function(t){var e=this.nestedTypes(t);return e?t.substr(0,t.length-e[e.length-1].length):t},SolidityType.prototype.isDynamicType=function(){return!1},SolidityType.prototype.nestedTypes=function(t){return t.match(/(\[[0-9]*\])/g)},SolidityType.prototype.encode=function(n,o){var t,e,r,s=this;return this.isDynamicArray(o)?(t=n.length,e=s.nestedName(o),(r=[]).push(f.formatInputInt(t).encode()),n.forEach(function(t){r.push(s.encode(t,e))}),r):this.isStaticArray(o)?function(){for(var t=s.staticArrayLength(o),e=s.nestedName(o),r=[],i=0;i<t;i++)r.push(s.encode(n[i],e));return r}():this._inputFormatter(n,o).encode()},SolidityType.prototype.decode=function(a,p,u){var t,y=this;if(this.isDynamicArray(u))return function(){for(var t=parseInt("0x"+a.substr(2*p,64)),e=parseInt("0x"+a.substr(2*t,64)),r=t+32,i=y.nestedName(u),t=y.staticPartLength(i),n=32*Math.floor((t+31)/32),o=[],s=0;s<e*n;s+=n)o.push(y.decode(a,r+s,i));return o}();if(this.isStaticArray(u))return function(){for(var t=y.staticArrayLength(u),e=p,r=y.nestedName(u),i=y.staticPartLength(r),n=32*Math.floor((i+31)/32),o=[],s=0;s<t*n;s+=n)o.push(y.decode(a,e+s,r));return o}();if(this.isDynamicType(u))return t=parseInt("0x"+a.substr(2*p,64)),e=parseInt("0x"+a.substr(2*t,64)),e=Math.floor((e+31)/32),e=new SolidityParam(a.substr(2*t,64*(1+e)),0),y._outputFormatter(e,u);var e=this.staticPartLength(u),e=new SolidityParam(a.substr(2*p,2*e));return this._outputFormatter(e,u)},module.exports=SolidityType;